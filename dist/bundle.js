!function(){"use strict";function d(t,e){var i=1<arguments.length&&void 0!==e?e:document;return[].slice.call(i.querySelectorAll(t))}function r(t,e,i,n,r){var o=new PIXI.Texture(t);return o.frame=new PIXI.Rectangle(e,i,n,r),o}function u(t){t.interactive=!0}function i(h){u(h);var l=null,c=null,x=null;h.on("pointerdown",function(t){if(c=t.data,l=h,x=c.getLocalPosition(l),void 0!==h.getDraggableRegion){var e=h.getDraggableRegion(),i=e.x,n=e.y,r=e.width,o=e.height;(x.x<i||x.x>r||x.y<n||x.y>o)&&(l=x=c=null)}}),h.on("pointerup",function(){l=x=c=null}),h.on("pointermove",function(){if(null!==l){var t=c.getLocalPosition(l.parent),e=t.x-x.x,i=t.y-x.y;if(void 0!==h.getDraggingRegion){var n=h.getDraggingRegion(),r=n.x,o=n.y,a=n.width,s=n.height,u=void 0===h.getDraggableRegion?h:h.getDraggableRegion();e<r&&(e=r),e+u.width>a&&(e=a-u.width),i<o&&(i=o),i+u.height>s&&(i=s-u.height)}l.position.x=e,l.position.y=i}})}function _(t,e){return e(t),t}function o(t){return"https://cdn.mili.us/time"+("/assets"+t)}function a(t){return void 0!==N[t]}function n(n,r){return new Promise(function(t){var e=o("/clothing/"+n+".xml"),i=r instanceof se;i?(r.add(e).on("complete",function(){return void 0===ue.getResource(e)?void 0:W[n]=ue.getResource(e).data}),t()):(G.debug("Loading avatar clothing config: "+n),r.add(e).on("complete",function(){W[n]=ue.getResource(e).data,i||t(W[n])}).load())})}function h(n,e){return void 0===Z[n]?a(n)?Promise.resolve(N[n]):Z[n]=new Promise(function(t){var i=o("/clothing/sprite/"+n+".json");e instanceof se?(e.add(i).use(function(t,e){return t.name===i?(N[n]=t.data,void x(n,!0).then(function(){return e()})):e()}),t()):(G.debug("Loading avatar clothing library: "+n),e.add(i).on("complete",function(){N[n]=ue.getResource(i,e).data,Z[n]=void 0,x(n,!0).then(function(){return t(N[n])})}).load())}):Z[n]}function l(t){var e=s().querySelector('action[id="'+t+'"]'),i={};if(null!==e)return e.attributes.forEach(function(t){return i[t.name]=t.value}),i}function s(){return W.actions}function H(){return W.animations}function c(){return W.draworder}function z(){return W.figuredata}function f(){return W.geometry}function M(){return W.partsets}function E(t,e,i){var n=2<arguments.length&&void 0!==i?i:{x:0,y:0};if(void 0===N[t])return null;try{var r=N[t].assets[e];if(void 0===r)return null;var o=new PIXI.Texture(x(t));o.frame=new PIXI.Rectangle(r[0],r[1],r[2],r[3]);var a=new PIXI.Sprite(o);return a.x=n.x-(r[4]+n.x-12),a.y=n.y-(r[5]-n.y/2-6),a}catch(t){return null}}function x(e,t){var i=!!(1<arguments.length&&void 0!==t)&&t;return void 0===N[e]?null:void 0===U[e]?i?new Promise(function(t){U[e]=PIXI.Texture.fromImage("data:image/png;base64,"+N[e].resource),t(U[e])}):U[e]=PIXI.Texture.fromImage("data:image/png;base64,"+N[e].resource):i?Promise.resolve(U[e]):U[e]}function p(t){var e=[];return M().querySelectorAll('activePartSet[id="'+t+'"] activePart').forEach(function(t){return e.push(t.getAttribute("set-type"))}),e}function L(t,e,i,n){if(isNaN(i)||isNaN(n))return{x:0,y:0};var r=H().querySelector('action[id="'+t+'"] offsets frame[id="'+i+'"] directions direction[id="'+n+'"] bodypart[id="'+e+'"]');return null===r?{x:0,y:0}:{x:parseInt(r.getAttribute("dx")),y:parseInt(r.getAttribute("dy"))}}function g(t,e){var i=1<arguments.length&&void 0!==e?e:{};return t=t.replace(/\${(.*?)}/g,function(t,e){return v(e,i)})}function v(t,e,i){var n=2<arguments.length&&void 0!==i?i:void 0,r=t.split("."),o=e,a=!0,s=!1,u=void 0;try{for(var h,l,c=r[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){if(void 0===o[l=h.value])return n;o=o[l]}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}return o}function y(t,e,i){t.beginFill(10000485),t.lineStyle(.5,8618839),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.endFill(),0<i&&(t.beginFill(8618839),t.moveTo(e[1].x,e[1].y),t.lineTo(e[1].x,e[1].y+i),t.lineTo(e[2].x,e[2].y+i),t.lineTo(e[2].x,e[2].y),t.endFill(),t.beginFill(7302985),t.moveTo(e[3].x,e[3].y),t.lineTo(e[3].x,e[3].y+i),t.lineTo(e[2].x,e[2].y+i),t.lineTo(e[2].x,e[2].y),t.endFill())}function m(t,e){return t.row===e.row&&t.column===e.column?void 0:e.row<t.row&&e.column>t.column?1:e.row===t.row&&e.column>t.column?2:e.row>t.row&&e.column>t.column?3:e.row>t.row&&e.column===t.column?4:e.row>t.row&&e.column<t.column?5:e.row===t.row&&e.column<t.column?6:e.row<t.row&&e.column<t.column?7:0}function b(t,e,i){return O(t,e,i)?[0,1,2,3][w(t,e,i).findIndex(function(t){return null!==t})]:null}function k(t,e,i){var n=P(t,e,i),r=w(t,e,i),o=X(r,4),a=o[0],s=o[1];o[2],o[3];return null!==a&&null!==s&&1===T(n-a)&&1===T(n-s)?3:null!==s&&1===T(n-s)?2:null!==a&&1===T(n-a)?4:-1}function w(t,e,i){return[P(t,e-1,i),P(t,e,i-1),P(t,e,i+1),P(t,e+1,i)]}function P(t,e,i){return void 0===t[e]?null:void 0===t[e][i]?null:t[e][i]}function O(t,e,i){return null!==P(t,e,i)&&1===w(t,e,i).filter(function(t){return null!==t}).length}var T=Math.abs,I=Math.round,F=Math.max,V=Math.floor,R=function(t){return function(){var s=t.apply(this,arguments);return new Promise(function(o,a){return function e(t,i){try{var n=s[t](i),r=n.value}catch(t){return void a(t)}return n.done?void o(r):Promise.resolve(r).then(function(t){e("next",t)},function(t){e("throw",t)})}("next")})}},S=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},A=function(){function n(t,e){for(var i,n=0;n<e.length;n++)(i=e[n]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),B=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0===a?void 0:a.call(n)},C=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},j=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},X=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},D=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},G=function(){function t(){S(this,t)}return A(t,null,[{key:"debug",value:function(){}},{key:"error",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).error.apply(t,["[E]"].concat(i))}}]),t}(),e=function(){function e(t){S(this,e),this._parts={},this.parse(t)}return A(e,[{key:"parts",get:function(){return this._parts}}]),A(e,[{key:"hasPartId",value:function(t,e){return!!this.hasPartType(t)&&this._parts[t].id===e}},{key:"hasPartType",value:function(t){return void 0!==this._parts[t]}},{key:"parse",value:function(t){var e=this;(t=(t=(t=t.split(".")).map(function(t){return t.split("-")})).sort(function(t,e){return t[0].localeCompare(e[0])})).forEach(function(t){return e._parts[t[0]]={id:parseInt(t[1]),color:[t[2],t[3]].filter(function(t){return null!==t})}})}},{key:"toString",value:function(){var i=[];return this.parts.forEach(function(t,e){return i.push([e,t.id].concat(D(t.color)).join("-"))}),i.join(".")}}]),e}(),q=function(t){function s(t,e,i){var n=0<arguments.length&&void 0!==t?t:"hd-195-4",r=1<arguments.length&&void 0!==e?e:"vertical",o=2<arguments.length&&void 0!==i?i:"full";S(this,s);var a=j(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return u(a),a.initialBuild=!0,a.canPoof=!1,a.id="avatar-"+window.performance.now(),a.loader=new PIXI.loaders.Loader,a.needsUpdate=!1,a.partContainer=new PIXI.Container,a.addChild(a.partContainer),a._alsoUpdate=[],a._ticker=!1,a._width=0,a._height=0,a._actions=[$],a._frames={},a.avatarSet=o,a.direction=2,a.figure=n,a.geometry=r,a.headDirection=a.direction,a.build(),a.canPoof=!0,a.initialBuild=!1,a}return C(s,t),A(s,[{key:"actions",get:function(){return this._actions}},{key:"avatarSet",get:function(){return this._avatarSet},set:function(t){this._avatarSet=t}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"figure",get:function(){return this._figure},set:function(t){void 0===t||(this._figure=new e(t),!this.initialBuild&&this.build(),this.poof())}},{key:"geometry",get:function(){return this._geometry},set:function(t){this._geometry=t}},{key:"headDirection",get:function(){return this._headDirection},set:function(t){this._headDirection=t}}]),A(s,[{key:"addAction",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._actions[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(r.value.id===t)return}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}void 0===(t=l(t))||(this._actions.pushChain(t).sort(function(t,e){return Y.indexOf(e.id)-Y.indexOf(t.id)}),this._frames[t.id]=0,"true"===t.preventheadturn&&(this._headDirection=this.direction))}},{key:"hasAction",value:function(t){var e=!1,i=!0,n=!1,r=void 0;try{for(var o,a=this._actions[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)o.value.id===t&&(e=!0)}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e}},{key:"removeAction",value:function(e){this.hasAction(e)&&(this._actions=this._actions.filter(function(t){return t.id!==e}).sort(function(t,e){return Y.indexOf(e.id)-Y.indexOf(t.id)}))}},{key:"setPosition",value:function(t,e,i){var n=2<arguments.length&&void 0!==i?i:3;return this.x=t,this.y=e,this.direction=n,this.headDirection=n,this}},{key:"build",value:function(){var e=this;if(!this.isBuilding){this.isBuilding=!0,this.needsUpdate=!0,this.emit("avatar-build",this),this.invalidate();var i=this.getLibraries().filter(function(t){return!a(t)});if(0<i.length){this._loading=!0;!function t(){return 0===i.length?void(e._loading=!1):void h(i.shift(),e.loader).then(t)}()}this.update(),this.isBuilding=!1}}},{key:"decideGeometry",value:function(){var t=f().querySelector('canvas[scale="h"] geometry[id="'+this.geometry+'"]');this._height=parseInt(t.getAttribute("height")),this._width=parseInt(t.getAttribute("width")),"head"===this.geometry&&(this._height=this._width)}},{key:"getActivePartSets",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,i=[];return null===e?i.push.apply(i,D(p("figure"))):i.push.apply(i,D(p(e.activepartset))),i.unique()}},{key:"hasActivePartSet",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o,a=this.actions[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)if(null!==(o=r.value)&&o.activepartset===t)return!0}catch(t){i=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(i)throw n}}return!1}},{key:"getBodyparts",value:function(){var e=[];return d('avatarset[id="'+this.avatarSet+'"] bodypart',f()).forEach(function(t){return e.push(t.getAttribute("id"))}),e}},{key:"getLibraries",value:function(){var n=[];return this._parts.forEach(function(t,i){t.parts.forEach(function(t){var e=W.figuremap.querySelector('part[id="'+t.id+'"][type="'+i+'"]');null===e||null===e.parentNode||(e=e.parentNode,n.push(t.library=e.getAttribute("id").toLowerCase()))})}),n.unique()}},{key:"getRoomOffsets",value:function(){return{x:-this._width/2,y:-104}}},{key:"gatherParts",value:function(){var h=this;this.figure.parts.forEach(function(t,i){var e=z().querySelector('sets > settype[type="'+i+'"]');if(null!==e){var n=e.querySelector('set[id="'+t.id+'"]'),r=n.getElementsByTagName("part"),o="1"===n.getAttribute("colorable"),a=[],s=e.getAttribute("paletteid"),u=n.querySelectorAll("hiddenlayers layer");null!==u&&u.forEach(function(t){return a.push(t.getAttribute("parttype"))}),r.forEach(function(t){var e=t.getAttribute("type");void 0===h._parts[e]&&(h._parts[e]={hiddenlayers:a,parts:[]}),h._parts[e].parts.push({id:parseInt(t.getAttribute("id")),colorable:"1"===t.getAttribute("colorable")&&o,colorindex:parseInt(t.getAttribute("colorindex")),index:parseInt(t.getAttribute("index")),paletteid:s,set:i,type:e})})}})}},{key:"invalidate",value:function(){this._parts={},this._sprites={},this.decideGeometry(),this.gatherParts()}},{key:"poof",value:function(){var i=this;if(this.canPoof){var n=[{sprite:new PIXI.extras.AnimatedSprite([ue.getResource(tt.poof["1_1"]).texture,ue.getResource(tt.poof["1_2"]).texture,ue.getResource(tt.poof["1_3"]).texture,ue.getResource(tt.poof["1_4"]).texture]),x:-4,y:-36},{sprite:new PIXI.extras.AnimatedSprite([ue.getResource(tt.poof["2_1"]).texture,ue.getResource(tt.poof["2_2"]).texture,ue.getResource(tt.poof["2_3"]).texture,ue.getResource(tt.poof["2_4"]).texture]),x:4,y:36},{sprite:new PIXI.extras.AnimatedSprite([ue.getResource(tt.poof["3_1"]).texture,ue.getResource(tt.poof["3_2"]).texture,ue.getResource(tt.poof["3_3"]).texture,ue.getResource(tt.poof["3_4"]).texture]),x:-4,y:16},{sprite:new PIXI.extras.AnimatedSprite([ue.getResource(tt.poof["3_1"]).texture,ue.getResource(tt.poof["3_2"]).texture,ue.getResource(tt.poof["3_3"]).texture,ue.getResource(tt.poof["3_4"]).texture]),x:4,y:-16}],r=this._width/2,o=this._height/2;!function t(e){i.addChild(e.sprite),e.sprite.anchor.set(.5),e.sprite.animationSpeed=.2,e.sprite.loop=!1,e.sprite.hitArea=null,e.sprite.position.x=r+e.x,e.sprite.position.y=o+e.y,e.sprite.play(),setTimeout(function(){return i.removeChild(e.sprite)},330),void 0!==n[0]&&setTimeout(function(){return t(n.shift())},45)}(n.shift())}}},{key:"render",value:function(){var e=this;this.partContainer.cacheAsBitmap=!1,this.alpha=this._loading?.8:1;var t="std";this.hasActivePartSet("handLeft")?t=3<this.direction&&this.direction<7?"rh-up":"lh-up":this.hasActivePartSet("handRightAndHead")&&(t=3<this.direction&&this.direction<7?"lh-up":"rh-up");var i=d('action[id="'+t+'"] direction[id="'+this.direction+'"] partList part',c()).map(function(t){return t.getAttribute("set-type")});for(0===i.length&&(i=d('action[id="std"] direction[id="'+this.direction+'"] partList part',c()).map(function(t){return t.getAttribute("set-type")}));this.partContainer.children[0];)this.partContainer.removeChild(this.partContainer.children[0]);var n=!0,r=!1,o=void 0;try{for(var a,s,u=i[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)s=a.value,void 0!==this._sprites[s]&&this._sprites[s].forEach(function(t){return e.partContainer.addChild(t)})}catch(e){r=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw o}}this.partContainer.cacheAsBitmap=!0}},{key:"update",value:function(){var e=this;this.needsUpdate&&(this.actions.forEach(function(t){return e.updateAction(t)}),this.render())}},{key:"updateAction",value:function(t){var O=this,T=0<arguments.length&&void 0!==t?t:null,I={x:this._width/2,y:this._height/2};if(null!==T){var R=this.getActivePartSets(T),S=++this._frames[T.id]||0,A=[],B=this._loading?null===J?{}:J._parts:this._parts;if(void 0!==B){B.forEach(function(t){return A.push.apply(A,D(t.hiddenlayers))});var e=[];this.getBodyparts().forEach(function(t){return e.push(f().querySelector('type[id="'+O.geometry+'"] bodypart[id="'+t+'"]'))});var i=!0,n=!1,r=void 0;try{for(var o,a=e.sort(K)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var C=o.value,j=C.getAttribute("id"),s=d("item",C).sort(K),u=!0,h=!1,l=void 0;try{for(var X,c=function(){var t,e,i,n,r=X.value,v="head"===j?O.headDirection:O.direction,y=r.getAttribute("id"),m=v,w=y,_=!1,o=(t=y,null!==(e=M().querySelector('partSet part[set-type="'+t+'"]').getAttribute("remove-set-type"))&&""!==e?e:null);null!==o&&A.push(o),3<v&&v<7&&(_=!0,i=y,n=M().querySelector('partSet part[set-type="'+i+'"]').getAttribute("flipped-set-type"),y=null!==n&&""!==n?n:i);var a,s,u,h,l,c,b=(c=["std"],"bd"===(l=y)?c.push("sit","lay","wlk"):"hd"===l?c.push("lsp","lay","spk"):"fa"===l?c.push("lsp","lay"):"ea"===l?c.push("lay"):"ey"===l?c.push("agr","sad","sml","srp","lag","lsp","lay","eyb"):"fc"===l?c.push("agr","blw","sad","spk","srp","sml","lsp","lay"):"hr"===l||"hrb"===l?c.push("lay"):"he"===l?c.push("lay"):"ha"===l?c.push("spk","lay"):"ch"===l?c.push("lay"):"cc"===l?c.push("lay"):"ca"===l?c.push("lay"):"lg"===l?c.push("sit","wlk","lay"):"lh"===l?c.push("respect","sig","wav","wlk","lay"):"ls"===l?c.push("wlk","wav","lay"):"lc"===l?c.push("wlk","wav","lay"):"rh"===l?c.push("drk","crr","wlk","lay","blw"):"rs"===l?c.push("drk","crr","wlk","lay"):"rc"===l?c.push("drk","crr","wlk","lay"):"ri"===l?c.push("crr","drk"):"li"===l?c.push("sig"):"sh"===l&&c.push("sit","wlk","lay"),c),k=(a=T.id,s=y,u=H().querySelectorAll('action[id="'+a+'"] part[set-type="'+s+'"] frame'),h=[],u.forEach(function(t){for(var e=t.hasAttribute("repeats")?parseInt(t.getAttribute("repeats")):1,i=0;i<e;i++)h.push({number:parseInt(t.getAttribute("number")),assetpartdefinition:t.getAttribute("assetpartdefinition")})}),h);if(-1===R.indexOf(w))return"continue";if(void 0===O._sprites[w]&&(O._sprites[w]={}),-1<A.indexOf(y))return"continue";if(void 0===B[w])return"continue";var x=!0,d=!1,f=void 0;try{for(var P,p=function(){var t=P.value;if(O._loading&&"hh_human_body"!==t.library)return"break";var e=parseInt(C.getAttribute("x")),i=parseInt(C.getAttribute("y")),n=!1,r=S%(null===k?1:Object.values(k).length),o=k&&k[r]?k[r].assetpartdefinition:T.assetpartdefinition;-1===b.indexOf(o)&&(o=b[0]),v="head"===j?O.headDirection:O.direction,r=k&&k[r]?k[r].number:0;var a,s,u,h=L(T.id,j,S%(a=T.id,s=H().querySelectorAll('action[id="'+a+'"] part:first-child frame').length,u=H().querySelectorAll('action[id="'+a+'"] offsets frame').length,F(s,u)),v),l=function(){return"h_"+o+"_"+y+"_"+t.id+"_"+v+"_"+r},c=E(t.library,l(),I);if(null===c){var x=r;r=0,c=E(t.library,l(),I),r=x}if(null===c&&(v=6-v,n=3<m&&m<7,c=E(t.library,l(),I)),null===c){var d=o;o="std",c=E(t.library,l(),I),o=d}if(null===c)return"break";if(_?(c.x-=e+h.x,c.y-=i+h.y):(c.x+=e+h.x,c.y+=i+h.y),n&&(c.scale.x=-1,c.x=O._width-c.width-c.x+c.width+h.x),c.x=V(c.x),c.y=V(c.y),t.colorable&&"ey"!==y&&!O._loading){var f=O.figure.parts[t.set].color,p=f[t.colorindex-1]||f[0],g=z().querySelector('palette[id="'+t.paletteid+'"] color[id="'+p+'"]');null!==g&&(c.tint=parseInt("0x"+g.textContent))}void 0!==O._sprites[w][t.index]&&O._sprites[w][t.index].destroy(!1),O._sprites[w][t.index]=c},g=B[w].parts[Symbol.iterator]();!(x=(P=g.next()).done)&&"break"!==p();x=!0);}catch(t){d=!0,f=t}finally{try{!x&&g.return&&g.return()}finally{if(d)throw f}}},x=s[Symbol.iterator]();!(u=(X=x.next()).done);u=!0)c()}catch(O){h=!0,l=O}finally{try{!u&&x.return&&x.return()}finally{if(h)throw l}}}}catch(O){n=!0,r=O}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}}}},{key:"destroy",value:function(){ue.getManager(et).removeAvatar(this)}}]),s}(PIXI.Container),W={},N={},U={},Z={},Y=null,$=null,J=null,K=function(t,e){return e.getAttribute("z")-t.getAttribute("z")},Q=function(){function t(){S(this,t),this._name=this.constructor.name}return A(t,[{key:"display",get:function(){return ue.display}},{key:"loader",get:function(){return ue.loader}},{key:"name",get:function(){return this._name}},{key:"stage",get:function(){return ue.stage}}]),A(t,[{key:"initialize",value:(e=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:G.debug("Initializing manager: "+this.name);case 1:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"dispose",value:function(){}},{key:"log",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).log.apply(t,[this.name].concat(i))}},{key:"logDebug",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).debug.apply(t,[this.name].concat(i))}},{key:"logError",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).error.apply(t,[this.name].concat(i))}},{key:"logWarning",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).warn.apply(t,[this.name].concat(i))}}]),t;var e}(),tt={poof:{"1_1":"./resource/image/avatar/poof/1-1.png","1_2":"./resource/image/avatar/poof/1-2.png","1_3":"./resource/image/avatar/poof/1-3.png","1_4":"./resource/image/avatar/poof/1-4.png","2_1":"./resource/image/avatar/poof/2-1.png","2_2":"./resource/image/avatar/poof/2-2.png","2_3":"./resource/image/avatar/poof/2-3.png","2_4":"./resource/image/avatar/poof/2-4.png","3_1":"./resource/image/avatar/poof/3-1.png","3_2":"./resource/image/avatar/poof/3-2.png","3_3":"./resource/image/avatar/poof/3-3.png","3_4":"./resource/image/avatar/poof/3-4.png","4_1":"./resource/image/avatar/poof/4-1.png","4_2":"./resource/image/avatar/poof/4-2.png","4_3":"./resource/image/avatar/poof/4-3.png","4_4":"./resource/image/avatar/poof/4-4.png"}},et=function(){function i(){S(this,i);var t=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.avatars=[],t.lastUpdate=0,ue.once("application-loading-done",function(){return t.initializeRenderer()}),t}return C(i,Q),A(i,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:return t.next=4,n("actions",this.loader);case 4:return t.next=6,n("animations",this.loader);case 6:return t.next=8,n("draworder",this.loader);case 8:return t.next=10,n("effectmap",this.loader);case 10:return t.next=12,n("figuredata",this.loader);case 12:return t.next=14,n("figuremap",this.loader);case 14:return t.next=16,n("geometry",this.loader);case 16:return t.next=18,n("offsets",this.loader);case 18:return t.next=20,n("partsets",this.loader);case 20:return t.next=22,h("hh_human_body",this.loader);case 22:return t.next=24,h("hh_human_face",this.loader);case 24:tt.poof.forEach(function(t){return e.loader.add(t)});case 25:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"initializeRenderer",value:function(){var t=this;null===Y&&(Y=d("action",s()).map(function(t){return t.getAttribute("id")})),null===$&&($=l("Default")),null===J&&(J=new q("hd-195-1")),ue.display.on("tick",function(){return t.onGameTick()})}},{key:"newAvatar",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=new(Function.prototype.bind.apply(q,[null].concat(e)));return this.avatars.push(n),n}},{key:"removeAvatar",value:function(e){this.avatars=this.avatars.filter(function(t){return t.id!==e.id})}},{key:"onGameTick",value:function(){(-1===this.lastUpdate||90<ue.ticker.lastTime-this.lastUpdate)&&(this.lastUpdate=ue.ticker.lastTime,this.avatars.forEach(function(t){return t.update()}))}}]),i;var t}(),it=function(){function i(){S(this,i);var t=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.config={},t}return C(i,Q),A(i,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:this.loader.add("./resource/config/config.json",0).on("complete",function(){return e.onConfigLoaded(ue.getResource("./resource/config/config.json"))});case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getString",value:function(t,e,i){var n=1<arguments.length&&void 0!==e?e:{},r=2<arguments.length&&void 0!==i?i:void 0,o=v(t,this.config);return void 0===o&&void 0!==r?r:g(o,Object.assign({},n,this.config))}},{key:"onConfigLoaded",value:function(t){void 0===t||(this.config=t.data)}}]),i;var t}(),nt=function(){function i(){S(this,i);var t=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.texts={},t}return C(i,Q),A(i,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:this.loader.add("./resource/config/texts.json",0).on("complete",function(){return e.onTextsLoaded(ue.getResource("./resource/config/texts.json"))});case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getString",value:function(t,e,i){var n=1<arguments.length&&void 0!==e?e:{},r=2<arguments.length&&void 0!==i?i:void 0,o=v(t,this.texts);return void 0===o&&void 0!==r?r:g(o,Object.assign({},n,this.text,ue.getManager(it).config))}},{key:"onTextsLoaded",value:function(t){void 0===t||(this.texts=t.data)}}]),i;var t}(),rt=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.barHeight=30,t.barThickness=2,t.barWidth=300,t.percentage=0,t}return C(e,t),A(e,[{key:"percentage",get:function(){return this._percentage},set:function(t){this._percentage=t,this.render()}}]),A(e,[{key:"render",value:function(){this.clear(),this.beginFill(0),this.lineStyle(this.barThickness,4408131),this.drawRoundedRect(0,0,this.barWidth,this.barHeight,6),this.endFill(),this.beginFill(5723991),this.lineStyle(null),this.drawRoundedRect(this.barThickness,this.barThickness,I(this.percentage/100*(this.barWidth-2*this.barThickness)),this.barHeight-2*this.barThickness,4),this.endFill()}}]),e}(PIXI.Graphics),ot=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.loader=new PIXI.loaders.Loader,t.loadingBar=new rt,t.logo=null,t.init(),t.loadResources(),t}return C(e,t),A(e,[{key:"percentage",get:function(){return this.loadingBar.percentage||0},set:function(t){this.loadingBar.percentage=I(t),this.render()}}]),A(e,[{key:"init",value:function(){var t=this,e=new PIXI.TextStyle({align:"center",fontFamily:"proxima-nova",fontSize:15,fontWeight:300,fill:16777215,wordWrap:!0,wordWrapWidth:this.loadingBar.barWidth});this.text=new PIXI.Text("",e),ue.display.on("resize",function(){return t.render()})}},{key:"loadResources",value:function(){var t=this;this.loader.add("/resource/image/logo.png").load(function(){return t.onResourcesLoaded()})}},{key:"onResourcesLoaded",value:function(){var e=this;this.logo=new PIXI.Sprite(ue.getResource("/resource/image/logo.png",this.loader).texture),this.addChild(this.logo),this.addChild(this.loadingBar),this.addChild(this.text),this.logo.visible=!1,ue.loader.on("progress",function(t){return e.percentage=t.progress}),this.render(),this.emit("loader-ready")}},{key:"render",value:function(){var t=this.percentage;this.clear();var e=ue.display.height,i=ue.display.width;this.beginFill(0),this.drawRect(0,0,i,e),this.endFill(),this.loadingBar.position.x=i/2-this.loadingBar.barWidth/2,this.loadingBar.position.y=e-(this.loadingBar.barHeight+60),this.logo.visible=!0,this.logo.x=I(i/2-this.logo.width/2),this.logo.y=I(e/2-this.logo.height/2),this.text.text=ue.getManager(nt).getString("loading-view.starting-up",{percentage:t},""),this.text.position.set(this.loadingBar.position.x+this.loadingBar.barWidth/2-this.text.width/2,this.loadingBar.position.y-30)}}]),e}(PIXI.Graphics),at=0,st=function(t){function i(){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));if(e.dpi=window.devicePixelRatio,e.mount=document.querySelector("main#stage-mount"),null===e.mount)throw new Error("Display mount not found!");return e.mount.innerHTML="",e.initApp(),e.initEvents(),e.ticker.add(function(t){return e.onTick(t)}),e}return C(i,t),A(i,[{key:"frame",get:function(){return at}},{key:"renderer",get:function(){return this.app.renderer}},{key:"stage",get:function(){return this.app.stage}},{key:"ticker",get:function(){return this.app.ticker}},{key:"view",get:function(){return this.app.view}},{key:"height",get:function(){return this.renderer.height/this.dpi}},{key:"width",get:function(){return this.renderer.width/this.dpi}},{key:"size",get:function(){return{width:this.width,height:this.height}}}]),A(i,[{key:"initApp",value:function(){this.app=new PIXI.Application({height:window.innerHeight,width:window.innerWidth,antialiasing:!1,transparent:!1,resolution:this.dpi,roundPixels:!1,powerPreference:"high-performance",forceFXAA:!1}),this.mount.appendChild(this.view),this.view.style.height=window.innerHeight+"px",this.view.style.width=window.innerWidth+"px"}},{key:"initEvents",value:function(){var t=this;window.addEventListener("resize",function(){return t.onWindowResize()})}},{key:"onTick",value:function(t){at++,this.emit("tick",t),0==at%12&&this.emit("tick-update",t),this.stage.updateLayerOrder()}},{key:"onWindowResize",value:function(){this.renderer.resize(window.innerWidth,window.innerHeight),this.emit("resize"),this.view.style.height=window.innerHeight+"px",this.view.style.width=window.innerWidth+"px"}}]),i}(PIXI.utils.EventEmitter),ut=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.background=new PIXI.Sprite(ue.getResource(St.bottomBar.background).texture),t.addChild(t.background),t.addChild(t.meButton=new ht),t.addChild(t.navigatorButton=new gt),t.addChild(t.friendsButton=new dt),t.addChild(t.chatButton=new xt),t.addChild(t.catalogueButton=new ct),t.addChild(t.inventoryButton=new pt),t.addChild(t.helpButton=new ft),t.draw(),ue.display.on("resize",function(){return t.draw()}),t}return C(e,t),A(e,[{key:"draw",value:function(){var t=ue.display.size,e=t.width,i=t.height;this.x=0,this.y=i-70,this.background.x=0,this.background.y=0,this.background.width=e,this.meButton.x=12,this.navigatorButton.x=e-24-360,this.friendsButton.x=e-24-300,this.chatButton.x=e-24-240,this.catalogueButton.x=e-24-180,this.inventoryButton.x=e-24-120,this.helpButton.x=e-24-60}}]),e}(PIXI.Container),t=function(t){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e}return C(i,t),i}(PIXI.extras.AnimatedSprite),ht=function(t){function n(t){var e=0<arguments.length&&void 0!==t?t:void 0;S(this,n);var i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.avatar=ue.getManager(et).newAvatar(e,"vertical","head"),i.addChild(i.avatar),i.avatar.canPoof=!1,i.avatar.direction=i.avatar.headDirection=3,i.avatar.addAction("GestureSmile"),i.avatar.x=-10,i.avatar.y=-5,i}return C(n,t),A(n,[{key:"figure",get:function(){return this.avatar.figure},set:function(t){this.avatar.figure=t}}]),n}(PIXI.Graphics),lt=function(){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e.on("pointerover",function(){return e.onPointerOver()}),e.on("pointerout",function(){return e.onPointerOut()}),e}return C(i,t),A(i,[{key:"onPointerOver",value:function(){this.animationSpeed=.2,this.play()}},{key:"onPointerOut",value:function(){this.animationSpeed=-.2,this.play()}}]),i}(),ct=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.catalogue).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70),r(t,420,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,lt),i}(),xt=function(){function e(){S(this,e);var t=[r(ue.getResource(St.bottomBar.chat).texture,0,0,70,70)];return j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return C(e,t),e}(),dt=(function(){function n(){S(this,n);var t=ue.getResource(St.bottomBar.chatMessages).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}C(n,t)}(),function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.friends).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,lt),i}()),ft=(function(){function n(){S(this,n);var t=ue.getResource(St.bottomBar.friendsInvited).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}C(n,t)}(),function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.help).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,lt),i}()),pt=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.inventory).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,lt),i}(),gt=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.navigator).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,lt),i}(),vt=(function(t){function e(){return S(this,e),j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}C(e,t)}(PIXI.Container),function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._avatarHolder=new PIXI.Graphics,t._avatarHolder.buttonMode=!0,t._avatarHolder.interactive=!0,t._avatarHolder.on("pointerover",function(){return t.onAvatarHover()}),t._avatarHolder.on("pointerout",function(){return t.onAvatarLeave()}),t._avatar=ue.getManager(et).newAvatar("","vertical","head"),t.avatar.canPoof=!1,t.avatar.headDirection=3,t.avatar.position.x=-15,t.avatar.position.y=-11,t._avatarHolder.addChild(t.avatar),t._chatBubble=new vt,t.chatBubble.position.x=68,t.chatBubble.position.y=8,t.chatBubble.on("pointerover",function(){return t.onChatBubbleHover()}),t.chatBubble.on("pointerout",function(){return t.onChatBubbleLeave()}),t.addChild(t._avatarHolder),t.addChild(t.chatBubble),t.draw(),ue.display.on("resize",function(){return t.draw()}),setTimeout(function(){return t.avatar.addAction("GestureSmile")},500),t}C(e,t),A(e,[{key:"avatar",get:function(){return this._avatar}},{key:"chatBubble",get:function(){return this._chatBubble}}]),A(e,[{key:"draw",value:function(){this.position.x=16,this.position.y=ue.display.height-76,this._avatarHolder.clear(),this._avatarHolder.beginFill(0,.25),this._avatarHolder.drawCircle(30,32,32),this._avatarHolder.endFill(),this._avatarHolder.beginFill(801381),this._avatarHolder.lineStyle(4,2379124),this._avatarHolder.drawCircle(30,30,30),this._avatarHolder.endFill()}},{key:"onAvatarHover",value:function(){this.avatar.removeAction("GestureSmile"),this.avatar.addAction("GestureSurprised")}},{key:"onAvatarLeave",value:function(){this.avatar.removeAction("GestureSurprised"),this.avatar.addAction("GestureSmile")}},{key:"onChatBubbleHover",value:function(){this.avatar.removeAction("GestureSmile"),this.avatar.addAction("Talk")}},{key:"onChatBubbleLeave",value:function(){this.avatar.removeAction("Talk"),this.avatar.addAction("GestureSmile")}}])}(PIXI.Container),function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.interactive=!0,t.imLeft=new PIXI.Sprite(ue.getResource(St.chatBubble.left).texture),t.imMiddle=new PIXI.extras.TilingSprite(ue.getResource(St.chatBubble.middle).texture),t.imRight=new PIXI.Sprite(ue.getResource(St.chatBubble.right).texture),t.imLeft.height=44,t.imMiddle.height=44,t.imRight.height=44,t.addChild(t.imLeft),t.addChild(t.imMiddle),t.addChild(t.imRight),t.draw(),t}return C(e,t),A(e,[{key:"draw",value:function(){this.imLeft.position.x=0,this.imLeft.position.y=0,this.imMiddle.position.x=17,this.imMiddle.position.y=0,this.imMiddle.width=100,this.imRight.position.x=117,this.imRight.position.y=0}}]),e}(PIXI.Graphics)),yt=(function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.background=new PIXI.Sprite(ue.getResource(St.bottomBar.background).texture),t.addChild(t.background),t.addChild(t.meButton=new mt),t.addChild(t.navigatorButton=new Tt),t.addChild(t.friendsButton=new kt),t.addChild(t.chatButton=new bt),t.addChild(t.catalogueButton=new _t),t.addChild(t.inventoryButton=new Ot),t.addChild(t.helpButton=new Pt),t.draw(),ue.display.on("resize",function(){return t.draw()}),t}C(e,t),A(e,[{key:"draw",value:function(){var t=ue.display.size,e=t.width,i=t.height;this.x=0,this.y=i-70,this.background.x=0,this.background.y=0,this.background.width=e,this.meButton.x=12,this.navigatorButton.x=e-24-360,this.friendsButton.x=e-24-300,this.chatButton.x=e-24-240,this.catalogueButton.x=e-24-180,this.inventoryButton.x=e-24-120,this.helpButton.x=e-24-60}}])}(PIXI.Container),function(t){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e}return C(i,t),i}(PIXI.extras.AnimatedSprite)),mt=function(t){function n(t){var e=0<arguments.length&&void 0!==t?t:void 0;S(this,n);var i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.avatar=ue.getManager(et).newAvatar(e,"vertical","head"),i.addChild(i.avatar),i.avatar.canPoof=!1,i.avatar.direction=i.avatar.headDirection=3,i.avatar.addAction("GestureSmile"),i.avatar.x=-10,i.avatar.y=-5,i}return C(n,t),A(n,[{key:"figure",get:function(){return this.avatar.figure},set:function(t){this.avatar.figure=t}}]),n}(PIXI.Graphics),wt=function(){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e.on("pointerover",function(){return e.onPointerOver()}),e.on("pointerout",function(){return e.onPointerOut()}),e}return C(i,yt),A(i,[{key:"onPointerOver",value:function(){this.animationSpeed=.2,this.play()}},{key:"onPointerOut",value:function(){this.animationSpeed=-.2,this.play()}}]),i}(),_t=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.catalogue).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70),r(t,420,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,wt),i}(),bt=function(){function e(){S(this,e);var t=[r(ue.getResource(St.bottomBar.chat).texture,0,0,70,70)];return j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return C(e,yt),e}(),kt=(function(){function n(){S(this,n);var t=ue.getResource(St.bottomBar.chatMessages).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}C(n,yt)}(),function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.friends).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,wt),i}()),Pt=(function(){function n(){S(this,n);var t=ue.getResource(St.bottomBar.friendsInvited).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=j(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}C(n,yt)}(),function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.help).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,wt),i}()),Ot=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.inventory).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,wt),i}(),Tt=function(){function i(){S(this,i);var t=ue.getResource(St.bottomBar.navigator).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70)];return j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return C(i,wt),i}(),It=(function(t){function e(){return S(this,e),j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}C(e,t)}(PIXI.Container),function(t){function r(){S(this,r);var t=j(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.x=100,t.y=100,t.z=1e4,t.visible=!1,t.bg=new PIXI.Graphics,t.addChild(t.bg),t.init(),t.title="",t.render(),ue.display.on("tick",function(){return t.render()}),i(t),t}return C(r,t),A(r,[{key:"height",get:function(){return this._height},set:function(t){this._height=t}},{key:"opened",get:function(){return this.visible}},{key:"title",get:function(){return this.titleText.text.trim()},set:function(t){this.titleText.text=t}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}}]),A(r,[{key:"init",value:function(){var t=new PIXI.TextStyle({align:"center",fontFamily:"proxima-nova",fontSize:15,fontWeight:700,fill:15000804});this.titleText=new PIXI.Text("",t),this.addChild(this.titleText),this.filters=[_(new PIXI.filters.DropShadowFilter,function(t){t.color=0,t.alpha=.2,t.blur=2,t.distance=1,t.rotation=90})]}},{key:"getDraggableRegion",value:function(){return{x:0,y:0,width:this.width,height:""===this.title?0:42}}},{key:"getDraggingRegion",value:function(){return{x:12,y:12,width:ue.display.width-12,height:ue.display.height-70-12}}},{key:"close",value:function(){var t=this;void 0!==this.currentAnimation||(this.currentAnimation=anime({targets:this,duration:210,easing:[.55,0,.1,1],alpha:[1,0],y:[this.y,this.y+24]}).finished.then(function(){t.currentAnimation=void 0,t.y-=24,t.visible=!1}))}},{key:"open",value:function(){var t=this;void 0!==this.currentAnimation||(this.visible=!0,this.currentAnimation=anime({targets:this,duration:210,easing:[.55,0,.1,1],alpha:[0,1],y:[this.y+24,this.y]}).finished.then(function(){t.currentAnimation=void 0}))}},{key:"render",value:function(){this.bg.clear();var t=F(this.width||0,B(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"width",this)),e=F(this.height||0,B(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"height",this)),i=0;if(this.bg.beginFill(1463929),this.bg.lineStyle(3,1729935),this.bg.drawRoundedRect(0,0,t,e,6),this.bg.endFill(),this.bg.lineStyle(0),""!==this.title){i=39,this.titleText.x=t/2,this.titleText.y=15,this.titleText.anchor.x=.5,this.titleText.visible=!0;var n=this.title;this.title="",this.title=n}else this.titleText.visible=!1;this.bg.beginFill(16777215),this.bg.drawRoundedRect(6,6+i,t-12,e-(12+i),6),this.bg.endFill()}}]),r}(PIXI.Container)),Rt={AccelerationCurve:[.4,0,1,1],DecelerationCurve:[0,0,.2,1],SharpCurve:[.4,0,.6,1],StandardCurve:[.4,0,.2,1],SwiftOut:[.55,0,.1,1]},St={chatBubble:{left:"./resource/image/interface/chat-bubble/left.png",middle:"./resource/image/interface/chat-bubble/middle.png",right:"./resource/image/interface/chat-bubble/right.png"},bottomBar:{background:"./resource/image/interface/bottom-bar/background.png",navigator:"./resource/image/interface/bottom-bar/navigator.png",friends:"./resource/image/interface/bottom-bar/friends.png",friendsInvited:"./resource/image/interface/bottom-bar/friends-invited.png",chat:"./resource/image/interface/bottom-bar/chat.png",chatMessages:"./resource/image/interface/bottom-bar/chat-messages.png",catalogue:"./resource/image/interface/bottom-bar/catalogue.png",inventory:"./resource/image/interface/bottom-bar/inventory.png",help:"./resource/image/interface/bottom-bar/help.png"}},At=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.z=1e5,t.init(),t.hello(),t}return C(e,t),A(e,[{key:"init",value:function(){this.bottomBar=new ut,this.addChild(this.bottomBar)}},{key:"hello",value:function(){anime({targets:this.bottomBar,duration:300,easing:Rt.SwiftOut,y:[this.bottomBar.y+70,this.bottomBar.y]})}}]),e}(PIXI.Container),Bt=void 0,Ct=function(){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return ue.once("application-loading-done",function(){return Bt=new At,void ue.display.stage.addChild(Bt)}),t}return C(e,Q),A(e,[{key:"interface",get:function(){return Bt}}]),A(e,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loader.add(St.bottomBar.background),this.loader.add(St.bottomBar.catalogue),this.loader.add(St.bottomBar.chat),this.loader.add(St.bottomBar.chatMessages),this.loader.add(St.bottomBar.friends),this.loader.add(St.bottomBar.friendsInvited),this.loader.add(St.bottomBar.help),this.loader.add(St.bottomBar.inventory),this.loader.add(St.bottomBar.navigator),this.loader.add(St.chatBubble.left),this.loader.add(St.chatBubble.middle),this.loader.add(St.chatBubble.right);case 14:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),e;var t}(),jt=function(t){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.row=0,e.column=0,e.cacheAsBitmap=!0,e.interactive=!0,e.thickness=t,e.on("pointertap",function(){return e.onClick()}),e.on("pointerover",function(){return e.onMouseOver()}),e.on("pointerout",function(){return e.onMouseOut()}),e}return C(i,t),A(i,[{key:"onClick",value:function(){this.emit("tile-tap",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOver",value:function(){this.emit("tile-hover",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOut",value:function(){this.emit("tile-leave",{row:this.row,column:this.column,x:this.x,y:this.y,width:this.width,height:this.height,tile:this})}}]),i}(PIXI.Graphics),Xt=function(){function e(t){return S(this,e),j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return C(e,jt),e}(),Ht=function(){function s(t){S(this,s);for(var e=j(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t)),i=[],n=0;n<4;n++){var r=8*n,o=12*n,a=[new PIXI.Point(Lt/2+r,o),new PIXI.Point(Lt/2+Lt/8+r,Et/8+o),new PIXI.Point(Lt/2-24+r,20+o),new PIXI.Point(r,Et/2+o)];i.push.apply(i,a),y(e,a,e.thickness)}return e}return C(s,jt),s}(),zt=function(){function o(t){S(this,o);for(var e=j(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t)),i=0;i<4;i++){var n=-8*i,r=12*i;y(e,[new PIXI.Point(Lt/2+n,r),new PIXI.Point(Lt+n,Et/2+r),new PIXI.Point(Lt/2+24+n,20+r),new PIXI.Point(Lt/2-Lt/8+n,Et/8+r)],e.thickness)}return e}return C(o,jt),o}(),Mt=function(){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return y(e,[new PIXI.Point(Lt/2,0),new PIXI.Point(Lt,Et/2),new PIXI.Point(Lt/2,Et),new PIXI.Point(0,Et/2)],e.thickness),e}return C(i,jt),i}(),Et=32,Lt=64,Ft="./resource/image/furni/loading.png",Vt=(function(t){function i(t){S(this,i);var e=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.furniName=t,e._loadingSprite=new PIXI.Sprite(ue.getResource(Ft).texture),e.addChild(e._loadingSprite),e.loading=!0,e.render(),e}C(i,t),A(i,[{key:"loading",get:function(){return this._loading},set:function(t){this._loading=t}}]),A(i,[{key:"getRoomOffsets",value:function(){return{x:-34,y:-50}}},{key:"render",value:function(){}}])}(PIXI.Container),function(){function e(){return S(this,e),j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return C(e,Q),A(e,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loader.add(Ft);case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),e;var t}()),Dt=function(t){function i(){S(this,i);var t=j(this,(i.__proto__||Object.getPrototypeOf(i)).call(this)),e=[new PIXI.Point(32,0),new PIXI.Point(64,16),new PIXI.Point(32,32),new PIXI.Point(0,16)];return t.lineStyle(4,0,.2),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.lineTo(e[0].x,e[0].y),t.endFill(),t.lineStyle(4,16777215),t.moveTo(e[0].x,e[0].y-1),t.lineTo(e[1].x,e[1].y-1),t.lineTo(e[2].x,e[2].y-1),t.lineTo(e[3].x,e[3].y-1),t.lineTo(e[0].x,e[0].y-1),t.endFill(),t}return C(i,t),A(i,[{key:"hover",value:function(t,e,i){this.position.x=t,this.position.y=e-2,this.z=i}},{key:"getRoomOffsets",value:function(){return{x:-32,y:-16}}}]),i}(PIXI.Graphics),Gt=function(t){function r(t,e,i){S(this,r);var n=j(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.interactive=!0,n.doorHeight=85,n.floorThickness=t,n.wallHeight=115+32*i,n.wallThickness=e,anime({targets:n,delay:2e3,duration:900,easing:Rt.SwiftOut,alpha:[0,1],wallHeight:[0,n.wallHeight],update:function(){return n.render()}}),n}return C(r,t),A(r,[{key:"render",value:function(){this.clear()}}]),r}(PIXI.Graphics),qt=function(){function o(t,e,i,n){S(this,o);var r=j(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,e,i));return r.doorMode=n,r.render(),r}return C(o,Gt),A(o,[{key:"render",value:function(){B(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"render",this).call(this);var t=this.doorMode?this.doorHeight+this.floorThickness:0;this.doorMode||(this.beginFill(9869217),this.moveTo(32,16+this.floorThickness),this.lineTo(32+this.wallThickness,16+this.floorThickness-this.wallThickness/2),this.lineTo(32+this.wallThickness,16-this.wallThickness/2-this.wallHeight),this.lineTo(32,16-this.wallHeight),this.lineTo(32,16+this.floorThickness),this.endFill()),this.beginFill(11909577),this.moveTo(32,16+this.floorThickness-t),this.lineTo(32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(0,this.floorThickness-t),this.lineTo(32,16+this.floorThickness-t),this.endFill(),this.beginFill(7434875),this.moveTo(32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(this.wallThickness,16-this.wallHeight-16-this.wallThickness/2),this.lineTo(32+this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(32,16-this.wallHeight),this.endFill()}}]),o}(),Wt=function(){function r(t,e,i){S(this,r);var n=j(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e,i));return n.render(),n}return C(r,Gt),A(r,[{key:"render",value:function(){B(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"render",this).call(this),this.beginFill(7434875),this.moveTo(0,-this.wallHeight),this.lineTo(this.wallThickness,-this.wallHeight-this.wallThickness/2),this.lineTo(0,-this.wallHeight-this.wallThickness),this.lineTo(-this.wallThickness,-this.wallHeight-this.wallThickness/2),this.lineTo(0,-this.wallHeight),this.endFill()}}]),r}(),Nt=function(){function o(t,e,i,n){S(this,o);var r=j(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,e,i));return r.doorMode=n,r}return C(o,Gt),A(o,[{key:"render",value:function(){B(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"render",this).call(this);var t=this.doorMode?this.doorHeight+this.floorThickness:0;this.doorMode||(this.beginFill(12238542),this.moveTo(-32,16+this.floorThickness),this.lineTo(-32,16-this.wallHeight),this.lineTo(-32-this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(-32-this.wallThickness,16+this.floorThickness-this.wallThickness/2),this.lineTo(-32,16+this.floorThickness),this.endFill()),this.beginFill(9606045),this.moveTo(-32,16+this.floorThickness-t),this.lineTo(-32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(0,this.floorThickness-t),this.lineTo(-32,16+this.floorThickness-t),this.endFill(),this.beginFill(7434875),this.moveTo(-32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(-this.wallThickness,16-this.wallHeight-16-this.wallThickness/2),this.lineTo(-32-this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(-32,16-this.wallHeight),this.endFill()}}]),o}(),Ut=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.z=1e3,t._entities=[],t._heightmap={},t._tiles={},t.columns=0,t.rows=0,t.floorThickness=8,t.wallThickness=8,t.highest=0,t.lowest=0,t.offsets={x:0,y:0},t.roomScale=1,t.tileCursor=new Dt,t.tileCursor.visible=!1,i(t),t}return C(e,t),A(e,[{key:"entities",get:function(){return this._entities}},{key:"heightmap",get:function(){return this._heightmap}},{key:"roomScale",get:function(){return this.scale.x},set:function(t){this.scale.x=t,this.scale.y=t}},{key:"tiles",get:function(){return this._tiles}}]),A(e,[{key:"clearEverything",value:function(){for(;this.children[0];)this.removeChild(this.children[0]);this.addChild(this.tileCursor),this._entities=[],this._tiles={}}},{key:"prepareHeightmap",value:function(t){var m=this;this.emit("room-view-emptied"),this.clearEverything();var w=this._heightmap=t.trim().split("\n").map(function(t){return t.split("").map(function(t){return"x"===(e=t)?null:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"].indexOf(e);var e})}),e=function(t){for(var e=0,i=36,n=0;n<t.length;n++)for(var r,o=0;o<t[n].length;o++)e<(r=t[n][o])&&(e=r),r<i&&(i=0);return{highest:e,lowest:i}}(this.heightmap),i=e.highest,n=e.lowest;if(this.highest=i,this.lowest=n,0!==w.length){this.columns=w[0].length,this.rows=w.length,this.doors=[];for(var r=function(y){m._tiles[y]={};for(var t=function(c){var x=m.getTileHeight(y,c);if(null===x)return"continue";var e=O(w,y,c),d=k(w,y,c),t=function(t){var e=0<arguments.length&&void 0!==t?t:-1;return 3===e?Xt:2===e?Ht:4===e?zt:Mt}(d),f=function(t,e,i){if(O(t,e,i))return!1;for(var n=e;-1<n;)if(null!==P(t,--n,i)&&!O(t,n,i))return!1;return(null===P(t,e-1,i-1)||O(t,e-1,i-1))&&(null===P(t,e-1,i+1)||O(t,e-1,i+1))}(w,y,c),p=function(t,e,i){if(O(t,e,i))return!1;for(var n=i;-1<n;)if(null!==P(t,e,--n)&&!O(t,e,n))return!1;return(null===P(t,e-1,i-1)||O(t,e-1,i-1))&&(null===P(t,e+1,i-1)||O(t,e+1,i-1))}(w,y,c),g=m.getX(y,c),v=m.getY(y,c),i=m.getRealZ(y,c,1);(f||p)&&function(){var t=[],e=O(w,y-1,c),i=O(w,y,c-1),n=e||i,r=T(m.highest-x);n&&(e?m.doors.push({row:y-1,column:c,direction:b(w,y-1,c)}):m.doors.push({row:y,column:c-1,direction:b(w,y,c-1)})),f&&p?(t.push(new Wt(m.floorThickness,m.wallThickness,r)),t.push(new qt(m.floorThickness,m.wallThickness,r,e)),t.push(new Nt(m.floorThickness,m.wallThickness,r,i))):f?t.push(new qt(m.floorThickness,m.wallThickness,r,e)):p&&t.push(new Nt(m.floorThickness,m.wallThickness,r,i));var o=!0,a=!1,s=void 0;try{for(var u,h,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0)h=u.value,m.addChild(_(h,function(t){m.entities.push(t),t.x=g+32,t.y=v+(-1===d?0:32),t.z=m.getRealZ(y,c,n?4:0)}))}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}}(),m.addChild(_(new t(m.floorThickness),function(t){m.entities.push(t),(m._tiles[y][c]=t).row=y,t.column=c,e&&(t.tint=16711680),t.on("tile-tap",function(t){return m.onTileClick(t)}),t.on("tile-hover",function(t){return m.onTileHover(t)}),t.on("tile-leave",function(t){return m.onTileLeave(t)}),t.x=g,t.y=v,t.z=i}))},e=0;e<w[y].length;e++)t(e)},o=0;o<w.length;o++)r(o);this.centerRoom(),this.position.x=V(ue.display.width/2-this.width/2),this.position.y=V(ue.display.height/2-(this.height/2-115)),this.hitArea=new PIXI.Rectangle(-5e3,-5e3,this.width+1e4,this.height+1e4),this.emit("room-view-ready")}}},{key:"addEntityToTile",value:function(t,e,i,n){this.addChild(t),this.associateEntityToTile(t,e,i,n)}},{key:"removeEntity",value:function(t){this.removeChild(t)}},{key:"animateBuildingTiles",value:function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)void 0!==this.tiles[t][e]&&anime({targets:this.tiles[t][e],delay:50*(t+e),duration:900,easing:Rt.DecelerationCurve,alpha:[0,1],y:[this.tiles[t][e].y+ue.display.height,this.tiles[t][e].y]})}},{key:"associateEntityToTile",value:function(t,e,i,n){var r=3<arguments.length&&void 0!==n?n:0,o=this.getEntityPosition(t,e,i,r);t.position.x=o.x,t.position.y=o.y,t.z=o.z,this.updateLayerOrder()}},{key:"centerEntity",value:function(t,e){var i=!(1<arguments.length&&void 0!==e)||e,n=ue.display.width/2,r=ue.display.height/2;n-=I(t.x+t.width/2),r-=I(t.y+t.height/2),n-=n%2,i?anime({targets:this,x:n,y:r,duration:800,easing:"easeInOutSine"}):anime({targets:this,x:n,y:r,duration:45,easing:"linear"})}},{key:"centerRoom",value:function(){if(0<this.entities.length){var e=this.entities.reduce(function(t,e){return t.x<e.x?t:e}).x,i=this.entities.filter(function(t){return t instanceof jt}).reduce(function(t,e){return t.y<e.y?t:e}).y;this.offsets.x=-e,this.offsets.y=-i,this.entities.forEach(function(t){t.x-=e,t.y-=i})}}},{key:"getClosestTile",value:function(){}},{key:"getDoorTile",value:function(t){return!(0<arguments.length&&void 0!==t)||t?this.doors[V(Math.random()*this.doors.length)]:this.doors[0]}},{key:"getEntityPosition",value:function(t,e,i,n){var r=3<arguments.length&&void 0!==n?n:0,o={x:0,y:0},a=this.getTile(e,i);void 0!==t.getRoomOffsets&&(o=t.getRoomOffsets());var s=!(a instanceof Mt),u=this.getX(e,i)+32+(o.x+this.offsets.x),h=this.getY(e,i)+16+(o.y+this.offsets.y)+(a&&s?16:0),l=this.getZ(e,i+2,5)+r;return O(this.tiles,e,i)&&(l=this.getRealZ(e,i,4)),{x:u,y:h,z:l,isStairs:s}}},{key:"getRandomTile",value:function(){var t=V(Math.random()*this.rows),e=V(Math.random()*this.columns);return this.isValidTile(t,e)?{row:t,column:e}:this.getRandomTile()}},{key:"getTile",value:function(t,e){return void 0===this.tiles[t]?void 0:this.tiles[t][e]||void 0}},{key:"getTileHeight",value:function(t,e){return void 0===this.heightmap[t]?void 0:this.heightmap[t][e]}},{key:"getX",value:function(t,e){return 32*(e-t)}},{key:"getY",value:function(t,e){var i=this.getTileHeight(t,e);return void 0===i&&(i=0),-1!==k(this.heightmap,t,e)&&(i+=1),16*(e+t)-32*i}},{key:"getZ",value:function(t,e,i){var n=2<arguments.length&&void 0!==i?i:0;return e*=1e3,(t*=1e3)*this.columns+e+n}},{key:"getRealZ",value:function(t,e,i){var n=2<arguments.length&&void 0!==i?i:0;return t*this.columns+e+n}},{key:"isValidTile",value:function(t,e){return void 0!==this.getTile(t,e)}},{key:"onTileClick",value:function(t){this.emit("tile-tap",t)}},{key:"onTileHover",value:function(n){var r=this;setTimeout(function(){var t=r.getEntityPosition(r.tileCursor,n.row,n.column),e=t.x,i=t.y;r.currentHover=[n.row,n.column],r.tileCursor.visible=!0,r.tileCursor.hover(e,i,r.getRealZ(n.row,n.column,2)),r.updateLayerOrder()},1)}},{key:"onTileLeave",value:function(t){var e=this;this.currentHover=void 0,setTimeout(function(){void 0!==e.currentHover&&(t.x!==e.currentHover.x||t.y!==e.currentHover.y)||(e.tileCursor.visible=!1)},2)}}]),e}(PIXI.Container),Zt={index:o("/room-content/index.xml"),assets:o("/room-content/room_assets.xml"),manifest:o("/room-content/manifest.xml"),visualization:o("/room-content/room_visualization.xml")},Yt=void 0,$t=function(){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return Yt=new Ut,t.roomViewer.visible=!1,t}return C(e,Q),A(e,[{key:"roomViewer",get:function(){return Yt}}]),A(e,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loader.add(Zt.index),this.loader.add(Zt.assets),this.loader.add(Zt.manifest),this.loader.add(Zt.visualization);case 6:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"ensureRoomViewerIsMounted",value:function(){null!==this.roomViewer.parent||ue.display.stage.addChild(this.roomViewer)}},{key:"removeRoomViewer",value:function(){this.roomViewer.removeAllListeners(),ue.display.stage.removeChild(this.roomViewer)}},{key:"showRoomViewer",value:function(t){this.ensureRoomViewerIsMounted(),this.roomViewer.prepareHeightmap(t),this.roomViewer.visible=!0}}]),e;var t}(),Jt=["hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92","lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92","hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97","hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106","hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324","hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110","hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586"],Kt=function(){return Jt[V(Math.random()*Jt.length)]},Qt=[];Qt.push("\nxxxxx\nx000x\n0000x\nx000x\nx000x\nx000x\nxxxxx\n"),Qt.push("\nxxxxx\nx110x\nx110x\nx000x\nxxxxx\n"),Qt.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx2222xxxxxxxxxxxxxx\nx2222xxxxxxxxxxxxxx\nx2222211111xx000000\nx222221111110000000\nx222221111110000000\nx2222211111xx000000\nxx22xxx1111xxxxxxxx\nxx11xxx1111xxxxxxxx\nx1111xx1111xx000000\nx1111xx111110000000\nx1111xx111110000000\nx1111xx1111xx000000\nxxxxxxxxxxxxxxxxxxx\n"),Qt.push("\nxxxxxxxxxxxxxxxxxxxxxx\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx000x11xxxxxxxx11x000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\n000000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nxxxxxxxxxxxxxxxxxxxxxx\n"),Qt.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx2222xx111111111111\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\n22222xx000000000000\nx2222xx000000000000\nxxxxxxxxxxxxxxxxxxx\n"),Qt.push("\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x00000000xxxxxxxx00000000xxxx\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\n0000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n");var te=function(){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.height=540,t.width=420,t.title="Navigator",t}return C(e,It),A(e,[{key:"open",value:function(){this.x=ue.display.width/2-this.width/2,this.y=ue.display.height/2-this.height/2,B(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"open",this).call(this)}}]),e}(),ee="./resource/image/hotel-view/hotel.png",ie="./resource/image/hotel-view/skyline.png",ne=function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.skyline=new PIXI.extras.TilingSprite(ue.getResource(ie).texture),t.addChild(t.skyline),t.hotel=new PIXI.Sprite(ue.getResource(ee).texture),t.addChild(t.hotel),t.visible=!1,t.render(),ue.display.on("resize",function(){return t.render()}),t}return C(e,t),A(e,[{key:"opened",get:function(){return this.visible}}]),A(e,[{key:"close",value:function(){var t=this;anime({targets:this,duration:300,easing:Rt.SwiftOut,alpha:[1,0]}).finished.then(function(){return t.visible=!1})}},{key:"open",value:function(){this.visible=!0;var t=ue.display.height;anime({targets:this,duration:300,easing:Rt.SwiftOut,alpha:[0,1]}),anime({targets:this.skyline,delay:75,duration:750,easing:Rt.SwiftOut,alpha:[0,1],y:[t,this.skyline.y]}),anime({targets:this.hotel,delay:150,duration:750,easing:Rt.SwiftOut,y:[t,this.hotel.y]})}},{key:"render",value:function(){var t=ue.display.size,e=t.width,i=t.height;this.clear(),this.beginFill(2472174),this.drawRect(0,0,e,i),this.endFill(),this.hotel.x=e-750,this.hotel.y=i-638,this.skyline.height=120,this.skyline.width=e,this.skyline.x=0,this.skyline.y=i-190}}]),e}(PIXI.Graphics),re=function(){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return ue.once("application-loading-done",function(){return t.onApplicationLoadingDone()}),t}return C(e,Q),A(e,[{key:"hotelView",get:function(){return this._hotelView}}]),A(e,[{key:"initialize",value:(t=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loader.add(ee),this.loader.add(ie);case 2:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"onApplicationLoadingDone",value:function(){this._hotelView=new ne,ue.display.stage.addChild(this.hotelView)}}]),e;var t}(),oe=[],ae=function(){function r(t,e,i,n){S(this,r),this.roomViewer=t,this.avatar=e,this.row=i,this.column=n}return A(r,[{key:"position",get:function(){return{row:this.row,column:this.column}}}]),A(r,[{key:"moveTo",value:function(t,e,i){var n,r,o=this,a=2<arguments.length&&void 0!==i?i:void 0,s=(n=this.position,r={row:t,column:e},F(T(n.row-r.row),T(n.column-r.column)));a=void 0===a?m(this.position,{row:t,column:e})||this.avatar.direction:a;var u=this.roomViewer.getEntityPosition(this.avatar,t,e),h=u.x,l=u.y,c=u.z;if(1<s)this.teleportTo(t,e);else{this.avatar.direction=this.avatar.headDirection=a;var x=anime({targets:this.avatar,duration:360,x:h,y:l,easing:"linear"});x.update=function(t){t.currentTime<180||(x.update=void 0,o.avatar.z=c,o.roomViewer.updateLayerOrder())}}}},{key:"teleportTo",value:function(t,e){var i=this.roomViewer.getEntityPosition(this.avatar,t,e),n=i.x,r=i.y,o=i.z;this.avatar.position.x=n,this.avatar.position.y=r,this.avatar.z=o,this.roomViewer.updateLayerOrder()}},{key:"walkTo",value:function(r,o){var a=this,s=this.position;if(s.row!==r||s.column!==o){this.avatar.addAction("Move");!function t(){var e=s.row>r?--s.row:s.row<r?++s.row:r,i=s.column>o?--s.column:s.column<o?++s.column:o,n=m(a.position,{row:e,column:i});a.column=i,a.row=e,a.moveTo(e,i,n),setTimeout(function(){s.row===r&&s.column===o?a.avatar.removeAction("Move"):t()},360)}()}}}]),r}(),se=function(t){function h(){S(this,h);var t=j(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return t.urls=[],t}return C(h,t),A(h,[{key:"add",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:1;return this.urls.push({stage:i,url:t}),this}},{key:"load",value:function(){G.debug("InitializerLoader","Skipped load() initializing..")}},{key:"realLoad",value:function(t,e){var i,s=this,n=1<arguments.length&&void 0!==e?e:1,r=this.urls.filter(function(t){return t.stage===n}).map(function(t){return t.url}),o=r.filter(function(t){return"string"==typeof t}),u=r.filter(function(t){return"string"!=typeof t});o.forEach(function(t){return B(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"add",s).call(s,t)}),(i=R(regeneratorRuntime.mark(function t(){var e,i,n,r,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise(function(t){return B(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"load",s).call(s,t)});case 2:i=!(e=!0),n=void 0,t.prev=5,r=u[Symbol.iterator]();case 7:if(e=(o=r.next()).done){t.next=14;break}return a=o.value,t.next=11,a;case 11:e=!0,t.next=7;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(5),i=!0,n=t.t0;case 20:t.prev=20,t.prev=21,!e&&r.return&&r.return();case 23:if(t.prev=23,!i){t.next=26;break}throw n;case 26:return t.finish(23);case 27:return t.finish(20);case 28:case"end":return t.stop()}},t,s,[[5,16,20,28],[21,,23,27]])})),function(){return i.apply(this,arguments)})().then(function(){return t()})}}]),h}(PIXI.loaders.Loader),ue=new(function(t){function e(){S(this,e);var t=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._display=new st,t._loader=new se,t.managers=[],t}return C(e,t),A(e,[{key:"display",get:function(){return this._display}},{key:"loader",get:function(){return this._loader}},{key:"stage",get:function(){return this.display.stage}},{key:"ticker",get:function(){return this.display.ticker}}]),A(e,[{key:"addDefaultManagers",value:function(){this.addManager(new it),this.addManager(new nt),this.addManager(new et),this.addManager(new Vt),this.addManager(new re),this.addManager(new $t),this.addManager(new Ct)}},{key:"addManager",value:function(t){G.debug("Application","Added manager "+t.constructor.name),this.managers.push(t)}},{key:"getManager",value:function(e){return this.managers.find(function(t){return t instanceof e})}},{key:"create",value:function(){var t=this;this.loadingView=new ot,this.loadingView.on("loader-ready",function(){return t.emit("application-can-run")}),this.stage.addChild(this.loadingView),this.addDefaultManagers()}},{key:"initialize",value:(n=R(regeneratorRuntime.mark(function t(){var i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.managers.forEach(function(){var t=R(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initialize();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,i)}));return function(){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"run",value:(i=R(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loadingView.loadingBar.alpha=0,setTimeout(function(){return e.loader.realLoad(function(){return e.onLoadingStage0Done()},0)},0);case 2:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"onLoadingStage0Done",value:function(){var t=this;this.loadingView.loadingBar.alpha=1,this.loadingView.percentage=0,this.loader.realLoad(function(){return t.onLoadingStage1Done()},1)}},{key:"onLoadingStage1Done",value:function(){G.debug("Application","Loading of manager data done!"),this.emit("application-loading-done"),delete this.loader,this.stage.removeChild(this.loadingView),function(){var t=Kt(),n=ue.getManager(et),r=ue.getManager($t),e=ue.getManager(re),i=ue.getManager(Ct);e.hotelView.open();var o=new te;ue.stage.addChild(o),i.interface.bottomBar.navigatorButton.on("pointertap",function(){o.opened?o.close():o.open()}),i.interface.bottomBar.friendsButton.on("pointertap",function(){e.hotelView.opened?(e.hotelView.close(),setTimeout(function(){r.roomViewer.on("room-view-ready",function(){return r.roomViewer.animateBuildingTiles()}),r.roomViewer.on("tile-tap",function(t){return oe[0].walkTo(t.row,t.column)}),r.showRoomViewer(Qt[3]);for(var t=function(t){var e=n.newAvatar(Kt()),i=r.roomViewer.getRandomTile();0===t&&(i=r.roomViewer.getDoorTile(!0)),e.direction=e.headDirection=i.direction||V(8*Math.random())%8,oe.push(new ae(r.roomViewer,e,i.row,i.column)),e.on("pointertap",function(){return e.figure=Kt()}),r.roomViewer.addEntityToTile(e,i.row,i.column)},e=0;e<10;e++)t(e)},300)):(oe.forEach(function(t){return r.roomViewer.removeEntity(t.avatar)}),oe.forEach(function(t){return n.removeAvatar(t.avatar)}),oe=void 0,oe=[],e.hotelView.open(),r.removeRoomViewer())}),i.interface.bottomBar.meButton.figure=t,i.interface.bottomBar.friendsButton.emit("pointertap")}()}},{key:"getResource",value:function(t,e){return((1<arguments.length&&void 0!==e?e:void 0)||this.loader).resources[t]}},{key:"getResources",value:function(t){return((0<arguments.length&&void 0!==t?t:void 0)||this.loader).resources}}]),e;var i,n}(PIXI.utils.EventEmitter)),he=function(){function t(){S(this,t)}return A(t,null,[{key:"init",value:(e=R(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return G.debug("Bootstrapper","Loading everything.."),PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,ue.create(),ue.on("application-can-run",function(){return ue.run()}),t.next=6,ue.initialize();case 6:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t;var e}();Array.prototype.pushChain=function(){return this.push.apply(this,arguments),this},Array.prototype.unique=function(){return this.filter(function(t,e,i){return i.indexOf(t)===e})},Object.prototype.forEach=function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e)},PIXI.Container.prototype.updateLayerOrder=function(){var r=this;this.children.sort(function(t,e){var i=t.z||0,n=e.z||0;return i===n?r.children.indexOf(t)-r.children.indexOf(e):i-n})},he.init().then(function(){})}();
//# sourceMappingURL=bundle.js.map
