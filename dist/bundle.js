(function(){"use strict";function e(e){e.innerHTML=""}function t(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document;return[].slice.call(t.querySelectorAll(e))}function a(e){e.interactive=!0}function i(e){a(e);var t=null,i=null;e.on("pointerdown",function(a){t=a.data,ae=e,i=t.getLocalPosition(ae)}),e.on("pointerup",function(){t=null,i=null,ae=null}),e.on("pointermove",function(){if(null!==ae){var e=t.getLocalPosition(ae.parent);ae.position.x=e.x-i.x,ae.position.y=e.y-i.y}})}function r(e,t){return t(e),e}function o(e){return oe+e}function n(e){return o("/assets"+e)}function l(e,t){le[e]=t}function x(){null===se&&(se=t("action",y()).map(function(e){return e.getAttribute("id")})),null===pe&&(pe=g("Default")),null===ue&&(ue=new re("hd-195-1"))}function d(e){return n("/clothing/"+e+".xml")}function s(e){return n("/clothing/lib/"+e+".json")}function p(e){var t=["std"];return"bd"===e?t.push("sit","lay","wlk"):"hd"===e?t.push("lsp","lay","spk"):"fa"===e?t.push("lsp","lay"):"ea"===e?t.push("lay"):"ey"===e?t.push("agr","sad","sml","srp","lag","lsp","lay","eyb"):"fc"===e?t.push("agr","blw","sad","spk","srp","sml","lsp","lay"):"hr"===e||"hrb"===e?t.push("lay"):"he"===e?t.push("lay"):"ha"===e?t.push("spk","lay"):"ch"===e?t.push("lay"):"cc"===e?t.push("lay"):"ca"===e?t.push("lay"):"lg"===e?t.push("sit","wlk","lay"):"lh"===e?t.push("respect","sig","wav","wlk","lay"):"ls"===e?t.push("wlk","wav","lay"):"lc"===e?t.push("wlk","wav","lay"):"rh"===e?t.push("drk","crr","wlk","lay","blw"):"rs"===e?t.push("drk","crr","wlk","lay"):"rc"===e?t.push("drk","crr","wlk","lay"):"ri"===e?t.push("crr","drk"):"li"===e?t.push("sig"):"sh"===e?t.push("sit","wlk","lay"):void 0,t}function u(e){return le[e]!==void 0}function c(e,t){return new Promise(function(a){var i=d(e),r=t instanceof lt;r?(t.add(i).on("complete",function(){return dt.getResource(i)===void 0?void 0:ne[e]=dt.getResource(i).data}),a()):(te.debug("Loading avatar clothing config: "+e),t.add(i).on("complete",function(){ne[e]=dt.getResource(i).data,r||a(ne[e])}).load())})}function h(e,t){return void 0===de[e]?u(e)?Promise.resolve(le[e]):de[e]=new Promise(function(a){var i=s(e);t instanceof lt?(t.add(i).on("complete",function(){return dt.getResource(i,t)===void 0?void 0:l(e,dt.getResource(i,t).data)}),a()):(te.debug("Loading avatar clothing library: "+e),t.add(i).on("complete",function(){de[e]=void 0,l(e,dt.getResource(i,t).data),a(le[e])}).load())}):de[e]}function g(e){var t=y().querySelector("action[id=\""+e+"\"]"),a={};if(null!==t)return t.attributes.forEach(function(e){return a[e.name]=e.value}),a}function y(){return ne.actions}function f(){return ne.animations}function v(){return ne.draworder}function _(){return ne.figuredata}function m(){return ne.figuremap}function k(){return ne.geometry}function b(){return ne.partsets}function w(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};if(void 0===le[e]||void 0===le[e][t])return null;var i=new PIXI.Sprite(T(e,t));return i.x=a.x-(le[e][t].offset.x+a.x-12),i.y=a.y-(le[e][t].offset.y-a.y/2-6),i}function T(e,t){return void 0===le[e]||void 0===le[e][t]?null:void 0===xe[e+":"+t]?xe[e+":"+t]=PIXI.Texture.fromImage("data:image/png;base64,"+le[e][t].asset):xe[e+":"+t]}function A(e){var t=b().querySelector("partSet part[set-type=\""+e+"\"]").getAttribute("flipped-set-type");return null!==t&&""!==t?t:e}function P(e){var t=b().querySelector("partSet part[set-type=\""+e+"\"]").getAttribute("remove-set-type");return null!==t&&""!==t?t:null}function S(e){var t=[],a=b().querySelectorAll("activePartSet[id=\""+e+"\"] activePart");return a.forEach(function(e){return t.push(e.getAttribute("set-type"))}),t}function C(e,t){var a=f().querySelectorAll("action[id=\""+e+"\"] part[set-type=\""+t+"\"] frame"),r=[];return a.forEach(function(e){for(var t=e.hasAttribute("repeats")?parseInt(e.getAttribute("repeats")):1,a=0;a<t;a++)r.push({number:parseInt(e.getAttribute("number")),assetpartdefinition:e.getAttribute("assetpartdefinition")})}),r}function H(e){var t=f().querySelectorAll("action[id=\""+e+"\"] part:first-child frame").length,a=f().querySelectorAll("action[id=\""+e+"\"] offsets frame").length;return U(t,a)}function O(e,t,a,i){if(isNaN(a)||isNaN(i))return{x:0,y:0};var r=f().querySelector("action[id=\""+e+"\"] offsets frame[id=\""+a+"\"] directions direction[id=\""+i+"\"] bodypart[id=\""+t+"\"]");return null===r?{x:0,y:0}:{x:parseInt(r.getAttribute("dx")),y:parseInt(r.getAttribute("dy"))}}function R(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e=e.replace(/\${(.*?)}/g,function(e,a){return E(a,t)}),e}function E(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0,i=e.split("."),r=t,o=!0,n=!1,l=void 0;try{for(var x,d,s=i[Symbol.iterator]();!(o=(x=s.next()).done);o=!0){if(d=x.value,void 0===r[d])return a;r=r[d]}}catch(e){n=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw l}}return r}function F(e,t,a){e.beginFill(10000485),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.endFill(),0<a&&(e.beginFill(8618839),e.moveTo(t[1].x,t[1].y),e.lineTo(t[1].x,t[1].y+a),e.lineTo(t[2].x,t[2].y+a),e.lineTo(t[2].x,t[2].y),e.endFill(),e.beginFill(7302985),e.moveTo(t[3].x,t[3].y),e.lineTo(t[3].x,t[3].y+a),e.lineTo(t[2].x,t[2].y+a),e.lineTo(t[2].x,t[2].y),e.endFill())}function L(e,t,a){var i=B(e,t,a),r=z(e,t,a),o=K(r,4),n=o[0],l=o[1],x=o[2],d=o[3];if(null!==n&&null!==l&&1===V(i-n)&&1===V(i-l))return Ue.South;return null!==l&&1===V(i-l)?Ue.SouthEast:null!==n&&1===V(i-n)?Ue.SouthWest:void 0}function z(e,t,a){var i=B(e,t-1,a),r=B(e,t,a-1),o=B(e,t,a+1),n=B(e,t+1,a);return[i,r,o,n]}function B(e,t,a){return"undefined"==typeof e[t]?null:"undefined"==typeof e[t][a]?null:e[t][a]}function M(e){return"x"===e?null:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"].indexOf(e)}function W(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:void 0;return e===Ue.South?Be:e===Ue.SouthEast?Me:e===Ue.SouthWest?We:De}function D(e,t,a){return null!==B(e,t,a)&&1===z(e,t,a).filter(function(e){return null!==e}).length}function q(e,t,a){if(D(e,t,a))return!1;for(var i=t;0<i;)if(null!==B(e,--i,a)&&!D(e,t,i))return!1;return(null===B(e,t-1,a-1)||D(e,t-1,a-1))&&(null===B(e,t-1,a+1)||D(e,t-1,a+1))}function G(e,t,a){if(D(e,t,a))return!1;for(var i=a;0<i;)if(null!==B(e,t,--i)&&!D(e,t,i))return!1;return(null===B(e,t-1,a-1)||D(e,t-1,a-1))&&(null===B(e,t+1,a-1)||D(e,t+1,a-1))}function j(e){for(var t=0,a=36,i=0;i<e.length;i++)for(var r,o=0;o<e[i].length;o++)r=e[i][o],r>t&&(t=r),r<a&&(a=0);return{highest:t,lowest:a}}var V=Math.abs,I=Math.round,U=Math.max,N=Math.floor,Z=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){function i(r,o){try{var n=t[r](o),l=n.value}catch(e){return void a(e)}return n.done?void e(l):Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)})}return i("next")})}},X=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Y=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),Q=function e(t,a,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,a);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,a,i)}if("value"in r)return r.value;var n=r.get;return void 0===n?void 0:n.call(i)},J=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},$=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},K=function(){function e(e,t){var a=[],i=!0,r=!1,o=void 0;try{for(var n,l=e[Symbol.iterator]();!(i=(n=l.next()).done)&&(a.push(n.value),!(t&&a.length===t));i=!0);}catch(e){r=!0,o=e}finally{try{!i&&l["return"]&&l["return"]()}finally{if(r)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ee=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)},te=function(){function e(){X(this,e)}return Y(e,null,[{key:"debug",value:function(){var e}},{key:"error",value:function(){for(var e,t=arguments.length,a=Array(t),i=0;i<t;i++)a[i]=arguments[i];(e=console).error.apply(e,["[E]"].concat(a))}}]),e}(),ae=null,ie=function(){function e(t){X(this,e),this._parts={},this.parse(t)}return Y(e,[{key:"parts",get:function(){return this._parts}}]),Y(e,[{key:"hasPartId",value:function(e,t){return!!this.hasPartType(e)&&this._parts[e].id===t}},{key:"hasPartType",value:function(e){return void 0!==this._parts[e]}},{key:"parse",value:function(e){var t=this;e=e.split("."),e=e.map(function(e){return e.split("-")}),e=e.sort(function(e,t){return e[0].localeCompare(t[0])}),e.forEach(function(e){return t._parts[e[0]]={id:parseInt(e[1]),color:[e[2],e[3]].filter(function(e){return null!==e})}})}},{key:"toString",value:function(){var e=[];return this.parts.forEach(function(t,a){return e.push([a,t.id].concat(ee(t.color)).join("-"))}),e.join(".")}}]),e}(),re=function(e){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"vertical",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"full";X(this,i);var o=$(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return a(o),o.canPoof=!1,o.id="avatar-"+window.performance.now(),o.loader=new PIXI.loaders.Loader,o.partContainer=new PIXI.Container,o.addChild(o.partContainer),o._alsoUpdate=[],o._ticker=!1,o._width=0,o._height=0,o._actions=[pe],o._frames={},o.avatarSet=r,o.direction=2,o.figure=e,o.geometry=t,o.headDirection=o.direction,o.build(),o.canPoof=!0,o}return J(i,e),Y(i,[{key:"actions",get:function(){return this._actions}},{key:"avatarSet",get:function(){return this._avatarSet},set:function(e){this._avatarSet=e}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=e}},{key:"figure",get:function(){return this._figure},set:function(e){void 0===e||(this._figure=new ie(e),this.poof())}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e}},{key:"headDirection",get:function(){return this._headDirection},set:function(e){this._headDirection=e}}]),Y(i,[{key:"addAction",value:function(e){var t=!0,i=!1,r=void 0;try{for(var o,n,a=this._actions[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)if(n=o.value,n.id===e)return}catch(e){i=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw r}}e=g(e),void 0===e||(this._actions.pushChain(e).sort(function(e,t){return se.indexOf(t.id)-se.indexOf(e.id)}),this._frames[e.id]=0,"true"===e.preventheadturn&&(this._headDirection=this.direction))}},{key:"hasAction",value:function(e){var t=!1,i=!0,r=!1,o=void 0;try{for(var n,l,a=this._actions[Symbol.iterator]();!(i=(n=a.next()).done);i=!0)l=n.value,l.id===e&&(t=!0)}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return t}},{key:"removeAction",value:function(e){this.hasAction(e)&&(this._actions=this._actions.filter(function(t){return t.id!==e}).sort(function(e,t){return se.indexOf(t.id)-se.indexOf(e.id)}))}},{key:"setPosition",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:3;return this.x=e,this.y=t,this.direction=a,this.headDirection=a,this}},{key:"build",value:function(){var e=this;this.emit("avatar-build",this),this.invalidate();var t=this.getLibraries().filter(function(e){return!u(e)});if(0<t.length){this._loading=!0;var a=function a(){return 0===t.length?void(e._loading=!1):void h(t.shift(),e.loader).then(a)};a()}this.update()}},{key:"decideGeometry",value:function(){var e=k().querySelector("canvas[scale=\"h\"] geometry[id=\""+this.geometry+"\"]");this._height=parseInt(e.getAttribute("height")),this._width=parseInt(e.getAttribute("width")),"head"===this.geometry&&(this._height=this._width)}},{key:"getActivePartSets",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[];return null===e?t.push.apply(t,ee(S("figure"))):t.push.apply(t,ee(S(e.activepartset))),t.unique()}},{key:"hasActivePartSet",value:function(e){var t=!0,a=!1,i=void 0;try{for(var r,o,n=this.actions[Symbol.iterator]();!(t=(r=n.next()).done);t=!0)if(o=r.value,o.activepartset===e)return!0}catch(e){a=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw i}}return!1}},{key:"getBodyparts",value:function(){var e=[];return t("avatarset[id=\""+this.avatarSet+"\"] bodypart",k()).forEach(function(t){return e.push(t.getAttribute("id"))}),e}},{key:"getLibraries",value:function(){var e=[];return this._parts.forEach(function(t,a){t.parts.forEach(function(t){var i=m().querySelector("part[id=\""+t.id+"\"][type=\""+a+"\"]");null===i||null===i.parentNode||(i=i.parentNode,e.push(t.library=i.getAttribute("id").toLowerCase()))})}),e.unique()}},{key:"getRoomOffsets",value:function(){var e=-(this._width/2);return{x:e,y:-104}}},{key:"gatherParts",value:function(){var e=this;this.figure.parts.forEach(function(t,a){var i=_().querySelector("sets > settype[type=\""+a+"\"]");if(null!==i){var r=i.querySelector("set[id=\""+t.id+"\"]"),o=r.getElementsByTagName("part"),n="1"===r.getAttribute("colorable"),l=[],x=i.getAttribute("paletteid"),d=r.querySelectorAll("hiddenlayers layer");null!==d&&d.forEach(function(e){return l.push(e.getAttribute("parttype"))}),o.forEach(function(t){var i=t.getAttribute("type");void 0===e._parts[i]&&(e._parts[i]={hiddenlayers:l,parts:[]}),e._parts[i].parts.push({id:parseInt(t.getAttribute("id")),colorable:"1"===t.getAttribute("colorable")&&n,colorindex:parseInt(t.getAttribute("colorindex")),index:parseInt(t.getAttribute("index")),paletteid:x,set:a,type:i})})}})}},{key:"invalidate",value:function(){this._parts={},this._sprites={},this.decideGeometry(),this.gatherParts()}},{key:"poof",value:function(){var e=this;if(this.canPoof){var t=[{sprite:new PIXI.extras.AnimatedSprite([dt.getResource(ge.poof["1_1"]).texture,dt.getResource(ge.poof["1_2"]).texture,dt.getResource(ge.poof["1_3"]).texture,dt.getResource(ge.poof["1_4"]).texture]),x:-4,y:-36},{sprite:new PIXI.extras.AnimatedSprite([dt.getResource(ge.poof["2_1"]).texture,dt.getResource(ge.poof["2_2"]).texture,dt.getResource(ge.poof["2_3"]).texture,dt.getResource(ge.poof["2_4"]).texture]),x:4,y:36},{sprite:new PIXI.extras.AnimatedSprite([dt.getResource(ge.poof["3_1"]).texture,dt.getResource(ge.poof["3_2"]).texture,dt.getResource(ge.poof["3_3"]).texture,dt.getResource(ge.poof["3_4"]).texture]),x:-4,y:16},{sprite:new PIXI.extras.AnimatedSprite([dt.getResource(ge.poof["3_1"]).texture,dt.getResource(ge.poof["3_2"]).texture,dt.getResource(ge.poof["3_3"]).texture,dt.getResource(ge.poof["3_4"]).texture]),x:4,y:-16}],a=this._width/2,i=this._height/2,r=function r(o){e.addChild(o.sprite),o.sprite.anchor.set(.5),o.sprite.animationSpeed=.2,o.sprite.loop=!1,o.sprite.hitArea=null,o.sprite.position.x=a+o.x,o.sprite.position.y=i+o.y,o.sprite.play(),setTimeout(function(){return e.removeChild(o.sprite)},330),void 0!==t[0]&&setTimeout(function(){return r(t.shift())},45)};r(t.shift())}}},{key:"render",value:function(){var e=this;if(this._loading){var a=new PIXI.filters.AlphaFilter;a.alpha=.8,this.filters=[a]}else this.filters=[];var i="std";this.hasActivePartSet("handLeft")?i=3<this.direction&&7>this.direction?"rh-up":"lh-up":this.hasActivePartSet("handRightAndHead")&&(i=3<this.direction&&7>this.direction?"lh-up":"rh-up");var r=t("action[id=\""+i+"\"] direction[id=\""+this.direction+"\"] partList part",v()).map(function(e){return e.getAttribute("set-type")});for(0===r.length&&(r=t("action[id=\"std\"] direction[id=\""+this.direction+"\"] partList part",v()).map(function(e){return e.getAttribute("set-type")}));this.partContainer.children[0];)this.partContainer.removeChild(this.partContainer.children[0]);var o=!0,n=!1,l=void 0;try{for(var x,d,s=r[Symbol.iterator]();!(o=(x=s.next()).done);o=!0)d=x.value,void 0!==this._sprites[d]&&this._sprites[d].forEach(function(t){return e.partContainer.addChild(t)})}catch(e){n=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(n)throw l}}}},{key:"update",value:function(){var e=this;this.actions.forEach(function(t){return e.updateAction(t)}),this.render()}},{key:"updateAction",value:function(){var e=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i={x:this._width/2,y:this._height/2},r=this.getActivePartSets(a),o=++this._frames[a.id]||0,n=[],l=this._loading?null===ue?{}:ue._parts:this._parts;l.forEach(function(e){return n.push.apply(n,ee(e.hiddenlayers))});var x=[];this.getBodyparts().forEach(function(t){return x.push(k().querySelector("type[id=\""+e.geometry+"\"] bodypart[id=\""+t+"\"]"))});var d=!0,s=!1,u=void 0;try{for(var c,h=x.sort(ce)[Symbol.iterator]();!(d=(c=h.next()).done);d=!0){var g=c.value,y=g.getAttribute("id"),f=t("item",g).sort(ce),v=!0,m=!1,b=void 0;try{for(var T,S,R=function(){var t=T.value,x="head"===y?e.headDirection:e.direction,d=t.getAttribute("id"),s=x,u=d,c=!1,h=P(d);null!==h&&n.push(h),3<x&&7>x&&(c=!0,d=A(d));var f=p(d),v=C(a.id,d);if(-1===r.indexOf(d))return"continue";if(void 0===e._sprites[u]&&(e._sprites[u]={}),-1<n.indexOf(d))return"continue";if(void 0===l[u])return"continue";var m=!0,k=!1,b=void 0;try{for(var S,R,E=function(){var t=S.value;if(e._loading&&"hh_human_body"!==t.library)return"break";var r={x:parseInt(g.getAttribute("x")),y:parseInt(g.getAttribute("y"))},n=!1,l=o%(null===v?1:Object.values(v).length),p=v&&v[l]?v[l].assetpartdefinition:a.assetpartdefinition;-1===f.indexOf(p)&&(p=f[0]),x="head"===y?e.headDirection:e.direction,l=v&&v[l]?v[l].number:0;var h=O(a.id,y,o%H(a.id),x),m=function(){return"h_"+p+"_"+d+"_"+t.id+"_"+x+"_"+l},k=w(t.library,m(),i);if(null===k){var b=l;l=0,k=w(t.library,m(),i),l=b}if(null===k&&(x=6-x,n=3<s&&7>s,k=w(t.library,m(),i)),null===k){var T=p;p="std",k=w(t.library,m(),i),p=T}if(null===k)return"break";if(c?(k.x-=r.x+h.x,k.y-=r.y+h.y):(k.x+=r.x+h.x,k.y+=r.y+h.y),n&&(k.scale.x=-1,k.x=e._width-k.width-k.x+k.width+h.x),k.x=N(k.x),k.y=N(k.y),t.colorable&&"ey"!==d&&!e._loading){var A=e.figure.parts[t.set].color,P=A[t.colorindex-1]||A[0],C=_().querySelector("palette[id=\""+t.paletteid+"\"] color[id=\""+P+"\"]");null!==C&&(k.tint=parseInt("0x"+C.textContent))}void 0!==e._sprites[u][t.index]&&e._sprites[u][t.index].destroy(!1),e._sprites[u][t.index]=k},F=l[u].parts[Symbol.iterator]();!(m=(S=F.next()).done)&&(R=E(),"break"!==R);m=!0);}catch(e){k=!0,b=e}finally{try{!m&&F.return&&F.return()}finally{if(k)throw b}}},E=f[Symbol.iterator]();!(v=(T=E.next()).done);v=!0)S=R(),"continue"===S}catch(e){m=!0,b=e}finally{try{!v&&E.return&&E.return()}finally{if(m)throw b}}}}catch(e){s=!0,u=e}finally{try{!d&&h.return&&h.return()}finally{if(s)throw u}}}},{key:"destroy",value:function(){dt.getManager(ye).removeAvatar(this)}}]),i}(PIXI.Container),oe="https://cdn.mili.us/time",ne={},le={},xe={},de={},se=null,pe=null,ue=null,ce=function(e,t){return t.getAttribute("z")-e.getAttribute("z")},he=function(){function e(){X(this,e),this._name=this.constructor.name}return Y(e,[{key:"display",get:function(){return dt.display}},{key:"loader",get:function(){return dt.loader}},{key:"name",get:function(){return this._name}},{key:"stage",get:function(){return dt.stage}}]),Y(e,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:te.debug("Initializing manager: "+this.name);case 1:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){}}]),e}(),ge={poof:{"1_1":"./resource/image/avatar/poof/1-1.png","1_2":"./resource/image/avatar/poof/1-2.png","1_3":"./resource/image/avatar/poof/1-3.png","1_4":"./resource/image/avatar/poof/1-4.png","2_1":"./resource/image/avatar/poof/2-1.png","2_2":"./resource/image/avatar/poof/2-2.png","2_3":"./resource/image/avatar/poof/2-3.png","2_4":"./resource/image/avatar/poof/2-4.png","3_1":"./resource/image/avatar/poof/3-1.png","3_2":"./resource/image/avatar/poof/3-2.png","3_3":"./resource/image/avatar/poof/3-3.png","3_4":"./resource/image/avatar/poof/3-4.png","4_1":"./resource/image/avatar/poof/4-1.png","4_2":"./resource/image/avatar/poof/4-2.png","4_3":"./resource/image/avatar/poof/4-3.png","4_4":"./resource/image/avatar/poof/4-4.png"}},ye=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.avatars=[],e.lastUpdate=0,e}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){var a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:return e.next=4,c("actions",this.loader);case 4:return e.next=6,c("animations",this.loader);case 6:return e.next=8,c("draworder",this.loader);case 8:return e.next=10,c("effectmap",this.loader);case 10:return e.next=12,c("figuredata",this.loader);case 12:return e.next=14,c("figuremap",this.loader);case 14:return e.next=16,c("geometry",this.loader);case 16:return e.next=18,c("offsets",this.loader);case 18:return e.next=20,c("partsets",this.loader);case 20:return e.next=22,h("hh_human_body",this.loader);case 22:return e.next=24,h("hh_human_face",this.loader);case 24:ge.poof.forEach(function(e){return a.loader.add(e)});case 25:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initializeRenderer",value:function(){var e=this;x(),dt.ticker.add(function(){(-1===e.lastUpdate||90<dt.ticker.lastTime-e.lastUpdate)&&(e.lastUpdate=dt.ticker.lastTime,e.avatars.forEach(function(e){return e.build()}))})}},{key:"newAvatar",value:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=new(Function.prototype.bind.apply(re,[null].concat(t)));return this.avatars.push(i),i}},{key:"removeAvatar",value:function(e){this.avatars=this.avatars.filter(function(t){return t.id!==e.id})}}]),t}(he),fe="./resource/config/config.json",ve=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.config={},e}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){var a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:this.loader.add(fe,0).on("complete",function(){return a.onConfigLoaded(dt.getResource(fe))});case 3:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,i=E(e,this.config);return void 0===i&&void 0!==a?a:R(i,Object.assign({},t,this.config))}},{key:"onConfigLoaded",value:function(e){void 0===e||(this.config=e.data)}}]),t}(he),_e="./resource/config/texts.json",me=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texts={},e}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){var a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:this.loader.add(_e,0).on("complete",function(){return a.onTextsLoaded(dt.getResource(_e))});case 3:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,i=E(e,this.texts);return void 0===i&&void 0!==a?a:R(i,Object.assign({},t,this.text,dt.getManager(ve).config))}},{key:"onTextsLoaded",value:function(e){void 0===e||(this.texts=e.data)}}]),t}(he),ke="/resource/image/logo.png",be=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.barColor=8947848,e.barHeight=12,e.barThickness=2,e.barWidth=300,e.percentage=0,dt.display.ticker.add(function(t){return e.onTick(t)}),e}return J(t,e),Y(t,[{key:"onTick",value:function(){this.clear(),this.beginFill(this.barColor),this.drawRect(0,0,I(this.percentage/100*this.barWidth),this.barHeight),this.endFill(),this.lineStyle(this.barThickness,this.barColor),this.moveTo(-this.barThickness,-this.barThickness),this.lineTo(this.barWidth+this.barThickness,-this.barThickness),this.lineTo(this.barWidth+this.barThickness,this.barHeight+this.barThickness),this.lineTo(-this.barThickness,this.barHeight+this.barThickness),this.lineTo(-this.barThickness,-this.barThickness)}}]),t}(PIXI.Graphics),we=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.loader=new PIXI.loaders.Loader,e.loadingBar=new be,e.logo=null,e.init(),e.loadResources(),dt.display.ticker.add(function(t){return e.onTick(t)}),e}return J(t,e),Y(t,[{key:"percentage",get:function(){return this.loadingBar.percentage||0},set:function(e){this.loadingBar.percentage=I(e)}}]),Y(t,[{key:"init",value:function(){var e=new PIXI.TextStyle({align:"center",fontFamily:"Segoe UI",fontSize:13,fill:"white",wordWrap:!0,wordWrapWidth:360});this.text=new PIXI.Text("",e)}},{key:"loadResources",value:function(){var e=this;this.loader.add(ke).load(function(){return e.onResourcesLoaded()})}},{key:"onResourcesLoaded",value:function(){var e=this;this.logo=new PIXI.Sprite(dt.getResource(ke,this.loader).texture),this.addChild(this.logo),this.addChild(this.loadingBar),this.addChild(this.text),this.emit("loader-ready"),dt.loader.on("progress",function(t){return e.percentage=t.progress})}},{key:"onTick",value:function(){var e=this.percentage;this.clear();var t=dt.display.height,a=dt.display.width;this.beginFill(0),this.drawRect(0,0,a,t),this.endFill(),this.loadingBar.position.x=I(a/2-this.loadingBar.width/2),this.loadingBar.position.y=t-(this.loadingBar.height+91),null!==this.logo&&(this.logo.x=I(a/2-this.logo.width/2),this.logo.y=I(t/2-this.logo.height/2)),this.text.text=dt.getManager(me).getString("loading-view.starting-up",{percentage:e},""),this.text.position.set(N(a/2-this.text.width/2),this.loadingBar.position.y-30)}}]),t}(PIXI.Graphics),Te=0,Ae=function(t){function a(){X(this,a);var t=$(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(t.dpi=1,t.mount=document.querySelector("main#stage-mount"),null===t.mount)throw new Error("Display mount not found!");return e(t.mount),t.initApp(),t.initEvents(),t.ticker.add(function(){return Te++}),t}return J(a,t),Y(a,[{key:"frame",get:function(){return Te}},{key:"renderer",get:function(){return this.app.renderer}},{key:"stage",get:function(){return this.app.stage}},{key:"ticker",get:function(){return this.app.ticker}},{key:"view",get:function(){return this.app.view}},{key:"height",get:function(){return this.renderer.height/this.dpi}},{key:"width",get:function(){return this.renderer.width/this.dpi}}]),Y(a,[{key:"initApp",value:function(){this.app=new PIXI.Application({height:window.innerHeight/this.dpi,width:window.innerWidth/this.dpi,antialiasing:!1,transparent:!1,resolution:this.dpi,roundPixels:!1}),this.mount.appendChild(this.view)}},{key:"initEvents",value:function(){var e=this;window.addEventListener("resize",function(){return e.onWindowResize()})}},{key:"onWindowResize",value:function(){this.renderer.resize(window.innerWidth/this.dpi,window.innerHeight/this.dpi),this.emit("resize")}}]),a}(PIXI.utils.EventEmitter),Pe=54,Se=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.draw(),dt.display.on("resize",function(){return e.draw()}),e}return J(t,e),Y(t,[{key:"draw",value:function(){this.clear(),this.beginFill(2367772),this.drawRect(0,0,dt.display.width,Pe),this.endFill(),this.beginFill(2565407),this.drawRect(0,0,dt.display.width,6),this.endFill(),this.beginFill(2104601),this.drawRect(0,Pe-6,dt.display.width,6),this.endFill(),this.beginFill(3354923),this.drawRect(0,Pe,dt.display.width,3),this.endFill()}}]),t}(PIXI.Graphics),Ce=60,He=30,Oe=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._avatarHolder=new PIXI.Graphics,e._avatarHolder.buttonMode=!0,e._avatarHolder.interactive=!0,e._avatarHolder.on("pointerover",function(){return e.onAvatarHover()}),e._avatarHolder.on("pointerout",function(){return e.onAvatarLeave()}),e._avatar=dt.getManager(ye).newAvatar("","vertical","head"),e.avatar.canPoof=!1,e.avatar.headDirection=3,e.avatar.position.x=-15,e.avatar.position.y=-11,e.avatar.update(),e._avatarHolder.addChild(e.avatar),e._chatBubble=new Re,e.chatBubble.position.x=Ce+8,e.chatBubble.position.y=8,e.chatBubble.on("pointerover",function(){return e.onChatBubbleHover()}),e.chatBubble.on("pointerout",function(){return e.onChatBubbleLeave()}),e.addChild(e._avatarHolder),e.addChild(e.chatBubble),e.draw(),dt.display.on("resize",function(){return e.draw()}),setTimeout(function(){return e.avatar.addAction("GestureSmile")},500),e}return J(t,e),Y(t,[{key:"avatar",get:function(){return this._avatar}},{key:"chatBubble",get:function(){return this._chatBubble}}]),Y(t,[{key:"draw",value:function(){this.position.x=16,this.position.y=dt.display.height-(Ce+16),this._avatarHolder.clear(),this._avatarHolder.beginFill(0,.25),this._avatarHolder.drawCircle(He,He+2,He+2),this._avatarHolder.endFill(),this._avatarHolder.beginFill(801381),this._avatarHolder.lineStyle(4,2379124),this._avatarHolder.drawCircle(He,He,He),this._avatarHolder.endFill()}},{key:"onAvatarHover",value:function(){this.avatar.removeAction("GestureSmile"),this.avatar.addAction("GestureSurprised")}},{key:"onAvatarLeave",value:function(){this.avatar.removeAction("GestureSurprised"),this.avatar.addAction("GestureSmile")}},{key:"onChatBubbleHover",value:function(){this.avatar.removeAction("GestureSmile"),this.avatar.addAction("Talk")}},{key:"onChatBubbleLeave",value:function(){this.avatar.removeAction("Talk"),this.avatar.addAction("GestureSmile")}}]),t}(PIXI.Container),Re=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.interactive=!0,e.imLeft=new PIXI.Sprite(dt.getResource(Ee.chatBubble.left).texture),e.imMiddle=new PIXI.extras.TilingSprite(dt.getResource(Ee.chatBubble.middle).texture),e.imRight=new PIXI.Sprite(dt.getResource(Ee.chatBubble.right).texture),e.imLeft.height=44,e.imMiddle.height=44,e.imRight.height=44,e.addChild(e.imLeft),e.addChild(e.imMiddle),e.addChild(e.imRight),e.draw(),e}return J(t,e),Y(t,[{key:"draw",value:function(){var e=100;this.imLeft.position.x=0,this.imLeft.position.y=0,this.imMiddle.position.x=17,this.imMiddle.position.y=0,this.imMiddle.width=e,this.imRight.position.x=17+e,this.imRight.position.y=0}}]),t}(PIXI.Graphics),Ee={chatBubble:{left:"./resource/image/interface/chat-bubble/left.png",middle:"./resource/image/interface/chat-bubble/middle.png",right:"./resource/image/interface/chat-bubble/right.png"}},Fe=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._memenu=new Oe,e._toolbar=new Se,e.addChild(e.memenu),e.addChild(e.toolbar),e.memenu.avatar.figure="hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92",e}return J(t,e),Y(t,[{key:"memenu",get:function(){return this._memenu}},{key:"toolbar",get:function(){return this._toolbar}}]),t}(PIXI.Container),ze=function(e){function t(){return X(this,t),$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:this.loader.add(Ee.chatBubble.left),this.loader.add(Ee.chatBubble.middle),this.loader.add(Ee.chatBubble.right);case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(he),Le=function(e){function t(e){X(this,t);var a=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.row=0,a.column=0,a.interactive=!0,a.thickness=e,a.on("click",function(){return a.onClick()}),a.on("pointerover",function(){return a.onMouseOver()}),a.on("pointerout",function(){return a.onMouseOut()}),a}return J(t,e),Y(t,[{key:"onClick",value:function(){this.emit("tile-click",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOver",value:function(){this.emit("tile-hover",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOut",value:function(){this.emit("tile-leave",{row:this.row,column:this.column,x:this.x,y:this.y,width:this.width,height:this.height,tile:this})}}]),t}(PIXI.Graphics),Be=function(e){function t(e){return X(this,t),$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return J(t,e),t}(Le),Me=function(e){function t(e){X(this,t);for(var a=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=[],r=0;4>r;r++){var o=8*r,n=12*r,l=[new PIXI.Point(Ve/2+o,n),new PIXI.Point(Ve/2+Ve/8+o,Ge/8+n),new PIXI.Point(Ve/2-24+o,20+n),new PIXI.Point(o,Ge/2+n)];i.push.apply(i,l),F(a,l,a.thickness)}return a}return J(t,e),t}(Le),We=function(e){function t(e){X(this,t);for(var a=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=0;4>i;i++){var r=-8*i,o=12*i,n=[new PIXI.Point(Ve/2+r,o),new PIXI.Point(Ve+r,Ge/2+o),new PIXI.Point(Ve/2+24+r,20+o),new PIXI.Point(Ve/2-Ve/8+r,Ge/8+o)];F(a,n,a.thickness)}return a}return J(t,e),t}(Le),De=function(e){function t(e){X(this,t);var a=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=[new PIXI.Point(Ve/2,0),new PIXI.Point(Ve,Ge/2),new PIXI.Point(Ve/2,Ge),new PIXI.Point(0,Ge/2)];return F(a,i,a.thickness),a}return J(t,e),t}(Le),qe=5e3,Ge=32,je=Ge/2,Ve=64,Ie=Ve/2,Ue={South:3,SouthEast:2,SouthWest:4},Ne=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=[new PIXI.Point(Ve/2,0),new PIXI.Point(Ve,Ge/2),new PIXI.Point(Ve/2,Ge),new PIXI.Point(0,Ge/2)];return e.lineStyle(4,16777215),e.moveTo(a[0].x,a[0].y-1),e.lineTo(a[1].x,a[1].y-1),e.lineTo(a[2].x,a[2].y-1),e.lineTo(a[3].x,a[3].y-1),e.lineTo(a[0].x,a[0].y-1),e.endFill(),e.filters=[r(new PIXI.filters.DropShadowFilter,function(e){e.color=0,e.alpha=.2,e.blur=0,e.distance=2,e.rotation=90})],e}return J(t,e),Y(t,[{key:"hover",value:function(e,t,a){this.position.x=e,this.position.y=t-2,this.z=a}},{key:"getRoomOffsets",value:function(){return{x:-Ie,y:-je}}}]),t}(PIXI.Graphics),Ze=[];Ze.push("\nxxxxx\nx000x\n0000x\nx000x\nx000x\nx000x\nxxxxx\n"),Ze.push("\nxxxxx\nx110x\nx110x\nx000x\nxxxxx\n"),Ze.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx2222xxxxxxxxxxxxxx\nx2222xxxxxxxxxxxxxx\nx2222211111xx000000\nx222221111110000000\nx222221111110000000\nx2222211111xx000000\nxx22xxx1111xxxxxxxx\nxx11xxx1111xxxxxxxx\nx1111xx1111xx000000\nx1111xx111110000000\nx1111xx111110000000\nx1111xx1111xx000000\nxxxxxxxxxxxxxxxxxxx\n"),Ze.push("\nxxxxxxxxxxxxxxxxxxxxxx\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx000x11xxxxxxxx11x000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\n000000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nxxxxxxxxxxxxxxxxxxxxxx\n"),Ze.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx2222xx111111111111\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\n22222xx000000000000\nx2222xx000000000000\nxxxxxxxxxxxxxxxxxxx\n"),Ze.push("\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x00000000xxxxxxxx00000000xxxx\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\n0000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n");var Xe=function(e){function t(e,a,i){X(this,t);var r=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.interactive=!0,r.doorHeight=85,r.floorThickness=e,r.wallHeight=115+i*Ge,r.wallThickness=a,r}return J(t,e),t}(PIXI.Graphics),Ye=function(e){function t(e,a,i,r){X(this,t);var o=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,i)),n=r?o.doorHeight+o.floorThickness:0;return r||(o.beginFill(9869217),o.moveTo(Ie,je+o.floorThickness),o.lineTo(Ie+o.wallThickness,je+o.floorThickness-o.wallThickness/2),o.lineTo(Ie+o.wallThickness,je-o.wallThickness/2-o.wallHeight),o.lineTo(Ie,je-o.wallHeight),o.lineTo(Ie,je+o.floorThickness),o.endFill()),o.beginFill(11909577),o.moveTo(Ie,je+o.floorThickness-n),o.lineTo(Ie,je-o.wallHeight),o.lineTo(0,je-o.wallHeight-je),o.lineTo(0,o.floorThickness-n),o.lineTo(Ie,je+o.floorThickness-n),o.endFill(),o.beginFill(7434875),o.moveTo(Ie,je-o.wallHeight),o.lineTo(0,je-o.wallHeight-je),o.lineTo(o.wallThickness,je-o.wallHeight-je-o.wallThickness/2),o.lineTo(Ie+o.wallThickness,je-o.wallHeight-o.wallThickness/2),o.lineTo(Ie,je-o.wallHeight),o.endFill(),o}return J(t,e),t}(Xe),Qe=function(e){function t(e,a,i){X(this,t);var r=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,i));return r.beginFill(7434875),r.moveTo(0,-r.wallHeight),r.lineTo(r.wallThickness,-r.wallHeight-r.wallThickness/2),r.lineTo(0,-r.wallHeight-r.wallThickness),r.lineTo(-r.wallThickness,-r.wallHeight-r.wallThickness/2),r.lineTo(0,-r.wallHeight),r.endFill(),r}return J(t,e),t}(Xe),Je=function(e){function t(e,a,i,r){X(this,t);var o=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,i)),n=r?o.doorHeight+o.floorThickness:0;return r||(o.beginFill(12238542),o.moveTo(-Ie,je+o.floorThickness),o.lineTo(-Ie,je-o.wallHeight),o.lineTo(-Ie-o.wallThickness,je-o.wallHeight-o.wallThickness/2),o.lineTo(-Ie-o.wallThickness,je+o.floorThickness-o.wallThickness/2),o.lineTo(-Ie,je+o.floorThickness),o.endFill()),o.beginFill(9606045),o.moveTo(-Ie,je+o.floorThickness-n),o.lineTo(-Ie,je-o.wallHeight),o.lineTo(0,je-o.wallHeight-je),o.lineTo(0,o.floorThickness-n),o.lineTo(-Ie,je+o.floorThickness-n),o.endFill(),o.beginFill(7434875),o.moveTo(-Ie,je-o.wallHeight),o.lineTo(0,je-o.wallHeight-je),o.lineTo(-o.wallThickness,je-o.wallHeight-je-o.wallThickness/2),o.lineTo(-Ie-o.wallThickness,je-o.wallHeight-o.wallThickness/2),o.lineTo(-Ie,je-o.wallHeight),o.endFill(),o}return J(t,e),t}(Xe),$e=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._entities=[],e._heightmap={},e._tiles={},e.columns=0,e.rows=0,e.floorThickness=8,e.wallThickness=8,e.highest=0,e.lowest=0,e.offsets={x:0,y:0},e.roomScale=1,e.tileCursor=new Ne,e.tileCursor.visible=!1,i(e),e.prepareHeightmap(Ze[5]),dt.ticker.add(function(){return e.onTick()}),e}return J(t,e),Y(t,[{key:"entities",get:function(){return this._entities}},{key:"heightmap",get:function(){return this._heightmap}},{key:"roomScale",get:function(){return this.scale.x},set:function(e){this.scale.x=e,this.scale.y=e}},{key:"tiles",get:function(){return this._tiles}}]),Y(t,[{key:"clearEverything",value:function(){for(this.clear();this.children[0];)this.removeChild(this.children[0]);this.addChild(this.tileCursor),this._entities=[],this._tiles={}}},{key:"prepareHeightmap",value:function(e){var t=this;this.emit("room-view-emptied"),this.clearEverything();var a=this._heightmap=e.trim().split("\n").map(function(e){return e.split("").map(function(e){return M(e)})}),i=j(this.heightmap),o=i.highest,n=i.lowest;if(this.highest=o,this.lowest=n,0!==a.length){this.columns=a[0].length,this.rows=a.length;for(var l=function(e){t._tiles[e]={};for(var i,o=function(i){var o=t.getTileHeight(e,i);if(null===o)return"continue";var n=D(a,e,i),l=L(a,e,i),d=W(l),s=q(a,e,i),p=G(a,e,i),u=t.getX(e,i),x=t.getY(e,i),c=e*t.columns+i;(s||p)&&function(){var n=[],d=D(a,e-1,i),h=D(a,e,i-1),g=V(t.highest-o);s&&p?(n.push(new Qe(t.floorThickness,t.wallThickness,g)),n.push(new Ye(t.floorThickness,t.wallThickness,g,d)),n.push(new Je(t.floorThickness,t.wallThickness,g,h))):s?n.push(new Ye(t.floorThickness,t.wallThickness,g,d)):p&&n.push(new Je(t.floorThickness,t.wallThickness,g,h));var y=d||h?c+2:c-1,f=!0,v=!1,_=void 0;try{for(var m,k,b=n[Symbol.iterator]();!(f=(m=b.next()).done);f=!0)k=m.value,t.addChild(r(k,function(e){t.entities.push(e),e.x=u+Ie,e.y=x+(void 0===l?0:Ge),e.z=y}))}catch(e){v=!0,_=e}finally{try{!f&&b.return&&b.return()}finally{if(v)throw _}}}(),t.addChild(r(new d(t.floorThickness),function(a){t.entities.push(a),t._tiles[e][i]=a,a.row=e,a.column=i,n&&(a.tint=16711680),s&&p?a.tint=65535:s?a.tint=65280:p&&(a.tint=255),a.on("tile-click",function(e){return t.onTileClick(e)}),a.on("tile-hover",function(e){return t.onTileHover(e)}),a.on("tile-leave",function(e){return t.onTileLeave(e)}),a.x=u,a.y=x,a.z=c}))},n=0;n<a[e].length;n++)i=o(n),"continue"===i},x=0;x<a.length;x++)l(x);this.centerRoom(),this.position.x=N(dt.display.width/2-this.width/2),this.position.y=N(dt.display.height/2-(this.height/2-115)),this.hitArea=new PIXI.Rectangle(-qe,-qe,this.width+2*qe,this.height+2*qe),this.emit("room-view-ready")}}},{key:"associateEntityToTile",value:function(e,t,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=this.getEntityPosition(e,t,a,i);e.position.x=r.x,e.position.y=r.y,e.z=r.z}},{key:"centerEntity",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=dt.display.width/2,i=dt.display.height/2;a-=I(e.x+e.width/2),i-=I(e.y+e.height/2),a-=a%2,t?anime({targets:this,x:a,y:i,duration:800,easing:"easeInOutSine"}):anime({targets:this,x:a,y:i,duration:45,easing:"linear"})}},{key:"centerRoom",value:function(){if(0<this.entities.length){var e=this.entities.reduce(function(e,t){return e.x<t.x?e:t}).x,t=this.entities.filter(function(e){return e instanceof Le}).reduce(function(e,t){return e.y<t.y?e:t}).y;this.offsets.x=-e,this.offsets.y=-t,this.entities.forEach(function(a){a.x-=e,a.y-=t})}}},{key:"getClosestTile",value:function(){}},{key:"getEntityPosition",value:function(e,t,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r={x:0,y:0},o=this.getTile(t,a);void 0!==e.getRoomOffsets&&(r=e.getRoomOffsets());var n=!(o instanceof De),l=this.getX(t,a)+Ie+(r.x+this.offsets.x),d=this.getY(t,a)+je+(r.y+this.offsets.y)+(o&&n?je:0),s=this.getZ(t,a+2,5)+i;return D(this.tiles,t,a)&&(s=this.getRealZ(t,a,i)),{x:l,y:d,z:s,isStairs:n}}},{key:"getTile",value:function(e,t){return void 0===this.tiles[e]?void 0:this.tiles[e][t]||void 0}},{key:"getTileHeight",value:function(e,t){return void 0===this.heightmap[e]?void 0:this.heightmap[e][t]}},{key:"getX",value:function(e,t){return(t-e)*Ie}},{key:"getY",value:function(e,t){var a=this.getTileHeight(e,t);return void 0===a&&(a=0),void 0!==L(this.heightmap,e,t)&&(a+=1),(t+e)*je-a*Ie}},{key:"getZ",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return e*=1e3,t*=1e3,e*this.columns+t+a}},{key:"getRealZ",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return e*this.columns+t+a}},{key:"onTick",value:function(){this.updateLayerOrder()}},{key:"onTileClick",value:function(e){this.emit("tile-click",e)}},{key:"onTileHover",value:function(e){var t=this;setTimeout(function(){var a=t.getEntityPosition(t.tileCursor,e.row,e.column),i=a.x,r=a.y;t.currentHover=[e.row,e.column],t.tileCursor.visible=!0,t.tileCursor.hover(i,r,t.getRealZ(e.row,e.column,1))},1)}},{key:"onTileLeave",value:function(e){var t=this;this.currentHover=void 0,setTimeout(function(){void 0!==t.currentHover&&(e.x!==t.currentHover.x||e.y!==t.currentHover.y)||(t.tileCursor.visible=!1)},2)}}]),t}(PIXI.Graphics),Ke=["hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92","lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92","hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97","hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106","hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324","hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110","hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586"],et=function(){return Ke[N(Math.random()*Ke.length)]},tt=function(){var e=Z(regeneratorRuntime.mark(function e(t,a,i,r,o,n){var l,x,d,s,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=U(V(i-o),V(r-n)),x=t.getEntityPosition(a,o,n,2),a.addAction("Move"),d=0,o<i&&n>r?d=1:o===i&&n>r?d=2:o>i&&n>r?d=3:o>i&&n===r?d=4:o>i&&n<r?d=5:o===i&&n<r?d=6:o<i&&n<r&&(d=7),a.direction=a.headDirection=d,a.z=x.z,s=360*l,p=anime({targets:a,duration:s,x:x.x,y:x.y,easing:"linear"}),e.next=11,p.finished;case 11:return i=o,r=n,a.z=x.z,a.removeAction("Move"),e.abrupt("return",{cr:i,cc:r,avatar:a});case 16:case"end":return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),at={loading:"./resource/image/furni/loading.png"},it=function(e){function t(e){X(this,t);var a=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.furniName=e,a._loadingSprite=new PIXI.Sprite(dt.getResource(at.loading).texture),a.addChild(a._loadingSprite),a.loading=!0,a.render(),a}return J(t,e),Y(t,[{key:"loading",get:function(){return this._loading},set:function(e){this._loading=e}}]),Y(t,[{key:"getRoomOffsets",value:function(){return{x:-(Ie+2),y:-(je+34)}}},{key:"render",value:function(){}}]),t}(PIXI.Container),rt=function(e){function t(){return X(this,t),$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:this.loader.add(at.loading);case 3:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(he),ot={index:n("/room-content/index.xml"),assets:n("/room-content/room_assets.xml"),manifest:n("/room-content/manifest.xml"),visualization:n("/room-content/room_visualization.xml")},nt=function(e){function t(){return X(this,t),$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return J(t,e),Y(t,[{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);case 2:this.loader.add(ot.index),this.loader.add(ot.assets),this.loader.add(ot.manifest),this.loader.add(ot.visualization);case 6:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(he),lt=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.urls=[],e}return J(t,e),Y(t,[{key:"add",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return this.urls.push({stage:t,url:e}),this}},{key:"load",value:function(){te.debug("InitializerLoader","Skipped load() initializing..")}},{key:"realLoad",value:function(e){var a=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;this.urls.filter(function(e){return e.stage===i}).map(function(e){return e.url}).forEach(function(e){return Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",a).call(a,e)}),Q(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,e)}}]),t}(PIXI.loaders.Loader),xt=function(e){function t(){X(this,t);var e=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._display=new Ae,e._loader=new lt,e.managers=[],e}return J(t,e),Y(t,[{key:"display",get:function(){return this._display}},{key:"loader",get:function(){return this._loader}},{key:"stage",get:function(){return this.display.stage}},{key:"ticker",get:function(){return this.display.ticker}}]),Y(t,[{key:"addDefaultManagers",value:function(){this.addManager(new ve),this.addManager(new me),this.addManager(new ye),this.addManager(new rt),this.addManager(new nt),this.addManager(new ze)}},{key:"addManager",value:function(e){te.debug("Application","Added manager "+e.constructor.name),this.managers.push(e)}},{key:"getManager",value:function(e){return this.managers.find(function(t){return t instanceof e})}},{key:"create",value:function(){var e=this;this.loadingView=new we,this.loadingView.on("loader-ready",function(){return e.emit("application-can-run")}),this.stage.addChild(this.loadingView),this.addDefaultManagers()}},{key:"initialize",value:function(){var e=Z(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.managers.forEach(function(){var e=Z(regeneratorRuntime.mark(function e(a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initialize();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop();}},e,t)}));return function(){return e.apply(this,arguments)}}());case 2:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Z(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.loadingView.loadingBar.alpha=0,setTimeout(function(){return t.loader.realLoad(function(){return t.onLoadingStage0Done()},0)},0);case 2:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onLoadingStage0Done",value:function(){var e=this;this.loadingView.loadingBar.alpha=1,this.loadingView.percentage=0,this.loader.realLoad(function(){return e.onLoadingStage1Done()},1)}},{key:"onLoadingStage1Done",value:function(){var e=this;te.debug("Application","Loading of manager data done!"),this.emit("application-loading-done"),this.getManager(ye).initializeRenderer(),delete this.loader,this.stage.removeChild(this.loadingView);var t=[void 0,void 0],a=[void 0],i=new $e;this.stage.addChild(i),this.stage.addChild(new Fe),i.addChild(t[0]=this.getManager(ye).newAvatar(et(),"vertical","full")),i.addChild(t[1]=this.getManager(ye).newAvatar(et(),"vertical","full")),i.addChild(a[0]=new it("throne")),i.associateEntityToTile(t[0],15,0,2),i.associateEntityToTile(t[1],8,20,2),i.associateEntityToTile(a[0],8,21,2);var r=0,o={cr:15,cc:0,avatar:t[r]};t[0].on("click",function(){return t[0].figure=et()}),t[0].on("click",function(){return i.centerEntity(t[0])}),t[1].addAction("Wave"),t[1].on("click",function(){return t[1].figure=et()}),t[1].on("click",function(){return i.centerEntity(t[1])}),i.centerEntity(t[r]),i.on("tile-click",function(a){return t[r].once("avatar-build",Z(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tt(i,o.avatar,o.cr,o.cc,a.row,a.column);case 2:return e.abrupt("return",o=e.sent);case 3:case"end":return e.stop();}},t,e)})))})}},{key:"getResource",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return(t||this.loader).resources[e]}},{key:"getResources",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return(e||this.loader).resources}}]),t}(PIXI.utils.EventEmitter),dt=new xt,st=function(){function e(){X(this,e)}return Y(e,null,[{key:"init",value:function(){var e=Z(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return te.debug("Bootstrapper","Loading everything.."),PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,dt.create(),dt.on("application-can-run",function(){return dt.run()}),e.next=6,dt.initialize();case 6:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();Array.prototype.pushChain=function(){return this.push.apply(this,arguments),this},Array.prototype.unique=function(){return this.filter(function(e,t,a){return a.indexOf(e)===t})},Object.prototype.forEach=function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t)},PIXI.Container.prototype.updateLayerOrder=function(){var e=this;this.children.sort(function(t,a){var i=t.z||0,r=a.z||0;return i===r?e.children.indexOf(t)-e.children.indexOf(a):i-r})},st.init().then(function(){})})();
//# sourceMappingURL=bundle.js.map
