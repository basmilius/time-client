!function(){"use strict";function d(t,e){var i=1<arguments.length&&void 0!==e?e:document;return[].slice.call(i.querySelectorAll(t))}function r(t,e,i,n,r){var o=new PIXI.Texture(t);return o.frame=new PIXI.Rectangle(e,i,n,r),o}function u(t){t.interactive=!0}function b(t,e){return e(t),t}function o(t){return"https://cdn.mili.us/time"+("/assets"+t)}function a(t){return void 0!==Z[t]}function n(i,n){return new Promise(function(t){var e=o("/clothing/"+i+".xml");n.add(e).on("complete",function(){return void 0===he.getResource(e)?void 0:Y[i]=he.getResource(e).data}),t()})}function l(n,e){return void 0===J[n]?a(n)?Promise.resolve(Z[n]):J[n]=new Promise(function(t){var i=o("/clothing/sprite/"+n+".json");e instanceof le?(e.add(i).use(function(t,e){return t.name===i?(Z[n]=t.data,void x(n,!0).then(function(){return e()})):e()}),t()):(N.debug("Loading avatar clothing library: "+n),e.add(i).on("complete",function(){Z[n]=he.getResource(i,e).data,J[n]=void 0,x(n,!0).then(function(){return t(Z[n])})}).load())}):J[n]}function h(t){var e=s().querySelector('action[id="'+t+'"]'),i={};if(null!==e)return e.attributes.forEach(function(t){return i[t.name]=t.value}),i}function s(){return Y.actions}function z(){return Y.animations}function c(){return Y.draworder}function E(){return Y.figuredata}function f(){return Y.geometry}function H(){return Y.partsets}function D(t,e,i){var n=2<arguments.length&&void 0!==i?i:{x:0,y:0};if(void 0===Z[t])return null;try{var r=Z[t].assets[e];if(void 0===r)return null;var o=new PIXI.Texture(x(t));o.frame=new PIXI.Rectangle(r[0],r[1],r[2],r[3]);var a=new PIXI.Sprite(o);return a.x=n.x-(r[4]+n.x-12),a.y=n.y-(r[5]-n.y/2-6),a}catch(t){return null}}function x(e,t){var i=!!(1<arguments.length&&void 0!==t)&&t;if(void 0===Z[e])return null;if(void 0!==$[e])return i?Promise.resolve($[e]):$[e];if(!i){var n=$[e]=PIXI.Texture.from("data:image/png;base64,"+Z[e].resource);return Z[e].resource=void 0,n}return new Promise(function(t){$[e]=PIXI.Texture.from("data:image/png;base64,"+Z[e].resource),Z[e].resource=void 0,t($[e])})}function p(t){var e=[];return H().querySelectorAll('activePartSet[id="'+t+'"] activePart').forEach(function(t){return e.push(t.getAttribute("set-type"))}),e}function M(t,e,i,n){if(isNaN(i)||isNaN(n))return{x:0,y:0};var r=z().querySelector('action[id="'+t+'"] offsets frame[id="'+i+'"] directions direction[id="'+n+'"] bodypart[id="'+e+'"]');return null===r?{x:0,y:0}:{x:parseInt(r.getAttribute("dx")),y:parseInt(r.getAttribute("dy"))}}function g(t,e){var i=1<arguments.length&&void 0!==e?e:{};return t=t.replace(/\${(.*?)}/g,function(t,e){return v(e,i)})}function v(t,e,i){var n=2<arguments.length&&void 0!==i?i:void 0,r=t.split("."),o=e,a=!0,s=!1,u=void 0;try{for(var l,h,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){if(void 0===o[h=l.value])return n;o=o[h]}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}return o}function y(t,e,i){t.beginFill(10000485),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.endFill(),0<i&&(t.beginFill(8618839),t.moveTo(e[1].x,e[1].y),t.lineTo(e[1].x,e[1].y+i),t.lineTo(e[2].x,e[2].y+i),t.lineTo(e[2].x,e[2].y),t.endFill(),t.beginFill(7302985),t.moveTo(e[3].x,e[3].y),t.lineTo(e[3].x,e[3].y+i),t.lineTo(e[2].x,e[2].y+i),t.lineTo(e[2].x,e[2].y),t.endFill())}function m(t,e){return t.row===e.row&&t.column===e.column?void 0:e.row<t.row&&e.column>t.column?1:e.row===t.row&&e.column>t.column?2:e.row>t.row&&e.column>t.column?3:e.row>t.row&&e.column===t.column?4:e.row>t.row&&e.column<t.column?5:e.row===t.row&&e.column<t.column?6:e.row<t.row&&e.column<t.column?7:0}function k(t,e,i){return T(t,e,i)?[0,1,2,3][w(t,e,i).findIndex(function(t){return null!==t})]:null}function P(t,e,i){var n=_(t,e,i),r=w(t,e,i),o=W(r,4),a=o[0],s=o[1];o[2],o[3];return null!==a&&null!==s&&1===R(n-a)&&1===R(n-s)?3:null!==s&&1===R(n-s)?2:null!==a&&1===R(n-a)?4:-1}function w(t,e,i){return[_(t,e-1,i),_(t,e,i-1),_(t,e,i+1),_(t,e+1,i)]}function _(t,e,i){return void 0===t[e]?null:void 0===t[e][i]?null:t[e][i]}function T(t,e,i){return null!==_(t,e,i)&&1===w(t,e,i).filter(function(t){return null!==t}).length}function O(t,e,i){return null!==t[e][i]}function I(t,e,i){if(T(t,e,i)||!O(t,e,i))return!1;for(var n=e;-1<n;)if(null!==_(t,--n,i)&&!T(t,n,i))return!1;return(null===_(t,e-1,i-1)||T(t,e-1,i-1))&&(null===_(t,e-1,i+1)||T(t,e-1,i+1))}function S(t,e,i){if(T(t,e,i)||!O(t,e,i))return!1;for(var n=i;-1<n;)if(null!==_(t,e,--n)&&!T(t,e,n))return!1;return(null===_(t,e-1,i-1)||T(t,e-1,i-1))&&(null===_(t,e+1,i-1)||T(t,e+1,i-1))}var R=Math.abs,C=Math.round,L=Math.max,V=Math.floor,A=function(t){return function(){var s=t.apply(this,arguments);return new Promise(function(o,a){return function e(t,i){try{var n=s[t](i),r=n.value}catch(t){return void a(t)}return n.done?void o(r):Promise.resolve(r).then(function(t){e("next",t)},function(t){e("throw",t)})}("next")})}},B=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},j=function(){function n(t,e){for(var i,n=0;n<e.length;n++)(i=e[n]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),X=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0===a?void 0:a.call(n)},F=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},q=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},W=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},G=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},N=function(){function t(){B(this,t)}return j(t,null,[{key:"debug",value:function(){}},{key:"error",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).error.apply(t,["[E]"].concat(i))}}]),t}(),e=function(){function e(t){B(this,e),this._parts={},this.parse(t)}return j(e,[{key:"parts",get:function(){return this._parts}}]),j(e,[{key:"hasPartId",value:function(t,e){return!!this.hasPartType(t)&&this._parts[t].id===e}},{key:"hasPartType",value:function(t){return void 0!==this._parts[t]}},{key:"parse",value:function(t){var e=this;(t=(t=(t=t.split(".")).map(function(t){return t.split("-")})).sort(function(t,e){return t[0].localeCompare(e[0])})).forEach(function(t){return e._parts[t[0]]={id:parseInt(t[1]),color:[t[2],t[3]].filter(function(t){return null!==t})}})}},{key:"toString",value:function(){var i=[];return this.parts.forEach(function(t,e){return i.push([e,t.id].concat(G(t.color)).join("-"))}),i.join(".")}}]),e}(),U=function(t){function s(t,e,i){var n=0<arguments.length&&void 0!==t?t:"hd-195-4",r=1<arguments.length&&void 0!==e?e:"vertical",o=2<arguments.length&&void 0!==i?i:"full";B(this,s);var a=q(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return u(a),a.initialBuild=!0,a.canPoof=!1,a.id="avatar-"+window.performance.now(),a.loader=new PIXI.loaders.Loader,a.needsUpdate=!1,a.partContainer=new PIXI.Container,a.addChild(a.partContainer),a._alsoUpdate=[],a._ticker=!1,a._width=0,a._height=0,a._actions=[Q],a._frames={},a.avatarSet=o,a.direction=2,a.figure=n,a.geometry=r,a.headDirection=a.direction,a.build(),a.canPoof=!0,a.initialBuild=!1,a}return F(s,t),j(s,[{key:"actions",get:function(){return this._actions}},{key:"avatarSet",get:function(){return this._avatarSet},set:function(t){this._avatarSet=t}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"figure",get:function(){return this._figure},set:function(t){void 0===t||(this._figure=new e(t),!this.initialBuild&&this.build(),this.poof())}},{key:"geometry",get:function(){return this._geometry},set:function(t){this._geometry=t}},{key:"headDirection",get:function(){return this._headDirection},set:function(t){this._headDirection=t}}]),j(s,[{key:"addAction",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._actions[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(r.value.id===t)return}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}void 0===(t=h(t))||(this._actions.pushChain(t).sort(function(t,e){return K.indexOf(e.id)-K.indexOf(t.id)}),this._frames[t.id]=0,"true"===t.preventheadturn&&(this._headDirection=this.direction))}},{key:"hasAction",value:function(t){var e=!1,i=!0,n=!1,r=void 0;try{for(var o,a=this._actions[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)o.value.id===t&&(e=!0)}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e}},{key:"removeAction",value:function(e){this.hasAction(e)&&(this._actions=this._actions.filter(function(t){return t.id!==e}).sort(function(t,e){return K.indexOf(e.id)-K.indexOf(t.id)}))}},{key:"setPosition",value:function(t,e,i){var n=2<arguments.length&&void 0!==i?i:3;return this.x=t,this.y=e,this.direction=n,this.headDirection=n,this}},{key:"build",value:function(){var e=this;if(!this.isBuilding){this.isBuilding=!0,this.needsUpdate=!0,this.emit("avatar-build",this),this.invalidate();var i=this.getLibraries().filter(function(t){return!a(t)});if(0<i.length){this._loading=!0;!function t(){return 0===i.length?void(e._loading=!1):void l(i.shift(),e.loader).then(t)}()}this.update(),this.isBuilding=!1}}},{key:"decideGeometry",value:function(){var t=f().querySelector('canvas[scale="h"] geometry[id="'+this.geometry+'"]');this._height=parseInt(t.getAttribute("height")),this._width=parseInt(t.getAttribute("width")),"head"===this.geometry&&(this._height=this._width)}},{key:"getActivePartSets",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,i=[];return null===e?i.push.apply(i,G(p("figure"))):i.push.apply(i,G(p(e.activepartset))),i.unique()}},{key:"hasActivePartSet",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o,a=this.actions[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)if(null!==(o=r.value)&&o.activepartset===t)return!0}catch(t){i=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(i)throw n}}return!1}},{key:"getBodyparts",value:function(){var e=[];return d('avatarset[id="'+this.avatarSet+'"] bodypart',f()).forEach(function(t){return e.push(t.getAttribute("id"))}),e}},{key:"getLibraries",value:function(){var n=[];return this._parts.forEach(function(t,i){t.parts.forEach(function(t){var e=Y.figuremap.querySelector('part[id="'+t.id+'"][type="'+i+'"]');null===e||null===e.parentNode||(e=e.parentNode,n.push(t.library=e.getAttribute("id").toLowerCase()))})}),n.unique()}},{key:"getRoomOffsets",value:function(){return{x:-this._width/2,y:-104}}},{key:"gatherParts",value:function(){var l=this;this.figure.parts.forEach(function(t,i){var e=E().querySelector('sets > settype[type="'+i+'"]');if(null!==e){var n=e.querySelector('set[id="'+t.id+'"]'),r=n.getElementsByTagName("part"),o="1"===n.getAttribute("colorable"),a=[],s=e.getAttribute("paletteid"),u=n.querySelectorAll("hiddenlayers layer");null!==u&&u.forEach(function(t){return a.push(t.getAttribute("parttype"))}),r.forEach(function(t){var e=t.getAttribute("type");void 0===l._parts[e]&&(l._parts[e]={hiddenlayers:a,parts:[]}),l._parts[e].parts.push({id:parseInt(t.getAttribute("id")),colorable:"1"===t.getAttribute("colorable")&&o,colorindex:parseInt(t.getAttribute("colorindex")),index:parseInt(t.getAttribute("index")),paletteid:s,set:i,type:e})})}})}},{key:"invalidate",value:function(){this._parts={},this._sprites={},this.decideGeometry(),this.gatherParts()}},{key:"poof",value:function(){var i=this;if(this.canPoof){var n=[{sprite:new PIXI.extras.AnimatedSprite([he.getResource(nt.poof["1_1"]).texture,he.getResource(nt.poof["1_2"]).texture,he.getResource(nt.poof["1_3"]).texture,he.getResource(nt.poof["1_4"]).texture]),x:-4,y:-36},{sprite:new PIXI.extras.AnimatedSprite([he.getResource(nt.poof["2_1"]).texture,he.getResource(nt.poof["2_2"]).texture,he.getResource(nt.poof["2_3"]).texture,he.getResource(nt.poof["2_4"]).texture]),x:4,y:36},{sprite:new PIXI.extras.AnimatedSprite([he.getResource(nt.poof["3_1"]).texture,he.getResource(nt.poof["3_2"]).texture,he.getResource(nt.poof["3_3"]).texture,he.getResource(nt.poof["3_4"]).texture]),x:-4,y:16},{sprite:new PIXI.extras.AnimatedSprite([he.getResource(nt.poof["3_1"]).texture,he.getResource(nt.poof["3_2"]).texture,he.getResource(nt.poof["3_3"]).texture,he.getResource(nt.poof["3_4"]).texture]),x:4,y:-16}],r=this._width/2,o=this._height/2;!function t(e){i.addChild(e.sprite),e.sprite.anchor.set(.5),e.sprite.animationSpeed=.2,e.sprite.loop=!1,e.sprite.hitArea=null,e.sprite.position.x=r+e.x,e.sprite.position.y=o+e.y,e.sprite.play(),setTimeout(function(){return i.removeChild(e.sprite)},330),void 0!==n[0]&&setTimeout(function(){return t(n.shift())},45)}(n.shift())}}},{key:"render",value:function(){var e=this;this.partContainer.cacheAsBitmap=!1,this.alpha=this._loading?.8:1;var t="std";this.hasActivePartSet("handLeft")?t=3<this.direction&&this.direction<7?"rh-up":"lh-up":this.hasActivePartSet("handRightAndHead")&&(t=3<this.direction&&this.direction<7?"lh-up":"rh-up");var i=d('action[id="'+t+'"] direction[id="'+this.direction+'"] partList part',c()).map(function(t){return t.getAttribute("set-type")});for(0===i.length&&(i=d('action[id="std"] direction[id="'+this.direction+'"] partList part',c()).map(function(t){return t.getAttribute("set-type")}));this.partContainer.children[0];)this.partContainer.removeChild(this.partContainer.children[0]);var n=!0,r=!1,o=void 0;try{for(var a,s,u=i[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)s=a.value,void 0!==this._sprites[s]&&this._sprites[s].forEach(function(t){return e.partContainer.addChild(t)})}catch(e){r=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw o}}this.partContainer.cacheAsBitmap=!0}},{key:"update",value:function(){var e=this;this.needsUpdate&&(this.actions.forEach(function(t){return e.updateAction(t)}),this.render())}},{key:"updateAction",value:function(t){var T=this,O=0<arguments.length&&void 0!==t?t:null,I={x:this._width/2,y:this._height/2};if(null!==O){var S=this.getActivePartSets(O),R=++this._frames[O.id]||0,C=[],A=this._loading?null===tt?{}:tt._parts:this._parts;if(void 0!==A){A.forEach(function(t){return C.push.apply(C,G(t.hiddenlayers))});var e=[];this.getBodyparts().forEach(function(t){return e.push(f().querySelector('type[id="'+T.geometry+'"] bodypart[id="'+t+'"]'))});var i=!0,n=!1,r=void 0;try{for(var o,a=e.sort(et)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var B=o.value,j=B.getAttribute("id"),s=d("item",B).sort(et),u=!0,l=!1,h=void 0;try{for(var X,c=function(){var t,e,i,n,r=X.value,v="head"===j?T.headDirection:T.direction,y=r.getAttribute("id"),m=v,w=y,_=!1,o=(t=y,null!==(e=H().querySelector('partSet part[set-type="'+t+'"]').getAttribute("remove-set-type"))&&""!==e?e:null);null!==o&&C.push(o),3<v&&v<7&&(_=!0,i=y,n=H().querySelector('partSet part[set-type="'+i+'"]').getAttribute("flipped-set-type"),y=null!==n&&""!==n?n:i);var a,s,u,l,h,c,b=(c=["std"],"bd"===(h=y)?c.push("sit","lay","wlk"):"hd"===h?c.push("lsp","lay","spk"):"fa"===h?c.push("lsp","lay"):"ea"===h?c.push("lay"):"ey"===h?c.push("agr","sad","sml","srp","lag","lsp","lay","eyb"):"fc"===h?c.push("agr","blw","sad","spk","srp","sml","lsp","lay"):"hr"===h||"hrb"===h?c.push("lay"):"he"===h?c.push("lay"):"ha"===h?c.push("spk","lay"):"ch"===h?c.push("lay"):"cc"===h?c.push("lay"):"ca"===h?c.push("lay"):"lg"===h?c.push("sit","wlk","lay"):"lh"===h?c.push("respect","sig","wav","wlk","lay"):"ls"===h?c.push("wlk","wav","lay"):"lc"===h?c.push("wlk","wav","lay"):"rh"===h?c.push("drk","crr","wlk","lay","blw"):"rs"===h?c.push("drk","crr","wlk","lay"):"rc"===h?c.push("drk","crr","wlk","lay"):"ri"===h?c.push("crr","drk"):"li"===h?c.push("sig"):"sh"===h&&c.push("sit","wlk","lay"),c),k=(a=O.id,s=y,u=z().querySelectorAll('action[id="'+a+'"] part[set-type="'+s+'"] frame'),l=[],u.forEach(function(t){for(var e=t.hasAttribute("repeats")?parseInt(t.getAttribute("repeats")):1,i=0;i<e;i++)l.push({number:parseInt(t.getAttribute("number")),assetpartdefinition:t.getAttribute("assetpartdefinition")})}),l);if(-1===S.indexOf(w))return"continue";if(void 0===T._sprites[w]&&(T._sprites[w]={}),-1<C.indexOf(y))return"continue";if(void 0===A[w])return"continue";var x=!0,d=!1,f=void 0;try{for(var P,p=function(){var t=P.value;if(T._loading&&"hh_human_body"!==t.library)return"break";var e=parseInt(B.getAttribute("x")),i=parseInt(B.getAttribute("y")),n=!1,r=R%(null===k?1:Object.values(k).length),o=k&&k[r]?k[r].assetpartdefinition:O.assetpartdefinition;-1===b.indexOf(o)&&(o=b[0]),v="head"===j?T.headDirection:T.direction,r=k&&k[r]?k[r].number:0;var a,s,u,l=M(O.id,j,R%(a=O.id,s=z().querySelectorAll('action[id="'+a+'"] part:first-child frame').length,u=z().querySelectorAll('action[id="'+a+'"] offsets frame').length,L(s,u)),v),h=function(){return"h_"+o+"_"+y+"_"+t.id+"_"+v+"_"+r},c=D(t.library,h(),I);if(null===c){var x=r;r=0,c=D(t.library,h(),I),r=x}if(null===c&&(v=6-v,n=3<m&&m<7,c=D(t.library,h(),I)),null===c){var d=o;o="std",c=D(t.library,h(),I),o=d}if(null===c)return"break";if(_?(c.x-=e+l.x,c.y-=i+l.y):(c.x+=e+l.x,c.y+=i+l.y),n&&(c.scale.x=-1,c.x=T._width-c.width-c.x+c.width+l.x),c.x=V(c.x),c.y=V(c.y),t.colorable&&"ey"!==y&&!T._loading){var f=T.figure.parts[t.set].color,p=f[t.colorindex-1]||f[0],g=E().querySelector('palette[id="'+t.paletteid+'"] color[id="'+p+'"]');null!==g&&(c.tint=parseInt("0x"+g.textContent))}void 0!==T._sprites[w][t.index]&&T._sprites[w][t.index].destroy(!1),T._sprites[w][t.index]=c},g=A[w].parts[Symbol.iterator]();!(x=(P=g.next()).done)&&"break"!==p();x=!0);}catch(t){d=!0,f=t}finally{try{!x&&g.return&&g.return()}finally{if(d)throw f}}},x=s[Symbol.iterator]();!(u=(X=x.next()).done);u=!0)c()}catch(T){l=!0,h=T}finally{try{!u&&x.return&&x.return()}finally{if(l)throw h}}}}catch(T){n=!0,r=T}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}}}},{key:"destroy",value:function(){he.getManager(rt).removeAvatar(this)}}]),s}(PIXI.Container),Y={},Z={},$={},J={},K=null,Q=null,tt=null,et=function(t,e){return e.getAttribute("z")-t.getAttribute("z")},it=function(){function t(){B(this,t),this._name=this.constructor.name}return j(t,[{key:"display",get:function(){return he.display}},{key:"loader",get:function(){return he.loader}},{key:"name",get:function(){return this._name}},{key:"stage",get:function(){return he.stage}}]),j(t,[{key:"initialize",value:(e=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:N.debug("Initializing manager: "+this.name);case 1:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"dispose",value:function(){}},{key:"log",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).log.apply(t,[this.name].concat(i))}},{key:"logDebug",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).debug.apply(t,[this.name].concat(i))}},{key:"logError",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).error.apply(t,[this.name].concat(i))}},{key:"logWarning",value:function(){for(var t,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).warn.apply(t,[this.name].concat(i))}}]),t;var e}(),nt={poof:{"1_1":"./resource/image/avatar/poof/1-1.png","1_2":"./resource/image/avatar/poof/1-2.png","1_3":"./resource/image/avatar/poof/1-3.png","1_4":"./resource/image/avatar/poof/1-4.png","2_1":"./resource/image/avatar/poof/2-1.png","2_2":"./resource/image/avatar/poof/2-2.png","2_3":"./resource/image/avatar/poof/2-3.png","2_4":"./resource/image/avatar/poof/2-4.png","3_1":"./resource/image/avatar/poof/3-1.png","3_2":"./resource/image/avatar/poof/3-2.png","3_3":"./resource/image/avatar/poof/3-3.png","3_4":"./resource/image/avatar/poof/3-4.png","4_1":"./resource/image/avatar/poof/4-1.png","4_2":"./resource/image/avatar/poof/4-2.png","4_3":"./resource/image/avatar/poof/4-3.png","4_4":"./resource/image/avatar/poof/4-4.png"}},rt=function(){function i(){B(this,i);var t=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.avatars=[],t.lastUpdate=0,he.once("application-loading-done",function(){return t.initializeRenderer()}),t}return F(i,it),j(i,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:return t.next=4,n("actions",this.loader);case 4:return t.next=6,n("animations",this.loader);case 6:return t.next=8,n("draworder",this.loader);case 8:return t.next=10,n("effectmap",this.loader);case 10:return t.next=12,n("figuredata",this.loader);case 12:return t.next=14,n("figuremap",this.loader);case 14:return t.next=16,n("geometry",this.loader);case 16:return t.next=18,n("offsets",this.loader);case 18:return t.next=20,n("partsets",this.loader);case 20:return t.next=22,l("hh_human_body",this.loader);case 22:return t.next=24,l("hh_human_face",this.loader);case 24:nt.poof.forEach(function(t){return e.loader.add(t)});case 25:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"initializeRenderer",value:function(){var t=this;null===K&&(K=d("action",s()).map(function(t){return t.getAttribute("id")})),null===Q&&(Q=h("Default")),null===tt&&(tt=new U("hd-195-1")),he.display.on("tick",function(){return t.onGameTick()})}},{key:"newAvatar",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=new(Function.prototype.bind.apply(U,[null].concat(e)));return this.avatars.push(n),n}},{key:"removeAvatar",value:function(e){this.avatars=this.avatars.filter(function(t){return t.id!==e.id})}},{key:"onGameTick",value:function(){(-1===this.lastUpdate||90<he.ticker.lastTime-this.lastUpdate)&&(this.lastUpdate=he.ticker.lastTime,this.avatars.forEach(function(t){return t.update()}))}}]),i;var t}(),ot=function(){function i(){B(this,i);var t=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.config={},t}return F(i,it),j(i,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:this.loader.add("./resource/config/config.json",0).on("complete",function(){return e.onConfigLoaded(he.getResource("./resource/config/config.json"))});case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getString",value:function(t,e,i){var n=1<arguments.length&&void 0!==e?e:{},r=2<arguments.length&&void 0!==i?i:void 0,o=v(t,this.config);return void 0===o&&void 0!==r?r:g(o,Object.assign({},n,this.config))}},{key:"onConfigLoaded",value:function(t){void 0===t||(this.config=t.data)}}]),i;var t}(),at=function(){function i(){B(this,i);var t=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.texts={},t}return F(i,it),j(i,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initialize",this).call(this);case 2:this.loader.add("./resource/config/texts.json",0).on("complete",function(){return e.onTextsLoaded(he.getResource("./resource/config/texts.json"))});case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getString",value:function(t,e,i){var n=1<arguments.length&&void 0!==e?e:{},r=2<arguments.length&&void 0!==i?i:void 0,o=v(t,this.texts);return void 0===o&&void 0!==r?r:g(o,Object.assign({},n,this.text,he.getManager(ot).config))}},{key:"onTextsLoaded",value:function(t){void 0===t||(this.texts=t.data)}}]),i;var t}(),i=function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.barHeight=30,t.barThickness=2,t.barWidth=300,t.percentage=0,t}return F(e,t),j(e,[{key:"percentage",get:function(){return this._percentage},set:function(t){this._percentage=t,this.render()}}]),j(e,[{key:"render",value:function(){this.clear(),this.beginFill(0),this.lineStyle(this.barThickness,4408131),this.drawRoundedRect(0,0,this.barWidth,this.barHeight,6),this.endFill(),this.beginFill(5723991),this.lineStyle(null),this.drawRoundedRect(this.barThickness,this.barThickness,C(this.percentage/100*(this.barWidth-2*this.barThickness)),this.barHeight-2*this.barThickness,4),this.endFill()}}]),e}(PIXI.Graphics),st=function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.loader=new PIXI.loaders.Loader,t.loadingBar=new i,t.logo=null,t.init(),t.loadResources(),t}return F(e,t),j(e,[{key:"percentage",get:function(){return this.loadingBar.percentage||0},set:function(t){this.loadingBar.percentage=C(t),this.render()}}]),j(e,[{key:"init",value:function(){var t=this,e=new PIXI.TextStyle({align:"center",fontFamily:"proxima-nova",fontSize:15,fontWeight:300,fill:16777215,wordWrap:!0,wordWrapWidth:this.loadingBar.barWidth});this.text=new PIXI.Text("Initializing...",e),he.display.on("resize",function(){return t.render()})}},{key:"loadResources",value:function(){var t=this;this.loader.add("/resource/image/logo.png").load(function(){return t.onResourcesLoaded()})}},{key:"onResourcesLoaded",value:function(){var e=this;this.logo=new PIXI.Sprite(he.getResource("/resource/image/logo.png",this.loader).texture),this.addChild(this.logo),this.addChild(this.loadingBar),this.addChild(this.text),he.loader.on("progress",function(t){return e.percentage=t.progress}),this.render(),this.emit("loader-ready")}},{key:"render",value:function(){var t=this.percentage,e=he.display.height,i=he.display.width;this.loadingBar.position.x=i/2-this.loadingBar.barWidth/2,this.loadingBar.position.y=e-(this.loadingBar.barHeight+60),null!==this.logo&&(this.logo.x=C(i/2-this.logo.width/2),this.logo.y=C(e/2-this.logo.height/2)),this.text.text=he.getManager(at).getString("loading-view.starting-up",{percentage:t},""),this.text.position.set(this.loadingBar.position.x+this.loadingBar.barWidth/2-this.text.width/2,this.loadingBar.position.y-30)}}]),e}(PIXI.Container),ut=0,lt=function(t){function i(){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));if(e.dpi=window.devicePixelRatio,e.mount=document.querySelector("main#stage-mount"),null===e.mount)throw new Error("Display mount not found!");return e.mount.innerHTML="",e.initApp(),e.initEvents(),e.ticker.add(function(t){return e.onTick(t)}),e}return F(i,t),j(i,[{key:"frame",get:function(){return ut}},{key:"renderer",get:function(){return this.app.renderer}},{key:"stage",get:function(){return this.app.stage}},{key:"ticker",get:function(){return this.app.ticker}},{key:"view",get:function(){return this.app.view}},{key:"height",get:function(){return this.renderer.height/this.dpi}},{key:"width",get:function(){return this.renderer.width/this.dpi}},{key:"size",get:function(){return{width:this.width,height:this.height}}}]),j(i,[{key:"initApp",value:function(){this.app=new PIXI.Application({height:window.innerHeight,width:window.innerWidth,antialiasing:!0,transparent:!1,resolution:this.dpi,roundPixels:!1,powerPreference:"high-performance",forceFXAA:!0}),this.mount.appendChild(this.view),this.view.style.height=window.innerHeight+"px",this.view.style.width=window.innerWidth+"px"}},{key:"initEvents",value:function(){var t=this;window.addEventListener("resize",function(){return t.onWindowResize()})}},{key:"onTick",value:function(t){ut++,this.emit("tick",t),0==ut%12&&this.emit("tick-update",t),this.stage.updateLayerOrder()}},{key:"onWindowResize",value:function(){this.renderer.resize(window.innerWidth,window.innerHeight),this.emit("resize"),this.view.style.height=window.innerHeight+"px",this.view.style.width=window.innerWidth+"px"}}]),i}(PIXI.utils.EventEmitter),ht=function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.background=new PIXI.Sprite(he.getResource(Ct.bottomBar.background).texture),t.addChild(t.background),t.addChild(t.meButton=new ct),t.addChild(t.navigatorButton=new yt),t.addChild(t.friendsButton=new pt),t.addChild(t.chatButton=new ft),t.addChild(t.catalogueButton=new dt),t.addChild(t.inventoryButton=new vt),t.addChild(t.helpButton=new gt),t.draw(),he.display.on("resize",function(){return t.draw()}),t}return F(e,t),j(e,[{key:"draw",value:function(){var t=he.display.size,e=t.width,i=t.height;this.x=0,this.y=i-70,this.background.x=0,this.background.y=0,this.background.width=e,this.meButton.x=12,this.navigatorButton.x=e-24-360,this.friendsButton.x=e-24-300,this.chatButton.x=e-24-240,this.catalogueButton.x=e-24-180,this.inventoryButton.x=e-24-120,this.helpButton.x=e-24-60}}]),e}(PIXI.Container),t=function(t){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e}return F(i,t),i}(PIXI.extras.AnimatedSprite),ct=function(t){function n(t){var e=0<arguments.length&&void 0!==t?t:void 0;B(this,n);var i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.avatar=he.getManager(rt).newAvatar(e,"vertical","head"),i.addChild(i.avatar),i.avatar.canPoof=!1,i.avatar.direction=i.avatar.headDirection=3,i.avatar.addAction("GestureSmile"),i.avatar.x=-10,i.avatar.y=-5,i}return F(n,t),j(n,[{key:"figure",get:function(){return this.avatar.figure},set:function(t){this.avatar.figure=t}}]),n}(PIXI.Graphics),xt=function(){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e.on("pointerover",function(){return e.onPointerOver()}),e.on("pointerout",function(){return e.onPointerOut()}),e}return F(i,t),j(i,[{key:"onPointerOver",value:function(){this.animationSpeed=.2,this.play()}},{key:"onPointerOut",value:function(){this.animationSpeed=-.2,this.play()}}]),i}(),dt=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.catalogue).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70),r(t,420,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,xt),i}(),ft=function(){function e(){B(this,e);var t=[r(he.getResource(Ct.bottomBar.chat).texture,0,0,70,70)];return q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return F(e,t),e}(),pt=(function(){function n(){B(this,n);var t=he.getResource(Ct.bottomBar.chatMessages).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}F(n,t)}(),function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.friends).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,xt),i}()),gt=(function(){function n(){B(this,n);var t=he.getResource(Ct.bottomBar.friendsInvited).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}F(n,t)}(),function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.help).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,xt),i}()),vt=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.inventory).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,xt),i}(),yt=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.navigator).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,xt),i}(),mt=(function(t){function e(){return B(this,e),q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}F(e,t)}(PIXI.Container),function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.background=new PIXI.Sprite(he.getResource(Ct.bottomBar.background).texture),t.addChild(t.background),t.addChild(t.meButton=new wt),t.addChild(t.navigatorButton=new It),t.addChild(t.friendsButton=new Pt),t.addChild(t.chatButton=new kt),t.addChild(t.catalogueButton=new bt),t.addChild(t.inventoryButton=new Ot),t.addChild(t.helpButton=new Tt),t.draw(),he.display.on("resize",function(){return t.draw()}),t}F(e,t),j(e,[{key:"draw",value:function(){var t=he.display.size,e=t.width,i=t.height;this.x=0,this.y=i-70,this.background.x=0,this.background.y=0,this.background.width=e,this.meButton.x=12,this.navigatorButton.x=e-24-360,this.friendsButton.x=e-24-300,this.chatButton.x=e-24-240,this.catalogueButton.x=e-24-180,this.inventoryButton.x=e-24-120,this.helpButton.x=e-24-60}}])}(PIXI.Container),function(t){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e}return F(i,t),i}(PIXI.extras.AnimatedSprite)),wt=function(t){function n(t){var e=0<arguments.length&&void 0!==t?t:void 0;B(this,n);var i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.avatar=he.getManager(rt).newAvatar(e,"vertical","head"),i.addChild(i.avatar),i.avatar.canPoof=!1,i.avatar.direction=i.avatar.headDirection=3,i.avatar.addAction("GestureSmile"),i.avatar.x=-10,i.avatar.y=-5,i}return F(n,t),j(n,[{key:"figure",get:function(){return this.avatar.figure},set:function(t){this.avatar.figure=t}}]),n}(PIXI.Graphics),_t=function(){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.animationSpeed=.2,e.buttonMode=!0,e.interactive=!0,e.loop=!1,e.on("pointerover",function(){return e.onPointerOver()}),e.on("pointerout",function(){return e.onPointerOut()}),e}return F(i,mt),j(i,[{key:"onPointerOver",value:function(){this.animationSpeed=.2,this.play()}},{key:"onPointerOut",value:function(){this.animationSpeed=-.2,this.play()}}]),i}(),bt=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.catalogue).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70),r(t,420,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,_t),i}(),kt=function(){function e(){B(this,e);var t=[r(he.getResource(Ct.bottomBar.chat).texture,0,0,70,70)];return q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return F(e,mt),e}(),Pt=(function(){function n(){B(this,n);var t=he.getResource(Ct.bottomBar.chatMessages).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}F(n,mt)}(),function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.friends).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,_t),i}()),Tt=(function(){function n(){B(this,n);var t=he.getResource(Ct.bottomBar.friendsInvited).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70)],i=q(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.animationSpeed=.025,i.loop=!0,i.play(),i}F(n,mt)}(),function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.help).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70),r(t,350,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,_t),i}()),Ot=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.inventory).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70),r(t,280,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,_t),i}(),It=function(){function i(){B(this,i);var t=he.getResource(Ct.bottomBar.navigator).texture,e=[r(t,0,0,70,70),r(t,70,0,70,70),r(t,140,0,70,70),r(t,210,0,70,70)];return q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}return F(i,_t),i}(),St=(function(t){function e(){return B(this,e),q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}F(e,t)}(PIXI.Container),function(t){function r(){B(this,r);var t=q(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.x=100,t.y=100,t.z=1e4,t.visible=!1,t.bg=new PIXI.Graphics,t.addChild(t.bg),t.init(),t.title="",t.render(),he.display.on("tick",function(){return t.render()}),function(l){u(l);var h=null,c=null,x=null;l.on("pointerdown",function(t){if(c=t.data,h=l,x=c.getLocalPosition(h),void 0!==l.getDraggableRegion){var e=l.getDraggableRegion(),i=e.x,n=e.y,r=e.width,o=e.height;(x.x<i||x.x>r||x.y<n||x.y>o)&&(h=x=c=null)}}),l.on("pointerup",function(){h=x=c=null}),l.on("pointermove",function(){if(null!==h){var t=c.getLocalPosition(h.parent),e=t.x-x.x,i=t.y-x.y;if(void 0!==l.getDraggingRegion){var n=l.getDraggingRegion(),r=n.x,o=n.y,a=n.width,s=n.height,u=void 0===l.getDraggableRegion?l:l.getDraggableRegion();e<r&&(e=r),e+u.width>a&&(e=a-u.width),i<o&&(i=o),i+u.height>s&&(i=s-u.height)}h.position.x=e,h.position.y=i}})}(t),t}return F(r,t),j(r,[{key:"height",get:function(){return this._height},set:function(t){this._height=t}},{key:"opened",get:function(){return this.visible}},{key:"title",get:function(){return this.titleText.text.trim()},set:function(t){this.titleText.text=t}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}}]),j(r,[{key:"init",value:function(){var t=new PIXI.TextStyle({align:"center",fontFamily:"proxima-nova",fontSize:15,fontWeight:700,fill:15000804});this.titleText=new PIXI.Text("",t),this.addChild(this.titleText),this.filters=[b(new PIXI.filters.DropShadowFilter,function(t){t.color=0,t.alpha=.2,t.blur=2,t.distance=1,t.rotation=90})]}},{key:"getDraggableRegion",value:function(){return{x:0,y:0,width:this.width,height:""===this.title?0:42}}},{key:"getDraggingRegion",value:function(){return{x:12,y:12,width:he.display.width-12,height:he.display.height-70-12}}},{key:"close",value:function(){var t=this;void 0!==this.currentAnimation||(this.currentAnimation=anime({targets:this,duration:210,easing:[.55,0,.1,1],alpha:[1,0],y:[this.y,this.y+24]}).finished.then(function(){t.currentAnimation=void 0,t.y-=24,t.visible=!1}))}},{key:"open",value:function(){var t=this;void 0!==this.currentAnimation||(this.visible=!0,this.currentAnimation=anime({targets:this,duration:210,easing:[.55,0,.1,1],alpha:[0,1],y:[this.y+24,this.y]}).finished.then(function(){t.currentAnimation=void 0}))}},{key:"render",value:function(){this.bg.clear();var t=L(this.width||0,X(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"width",this)),e=L(this.height||0,X(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"height",this)),i=0;if(this.bg.beginFill(1463929),this.bg.lineStyle(3,1729935),this.bg.drawRoundedRect(0,0,t,e,6),this.bg.endFill(),this.bg.lineStyle(0),""!==this.title){i=39,this.titleText.x=t/2,this.titleText.y=15,this.titleText.anchor.x=.5,this.titleText.visible=!0;var n=this.title;this.title="",this.title=n}else this.titleText.visible=!1;this.bg.beginFill(16777215),this.bg.drawRoundedRect(6,6+i,t-12,e-(12+i),6),this.bg.endFill()}}]),r}(PIXI.Container)),Rt={AccelerationCurve:[.4,0,1,1],DecelerationCurve:[0,0,.2,1],SharpCurve:[.4,0,.6,1],StandardCurve:[.4,0,.2,1],SwiftOut:[.55,0,.1,1]},Ct={chatBubble:{left:"./resource/image/interface/chat-bubble/left.png",middle:"./resource/image/interface/chat-bubble/middle.png",right:"./resource/image/interface/chat-bubble/right.png"},bottomBar:{background:"./resource/image/interface/bottom-bar/background.png",navigator:"./resource/image/interface/bottom-bar/navigator.png",friends:"./resource/image/interface/bottom-bar/friends.png",friendsInvited:"./resource/image/interface/bottom-bar/friends-invited.png",chat:"./resource/image/interface/bottom-bar/chat.png",chatMessages:"./resource/image/interface/bottom-bar/chat-messages.png",catalogue:"./resource/image/interface/bottom-bar/catalogue.png",inventory:"./resource/image/interface/bottom-bar/inventory.png",help:"./resource/image/interface/bottom-bar/help.png"}},At=function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.z=1e5,t.init(),t.hello(),t}return F(e,t),j(e,[{key:"init",value:function(){this.bottomBar=new ht,this.addChild(this.bottomBar)}},{key:"hello",value:function(){anime({targets:this.bottomBar,duration:300,easing:Rt.SwiftOut,y:[this.bottomBar.y+70,this.bottomBar.y]})}}]),e}(PIXI.Container),Bt=void 0,jt=function(){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return he.once("application-loading-done",function(){return Bt=new At,void he.display.stage.addChild(Bt)}),t}return F(e,it),j(e,[{key:"interface",get:function(){return Bt}}]),j(e,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loader.add(Ct.bottomBar.background),this.loader.add(Ct.bottomBar.catalogue),this.loader.add(Ct.bottomBar.chat),this.loader.add(Ct.bottomBar.chatMessages),this.loader.add(Ct.bottomBar.friends),this.loader.add(Ct.bottomBar.friendsInvited),this.loader.add(Ct.bottomBar.help),this.loader.add(Ct.bottomBar.inventory),this.loader.add(Ct.bottomBar.navigator),this.loader.add(Ct.chatBubble.left),this.loader.add(Ct.chatBubble.middle),this.loader.add(Ct.chatBubble.right);case 14:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),e;var t}(),Xt=function(t){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.row=0,e.column=0,e.cacheAsBitmap=!0,e.interactive=!0,e.thickness=t,e.on("pointertap",function(){return e.onClick()}),e.on("pointerover",function(){return e.onMouseOver()}),e.on("pointerout",function(){return e.onMouseOut()}),e}return F(i,t),j(i,[{key:"onClick",value:function(){this.emit("tile-tap",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOver",value:function(){this.emit("tile-hover",{row:this.row,column:this.column,x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,tile:this})}},{key:"onMouseOut",value:function(){this.emit("tile-leave",{row:this.row,column:this.column,x:this.x,y:this.y,width:this.width,height:this.height,tile:this})}}]),i}(PIXI.Graphics),zt=function(){function e(t){return B(this,e),q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return F(e,Xt),e}(),Et=function(){function s(t){B(this,s);for(var e=q(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t)),i=[],n=0;n<4;n++){var r=8*n,o=12*n,a=[new PIXI.Point(Lt/2+r,o),new PIXI.Point(Lt/2+Lt/8+r,Mt/8+o),new PIXI.Point(Lt/2-24+r,20+o),new PIXI.Point(r,Mt/2+o)];i.push.apply(i,a),y(e,a,e.thickness)}return e}return F(s,Xt),s}(),Ht=function(){function o(t){B(this,o);for(var e=q(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t)),i=0;i<4;i++){var n=-8*i,r=12*i;y(e,[new PIXI.Point(Lt/2+n,r),new PIXI.Point(Lt+n,Mt/2+r),new PIXI.Point(Lt/2+24+n,20+r),new PIXI.Point(Lt/2-Lt/8+n,Mt/8+r)],e.thickness)}return e}return F(o,Xt),o}(),Dt=function(){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return y(e,[new PIXI.Point(Lt/2,0),new PIXI.Point(Lt,Mt/2),new PIXI.Point(Lt/2,Mt),new PIXI.Point(0,Mt/2)],e.thickness),e}return F(i,Xt),i}(),Mt=32,Lt=64,Vt="./resource/image/furni/loading.png",Ft=(function(t){function i(t){B(this,i);var e=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.furniName=t,e._loadingSprite=new PIXI.Sprite(he.getResource(Vt).texture),e.addChild(e._loadingSprite),e.loading=!0,e.render(),e}F(i,t),j(i,[{key:"loading",get:function(){return this._loading},set:function(t){this._loading=t}}]),j(i,[{key:"getRoomOffsets",value:function(){return{x:-34,y:-50}}},{key:"render",value:function(){}}])}(PIXI.Container),function(){function e(){return B(this,e),q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return F(e,it),j(e,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loader.add(Vt);case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),e;var t}()),qt=function(t){function i(){B(this,i);var t=q(this,(i.__proto__||Object.getPrototypeOf(i)).call(this)),e=[new PIXI.Point(32,0),new PIXI.Point(64,16),new PIXI.Point(32,32),new PIXI.Point(0,16)];return t.lineStyle(4,0,.2),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.lineTo(e[0].x,e[0].y),t.endFill(),t.lineStyle(4,16777215),t.moveTo(e[0].x,e[0].y-1),t.lineTo(e[1].x,e[1].y-1),t.lineTo(e[2].x,e[2].y-1),t.lineTo(e[3].x,e[3].y-1),t.lineTo(e[0].x,e[0].y-1),t.endFill(),t}return F(i,t),j(i,[{key:"hover",value:function(t,e,i){this.position.x=t,this.position.y=e-2,this.z=i}},{key:"getRoomOffsets",value:function(){return{x:-32,y:-16}}}]),i}(PIXI.Graphics),Wt=function(t){function r(t,e,i){B(this,r);var n=q(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.interactive=!1,n.cacheAsBitmap=!1,n.doorHeight=85,n.floorThickness=t,n.wallHeight=115+32*i,n.wallThickness=e,n}return F(r,t),j(r,[{key:"render",value:function(){this.clear()}}]),r}(PIXI.Graphics),Gt=function(){function s(t,e,i,n,r,o){B(this,s);var a=q(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,e,i));return a.isDoor=n,a.isEnding=r,a.sceneryConfig=o,a.render(),a}return F(s,Wt),j(s,[{key:"render",value:function(){X(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"render",this).call(this);var t=this.isDoor?this.doorHeight+this.floorThickness:0;if(this.isDoor||(this.beginFill(9869217),this.moveTo(32,16+(this.isEnding?this.floorThickness:0)),this.lineTo(32+this.wallThickness,16+(this.isEnding?this.floorThickness:0)-this.wallThickness/2),this.lineTo(32+this.wallThickness,16-this.wallThickness/2-this.wallHeight),this.lineTo(32,16-this.wallHeight),this.lineTo(32,16+(this.isEnding?this.floorThickness:0)),this.endFill()),void 0!==this.sceneryConfig){var e=new PIXI.extras.TilingSprite(this.sceneryConfig.getWallTexture());e.x=0,e.y=-this.wallHeight,e.height=this.wallHeight-t,e.width=32,e.skew.y=-5.82,e.scale.x=1.13;var i=new PIXI.filters.AdjustmentFilter({brightness:1.1});e.filters=[i],this.addChild(e)}else this.beginFill(11909577),this.moveTo(32,16+t),this.lineTo(32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(0,t),this.lineTo(32,16+t),this.endFill();this.beginFill(7434875),this.moveTo(32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(this.wallThickness,16-this.wallHeight-16-this.wallThickness/2),this.lineTo(32+this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(32,16-this.wallHeight),this.endFill()}}]),s}(),Nt=function(){function r(t,e,i){B(this,r);var n=q(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e,i));return n.render(),n}return F(r,Wt),j(r,[{key:"render",value:function(){X(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"render",this).call(this),this.beginFill(7434875),this.moveTo(0,-this.wallHeight),this.lineTo(this.wallThickness,-this.wallHeight-this.wallThickness/2),this.lineTo(0,-this.wallHeight-this.wallThickness),this.lineTo(-this.wallThickness,-this.wallHeight-this.wallThickness/2),this.lineTo(0,-this.wallHeight),this.endFill()}}]),r}(),Ut=function(){function s(t,e,i,n,r,o){B(this,s);var a=q(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,e,i));return a.isDoor=n,a.isEnding=r,a.sceneryConfig=o,a.render(),a}return F(s,Wt),j(s,[{key:"render",value:function(){X(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"render",this).call(this);var t=this.isDoor?this.doorHeight+this.floorThickness:0;if(this.isDoor||(this.beginFill(12238542),this.moveTo(-32,16+(this.isEnding?this.floorThickness:0)),this.lineTo(-32,16-this.wallHeight),this.lineTo(-32-this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(-32-this.wallThickness,16+(this.isEnding?this.floorThickness:0)-this.wallThickness/2),this.lineTo(-32,16+(this.isEnding?this.floorThickness:0)),this.endFill()),void 0!==this.sceneryConfig){var e=new PIXI.extras.TilingSprite(this.sceneryConfig.getWallTexture());e.x=-32,e.y=-(this.wallHeight-16),e.height=this.wallHeight-t,e.width=32,e.skew.y=5.82,e.scale.x=1.13,this.addChild(e)}else this.beginFill(9606045),this.moveTo(-32,16-t),this.lineTo(-32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(0,-t),this.lineTo(-32,16-t),this.endFill();this.beginFill(7434875),this.moveTo(-32,16-this.wallHeight),this.lineTo(0,16-this.wallHeight-16),this.lineTo(-this.wallThickness,16-this.wallHeight-16-this.wallThickness/2),this.lineTo(-32-this.wallThickness,16-this.wallHeight-this.wallThickness/2),this.lineTo(-32,16-this.wallHeight),this.endFill()}}]),s}(),Yt=function(){function n(t,e,i){B(this,n),this.floor=t,this.landscape=e,this.wall=i}return j(n,[{key:"floor",get:function(){return this._floor},set:function(t){this._floor=t}},{key:"landscape",get:function(){return this._landscape},set:function(t){this._landscape=t}},{key:"wall",get:function(){return this._wall},set:function(t){this._wall=t}}]),j(n,[{key:"getFloorTexture",value:function(){}},{key:"getLandscapeTexture",value:function(){}},{key:"getWallTexture",value:function(){return function(t){var e=he.getManager(Kt),i=e.sprites.assets,n=e.sceneryTexture;void 0===i[t]&&(i[t]=[0,0,1,1]);var r=new PIXI.Texture(n);return r.frame=new(Function.prototype.bind.apply(PIXI.Rectangle,[null].concat(G(i[t])))),r}("wall_texture_64_3_wall_color_lsd2")}}]),n}(),Zt=function(t){function r(){B(this,r);var i=q(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));i.z=1e3,i._entities=[],i._heightmap={},i._tiles={},i.columns=0,i.rows=0,i.posfix={x:0,y:0},i.floorThickness=8,i.wallThickness=8,i.highest=0,i.lowest=0,i.offsets={x:0,y:0},i.roomScale=1,i.tileCursor=new qt,i.tileCursor.visible=!1,i.root=new PIXI.Container,i.tileSprites=new PIXI.Container,i.tileSprites.z=10,i.wallSprites=new PIXI.Container,i.wallSprites.z=20,i.root.addChild(i.tileSprites),i.root.addChild(i.wallSprites),i.root.addChild(i.tileCursor),i.addChild(i.root);var t=he.display.size,e=t.width,n=t.height;return i.beginFill(0),i.drawRect(0,0,e,n),i.endFill(),function(l,t,h){u(t);var c=null,x=null,d=null;t.on("pointerdown",function(t){if(x=t.data,c=l,d=x.getLocalPosition(c),void 0!==l.getDraggableRegion){var e=l.getDraggableRegion(),i=e.x,n=e.y,r=e.width,o=e.height;(d.x<i||d.x>r||d.y<n||d.y>o)&&(c=d=x=null)}}),t.on("pointerup",function(){c=d=x=null}),t.on("pointermove",function(){if(null!==c){var t=x.getLocalPosition(c.parent),e=t.x-d.x,i=t.y-d.y;if(void 0!==l.getDraggingRegion){var n=l.getDraggingRegion(),r=n.x,o=n.y,a=n.width,s=n.height,u=void 0===l.getDraggableRegion?l:l.getDraggableRegion();e<r&&(e=r),e+u.width>a&&(e=a-u.width),i<o&&(i=o),i+u.height>s&&(i=s-u.height)}h(e,i)}})}(i.root,i,function(t,e){i.root.x=t,i.root.y=e}),he.display.on("tick",function(){return i.root.updateLayerOrder()}),i}return F(r,t),j(r,[{key:"entities",get:function(){return this._entities}},{key:"heightmap",get:function(){return this._heightmap}},{key:"roomScale",get:function(){return this.scale.x},set:function(t){this.scale.x=t,this.scale.y=t}},{key:"tiles",get:function(){return this._tiles}}]),j(r,[{key:"clearEverything",value:function(){for(;this.tileSprites.children[0];)this.tileSprites.removeChild(this.tileSprites.children[0]);for(;this.wallSprites.children[0];)this.wallSprites.removeChild(this.wallSprites.children[0]);for(;this.root.children[0];)this.root.removeChild(this.root.children[0]);this.root.addChild(this.tileSprites),this.root.addChild(this.wallSprites),this.root.addChild(this.tileCursor),this._entities=[],this._tiles={}}},{key:"prepareHeightmap",value:function(t,e){var m=this,w=1<arguments.length&&void 0!==e?e:void 0;this.emit("room-view-emptied"),this.clearEverything(),void 0===w&&(w=new Yt("default","default","default"));var _=this._heightmap=t.trim().split("\n").map(function(t){return t.split("").map(function(t){return"x"===(e=t)?null:["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"].indexOf(e);var e})}),i=function(t){for(var e=0,i=36,n=0;n<t.length;n++)for(var r,o=0;o<t[n].length;o++)e<(r=t[n][o])&&(e=r),r<i&&(i=0);return{highest:e,lowest:i}}(this.heightmap),n=i.highest,r=i.lowest;if(this.highest=n,this.lowest=r,this.posfix={x:0,y:0},0!==_.length){this.columns=_[0].length,this.rows=_.length,this.doors=[];for(var o=function(y){m._tiles[y]={};for(var t=function(e){var t=m.getTileHeight(y,e);if(null===t)return"continue";var i=P(_,y,e),n=function(t){var e=0<arguments.length&&void 0!==t?t:-1;return 3===e?zt:2===e?Et:4===e?Ht:Dt}(i),r=I(_,y,e),o=S(_,y,e),a=m.getX(y,e),s=m.getY(y,e),u=T(_,y-1,e),l=T(_,y,e-1);if((u||l)&&(u?m.doors.push({row:y-1,column:e,direction:k(_,y-1,e)}):m.doors.push({row:y,column:e-1,direction:k(_,y,e-1)})),r||o){var h=[],c=R(m.highest-t);r&&o?(h.push(new Nt(m.floorThickness,m.wallThickness,c,w)),h.push(new Gt(m.floorThickness,m.wallThickness,c,u,!I(_,y,e+1),w)),h.push(new Ut(m.floorThickness,m.wallThickness,c,l,!S(_,y+1,e),w))):r?h.push(new Gt(m.floorThickness,m.wallThickness,c,u,!I(_,y,e+1),w)):o&&h.push(new Ut(m.floorThickness,m.wallThickness,c,l,!S(_,y+1,e),w));var x=!0,d=!1,f=void 0;try{for(var p,g,v=h[Symbol.iterator]();!(x=(p=v.next()).done);x=!0)g=p.value,m.wallSprites.addChild(b(g,function(t){t.x=a+32,t.y=s+(-1===i?0:32)}))}catch(t){d=!0,f=t}finally{try{!x&&v.return&&v.return()}finally{if(d)throw f}}}m.tileSprites.addChild(b(new n(m.floorThickness,w),function(t){(m._tiles[y][e]=t).row=y,t.column=e,t.on("tile-tap",function(t){return m.onTileClick(t)}),t.on("tile-hover",function(t){return m.onTileHover(t)}),t.on("tile-leave",function(t){return m.onTileLeave(t)}),t.x=a,t.y=s}))},e=0;e<_[y].length;e++)t(e)},a=0;a<_.length;a++)o(a);this.tileSprites.children.forEach(function(t){t.x<m.posfix.x&&(m.posfix.x=t.x),t.y<m.posfix.y&&(m.posfix.y=t.y)}),this.posfix.x=R(this.posfix.x),this.posfix.y=R(this.posfix.y),this.tileSprites.children.forEach(function(t){t.x+=m.posfix.x,t.y+=m.posfix.y}),this.wallSprites.children.forEach(function(t){t.x+=m.posfix.x,t.y+=m.posfix.y}),this.centerRoom(),this.emit("room-view-ready")}}},{key:"addEntityToTile",value:function(t,e,i,n){this.root.addChild(t),this.associateEntityToTile(t,e,i,n)}},{key:"removeEntity",value:function(t){this.removeChild(t)}},{key:"animateBuildingTiles",value:function(){}},{key:"associateEntityToTile",value:function(t,e,i,n){var r=3<arguments.length&&void 0!==n?n:0,o=this.getEntityPosition(t,e,i,r);t.position.x=o.x,t.position.y=o.y,t.z=o.z}},{key:"centerEntity",value:function(t,e){var i=!(1<arguments.length&&void 0!==e)||e,n=he.display.width/2,r=he.display.height/2;n-=C(t.x+t.width/2),r-=C(t.y+t.height/2),n-=n%2,i?anime({targets:this.root,x:n,y:r,duration:800,easing:Rt.DecelerationCurve}):anime({targets:this.root,x:n,y:r,duration:45,easing:"linear"})}},{key:"centerRoom",value:function(){this.root.x=this.width/2-this.root.width/2,this.root.y=this.height/2-this.root.height/2}},{key:"getClosestTile",value:function(){}},{key:"getDoorTile",value:function(t){return!(0<arguments.length&&void 0!==t)||t?this.doors[V(Math.random()*this.doors.length)]:this.doors[0]}},{key:"getEntityPosition",value:function(t,e,i,n){var r=3<arguments.length&&void 0!==n?n:0,o={x:0,y:0},a=this.getTile(e,i);void 0!==t.getRoomOffsets&&(o=t.getRoomOffsets());var s=!(a instanceof Dt);return{x:this.getX(e,i)+32+(o.x+this.offsets.x),y:this.getY(e,i)+16+(o.y+this.offsets.y)+(a&&s?16:0),z:this.getZ(e,i)+r,isStairs:s}}},{key:"getRandomTile",value:function(){var t=V(Math.random()*this.rows),e=V(Math.random()*this.columns);return this.isValidTile(t,e)?{row:t,column:e}:this.getRandomTile()}},{key:"getTile",value:function(t,e){return void 0===this.tiles[t]?void 0:this.tiles[t][e]||void 0}},{key:"getTileHeight",value:function(t,e){return void 0===this.heightmap[t]?void 0:this.heightmap[t][e]}},{key:"getX",value:function(t,e){return 32*(e-t)+this.posfix.x}},{key:"getY",value:function(t,e){var i=this.getTileHeight(t,e);return void 0===i&&(i=0),-1!==P(this.heightmap,t,e)&&(i+=1),16*(e+t)-32*i+this.posfix.y}},{key:"getZ",value:function(t,e,i){var n=2<arguments.length&&void 0!==i?i:0;return T(this.tiles,t,e)?11+n:t*this.columns+e+n}},{key:"isValidTile",value:function(t,e){return void 0!==this.getTile(t,e)}},{key:"onTileClick",value:function(t){this.emit("tile-tap",t)}},{key:"onTileHover",value:function(n){var r=this;setTimeout(function(){var t=r.getEntityPosition(r.tileCursor,n.row,n.column),e=t.x,i=t.y;r.currentHover=[n.row,n.column],r.tileCursor.visible=!0,r.tileCursor.hover(e,i,11)},1)}},{key:"onTileLeave",value:function(t){var e=this;this.currentHover=void 0,setTimeout(function(){void 0!==e.currentHover&&(t.x!==e.currentHover.x||t.y!==e.currentHover.y)||(e.tileCursor.visible=!1)},2)}}]),r}(PIXI.Graphics),$t={assets:o("/room-content/room_assets.xml"),sprites:o("/room-content/assets.json"),visualization:o("/room-content/room_visualization.xml")},Jt=void 0,Kt=function(){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._assets=null,t._sprites=null,t._visualization=null,Jt=new Zt,t.roomViewer.visible=!1,t}return F(e,it),j(e,[{key:"assets",get:function(){return this._assets}},{key:"roomViewer",get:function(){return Jt}},{key:"sceneryTexture",get:function(){return this._sceneryTexture}},{key:"sprites",get:function(){return this._sprites}},{key:"visualization",get:function(){return this._visualization}}]),j(e,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initialize",this).call(this);case 2:this.loadConfig($t.assets),this.loadConfig($t.sprites),this.loadConfig($t.visualization);case 5:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"loadConfig",value:function(i){var n=this;this.loader.add(i).on("complete",function(t,e){return void 0===t.resources[i]?void 0:n.onConfigLoaded(i,e[i])})}},{key:"onConfigLoaded",value:function(t,e){t===$t.assets?this._assets=e.data:t===$t.sprites?(this._sprites=e.data,this._sceneryTexture=PIXI.Texture.from("data:image/png;base64,"+this.sprites.resource),this.sprites.resource=void 0):t===$t.visualization&&(this._visualization=e.data)}},{key:"ensureRoomViewerIsMounted",value:function(){null!==this.roomViewer.parent||he.display.stage.addChild(this.roomViewer)}},{key:"removeRoomViewer",value:function(){this.roomViewer.removeAllListeners(),he.display.stage.removeChild(this.roomViewer)}},{key:"showRoomViewer",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:void 0;this.ensureRoomViewerIsMounted(),this.roomViewer.prepareHeightmap(t,i),this.roomViewer.visible=!0}}]),e;var t}(),Qt=["hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92","lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92","hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97","hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106","hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324","hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110","hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586"],te=function(){return Qt[V(Math.random()*(100*Qt.length))%Qt.length]},ee=[];ee.push("\nxxxxx\nx000x\n0000x\nx000x\nx000x\nx000x\nxxxxx\n"),ee.push("\nxxxxx\nx110x\nx110x\nx000x\nxxxxx\n"),ee.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nxxxxxxxxxxx22222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx222222222222222222\nx2222xxxxxxxxxxxxxx\nx2222xxxxxxxxxxxxxx\nx2222211111xx000000\nx222221111110000000\nx222221111110000000\nx2222211111xx000000\nxx22xxx1111xxxxxxxx\nxx11xxx1111xxxxxxxx\nx1111xx1111xx000000\nx1111xx111110000000\nx1111xx111110000000\nx1111xx1111xx000000\nxxxxxxxxxxxxxxxxxxx\n"),ee.push("\nxxxxxxxxxxxxxxxxxxxxxx\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nx22222222222222222222x\nxxxxx11xxxxxxxx11xxxxx\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\n000000000000000000000x\nx00000000000000000000x\nx00000000000000000000x\nxxxxxxxxxxxxxxxxxxxxxx\n"),ee.push("\nxxxxxxxxxxxxxxxxxxx\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx222222222222\nxxxxxxx111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx222221111111111111\nx2222xx111111111111\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\nx2222xx000000000000\n22222xx000000000000\nx2222xx000000000000\nxxxxxxxxxxxxxxxxxxx\n"),ee.push("\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x000000000000000000000000xxxx\nx222222222x00000000xxxxxxxx00000000xxxx\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\n0000000000000000000xxxxxxxx00000000xxxx\nx000000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00x000000000000000xxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx0000000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nx00x0000000000000000000000000000000xxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n");var ie=function(){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.height=540,t.width=420,t.title="Navigator",t}return F(e,St),j(e,[{key:"open",value:function(){this.x=he.display.width/2-this.width/2,this.y=he.display.height/2-this.height/2,X(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"open",this).call(this)}}]),e}(),ne="./resource/image/hotel-view/hotel.png",re="./resource/image/hotel-view/skyline.png",oe=function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.skyline=new PIXI.extras.TilingSprite(he.getResource(re).texture),t.addChild(t.skyline),t.hotel=new PIXI.Sprite(he.getResource(ne).texture),t.addChild(t.hotel),t.visible=!1,t.render(),t.interactive=!1,t.interactiveChildren=!1,he.display.on("resize",function(){return t.render()}),t}return F(e,t),j(e,[{key:"opened",get:function(){return this.visible}}]),j(e,[{key:"close",value:function(){var t=this;anime({targets:this,duration:300,easing:Rt.SwiftOut,alpha:[1,0]}).finished.then(function(){return t.visible=!1})}},{key:"open",value:function(){this.visible=!0;var t=he.display.height;anime({targets:this,duration:300,easing:Rt.SwiftOut,alpha:[0,1]}),anime({targets:this.skyline,delay:75,duration:750,easing:Rt.SwiftOut,alpha:[0,1],y:[t,this.skyline.y]}),anime({targets:this.hotel,delay:150,duration:750,easing:Rt.SwiftOut,y:[t,this.hotel.y]})}},{key:"render",value:function(){var t=he.display.size,e=t.width,i=t.height;this.clear(),this.beginFill(2472174),this.drawRect(0,0,e,i),this.endFill(),this.hotel.x=e-750,this.hotel.y=i-638,this.skyline.height=120,this.skyline.width=e,this.skyline.x=0,this.skyline.y=i-190}}]),e}(PIXI.Graphics),ae=function(){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return he.once("application-loading-done",function(){return t.onApplicationLoadingDone()}),t}return F(e,it),j(e,[{key:"hotelView",get:function(){return this._hotelView}}]),j(e,[{key:"initialize",value:(t=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loader.add(ne),this.loader.add(re);case 2:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"onApplicationLoadingDone",value:function(){this._hotelView=new oe,he.display.stage.addChild(this.hotelView)}}]),e;var t}(),se=[],ue=function(){function r(t,e,i,n){B(this,r),this.roomViewer=t,this.avatar=e,this.row=i,this.column=n}return j(r,[{key:"position",get:function(){return{row:this.row,column:this.column}}}]),j(r,[{key:"moveTo",value:function(t,e,i){var n,r,o=this,a=2<arguments.length&&void 0!==i?i:void 0,s=(n=this.position,r={row:t,column:e},L(R(n.row-r.row),R(n.column-r.column)));a=void 0===a?m(this.position,{row:t,column:e})||this.avatar.direction:a;var u=this.roomViewer.getEntityPosition(this.avatar,t,e,1),l=u.x,h=u.y,c=u.z;if(1<s)this.teleportTo(t,e);else{this.avatar.direction=this.avatar.headDirection=a;var x=anime({targets:this.avatar,duration:360,x:l,y:h,easing:"linear"});x.update=function(t){t.currentTime<180||(x.update=void 0,o.avatar.z=c,o.roomViewer.updateLayerOrder())}}}},{key:"teleportTo",value:function(t,e){var i=this.roomViewer.getEntityPosition(this.avatar,t,e),n=i.x,r=i.y,o=i.z;this.avatar.position.x=n,this.avatar.position.y=r,this.avatar.z=o,this.roomViewer.updateLayerOrder()}},{key:"walkTo",value:function(r,o){var a=this,s=this.position;if(s.row!==r||s.column!==o){this.avatar.addAction("Move");!function t(){var e=s.row>r?--s.row:s.row<r?++s.row:r,i=s.column>o?--s.column:s.column<o?++s.column:o,n=m(a.position,{row:e,column:i});a.column=i,a.row=e,a.moveTo(e,i,n),setTimeout(function(){s.row===r&&s.column===o?a.avatar.removeAction("Move"):t()},360)}()}}}]),r}(),le=function(t){function l(){B(this,l);var t=q(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return t.urls=[],t}return F(l,t),j(l,[{key:"add",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:1;return this.urls.push({stage:i,url:t}),this}},{key:"load",value:function(){N.debug("InitializerLoader","Skipped load() initializing..")}},{key:"realLoad",value:function(t,e){var i,s=this,n=1<arguments.length&&void 0!==e?e:1,r=this.urls.filter(function(t){return t.stage===n}).map(function(t){return t.url}),o=r.filter(function(t){return"string"==typeof t}),u=r.filter(function(t){return"string"!=typeof t});o.forEach(function(t){return X(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"add",s).call(s,t)}),(i=A(regeneratorRuntime.mark(function t(){var e,i,n,r,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise(function(t){return X(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"load",s).call(s,t)});case 2:i=!(e=!0),n=void 0,t.prev=5,r=u[Symbol.iterator]();case 7:if(e=(o=r.next()).done){t.next=14;break}return a=o.value,t.next=11,a;case 11:e=!0,t.next=7;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(5),i=!0,n=t.t0;case 20:t.prev=20,t.prev=21,!e&&r.return&&r.return();case 23:if(t.prev=23,!i){t.next=26;break}throw n;case 26:return t.finish(23);case 27:return t.finish(20);case 28:case"end":return t.stop()}},t,s,[[5,16,20,28],[21,,23,27]])})),function(){return i.apply(this,arguments)})().then(function(){return t()})}}]),l}(PIXI.loaders.Loader),he=new(function(t){function e(){B(this,e);var t=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.display=new lt,t.loader=new le,t.managers=[],t}return F(e,t),j(e,[{key:"stage",get:function(){return this.display.stage}},{key:"ticker",get:function(){return this.display.ticker}}]),j(e,[{key:"addDefaultManagers",value:function(){this.addManager(new ot),this.addManager(new at),this.addManager(new rt),this.addManager(new Ft),this.addManager(new ae),this.addManager(new Kt),this.addManager(new jt)}},{key:"addManager",value:function(t){N.debug("Application","Added manager "+t.constructor.name),this.managers.push(t)}},{key:"getManager",value:function(e){return this.managers.find(function(t){return t instanceof e})}},{key:"create",value:function(){var t=this;this.loadingView=new st,this.loadingView.on("loader-ready",function(){return t.emit("application-can-run")}),this.stage.addChild(this.loadingView),this.addDefaultManagers()}},{key:"initialize",value:(n=A(regeneratorRuntime.mark(function t(){var i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.managers.forEach(function(){var t=A(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initialize();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,i)}));return function(){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"run",value:(i=A(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loadingView.loadingBar.alpha=0,setTimeout(function(){return e.loader.realLoad(function(){return e.onLoadingStage0Done()},0)},0);case 2:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"onLoadingStage0Done",value:function(){var t=this;this.loadingView.loadingBar.alpha=1,this.loadingView.percentage=0,this.loader.realLoad(function(){return t.onLoadingStage1Done()},1)}},{key:"onLoadingStage1Done",value:function(){N.debug("Application","Loading of manager data done!"),this.emit("application-loading-done"),delete this.loader,this.stage.removeChild(this.loadingView),function(){var t=te(),n=he.getManager(rt),r=he.getManager(Kt),e=he.getManager(ae),i=he.getManager(jt);e.hotelView.open();var o=new ie;he.stage.addChild(o),i.interface.bottomBar.navigatorButton.on("pointertap",function(){o.opened?o.close():o.open()}),i.interface.bottomBar.friendsButton.on("pointertap",function(){e.hotelView.opened?(e.hotelView.close(),setTimeout(function(){r.roomViewer.on("room-view-ready",function(){return r.roomViewer.animateBuildingTiles()}),r.roomViewer.on("tile-tap",function(t){return se[0].walkTo(t.row,t.column)}),r.showRoomViewer(ee[3],new Yt("default","default","default"));for(var t=function(t){var e=n.newAvatar(te()),i=r.roomViewer.getRandomTile();0===t&&(i=r.roomViewer.getDoorTile(!0)),e.direction=e.headDirection=i.direction||V(8*Math.random())%8,se.push(new ue(r.roomViewer,e,i.row,i.column)),e.on("pointertap",function(){return e.figure=te()}),e.on("pointertap",function(){return r.roomViewer.centerEntity(e,!0)}),r.roomViewer.addEntityToTile(e,i.row,i.column)},e=0;e<10;e++)t(e)},300)):(se.forEach(function(t){return r.roomViewer.removeEntity(t.avatar)}),se.forEach(function(t){return n.removeAvatar(t.avatar)}),se=void 0,se=[],e.hotelView.open(),r.removeRoomViewer())}),i.interface.bottomBar.meButton.figure=t,i.interface.bottomBar.friendsButton.emit("pointertap")}()}},{key:"getResource",value:function(t,e){return((1<arguments.length&&void 0!==e?e:void 0)||this.loader).resources[t]}},{key:"getResources",value:function(t){return((0<arguments.length&&void 0!==t?t:void 0)||this.loader).resources}}]),e;var i,n}(PIXI.utils.EventEmitter)),ce=function(){function t(){B(this,t)}return j(t,null,[{key:"init",value:(e=A(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return N.debug("Bootstrapper","Loading everything.."),PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,he.create(),he.on("application-can-run",function(){return he.run()}),t.next=6,he.initialize();case 6:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t;var e}();Array.prototype.pushChain=function(){return this.push.apply(this,arguments),this},Array.prototype.unique=function(){return this.filter(function(t,e,i){return i.indexOf(t)===e})},Object.prototype.forEach=function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e)},PIXI.Container.prototype.updateLayerOrder=function(){var r=this;this.children.sort(function(t,e){var i=t.z||0,n=e.z||0;return i===n?r.children.indexOf(t)-r.children.indexOf(e):i-n})},ce.init().then(function(){})}();
//# sourceMappingURL=bundle.js.map
