{"version":3,"file":"bundle.js.map","sources":["../src/core/logging.js","../src/core/dom-utils.js","../src/core/manager/manager.js","../src/core/pixi-utils.js","../src/view/avatar/avatar.js","../src/core/json-utils.js","../src/core/config/config.js","../src/core/i18n/i18n.js","../src/view/loading-view.js","../src/display.js","../src/preferences.js","../src/ui/interface/toolbar.js","../src/ui/interface/memenu.js","../src/ui/interface/interface.js","../src/view/room/room-view.js","../src/core/dev-utils.js","../src/view/furni/furni.js","../src/application.js","../src/bootstrapper.js","../node_modules/pixi.js/lib/index.js","../src/main.js"],"sourcesContent":["const debugMode = true;\r\n\r\nexport class Logger\r\n{\r\n\r\n\tstatic debug(...data)\r\n\t{\r\n\t\tif (!debugMode)\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(\"[D]\", ...data);\r\n\t}\r\n\r\n\tstatic error(...data)\r\n\t{\r\n\t\tconsole.error(\"[E]\", ...data);\r\n\t}\r\n\r\n}\r\n","/**\r\n * Applies styles to an element.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Object} styles\r\n */\r\nexport function applyStyles(element, styles)\r\n{\r\n\tstyles.forEach((value, key) => element.style.setProperty(key, value));\r\n}\r\n\r\n/**\r\n * Creates an element.\r\n *\r\n * @param {String} tagName\r\n * @param {Function} callback\r\n *\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tagName, callback = null)\r\n{\r\n\tconst element = document.createElement(tagName);\r\n\r\n\tif (callback !== null)\r\n\t\tcallback(element);\r\n\r\n\treturn element;\r\n}\r\n\r\n/**\r\n * Removes contents.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nexport function removeHtml(element)\r\n{\r\n\telement.innerHTML = \"\";\r\n}\r\n\r\n/**\r\n * Query Selector All to Array.\r\n *\r\n * @param selector\r\n * @param container\r\n *\r\n * @returns {Array<Element>}\r\n */\r\nexport function querySelectorAllArray(selector, container = document)\r\n{\r\n\treturn [].slice.call(container.querySelectorAll(selector));\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../logging.js\";\r\n\r\nexport class Manager\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn application.display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn application.loader;\r\n\t}\r\n\r\n\tget name()\r\n\t{\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn application.stage;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._name = this.constructor.name;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tLogger.debug(`Initializing manager: ${this.name}`)\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t}\r\n\r\n}\r\n","let simpleDraggableTarget = null;\r\n\r\nexport function setInteractive(target)\r\n{\r\n\ttarget.interactive = true;\r\n}\r\n\r\nexport function simpleDraggable(target)\r\n{\r\n\tsetInteractive(target);\r\n\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\ttarget.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\t});\r\n\r\n\ttarget.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\ttarget.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tsimpleDraggableTarget.position.x = p.x - pos.x;\r\n\t\tsimpleDraggableTarget.position.y = p.y - pos.y;\r\n\t});\r\n}\r\n\r\nexport function withInstance(instance, callback)\r\n{\r\n\tcallback(instance);\r\n\r\n\treturn instance;\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../../core/logging.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { InitializerLoader } from \"../../application.js\";\r\nimport { setInteractive } from \"../../core/pixi-utils.js\";\r\n\r\nconst ROOT = \"https://cdn.mili.us/time/assets/clothing\";\r\nconst LIBS = `${ROOT}/lib`;\r\n\r\nconst LOADED_CONFIGS = {};\r\nconst LOADED_LIBS = {};\r\nconst LOADED_TEXTURES = {};\r\nconst LOADING_LIBS = {};\r\n\r\nconst avatarResources = {\r\n\tpoof: {\r\n\t\t\"1_1\": \"./resource/image/avatar/poof/1-1.png\",\r\n\t\t\"1_2\": \"./resource/image/avatar/poof/1-2.png\",\r\n\t\t\"1_3\": \"./resource/image/avatar/poof/1-3.png\",\r\n\t\t\"1_4\": \"./resource/image/avatar/poof/1-4.png\",\r\n\t\t\"2_1\": \"./resource/image/avatar/poof/2-1.png\",\r\n\t\t\"2_2\": \"./resource/image/avatar/poof/2-2.png\",\r\n\t\t\"2_3\": \"./resource/image/avatar/poof/2-3.png\",\r\n\t\t\"2_4\": \"./resource/image/avatar/poof/2-4.png\",\r\n\t\t\"3_1\": \"./resource/image/avatar/poof/3-1.png\",\r\n\t\t\"3_2\": \"./resource/image/avatar/poof/3-2.png\",\r\n\t\t\"3_3\": \"./resource/image/avatar/poof/3-3.png\",\r\n\t\t\"3_4\": \"./resource/image/avatar/poof/3-4.png\",\r\n\t\t\"4_1\": \"./resource/image/avatar/poof/4-1.png\",\r\n\t\t\"4_2\": \"./resource/image/avatar/poof/4-2.png\",\r\n\t\t\"4_3\": \"./resource/image/avatar/poof/4-3.png\",\r\n\t\t\"4_4\": \"./resource/image/avatar/poof/4-4.png\"\r\n\t}\r\n};\r\n\r\nlet actionsSorted = null;\r\nlet defaultAction = null;\r\nlet loadingAvatar = null;\r\nlet radiusComparator = (a, b) => b.getAttribute(\"z\") - a.getAttribute(\"z\");\r\n\r\nexport function initializeAvatarRenderer()\r\n{\r\n\tif (actionsSorted === null)\r\n\t\tactionsSorted = querySelectorAllArray(\"action\", getActions()).map(action => action.getAttribute(\"id\"));\r\n\r\n\tif (defaultAction === null)\r\n\t\tdefaultAction = getAction(\"Default\");\r\n\r\n\tif (loadingAvatar === null)\r\n\t\tloadingAvatar = new Avatar(\"hd-195-1\");\r\n}\r\n\r\nexport function getAvatarClothingConfigUrl(config)\r\n{\r\n\treturn `${ROOT}/${config}.xml`;\r\n}\r\n\r\nexport function getAvatarClothingLibraryUrl(library)\r\n{\r\n\treturn `${LIBS}/${library}.json`;\r\n}\r\n\r\nexport function getValidActionsForPart(partType)\r\n{\r\n\tconst actions = [\"std\"];\r\n\r\n\tswitch (partType)\r\n\t{\r\n\t\tcase \"bd\":\r\n\t\t\tactions.push(\"sit\", \"lay\", \"wlk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hd\":\r\n\t\t\tactions.push(\"lsp\", \"lay\", \"spk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fa\":\r\n\t\t\tactions.push(\"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ea\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ey\":\r\n\t\t\tactions.push(\"agr\", \"sad\", \"sml\", \"srp\", \"lag\", \"lsp\", \"lay\", \"eyb\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fc\":\r\n\t\t\tactions.push(\"agr\", \"blw\", \"sad\", \"spk\", \"srp\", \"sml\", \"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hr\":\r\n\t\tcase \"hrb\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"he\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ha\":\r\n\t\t\tactions.push(\"spk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ch\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"cc\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ca\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lg\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lh\":\r\n\t\t\tactions.push(\"respect\", \"sig\", \"wav\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ls\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lc\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rh\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\", \"blw\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rs\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rc\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ri\":\r\n\t\t\tactions.push(\"crr\", \"drk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"li\":\r\n\t\t\tactions.push(\"sig\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"sh\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn actions;\r\n}\r\n\r\nexport function isLibraryLoaded(library)\r\n{\r\n\treturn LOADED_LIBS[library] !== undefined;\r\n}\r\n\r\nexport function loadAvatarClothingConfig(config, loader)\r\n{\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tconst configUrl = getAvatarClothingConfigUrl(config);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () => application.getResource(configUrl) !== undefined ? LOADED_CONFIGS[config] = application.getResource(configUrl).data : undefined);\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing config: ${config}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADED_CONFIGS[config] = application.getResource(configUrl).data;\r\n\r\n\t\t\t\t\tif (!isInitializerLoader)\r\n\t\t\t\t\t\tresolve(LOADED_CONFIGS[config]);\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function loadAvatarClothingLibrary(library, loader)\r\n{\r\n\tif (LOADING_LIBS[library] !== undefined)\r\n\t\treturn LOADING_LIBS[library];\r\n\r\n\tif (isLibraryLoaded(library))\r\n\t\treturn Promise.resolve(LOADED_LIBS[library]);\r\n\r\n\treturn LOADING_LIBS[library] = new Promise(resolve =>\r\n\t{\r\n\t\tconst libraryUrl = getAvatarClothingLibraryUrl(library);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () => application.getResource(libraryUrl, loader) !== undefined ? LOADED_LIBS[library] = application.getResource(libraryUrl, loader).data : undefined);\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing library: ${library}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADING_LIBS[library] = undefined;\r\n\t\t\t\t\tLOADED_LIBS[library] = application.getResource(libraryUrl, loader).data;\r\n\t\t\t\t\tresolve(LOADED_LIBS[library]);\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * Gets a single action.\r\n * @param {String} id\r\n * @returns {Object}\r\n */\r\nfunction getAction(id)\r\n{\r\n\tconst action = getActions().querySelector(`action[id=\"${id}\"]`);\r\n\tconst definition = {};\r\n\r\n\tif (action === null)\r\n\t\treturn undefined;\r\n\r\n\taction.attributes.forEach(attribute => definition[attribute.name] = attribute.value);\r\n\r\n\treturn definition;\r\n}\r\n\r\n/**\r\n * Gets actions.xml.\r\n * @returns {Document}\r\n */\r\nfunction getActions()\r\n{\r\n\treturn LOADED_CONFIGS[\"actions\"];\r\n}\r\n\r\n/**\r\n * Gets animations.xml.\r\n * @returns {Document}\r\n */\r\nfunction getAnimations()\r\n{\r\n\treturn LOADED_CONFIGS[\"animations\"];\r\n}\r\n\r\n/**\r\n * Gets draworder.xml.\r\n * @returns {Document}\r\n */\r\nfunction getDraworder()\r\n{\r\n\treturn LOADED_CONFIGS[\"draworder\"];\r\n}\r\n\r\n/**\r\n * Gets figuredata.xml.\r\n * @returns {Document}\r\n */\r\nfunction getFigureData()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuredata\"];\r\n}\r\n\r\n/**\r\n * Gets figuremap.xml.\r\n * @returns {Document}\r\n */\r\nfunction getFigureMap()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuremap\"];\r\n}\r\n\r\n/**\r\n * Gets geometry.xml.\r\n * @returns {Document}\r\n */\r\nfunction getGeometry()\r\n{\r\n\treturn LOADED_CONFIGS[\"geometry\"];\r\n}\r\n\r\n/**\r\n * Gets partsets.xml.\r\n * @returns {Document}\r\n */\r\nfunction getPartSets()\r\n{\r\n\treturn LOADED_CONFIGS[\"partsets\"];\r\n}\r\n\r\n/**\r\n * Gets a part sprite.\r\n * @param {String} library\r\n * @param {String} asset\r\n * @param {Object} center\r\n * @returns {PIXI.Sprite}\r\n */\r\nfunction getSprite(library, asset, center = {x: 0, y: 0})\r\n{\r\n\tif (LOADED_LIBS[library] === undefined || LOADED_LIBS[library][asset] === undefined)\r\n\t\treturn null;\r\n\r\n\tconst sprite = new PIXI.Sprite(getTexture(library, asset));\r\n\r\n\tsprite.x = center.x - (LOADED_LIBS[library][asset].offset.x + center.x - 12);\r\n\tsprite.y = center.y - (LOADED_LIBS[library][asset].offset.y - (center.y / 2) - 6);\r\n\r\n\treturn sprite;\r\n}\r\n\r\n/**\r\n * Gets a part texture.\r\n * @param {String} library\r\n * @param {String} asset\r\n * @returns {PIXI.Texture}\r\n */\r\nfunction getTexture(library, asset)\r\n{\r\n\tif (LOADED_LIBS[library] === undefined || LOADED_LIBS[library][asset] === undefined)\r\n\t\treturn null;\r\n\r\n\tif (LOADED_TEXTURES[`${library}:${asset}`] !== undefined)\r\n\t\treturn LOADED_TEXTURES[`${library}:${asset}`];\r\n\r\n\treturn LOADED_TEXTURES[`${library}:${asset}`] = PIXI.Texture.fromImage(\"data:image/png;base64,\" + LOADED_LIBS[library][asset][\"asset\"]);\r\n}\r\n\r\n/**\r\n * Returns a flipped version of {@see setType}.\r\n * @param setType\r\n * @returns {String}\r\n */\r\nfunction getFlippedSetType(setType)\r\n{\r\n\tlet flippedSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"flipped-set-type\");\r\n\r\n\tif (flippedSetType !== null && flippedSetType !== \"\")\r\n\t\treturn flippedSetType;\r\n\r\n\treturn setType;\r\n}\r\n\r\n/**\r\n * Checks if a set type needs to be removed.\r\n * @param setType\r\n * @returns {String}\r\n */\r\nfunction getRemoveSetType(setType)\r\n{\r\n\tlet removeSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"remove-set-type\");\r\n\r\n\tif (removeSetType !== null && removeSetType !== \"\")\r\n\t\treturn removeSetType;\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Gets active partset by id.\r\n * @param {String} id\r\n * @returns {Array}\r\n */\r\nfunction getActivePartSets(id)\r\n{\r\n\tconst result = [];\r\n\tconst activeParts = getPartSets().querySelectorAll(`activePartSet[id=\"${id}\"] activePart`);\r\n\r\n\tactiveParts.forEach(activePart => result.push(activePart.getAttribute(\"set-type\")));\r\n\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * Gets animation frames.\r\n * @param {String} id\r\n * @param {String} type\r\n * @returns {Array}\r\n */\r\nfunction getAnimationFrames(id, type)\r\n{\r\n\tconst defs = getAnimations().querySelectorAll(`action[id=\"${id}\"] part[set-type=\"${type}\"] frame`);\r\n\tconst frames = [];\r\n\r\n\tdefs.forEach(def =>\r\n\t{\r\n\t\tconst repeats = def.hasAttribute(\"repeats\") ? parseInt(def.getAttribute(\"repeats\")) : 1;\r\n\r\n\t\tfor (let i = 0; i < repeats; i++)\r\n\t\t\tframes.push({number: parseInt(def.getAttribute(\"number\")), assetpartdefinition: def.getAttribute(\"assetpartdefinition\")});\r\n\t});\r\n\r\n\treturn frames;\r\n}\r\n\r\n/**\r\n * Gets animation frames.\r\n * @param {String} id\r\n * @returns {Number}\r\n */\r\nfunction getAnimationFramesCount(id)\r\n{\r\n\tconst frames = getAnimations().querySelectorAll(`action[id=\"${id}\"] part:first-child frame`).length;\r\n\tconst offsets = getAnimations().querySelectorAll(`action[id=\"${id}\"] offsets frame`).length;\r\n\r\n\treturn Math.max(frames, offsets);\r\n}\r\n\r\n/**\r\n * Gets animation offset.\r\n * @param id\r\n * @param geometryId\r\n * @param frame\r\n * @param direction\r\n * @returns {{x: number, y: number}}\r\n */\r\nfunction getAnimationOffset(id, geometryId, frame, direction)\r\n{\r\n\tif (isNaN(frame) || isNaN(direction))\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\tconst bodypart = getAnimations().querySelector(`action[id=\"${id}\"] offsets frame[id=\"${frame}\"] directions direction[id=\"${direction}\"] bodypart[id=\"${geometryId}\"]`);\r\n\r\n\tif (bodypart === null)\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\treturn {\r\n\t\tx: parseInt(bodypart.getAttribute(\"dx\")),\r\n\t\ty: parseInt(bodypart.getAttribute(\"dy\"))\r\n\t};\r\n}\r\n\r\nexport class FigureString\r\n{\r\n\r\n\tget parts()\r\n\t{\r\n\t\treturn this._parts;\r\n\t}\r\n\r\n\tconstructor(figure)\r\n\t{\r\n\t\tthis._parts = {};\r\n\r\n\t\tthis.parse(figure);\r\n\t}\r\n\r\n\thasPartId(type, id)\r\n\t{\r\n\t\tif (!this.hasPartType(type))\r\n\t\t\treturn false;\r\n\r\n\t\treturn this._parts[type].id === id;\r\n\t}\r\n\r\n\thasPartType(type)\r\n\t{\r\n\t\treturn this._parts[type] !== undefined;\r\n\t}\r\n\r\n\tparse(figure)\r\n\t{\r\n\t\tfigure = figure.split(\".\");\r\n\t\tfigure = figure.map(part => part.split(\"-\"));\r\n\t\tfigure = figure.sort((a, b) => a[0].localeCompare(b[0]));\r\n\t\tfigure.forEach(part => this._parts[part[0]] = {id: parseInt(part[1]), color: [part[2], part[3]].filter(n => n !== null)});\r\n\t}\r\n\r\n\ttoString()\r\n\t{\r\n\t\tconst str = [];\r\n\r\n\t\tthis.parts.forEach((data, type) => str.push([type, data.id, ...data.color].join(\"-\")));\r\n\r\n\t\treturn str.join(\".\");\r\n\t}\r\n\r\n}\r\n\r\nexport class Avatar extends PIXI.Container\r\n{\r\n\r\n\tget actions()\r\n\t{\r\n\t\treturn this._actions;\r\n\t}\r\n\r\n\tget avatarSet()\r\n\t{\r\n\t\treturn this._avatarSet;\r\n\t}\r\n\r\n\tset avatarSet(value)\r\n\t{\r\n\t\tthis._avatarSet = value;\r\n\t}\r\n\r\n\tget direction()\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction(value)\r\n\t{\r\n\t\tthis._direction = value;\r\n\t}\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this._figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tif (value === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._figure = new FigureString(value);\r\n\t\tthis.poof();\r\n\t}\r\n\r\n\tget geometry()\r\n\t{\r\n\t\treturn this._geometry;\r\n\t}\r\n\r\n\tset geometry(value)\r\n\t{\r\n\t\tthis._geometry = value;\r\n\t}\r\n\r\n\tget headDirection()\r\n\t{\r\n\t\treturn this._headDirection;\r\n\t}\r\n\r\n\tset headDirection(value)\r\n\t{\r\n\t\tthis._headDirection = value;\r\n\t}\r\n\r\n\tconstructor(figure = \"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\", geometry = \"vertical\", avatarSet = \"full\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tsetInteractive(this);\r\n\r\n\t\tthis.canPoof = true;\r\n\t\tthis.lastUpdate = -1;\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.partContainer = new PIXI.Container();\r\n\r\n\t\tthis.addChild(this.partContainer);\r\n\r\n\t\tthis._alsoUpdate = [];\r\n\t\tthis._initial = true;\r\n\t\tthis._ticker = false;\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\r\n\t\tthis._actions = [defaultAction];\r\n\t\tthis._frames = {};\r\n\r\n\t\tthis.avatarSet = avatarSet;\r\n\t\tthis.direction = 2;\r\n\t\tthis.figure = figure;\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.headDirection = this.direction;\r\n\r\n\t\tthis._initial = false;\r\n\r\n\t\tthis.buildSync();\r\n\t}\r\n\r\n\taddAction(action)\r\n\t{\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\treturn;\r\n\r\n\t\taction = getAction(action);\r\n\r\n\t\tif (action === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions\r\n\t\t\t.pushChain(action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\r\n\t\tthis._frames[action.id] = 0;\r\n\r\n\t\tif (action[\"preventheadturn\"] === \"true\")\r\n\t\t\tthis._headDirection = this.direction;\r\n\t}\r\n\r\n\thasAction(action)\r\n\t{\r\n\t\tlet found = false;\r\n\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\tfound = true;\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tremoveAction(action)\r\n\t{\r\n\t\tif (!this.hasAction(action))\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions = this._actions\r\n\t\t\t.filter(a => a.id !== action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\t}\r\n\r\n\tsetPosition(x, y, dir = 3)\r\n\t{\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\tthis.direction = dir;\r\n\t\tthis.headDirection = dir;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tasync build()\r\n\t{\r\n\t\tif (this._initial === true)\r\n\t\t\treturn;\r\n\r\n\t\tthis.emit(\"avatar-build\", this);\r\n\r\n\t\tthis.lastUpdate = application.ticker.lastTime;\r\n\r\n\t\tthis.invalidate();\r\n\t\tthis.decideGeometry();\r\n\t\tthis.gatherParts();\r\n\r\n\t\tconst libraries = this.getLibraries();\r\n\r\n\t\tfor (let library of libraries)\r\n\t\t{\r\n\t\t\tif (isLibraryLoaded(library))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tawait loadAvatarClothingLibrary(library, this.loader);\r\n\t\t}\r\n\r\n\t\tthis._loading = false;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tbuildSync()\r\n\t{\r\n\t\tthis.build().then();\r\n\t}\r\n\r\n\tdecideGeometry()\r\n\t{\r\n\t\tconst geometry = getGeometry().querySelector(`canvas[scale=\"h\"] geometry[id=\"${this.geometry}\"]`);\r\n\t\tthis._height = parseInt(geometry.getAttribute(\"height\"));\r\n\t\tthis._width = parseInt(geometry.getAttribute(\"width\"));\r\n\r\n\t\tif (this.geometry === \"head\")\r\n\t\t\tthis._height = this._width;\r\n\t}\r\n\r\n\tgetActivePartSets(action = null)\r\n\t{\r\n\t\tlet activePartSets = [];\r\n\r\n\t\tif (action === null)\r\n\t\t\tactivePartSets.push(...getActivePartSets(\"figure\"));\r\n\t\telse\r\n\t\t\tactivePartSets.push(...getActivePartSets(action[\"activepartset\"]));\r\n\r\n\t\treturn activePartSets.unique();\r\n\t}\r\n\r\n\thasActivePartSet(id)\r\n\t{\r\n\t\tfor (let action of this.actions)\r\n\t\t\tif (action[\"activepartset\"] === id)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetBodyparts()\r\n\t{\r\n\t\tconst bodyparts = [];\r\n\r\n\t\tquerySelectorAllArray(`avatarset[id=\"${this.avatarSet}\"] bodypart`, getGeometry())\r\n\t\t\t.forEach(part => bodyparts.push(part.getAttribute(\"id\")));\r\n\r\n\t\treturn bodyparts;\r\n\t}\r\n\r\n\tgetLibraries()\r\n\t{\r\n\t\tconst libraries = [];\r\n\r\n\t\tthis._parts.forEach((settype, type) =>\r\n\t\t{\r\n\t\t\tsettype.parts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tlet lib = getFigureMap().querySelector(`part[id=\"${part.id}\"][type=\"${type}\"]`);\r\n\r\n\t\t\t\tif (lib === null || lib.parentNode === null)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tlib = lib.parentNode;\r\n\r\n\t\t\t\tlibraries.push(part[\"library\"] = lib.getAttribute(\"id\").toLowerCase());\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn libraries.unique();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\tlet x = -(this._width / 2);\r\n\t\tlet y = -104;\r\n\r\n\t\treturn {x, y};\r\n\t}\r\n\r\n\tgatherParts()\r\n\t{\r\n\t\tthis.figure.parts.forEach((data, type) =>\r\n\t\t{\r\n\t\t\tconst settype = getFigureData().querySelector(`sets > settype[type=\"${type}\"]`);\r\n\r\n\t\t\tif (settype === null)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst set = settype.querySelector(`set[id=\"${data.id}\"]`);\r\n\t\t\tconst parts = set.getElementsByTagName(\"part\");\r\n\r\n\t\t\tconst colorable = set.getAttribute(\"colorable\") === \"1\";\r\n\t\t\tconst hiddenlayers = [];\r\n\t\t\tconst paletteid = settype.getAttribute(\"paletteid\");\r\n\r\n\t\t\tconst setHiddenlayers = set.querySelectorAll(\"hiddenlayers layer\");\r\n\t\t\tif (setHiddenlayers !== null)\r\n\t\t\t\tsetHiddenlayers.forEach(layer => hiddenlayers.push(layer.getAttribute(\"parttype\")));\r\n\r\n\t\t\tparts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tconst partType = part.getAttribute(\"type\");\r\n\r\n\t\t\t\tif (this._parts[partType] === undefined)\r\n\t\t\t\t\tthis._parts[partType] = {hiddenlayers, parts: []};\r\n\r\n\t\t\t\tthis._parts[partType].parts.push({\r\n\t\t\t\t\tid: parseInt(part.getAttribute(\"id\")),\r\n\t\t\t\t\tcolorable: part.getAttribute(\"colorable\") === \"1\" && colorable,\r\n\t\t\t\t\tcolorindex: parseInt(part.getAttribute(\"colorindex\")),\r\n\t\t\t\t\tindex: parseInt(part.getAttribute(\"index\")),\r\n\t\t\t\t\tpaletteid,\r\n\t\t\t\t\tset: type,\r\n\t\t\t\t\ttype: partType\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tinvalidate()\r\n\t{\r\n\t\tthis._loading = true;\r\n\t\tthis._parts = {};\r\n\t\tthis._sprites = {};\r\n\r\n\t\tthis.decideGeometry();\r\n\t}\r\n\r\n\tpoof()\r\n\t{\r\n\t\tif (this._initial || !this.canPoof)\r\n\t\t\treturn;\r\n\r\n\t\tconst clouds = [\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: -36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: 36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: 16\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: -16\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\tlet cx = this._width / 2, cy = this._height / 2;\r\n\t\tlet fn = cloud =>\r\n\t\t{\r\n\t\t\tthis.addChild(cloud.sprite);\r\n\t\t\tcloud.sprite.anchor.set(0.5);\r\n\t\t\tcloud.sprite.animationSpeed = 0.2;\r\n\t\t\tcloud.sprite.loop = false;\r\n\t\t\tcloud.sprite.hitArea = null;\r\n\t\t\tcloud.sprite.position.x = cx + cloud.x;\r\n\t\t\tcloud.sprite.position.y = cy + cloud.y;\r\n\t\t\tcloud.sprite.play();\r\n\r\n\t\t\tsetTimeout(() => this.removeChild(cloud.sprite), 330);\r\n\r\n\t\t\tif (clouds[0] !== undefined)\r\n\t\t\t\tsetTimeout(() => fn(clouds.shift()), 45);\r\n\t\t};\r\n\r\n\t\tfn(clouds.shift());\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tif (this._loading)\r\n\t\t{\r\n\t\t\tconst cmf = new PIXI.filters.AlphaFilter();\r\n\t\t\tcmf.alpha = 0.8;\r\n\t\t\tthis.filters = [cmf];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.filters = [];\r\n\t\t}\r\n\r\n\t\tlet draworderId = \"std\";\r\n\r\n\t\tif (this.hasActivePartSet(\"handLeft\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"rh-up\" : \"lh-up\";\r\n\t\telse if (this.hasActivePartSet(\"handRightAndHead\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"lh-up\" : \"rh-up\";\r\n\r\n\t\tlet draworder = querySelectorAllArray(`action[id=\"${draworderId}\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\tif (draworder.length === 0)\r\n\t\t\tdraworder = querySelectorAllArray(`action[id=\"std\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\twhile (this.partContainer.children[0])\r\n\t\t\tthis.partContainer.removeChild(this.partContainer.children[0]);\r\n\r\n\t\tfor (let type of draworder)\r\n\t\t\tif (this._sprites[type] !== undefined)\r\n\t\t\t\tthis._sprites[type].forEach(part => this.partContainer.addChild(part));\r\n\r\n\t\tif (this._ticker === false)\r\n\t\t{\r\n\t\t\tthis._ticker = true;\r\n\r\n\t\t\tapplication.ticker.add(() =>\r\n\t\t\t{\r\n\t\t\t\tif (this.lastUpdate === -1 || (application.ticker.lastTime - this.lastUpdate) > 120)\r\n\t\t\t\t\tthis.buildSync();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.actions.forEach(action => this.updateAction(action));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tupdateAction(action = null)\r\n\t{\r\n\t\tif (this._initial === true)\r\n\t\t\treturn;\r\n\r\n\t\tconst center = {\r\n\t\t\tx: this._width / 2,\r\n\t\t\ty: this._height / 2\r\n\t\t};\r\n\r\n\t\tconst activePartSets = this.getActivePartSets(action);\r\n\t\tconst frame = ++this._frames[action.id] || 0;\r\n\r\n\t\tconst hiddenlayers = [];\r\n\t\tconst avatarParts = this._loading ? (loadingAvatar !== null ? loadingAvatar._parts : {}) : this._parts;\r\n\r\n\t\tavatarParts.forEach(data => hiddenlayers.push(...data.hiddenlayers));\r\n\r\n\t\tlet bodyparts = [];\r\n\t\tthis.getBodyparts().forEach(bodypart => bodyparts.push(getGeometry().querySelector(`type[id=\"${this.geometry}\"] bodypart[id=\"${bodypart}\"]`)));\r\n\r\n\t\tfor (const partset of bodyparts.sort(radiusComparator))\r\n\t\t{\r\n\t\t\tlet bodypart = partset.getAttribute(\"id\");\r\n\t\t\tlet items = querySelectorAllArray(\"item\", partset).sort(radiusComparator);\r\n\r\n\t\t\tfor (const item of items)\r\n\t\t\t{\r\n\t\t\t\tlet partDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\tlet partType = item.getAttribute(\"id\");\r\n\t\t\t\tlet partDirectionWithoutFlip = partDirection;\r\n\t\t\t\tlet partTypeWithoutFlip = partType;\r\n\t\t\t\tlet partSwapped = false;\r\n\t\t\t\tlet removeSetType = getRemoveSetType(partType);\r\n\r\n\t\t\t\tif (removeSetType !== null)\r\n\t\t\t\t\thiddenlayers.push(removeSetType);\r\n\r\n\t\t\t\tif (partDirection > 3 && partDirection < 7)\r\n\t\t\t\t{\r\n\t\t\t\t\tpartSwapped = true;\r\n\t\t\t\t\tpartType = getFlippedSetType(partType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet partValidActions = getValidActionsForPart(partType);\r\n\t\t\t\tlet partFrames = getAnimationFrames(action.id, partType);\r\n\r\n\t\t\t\tif (activePartSets.indexOf(partType) === -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (this._sprites[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip] = {};\r\n\r\n\t\t\t\tif (hiddenlayers.indexOf(partType) > -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (avatarParts[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tfor (const part of avatarParts[partTypeWithoutFlip].parts)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._loading && part.library !== \"hh_human_body\")\r\n\t\t\t\t\t\tbreak; // Other parts are probably from another library.\r\n\r\n\t\t\t\t\tlet offset = {\r\n\t\t\t\t\t\tx: parseInt(partset.getAttribute(\"x\")),\r\n\t\t\t\t\t\ty: parseInt(partset.getAttribute(\"y\"))\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tlet partFlipped = false;\r\n\t\t\t\t\tlet partFrame = frame % (partFrames !== null ? Object.values(partFrames).length : 1);\r\n\t\t\t\t\tlet partAction = (partFrames && partFrames[partFrame] ? partFrames[partFrame].assetpartdefinition : action.assetpartdefinition);\r\n\r\n\t\t\t\t\tif (partValidActions.indexOf(partAction) === -1)\r\n\t\t\t\t\t\tpartAction = partValidActions[0];\r\n\r\n\t\t\t\t\tpartDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\t\tpartFrame = partFrames && partFrames[partFrame] ? partFrames[partFrame].number : 0;\r\n\r\n\t\t\t\t\tlet animationOffset = getAnimationOffset(action.id, bodypart, frame % getAnimationFramesCount(action.id), partDirection);\r\n\t\t\t\t\tlet generateAssetName = () => `h_${partAction}_${partType}_${part.id}_${partDirection}_${partFrame}`;\r\n\t\t\t\t\tlet sprite = getSprite(part.library, generateAssetName(), center);\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opf = partFrame;\r\n\t\t\t\t\t\tpartFrame = 0;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartFrame = opf;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpartDirection = 6 - partDirection;\r\n\t\t\t\t\t\tpartFlipped = partDirectionWithoutFlip > 3 && partDirectionWithoutFlip < 7;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opa = partAction;\r\n\t\t\t\t\t\tpartAction = \"std\";\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartAction = opa;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// if (partType !== \"ey\" && partType !== \"fc\")\r\n\t\t\t\t\t\t// \tLogger.debug(\"Sprite not found!\", generateAssetName(), part.library, partType);\r\n\r\n\t\t\t\t\t\tbreak; // Don't draw incomplete pieces.\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!partSwapped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x += offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y += offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x -= offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y -= offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (partFlipped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.scale.x = -1;\r\n\t\t\t\t\t\tsprite.x = (((this._width - sprite.width) - sprite.x) + sprite.width) + animationOffset.x;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsprite.x = Math.floor(sprite.x);\r\n\t\t\t\t\tsprite.y = Math.floor(sprite.y);\r\n\r\n\t\t\t\t\tif (part.colorable && partType !== \"ey\" && !this._loading)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst colors = this.figure.parts[part.set].color;\r\n\t\t\t\t\t\tconst color = colors[part.colorindex - 1] || colors[0];\r\n\t\t\t\t\t\tconst fdColor = getFigureData().querySelector(`palette[id=\"${part.paletteid}\"] color[id=\"${color}\"]`);\r\n\r\n\t\t\t\t\t\tif (fdColor !== null)\r\n\t\t\t\t\t\t\tsprite.tint = parseInt(`0x${fdColor.textContent}`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this._sprites[partTypeWithoutFlip][part.index] !== undefined)\r\n\t\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index].destroy(false);\r\n\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index] = sprite;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_body\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"actions\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"animations\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"draworder\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"effectmap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuredata\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuremap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"geometry\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"offsets\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"partsets\", this.loader);\r\n\r\n\t\tavatarResources.poof.forEach(image => this.loader.add(image));\r\n\t}\r\n\r\n}\r\n","\r\nexport function evaluateString(string, context = {})\r\n{\r\n\tstring = string.replace(new RegExp(\"\\\\${(.*?)}\", \"g\"), (matches, contents) => findKey(contents, context));\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function findKey(key, object, defaultValue = undefined)\r\n{\r\n\tconst keyParts = key.split(\".\");\r\n\tlet current = object;\r\n\r\n\tfor (const keyPart of keyParts)\r\n\t{\r\n\t\tif (current[keyPart] === undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\tcurrent = current[keyPart];\r\n\t}\r\n\r\n\treturn current;\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst configJson = \"./resource/config/config.json\";\r\n\r\nexport class ConfigManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.config = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(configJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onConfigLoaded(application.getResource(configJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.config);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.config));\r\n\t}\r\n\r\n\tonConfigLoaded(config)\r\n\t{\r\n\t\tif (config === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.config = config.data;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { ConfigManager } from \"../config/config.js\";\r\n\r\nconst textsJson = \"./resource/config/texts.json\";\r\n\r\nexport class I18nManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.texts = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(textsJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onTextsLoaded(application.getResource(textsJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.texts);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.text, application.getManager(ConfigManager).config));\r\n\t}\r\n\r\n\tonTextsLoaded(texts)\r\n\t{\r\n\t\tif (texts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.texts = texts.data;\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { I18nManager } from \"../core/i18n/i18n.js\";\r\n\r\nconst resourceLogo = \"/resource/image/logo.png\";\r\n\r\nclass LoadingBar extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.barColor = 0x888888;\r\n\t\tthis.barHeight = 12;\r\n\t\tthis.barThickness = 2;\r\n\t\tthis.barWidth = 300;\r\n\t\tthis.percentage = 0;\r\n\r\n\t\tapplication.display.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(this.barColor);\r\n\t\tthis.drawRect(0, 0, Math.round(this.percentage / 100 * this.barWidth), this.barHeight);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(this.barThickness, this.barColor);\r\n\r\n\t\tthis.moveTo(-this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, -this.barThickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class LoadingView extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this.loadingBar.percentage || 0;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis.loadingBar.percentage = Math.round(value);\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingBar = new LoadingBar();\r\n\r\n\t\tthis.logo = null;\r\n\r\n\t\tthis.init();\r\n\t\tthis.loadResources();\r\n\r\n\t\tapplication.display.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"Segoe UI\",\r\n\t\t\tfontSize: 13,\r\n\t\t\tfill: \"white\",\r\n\t\t\twordWrap: true,\r\n\t\t\twordWrapWidth: 360\r\n\t\t});\r\n\r\n\t\tthis.text = new PIXI.Text(\"\", style);\r\n\t}\r\n\r\n\tloadResources()\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(resourceLogo)\r\n\t\t\t.load(() => this.onResourcesLoaded())\r\n\t}\r\n\r\n\tonResourcesLoaded()\r\n\t{\r\n\t\tthis.logo = new PIXI.Sprite(application.getResource(resourceLogo, this.loader).texture);\r\n\r\n\t\tthis.addChild(this.logo);\r\n\r\n\t\tthis.addChild(this.loadingBar);\r\n\t\tthis.addChild(this.text);\r\n\r\n\t\tthis.emit(\"loader-ready\");\r\n\r\n\t\tapplication.loader.on(\"progress\", state => this.percentage = state.progress);\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tconst percentage = this.percentage;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst height = application.display.height;\r\n\t\tconst width = application.display.width;\r\n\r\n\t\tthis.beginFill(0x0);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.loadingBar.position.x = Math.round((width / 2) - (this.loadingBar.width / 2));\r\n\t\tthis.loadingBar.position.y = height - (this.loadingBar.height + 91);\r\n\r\n\t\tif (this.logo !== null)\r\n\t\t{\r\n\t\t\tthis.logo.x = Math.round((width / 2) - (this.logo.width / 2));\r\n\t\t\tthis.logo.y = Math.round((height / 2) - (this.logo.height / 2));\r\n\t\t}\r\n\r\n\t\tthis.text.text = application.getManager(I18nManager).getString(\"loading-view.starting-up\", {percentage}, \"\");\r\n\r\n\t\tthis.text.position.set(\r\n\t\t\tMath.floor((width / 2) - (this.text.width / 2)),\r\n\t\t\tthis.loadingBar.position.y - 30\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import { removeHtml } from \"./core/dom-utils.js\";\r\n\r\nlet frame = 0;\r\n\r\nconst stageElement = \"main#stage-mount\";\r\n\r\nexport class Display extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget frame()\r\n\t{\r\n\t\treturn frame;\r\n\t}\r\n\r\n\tget renderer()\r\n\t{\r\n\t\treturn this.app.renderer;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.app.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.app.ticker;\r\n\t}\r\n\r\n\tget view()\r\n\t{\r\n\t\treturn this.app.view;\r\n\t}\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this.renderer.height / this.dpi;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this.renderer.width / this.dpi;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.dpi = 1;//window.devicePixelRatio;\r\n\t\tthis.mount = document.querySelector(stageElement);\r\n\r\n\t\tif (this.mount === null)\r\n\t\t\tthrow new Error(\"Display mount not found!\");\r\n\r\n\t\tremoveHtml(this.mount);\r\n\r\n\t\tthis.initApp();\r\n\t\tthis.initEvents();\r\n\r\n\t\tthis.ticker.add(() => frame++);\r\n\t}\r\n\r\n\tinitApp()\r\n\t{\r\n\t\tthis.app = new PIXI.Application({\r\n\t\t\theight: window.innerHeight / this.dpi,\r\n\t\t\twidth: window.innerWidth / this.dpi,\r\n\t\t\tantialiasing: false,\r\n\t\t\ttransparent: false,\r\n\t\t\tresolution: this.dpi,\r\n\t\t\troundPixels: false\r\n\t\t});\r\n\r\n\t\tthis.mount.appendChild(this.view);\r\n\t}\r\n\r\n\tinitEvents()\r\n\t{\r\n\t\twindow.addEventListener(\"resize\", () => this.onWindowResize());\r\n\t}\r\n\r\n\tonWindowResize()\r\n\t{\r\n\t\tthis.renderer.resize(window.innerWidth / this.dpi, window.innerHeight / this.dpi);\r\n\t\tthis.emit(\"resize\");\r\n\t}\r\n\r\n}\r\n","export const initialLoadingDelay = 0;\r\n","import { application } from \"../../bootstrapper.js\";\r\n\r\nconst toolbarHeight = 54;\r\n\r\nexport class Toolbar extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x24211C);\r\n\t\tthis.drawRect(0, 0, application.display.width, toolbarHeight);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x27251F);\r\n\t\tthis.drawRect(0, 0, application.display.width, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x201D19);\r\n\t\tthis.drawRect(0, toolbarHeight - 6, application.display.width, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x33312B);\r\n\t\tthis.drawRect(0, toolbarHeight, application.display.width, 3);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { Avatar } from \"../../view/avatar/avatar.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\n\r\nconst memenuSize = 60;\r\nconst memenuSizeHalf = Math.floor(memenuSize / 2);\r\n\r\nexport class MeMenu extends PIXI.Container\r\n{\r\n\r\n\tget avatar()\r\n\t{\r\n\t\treturn this._avatar;\r\n\t}\r\n\r\n\tget chatBubble()\r\n\t{\r\n\t\treturn this._chatBubble;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._avatarHolder = new PIXI.Graphics();\r\n\t\tthis._avatarHolder.buttonMode = true;\r\n\t\tthis._avatarHolder.interactive = true;\r\n\t\tthis._avatarHolder.on(\"pointerover\", () => this.onAvatarHover());\r\n\t\tthis._avatarHolder.on(\"pointerout\", () => this.onAvatarLeave());\r\n\r\n\t\tthis._avatar = new Avatar(\"\", \"vertical\", \"head\");\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.headDirection = 3;\r\n\t\tthis.avatar.position.x = -15;\r\n\t\tthis.avatar.position.y = -11;\r\n\t\tthis.avatar.update();\r\n\t\tthis._avatarHolder.addChild(this.avatar);\r\n\r\n\t\tthis._chatBubble = new ChatBubble();\r\n\t\tthis.chatBubble.position.x = memenuSize + 8;\r\n\t\tthis.chatBubble.position.y = 8;\r\n\t\tthis.chatBubble.on(\"pointerover\", () => this.onChatBubbleHover());\r\n\t\tthis.chatBubble.on(\"pointerout\", () => this.onChatBubbleLeave());\r\n\r\n\t\tthis.addChild(this._avatarHolder);\r\n\t\tthis.addChild(this.chatBubble);\r\n\r\n\t\tthis.draw();\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\r\n\t\tsetTimeout(() => this.avatar.addAction(\"GestureSmile\"), 500);\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.position.x = 16;\r\n\t\tthis.position.y = application.display.height - (memenuSize + 16);\r\n\r\n\t\tthis._avatarHolder.clear();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x000000, 0.25);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf + 2, memenuSizeHalf + 2);\r\n\t\tthis._avatarHolder.endFill();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x0C3A65);\r\n\t\tthis._avatarHolder.lineStyle(4, 0x244d74);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf, memenuSizeHalf);\r\n\t\tthis._avatarHolder.endFill();\r\n\t}\r\n\r\n\tonAvatarHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"GestureSurprised\");\r\n\t}\r\n\r\n\tonAvatarLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSurprised\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n\tonChatBubbleHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"Talk\");\r\n\t}\r\n\r\n\tonChatBubbleLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"Talk\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n}\r\n\r\nclass ChatBubble extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.imLeft = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.left).texture); // 17x44\r\n\t\tthis.imMiddle = new PIXI.extras.TilingSprite(application.getResource(interfaceResources.chatBubble.middle).texture); // 1x44\r\n\t\tthis.imRight = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.right).texture); // 12x44\r\n\r\n\t\tthis.imLeft.height = 44;\r\n\t\tthis.imMiddle.height = 44;\r\n\t\tthis.imRight.height = 44;\r\n\r\n\t\tthis.addChild(this.imLeft);\r\n\t\tthis.addChild(this.imMiddle);\r\n\t\tthis.addChild(this.imRight);\r\n\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tlet textWidth = 100;\r\n\r\n\t\tthis.imLeft.position.x = 0;\r\n\t\tthis.imLeft.position.y = 0;\r\n\r\n\t\tthis.imMiddle.position.x = 17;\r\n\t\tthis.imMiddle.position.y = 0;\r\n\t\tthis.imMiddle.width = textWidth;\r\n\r\n\t\tthis.imRight.position.x = 17 + textWidth;\r\n\t\tthis.imRight.position.y = 0;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { Toolbar } from \"./toolbar.js\";\r\nimport { MeMenu } from \"./memenu.js\";\r\n\r\nexport const interfaceResources = {\r\n\tchatBubble: {\r\n\t\tleft: \"./resource/image/interface/chat-bubble/left.png\",\r\n\t\tmiddle: \"./resource/image/interface/chat-bubble/middle.png\",\r\n\t\tright: \"./resource/image/interface/chat-bubble/right.png\"\r\n\t}\r\n};\r\n\r\nexport class InterfaceContainer extends PIXI.Container\r\n{\r\n\r\n\tget memenu()\r\n\t{\r\n\t\treturn this._memenu;\r\n\t}\r\n\r\n\tget toolbar()\r\n\t{\r\n\t\treturn this._toolbar;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._memenu = new MeMenu();\r\n\t\tthis._toolbar = new Toolbar();\r\n\r\n\t\tthis.addChild(this.memenu);\r\n\t\tthis.addChild(this.toolbar);\r\n\r\n\t\tthis.memenu.avatar.figure = \"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\";\r\n\t}\r\n\r\n}\r\n\r\nexport class InterfaceManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(interfaceResources.chatBubble.left);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.middle);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.right);\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../../core/pixi-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst debugDoor = false;\r\nconst debugWalls = false;\r\n\r\nconst hitAreaOffset = 5000;\r\n\r\nexport const tileHeight = 32;\r\nexport const tileHeightHalf = tileHeight / 2;\r\nexport const tileWidth = 64;\r\nexport const tileWidthHalf = tileWidth / 2;\r\n\r\nlet heightMaps = [];\r\n\r\nexport const Heading = {\r\n\tNorthEast: 0,\r\n\tNorthWest: 1,\r\n\tSouthEast: 2,\r\n\tSouthWest: 3\r\n};\r\n\r\nfunction drawTile(g, points, thickness)\r\n{\r\n\tg.beginFill(0x989865);\r\n\tg.lineStyle(1.0, 0x8E8E5E);\r\n\tg.moveTo(points[0].x, points[0].y);\r\n\tg.lineTo(points[1].x, points[1].y);\r\n\tg.lineTo(points[2].x, points[2].y);\r\n\tg.lineTo(points[3].x, points[3].y);\r\n\tg.endFill();\r\n\r\n\tif (thickness > 0)\r\n\t{\r\n\t\tg.beginFill(0x838357);\r\n\t\tg.lineStyle(0.5, 0x7A7A51);\r\n\t\tg.moveTo(points[1].x, points[1].y);\r\n\t\tg.lineTo(points[1].x, points[1].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\r\n\t\tg.beginFill(0x6F6F49);\r\n\t\tg.lineStyle(0.5, 0x676744);\r\n\t\tg.moveTo(points[3].x, points[3].y);\r\n\t\tg.lineTo(points[3].x, points[3].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\t}\r\n}\r\n\r\nfunction getDoorDirection(tiles, row, column)\r\n{\r\n\tif (!isDoor(tiles, row, column))\r\n\t\treturn null;\r\n\r\n\treturn [Heading.NorthEast, Heading.NorthWest, Heading.SouthEast, Heading.SouthWest][getSurroundings(tiles, row, column).findIndex(t => t !== null)];\r\n}\r\n\r\nfunction getSurroundings(tiles, row, column)\r\n{\r\n\tlet tileNorthEast = getTile(tiles, row - 1, column);\r\n\tlet tileNorthWest = getTile(tiles, row, column - 1);\r\n\tlet tileSouthEast = getTile(tiles, row, column + 1);\r\n\tlet tileSouthWest = getTile(tiles, row + 1, column);\r\n\r\n\treturn [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest];\r\n}\r\n\r\nfunction getTile(tiles, row, column)\r\n{\r\n\tif (typeof tiles[row] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\tif (typeof tiles[row][column] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\treturn tiles[row][column];\r\n}\r\n\r\nfunction getTileHeightIndex(char)\r\n{\r\n\tif (char === \"x\")\r\n\t\treturn null;\r\n\r\n\treturn [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"].indexOf(char);\r\n}\r\n\r\nfunction isDoor(tiles, row, column)\r\n{\r\n\tif (getTile(tiles, row, column) === null)\r\n\t\treturn false;\r\n\r\n\treturn getSurroundings(tiles, row, column).filter(t => t !== null).length === 1;\r\n}\r\n\r\nfunction needsWallC(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cy = row;\r\n\r\n\twhile (cy > 0)\r\n\t\tif (getTile(tiles, --cy, column) !== null && !isDoor(tiles, row, cy))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row - 1, column + 1) !== null && !isDoor(tiles, row - 1, column + 1)));\r\n}\r\n\r\nfunction needsWallR(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cx = column;\r\n\r\n\twhile (cx > 0)\r\n\t\tif (getTile(tiles, row, --cx) !== null && !isDoor(tiles, row, cx))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row + 1, column - 1) !== null && !isDoor(tiles, row + 1, column - 1)));\r\n}\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx000x\r\n0000x\r\nx000x\r\nx000x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx110x\r\nx110x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx2222xxxxxxxxxxxxxx\r\nx2222xxxxxxxxxxxxxx\r\nx2222211111xx000000\r\nx222221111110000000\r\nx222221111110000000\r\nx2222211111xx000000\r\nxx22xxx1111xxxxxxxx\r\nxx11xxx1111xxxxxxxx\r\nx1111xx1111xx000000\r\nx1111xx111110000000\r\nx1111xx111110000000\r\nx1111xx1111xx000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxxx\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx000x11xxxxxxxx11x000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx2222xx111111111111\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\n22222xx000000000000\r\nx2222xx000000000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x00000000xxxxxxxx00000000xxxx\r\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\n0000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nexport class RoomView extends PIXI.Graphics\r\n{\r\n\r\n\tget entities()\r\n\t{\r\n\t\treturn this._entities;\r\n\t}\r\n\r\n\tget heightmap()\r\n\t{\r\n\t\treturn this._heightmap;\r\n\t}\r\n\r\n\tget roomScale()\r\n\t{\r\n\t\treturn this.scale.x;\r\n\t}\r\n\r\n\tset roomScale(value)\r\n\t{\r\n\t\tthis.scale.x = value;\r\n\t\tthis.scale.y = value;\r\n\t}\r\n\r\n\tget tiles()\r\n\t{\r\n\t\treturn this._tiles;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._heightmap = {};\r\n\t\tthis._tiles = {};\r\n\r\n\t\tthis.columns = 0;\r\n\t\tthis.rows = 0;\r\n\r\n\t\tthis.offsets = {x: 0, y: 0};\r\n\r\n\t\tsimpleDraggable(this);\r\n\t\tthis.prepareHeightmap(heightMaps[5]);\r\n\r\n\t\tthis.roomScale = 1;\r\n\t\tthis.tileCursor = new TileCursor();\r\n\r\n\t\tapplication.ticker.add(() => this.onTick());\r\n\t}\r\n\r\n\tprepareHeightmap(floorplan)\r\n\t{\r\n\t\tthis.emit(\"room-view-emptied\");\r\n\r\n\t\tconst tiles = this._heightmap = floorplan\r\n\t\t\t.trim()\r\n\t\t\t.split(\"\\n\")\r\n\t\t\t.map(row => row.split(\"\").map(char => getTileHeightIndex(char)));\r\n\r\n\t\tthis.clear();\r\n\r\n\t\twhile (this.children[0])\r\n\t\t\tthis.removeChild(this.children[0]);\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._tiles = {};\r\n\r\n\t\tif (tiles.length === 0)\r\n\t\t\treturn;\r\n\r\n\t\tthis.columns = tiles[0].length;\r\n\t\tthis.rows = tiles.length;\r\n\r\n\t\tfor (let row = 0; row < tiles.length; row++)\r\n\t\t{\r\n\t\t\tthis._tiles[row] = {};\r\n\r\n\t\t\tfor (let column = 0; column < tiles[row].length; column++)\r\n\t\t\t{\r\n\t\t\t\tlet tileHeight = this.getTileHeight(row, column);\r\n\r\n\t\t\t\tif (tileHeight === null)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlet implementation = Tile;\r\n\t\t\t\tlet tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest;\r\n\r\n\t\t\t\t[tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest] = getSurroundings(tiles, row, column);\r\n\r\n\t\t\t\tlet door = isDoor(tiles, row, column);\r\n\t\t\t\tlet doorDirection = door ? getDoorDirection(tiles, row, column) : null;\r\n\r\n\t\t\t\tlet wallC = needsWallC(tiles, row, column);\r\n\t\t\t\tlet wallR = needsWallR(tiles, row, column);\r\n\t\t\t\tlet wall = wallC || wallR;\r\n\r\n\t\t\t\tif (tileSouthEast !== null && tileSouthWest !== null && Math.abs(tileHeight - tileSouthEast) === 1 && Math.abs(tileHeight - tileSouthWest) === 1)\r\n\t\t\t\t\timplementation = StairsSouth;\r\n\t\t\t\telse if (tileSouthEast !== null && Math.abs(tileHeight - tileSouthEast) === 1)\r\n\t\t\t\t\timplementation = StairsSouthEast;\r\n\t\t\t\telse if (tileSouthWest !== null && Math.abs(tileHeight - tileSouthWest) === 1)\r\n\t\t\t\t\timplementation = StairsSouthWest;\r\n\r\n\t\t\t\tlet x = this.getX(row, column);\r\n\t\t\t\tlet y = this.getY(row, column);\r\n\t\t\t\tlet z = this.getZ(row, column);\r\n\r\n\t\t\t\tif (wall)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet wallImplementations = [];\r\n\t\t\t\t\tlet isDoorColumn = isDoor(tiles, row - 1, column);\r\n\t\t\t\t\tlet isDoorRow = isDoor(tiles, row, column - 1);\r\n\r\n\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallCorner());\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(isDoorColumn));\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(isDoorRow));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(isDoorColumn));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(isDoorRow));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const wi of wallImplementations)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.addChild(withInstance(wi, wall =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.entities.push(wall);\r\n\r\n\t\t\t\t\t\t\twall.x = x + tileWidthHalf;\r\n\t\t\t\t\t\t\twall.y = y;\r\n\t\t\t\t\t\t\twall.z = isDoorColumn || isDoorRow ? this.getZ(row + 1, column) : (z - 1);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.addChild(withInstance(new implementation(), tile =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.entities.push(tile);\r\n\t\t\t\t\tthis._tiles[row][column] = tile;\r\n\r\n\t\t\t\t\ttile.row = row;\r\n\t\t\t\t\ttile.column = column;\r\n\r\n\t\t\t\t\tif (debugDoor && door)\r\n\t\t\t\t\t\ttile.tint = 0xFF0000;\r\n\r\n\t\t\t\t\tif (debugWalls)\r\n\t\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FFFF;\r\n\t\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FF00;\r\n\t\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x0000FF;\r\n\r\n\t\t\t\t\ttile.on(\"tile-click\", evt => this.onTileClick(evt));\r\n\t\t\t\t\ttile.on(\"tile-hover\", evt => this.onTileHover(evt));\r\n\t\t\t\t\ttile.on(\"tile-leave\", evt => this.onTileLeave(evt));\r\n\r\n\t\t\t\t\ttile.x = x;\r\n\t\t\t\t\ttile.y = y;\r\n\t\t\t\t\ttile.z = z;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.entities.length > 0)\r\n\t\t{\r\n\t\t\tlet xred = this.entities.reduce((acc, cur) => acc.x < cur.x ? acc : cur).x;\r\n\t\t\tlet yred = this.entities\r\n\t\t\t\t.filter(acc => acc instanceof TileBase)\r\n\t\t\t\t.reduce((acc, cur) => acc.y < cur.y ? acc : cur).y;\r\n\r\n\t\t\tthis.offsets.x = -xred;\r\n\t\t\tthis.offsets.y = -yred;\r\n\r\n\t\t\tthis.entities.forEach(entity =>\r\n\t\t\t{\r\n\t\t\t\tentity.x -= xred;\r\n\t\t\t\tentity.y -= yred;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.position.x = Math.floor((application.display.width / 2) - (this.width / 2));\r\n\t\tthis.position.y = Math.floor((application.display.height / 2) - (this.height / 2 - 115));\r\n\r\n\t\tthis.hitArea = new PIXI.Rectangle(-hitAreaOffset, -hitAreaOffset, this.width + (hitAreaOffset * 2), this.height + (hitAreaOffset * 2));\r\n\r\n\t\tthis.emit(\"room-view-ready\");\r\n\t}\r\n\r\n\tassociateEntityToTile(entity, row, column)\r\n\t{\r\n\t\tlet pos = this.getEntityPosition(entity, row, column);\r\n\r\n\t\tentity.position.x = pos.x;\r\n\t\tentity.position.y = pos.y;\r\n\t\tentity.z = pos.z;\r\n\t}\r\n\r\n\tcenterEntity(entity, animate = true)\r\n\t{\r\n\t\tlet x = application.display.width / 2;\r\n\t\tlet y = application.display.height / 2;\r\n\r\n\t\tx -= Math.round(entity.x + entity.width / 2);\r\n\t\ty -= Math.round(entity.y + entity.height / 2);\r\n\r\n\t\tx = x - (x % 2);\r\n\r\n\t\tif (animate)\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 800,\r\n\t\t\t\teasing: \"easeInOutSine\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 45,\r\n\t\t\t\teasing: \"linear\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetEntityPosition(entity, row, column)\r\n\t{\r\n\t\tlet offsets = {x: 0, y: 0};\r\n\t\tlet tile = this.getTile(row, column);\r\n\r\n\t\tif (entity.getRoomOffsets !== undefined)\r\n\t\t\toffsets = entity.getRoomOffsets();\r\n\r\n\t\tlet x = (this.getX(row, column) + tileWidthHalf) + (offsets.x + this.offsets.x);\r\n\t\tlet y = (this.getY(row, column) + tileHeightHalf) + (offsets.y + this.offsets.y) + (tile && !(tile instanceof Tile) ? (tileHeightHalf / 2) : 0);\r\n\t\tlet z = this.getZ(row, column, 5);\r\n\r\n\t\treturn {x, y, z};\r\n\t}\r\n\r\n\tgetTile(row, column)\r\n\t{\r\n\t\tif (this.tiles[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.tiles[row][column] || undefined;\r\n\t}\r\n\r\n\tgetTileHeight(row, column)\r\n\t{\r\n\t\tif (this.heightmap[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.heightmap[row][column];\r\n\t}\r\n\r\n\tgetX(row, column)\r\n\t{\r\n\t\treturn (column - row) * tileWidthHalf;\r\n\t}\r\n\r\n\tgetY(row, column)\r\n\t{\r\n\t\tlet h = this.getTileHeight(row, column);\r\n\r\n\t\tif (h === undefined)\r\n\t\t\th = 0;\r\n\r\n\t\treturn (column + row) * tileHeightHalf - (h * tileWidthHalf);\r\n\t}\r\n\r\n\tgetZ(row, column, add = 0)\r\n\t{\r\n\t\trow *= 1000;\r\n\t\tcolumn *= 1000;\r\n\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tthis.updateLayerOrder();\r\n\t}\r\n\r\n\tonTileClick(evt)\r\n\t{\r\n\t\tthis.emit(\"tile-click\", evt);\r\n\t}\r\n\r\n\tonTileHover(evt)\r\n\t{\r\n\t\tthis.addChild(this.tileCursor);\r\n\t\tthis.tileCursor.hover(evt.row, evt.column, evt.x, evt.y, this.getZ(evt.row, evt.column, 1), evt.tile);\r\n\t}\r\n\r\n\tonTileLeave(evt)\r\n\t{\r\n\t\tthis.removeChild(this.tileCursor);\r\n\t}\r\n\r\n}\r\n\r\nclass WallBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.doorHeight = 85;\r\n\t\tthis.tileThickness = 8;\r\n\t\tthis.wallHeight = 115;\r\n\t\tthis.wallThickness = 8;\r\n\t}\r\n\r\n}\r\n\r\nclass WallColumn extends WallBase\r\n{\r\n\r\n\tconstructor(doorMode)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tlet hole = doorMode ? this.doorHeight : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0x9697A1);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.tileThickness);\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf + this.tileThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - (this.wallThickness / 2) - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.tileThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0xB5B9C9);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.tileThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.tileThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.tileThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nclass WallCorner extends WallBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(0, -this.wallHeight);\r\n\t\tthis.lineTo(this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight - this.wallThickness);\r\n\t\tthis.lineTo(-this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nclass WallRow extends WallBase\r\n{\r\n\r\n\tconstructor(doorMode)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tlet hole = doorMode ? this.doorHeight : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0xBABECE);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.tileThickness);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf + this.tileThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.tileThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x92939D);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.tileThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.tileThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.tileThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(-this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nclass TileBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.row = 0;\r\n\t\tthis.column = 0;\r\n\r\n\t\tthis.interactive = true;\r\n\t\tthis.thickness = 8;\r\n\r\n\t\tthis.on(\"click\", () => this.onClick());\r\n\t\tthis.on(\"pointerover\", () => this.onMouseOver());\r\n\t\tthis.on(\"pointerout\", () => this.onMouseOut());\r\n\t}\r\n\r\n\tonClick()\r\n\t{\r\n\t\tthis.emit(\"tile-click\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOver()\r\n\t{\r\n\t\tthis.emit(\"tile-hover\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOut()\r\n\t{\r\n\t\tthis.emit(\"tile-leave\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nclass TileCursor extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tthis.lineStyle(4, 0xFFFFFF);\r\n\t\tthis.moveTo(points[0].x, points[0].y - 1);\r\n\t\tthis.lineTo(points[1].x, points[1].y - 1);\r\n\t\tthis.lineTo(points[2].x, points[2].y - 1);\r\n\t\tthis.lineTo(points[3].x, points[3].y - 1);\r\n\t\tthis.lineTo(points[0].x, points[0].y - 1);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.filters = [\r\n\t\t\twithInstance(new PIXI.filters.DropShadowFilter(), shadow =>\r\n\t\t\t{\r\n\t\t\t\tshadow.color = 0x000000;\r\n\t\t\t\tshadow.alpha = 0.2;\r\n\t\t\t\tshadow.blur = 0;\r\n\t\t\t\tshadow.distance = 1;\r\n\t\t\t\tshadow.rotation = 90;\r\n\t\t\t})\r\n\t\t];\r\n\t}\r\n\r\n\thover(row, column, x, y, z, tile)\r\n\t{\r\n\t\tlet nx = x;\r\n\t\tlet ny = y;\r\n\r\n\t\tif (!(tile instanceof Tile))\r\n\t\t\tny += tileHeightHalf;\r\n\r\n\t\tthis.position.x = nx;\r\n\t\tthis.position.y = ny - 2;\r\n\r\n\t\tthis.z = z;\r\n\t}\r\n\r\n}\r\n\r\nclass StairsSouth extends TileBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n}\r\n\r\nclass StairsSouthEast extends TileBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst allPoints = [];\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * 8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + (tileWidth / 8) + ax, (tileHeight / 8) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point(ax, (tileHeight / 2) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tallPoints.push(...points);\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nclass StairsSouthWest extends TileBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * -8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point(tileWidth + ax, (tileHeight / 2) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - (tileWidth / 8) + ax, (tileHeight / 8) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nclass Tile extends TileBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tdrawTile(this, points, this.thickness);\r\n\t}\r\n\r\n}\r\n","const figures = [\r\n\t\"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\",\r\n\t\"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\",\r\n\t\"hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97\",\r\n\t\"hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106\",\r\n\t\"hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324\",\r\n\t\"hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110\",\r\n\t\"hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586\"\r\n];\r\n\r\nexport const randomFigure = () => figures[Math.floor(Math.random() * figures.length)];\r\n\r\nexport const walkTo = async (rv, avatar, cr, cc, row, column) =>\r\n{\r\n\tlet distance = Math.max(Math.abs(cr - row), Math.abs(cc - column));\r\n\tlet pos = rv.getEntityPosition(avatar, row, column);\r\n\r\n\tavatar.addAction(\"Move\");\r\n\r\n\tlet direction = 0;\r\n\r\n\tif (row < cr && column > cc)\r\n\t\tdirection = 1;\r\n\telse if (row === cr && column > cc)\r\n\t\tdirection = 2;\r\n\telse if (row > cr && column > cc)\r\n\t\tdirection = 3;\r\n\telse if (row > cr && column === cc)\r\n\t\tdirection = 4;\r\n\telse if (row > cr && column < cc)\r\n\t\tdirection = 5;\r\n\telse if (row === cr && column < cc)\r\n\t\tdirection = 6;\r\n\telse if (row < cr && column < cc)\r\n\t\tdirection = 7;\r\n\r\n\tavatar.direction = avatar.headDirection = direction;\r\n\tavatar.z = Math.max(rv.getZ(row, column, 5), rv.getZ(cr, cc, 5));\r\n\r\n\tlet anim = anime({\r\n\t\ttargets: avatar,\r\n\t\tduration: 360 * distance,\r\n\t\tx: pos.x,\r\n\t\ty: pos.y,\r\n\t\teasing: \"linear\"\r\n\t});\r\n\r\n\t// anim.update = () => rv.centerEntity(avatar, false);\r\n\r\n\tawait anim.finished;\r\n\r\n\tcr = row;\r\n\tcc = column;\r\n\r\n\tavatar.z = pos.z;\r\n\tavatar.removeAction(\"Move\");\r\n\trv.centerEntity(avatar);\r\n\r\n\treturn {cr, cc, avatar};\r\n};\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { tileHeightHalf, tileWidthHalf } from \"../room/room-view.js\";\r\n\r\nconst furniResources = {\r\n\tloading: \"./resource/image/furni/loading.png\"\r\n};\r\n\r\nexport class Furni extends PIXI.Container\r\n{\r\n\r\n\tget loading()\r\n\t{\r\n\t\treturn this._loading;\r\n\t}\r\n\r\n\tset loading(value)\r\n\t{\r\n\t\tthis._loading = value;\r\n\t}\r\n\r\n\tconstructor(furniName)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.furniName = furniName;\r\n\r\n\t\tthis._loadingSprite = new PIXI.Sprite(application.getResource(furniResources.loading).texture);\r\n\t\tthis.addChild(this._loadingSprite);\r\n\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -(tileWidthHalf + 2),\r\n\t\t\ty: -(tileHeightHalf + 34)\r\n\t\t};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t}\r\n\r\n}\r\n\r\nexport class FurniManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(furniResources.loading);\r\n\t}\r\n\r\n}\r\n","import { Avatar, AvatarManager, initializeAvatarRenderer } from \"./view/avatar/avatar.js\";\r\nimport { Logger } from \"./core/logging.js\";\r\nimport { LoadingView } from \"./view/loading-view.js\";\r\nimport { Display } from \"./display.js\";\r\nimport { I18nManager } from \"./core/i18n/i18n.js\";\r\nimport { ConfigManager } from \"./core/config/config.js\";\r\nimport { initialLoadingDelay } from \"./preferences.js\";\r\nimport { InterfaceContainer, InterfaceManager } from \"./ui/interface/interface.js\";\r\nimport { RoomView } from \"./view/room/room-view.js\";\r\nimport { randomFigure, walkTo } from \"./core/dev-utils.js\";\r\nimport { Furni, FurniManager } from \"./view/furni/furni.js\";\r\n\r\nexport class InitializerLoader extends PIXI.loaders.Loader\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.urls = [];\r\n\t}\r\n\r\n\tadd(url, stage = 1)\r\n\t{\r\n\t\tthis.urls.push({\r\n\t\t\tstage,\r\n\t\t\turl\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tload()\r\n\t{\r\n\t\tLogger.debug(\"InitializerLoader\", \"Skipped load() initializing..\");\r\n\t}\r\n\r\n\trealLoad(cb, stage = 1)\r\n\t{\r\n\t\tthis.urls\r\n\t\t\t.filter(url => url.stage === stage)\r\n\t\t\t.map(url => url.url)\r\n\t\t\t.forEach(url => super.add(url));\r\n\r\n\t\tsuper.load(cb);\r\n\t}\r\n\r\n}\r\n\r\nexport class Application extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn this._display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn this._loader;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.display.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.display.ticker;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._display = new Display();\r\n\t\tthis._loader = new InitializerLoader();\r\n\r\n\t\tthis.managers = [];\r\n\t}\r\n\r\n\taddDefaultManagers()\r\n\t{\r\n\t\tthis.addManager(new ConfigManager());\r\n\t\tthis.addManager(new I18nManager());\r\n\r\n\t\tthis.addManager(new AvatarManager());\r\n\t\tthis.addManager(new FurniManager());\r\n\r\n\t\tthis.addManager(new InterfaceManager());\r\n\t}\r\n\r\n\taddManager(manager)\r\n\t{\r\n\t\tLogger.debug(\"Application\", `Added manager ${manager.constructor.name}`);\r\n\t\tthis.managers.push(manager);\r\n\t}\r\n\r\n\tgetManager(managerClass)\r\n\t{\r\n\t\treturn this.managers.find(manager => manager instanceof managerClass);\r\n\t}\r\n\r\n\tcreate()\r\n\t{\r\n\t\tthis.loadingView = new LoadingView();\r\n\t\tthis.loadingView.on(\"loader-ready\", () => this.emit(\"application-can-run\"));\r\n\t\tthis.stage.addChild(this.loadingView);\r\n\r\n\t\tthis.addDefaultManagers();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait this.managers.forEach(async manager => await manager.initialize());\r\n\t}\r\n\r\n\tasync run()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 0;\r\n\t\tsetTimeout(() => this.loader.realLoad(() => this.onLoadingStage0Done(), 0), initialLoadingDelay);\r\n\t}\r\n\r\n\tonLoadingStage0Done()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 1;\r\n\t\tthis.loadingView.percentage = 0;\r\n\t\tthis.loader.realLoad(() => this.onLoadingStage1Done(), 1);\r\n\t}\r\n\r\n\tonLoadingStage1Done()\r\n\t{\r\n\t\tLogger.debug(\"Application\", \"Loading of manager data done!\");\r\n\t\tthis.emit(\"application-loading-done\");\r\n\r\n\t\tdelete this.loader;\r\n\r\n\t\tthis.stage.removeChild(this.loadingView);\r\n\r\n\t\tinitializeAvatarRenderer();\r\n\r\n\t\tlet avatars = [undefined, undefined];\r\n\t\tlet furnis = [undefined];\r\n\t\tlet roomViewer = new RoomView();\r\n\r\n\t\tthis.stage.addChild(roomViewer);\r\n\t\tthis.stage.addChild(new InterfaceContainer());\r\n\r\n\t\troomViewer.addChild(avatars[0] = new Avatar(randomFigure(), \"vertical\", \"full\"));\r\n\t\troomViewer.addChild(avatars[1] = new Avatar(randomFigure(), \"vertical\", \"full\"));\r\n\r\n\t\troomViewer.addChild(furnis[0] = new Furni(\"throne\"));\r\n\r\n\t\troomViewer.associateEntityToTile(avatars[0], 15, 0);\r\n\t\troomViewer.associateEntityToTile(avatars[1], 9, 20);\r\n\r\n\t\troomViewer.associateEntityToTile(furnis[0], 9, 21);\r\n\r\n\t\tlet current = {cr: 15, cc: 0, avatar: avatars[0]};\r\n\r\n\t\t// avatars[0].addAction(\"Blow\");\r\n\t\tavatars[0].on(\"click\", () => avatars[0].figure = randomFigure());\r\n\t\tavatars[0].on(\"click\", () => roomViewer.centerEntity(avatars[0]));\r\n\r\n\t\tavatars[1].addAction(\"Wave\");\r\n\t\tavatars[1].on(\"click\", () => avatars[1].figure = randomFigure());\r\n\t\tavatars[1].on(\"click\", () => roomViewer.centerEntity(avatars[1]));\r\n\r\n\t\troomViewer.centerEntity(avatars[0]);\r\n\r\n\t\troomViewer.on(\"tile-click\", evt => avatars[0].once(\"avatar-build\", async () => current = await walkTo(roomViewer, current.avatar, current.cr, current.cc, evt.row, evt.column)));\r\n\t}\r\n\r\n\tgetResource(resource, loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources[resource];\r\n\t}\r\n\r\n\tgetResources(loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources;\r\n\t}\r\n\r\n}\r\n","import { Logger } from \"./core/logging.js\";\r\nimport { Application } from \"./application.js\";\r\n\r\n/**\r\n * @type {Application}\r\n */\r\nexport const application = new Application();\r\n\r\n/**\r\n * Class Bootstrapper.\r\n */\r\nexport class Bootstrapper\r\n{\r\n\r\n\t/**\r\n\t * Initializes everything.\r\n\t */\r\n\tstatic async init()\r\n\t{\r\n\t\tLogger.debug(\"Bootstrapper\", \"Loading everything..\");\r\n\r\n\t\tPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n\r\n\t\tapplication.create();\r\n\r\n\t\tapplication.on(\"application-can-run\", () => application.run());\r\n\r\n\t\tawait application.initialize();\r\n\t}\r\n\r\n}\r\n","'use strict';\n\nexports.__esModule = true;\nexports.loader = exports.prepare = exports.particles = exports.mesh = exports.loaders = exports.interaction = exports.filters = exports.extras = exports.extract = exports.accessibility = undefined;\n\nvar _polyfill = require('./polyfill');\n\nObject.keys(_polyfill).forEach(function (key) {\n    if (key === \"default\" || key === \"__esModule\") return;\n    Object.defineProperty(exports, key, {\n        enumerable: true,\n        get: function get() {\n            return _polyfill[key];\n        }\n    });\n});\n\nvar _core = require('./core');\n\nObject.keys(_core).forEach(function (key) {\n    if (key === \"default\" || key === \"__esModule\") return;\n    Object.defineProperty(exports, key, {\n        enumerable: true,\n        get: function get() {\n            return _core[key];\n        }\n    });\n});\n\nvar _deprecation = require('./deprecation');\n\nvar _deprecation2 = _interopRequireDefault(_deprecation);\n\nvar _accessibility = require('./accessibility');\n\nvar accessibility = _interopRequireWildcard(_accessibility);\n\nvar _extract = require('./extract');\n\nvar extract = _interopRequireWildcard(_extract);\n\nvar _extras = require('./extras');\n\nvar extras = _interopRequireWildcard(_extras);\n\nvar _filters = require('./filters');\n\nvar filters = _interopRequireWildcard(_filters);\n\nvar _interaction = require('./interaction');\n\nvar interaction = _interopRequireWildcard(_interaction);\n\nvar _loaders = require('./loaders');\n\nvar loaders = _interopRequireWildcard(_loaders);\n\nvar _mesh = require('./mesh');\n\nvar mesh = _interopRequireWildcard(_mesh);\n\nvar _particles = require('./particles');\n\nvar particles = _interopRequireWildcard(_particles);\n\nvar _prepare = require('./prepare');\n\nvar prepare = _interopRequireWildcard(_prepare);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// export core\n_core.utils.mixins.performMixins();\n\n/**\n * Alias for {@link PIXI.loaders.shared}.\n * @name loader\n * @memberof PIXI\n * @type {PIXI.loader.Loader}\n */\n\n\n// handle mixins now, after all code has been added, including deprecation\n\n\n// export libs\n// import polyfills. Done as an export to make sure polyfills are imported first\nvar loader = loaders.shared || null;\n\nexports.accessibility = accessibility;\nexports.extract = extract;\nexports.extras = extras;\nexports.filters = filters;\nexports.interaction = interaction;\nexports.loaders = loaders;\nexports.mesh = mesh;\nexports.particles = particles;\nexports.prepare = prepare;\nexports.loader = loader;\n\n// Apply the deprecations\n\nif (typeof _deprecation2.default === 'function') {\n    (0, _deprecation2.default)(exports);\n}\n\n// Always export PixiJS globally.\nglobal.PIXI = exports; // eslint-disable-line\n//# sourceMappingURL=index.js.map","import { Bootstrapper } from \"./bootstrapper.js\";\r\n\r\nimport \"../node_modules/pixi.js/lib/index.js\";\r\n\r\nArray.prototype.pushChain = function (...entries)\r\n{\r\n\tthis.push(...entries);\r\n\r\n\treturn this;\r\n};\r\n\r\nArray.prototype.unique = function ()\r\n{\r\n\treturn this.filter((value, index, self) => self.indexOf(value) === index);\r\n};\r\n\r\nObject.prototype.forEach = function (callback)\r\n{\r\n\tfor (let key in this)\r\n\t\tif (this.hasOwnProperty(key))\r\n\t\t\tcallback(this[key], key);\r\n};\r\n\r\nPIXI.Container.prototype.updateLayerOrder = function ()\r\n{\r\n\tthis.children.sort(function (a, b)\r\n\t{\r\n\t\ta.z = a.z || 0;\r\n\t\tb.z = b.z || 0;\r\n\r\n\t\treturn a.z - b.z\r\n\t});\r\n};\r\n\r\nBootstrapper.init().then(() =>\r\n{\r\n});\r\n"],"names":["Logger","[object Object]","data","querySelectorAllArray","selector","container","document","slice","call","querySelectorAll","Manager","e","application","display","x","loader","name","this","_name","h","stage","constructor","debug","simpleDraggableTarget","setInteractive","target","interactive","withInstance","instance","callback","ROOT","LIBS","LOADED_CONFIGS","LOADED_LIBS","LOADED_TEXTURES","LOADING_LIBS","avatarResources","c","l","u","d","p","f","g","w","I","v","y","m","b","P","X","k","$","actionsSorted","defaultAction","loadingAvatar","radiusComparator","a","getAttribute","getValidActionsForPart","partType","actions","push","isLibraryLoaded","library","undefined","loadAvatarClothingConfig","config","Promise","resolve","configUrl","getAvatarClothingConfigUrl","isInitializerLoader","InitializerLoader","add","on","getResource","load","loadAvatarClothingLibrary","libraryUrl","getAvatarClothingLibraryUrl","getAction","id","action","getActions","querySelector","definition","attributes","forEach","attribute","value","getAnimations","getDraworder","getFigureData","getGeometry","getPartSets","getSprite","asset","center","B","H","sprite","PIXI","Sprite","Texture","fromImage","getTexture","offset","getFlippedSetType","setType","flippedSetType","getRemoveSetType","removeSetType","getActivePartSets","result","activePart","getAnimationFrames","type","frames","def","repeats","hasAttribute","parseInt","i","J","K","getAnimationFramesCount","length","offsets","Math","max","getAnimationOffset","geometryId","frame","direction","isNaN","bodypart","FigureString","Q","_parts","figure","parse","hasPartType","split","map","part","sort","localeCompare","st","et","filter","n","str","parts","color","join","Avatar","Container","j","_actions","ht","_avatarSet","at","_direction","ct","_figure","poof","D","_geometry","dt","_headDirection","geometry","avatarSet","super","canPoof","lastUpdate","loaders","Loader","partContainer","addChild","_alsoUpdate","_initial","_ticker","_width","_height","_frames","headDirection","buildSync","pushChain","indexOf","found","hasAction","dir","emit","ticker","lastTime","invalidate","decideGeometry","gatherParts","libraries","getLibraries","_loading","update","build","then","activePartSets","unique","bodyparts","settype","lib","parentNode","toLowerCase","set","getElementsByTagName","colorable","hiddenlayers","paletteid","setHiddenlayers","layer","ti","ii","si","ei","xi","ni","_sprites","clouds","ri","extras","AnimatedSprite","texture","cx","cy","fn","cloud","anchor","animationSpeed","loop","hitArea","position","play","setTimeout","removeChild","shift","cmf","filters","AlphaFilter","alpha","draworderId","hasActivePartSet","draworder","children","updateAction","render","avatarParts","getBodyparts","partset","items","item","partDirection","partDirectionWithoutFlip","partTypeWithoutFlip","partSwapped","partValidActions","partFrames","partFlipped","partFrame","Object","values","partAction","assetpartdefinition","number","animationOffset","generateAssetName","opf","opa","scale","width","floor","colors","colorindex","fdColor","tint","textContent","index","destroy","AvatarManager","initialize","image","evaluateString","string","context","replace","RegExp","matches","contents","findKey","key","object","defaultValue","keyParts","current","keyPart","configJson","ConfigManager","onConfigLoaded","assign","textsJson","I18nManager","texts","onTextsLoaded","text","getManager","resourceLogo","LoadingBar","Graphics","barColor","barHeight","barThickness","barWidth","percentage","delta","onTick","clear","beginFill","drawRect","round","endFill","lineStyle","moveTo","lineTo","LoadingView","Di","loadingBar","logo","init","loadResources","style","TextStyle","Vi","ts","ss","fill","es","xs","Text","onResourcesLoaded","state","progress","height","getString","stageElement","Display","utils","EventEmitter","ls","us","app","renderer","Rt","ps","view","as","dpi","Xi","mount","Error","innerHTML","initApp","initEvents","Application","window","innerHeight","innerWidth","Ps","Xs","ks","$s","appendChild","addEventListener","onWindowResize","resize","initialLoadingDelay","toolbarHeight","Toolbar","draw","memenuSize","memenuSizeHalf","MeMenu","Ts","_avatar","Os","_chatBubble","_avatarHolder","buttonMode","onAvatarHover","onAvatarLeave","avatar","ChatBubble","chatBubble","onChatBubbleHover","onChatBubbleLeave","addAction","drawCircle","removeAction","imLeft","interfaceResources","left","imMiddle","TilingSprite","middle","imRight","right","Ns","Us","Zs","InterfaceContainer","Js","_memenu","Qs","_toolbar","memenu","toolbar","InterfaceManager","hitAreaOffset","tileHeight","tileHeightHalf","tileWidth","tileWidthHalf","heightMaps","Heading","te","ie","se","ee","drawTile","points","thickness","getDoorDirection","tiles","row","column","isDoor","NorthEast","NorthWest","SouthEast","SouthWest","getSurroundings","findIndex","t","getTile","needsWallC","needsWallR","RoomView","xe","_entities","he","_heightmap","ae","oe","_tiles","columns","rows","pos","evt","getLocalPosition","parent","simpleDraggable","prepareHeightmap","roomScale","tileCursor","TileCursor","floorplan","trim","char","getTileHeight","tileNorthEast","tileNorthWest","tileSouthEast","tileSouthWest","implementation","Tile","wallC","wallR","wall","abs","StairsSouth","StairsSouthEast","StairsSouthWest","getX","getY","z","getZ","wallImplementations","isDoorColumn","isDoorRow","WallCorner","WallColumn","WallRow","wi","entities","tile","onTileClick","onTileHover","onTileLeave","xred","reduce","acc","cur","yred","TileBase","entity","Rectangle","getEntityPosition","animate","anime","Te","Ae","Oe","getRoomOffsets","be","heightmap","updateLayerOrder","hover","WallBase","doorHeight","tileThickness","wallHeight","wallThickness","doorMode","hole","onClick","onMouseOver","onMouseOut","Pe","Xe","Ee","Point","DropShadowFilter","shadow","blur","distance","rotation","nx","ny","allPoints","step","ax","ay","figures","randomFigure","random","walkTo","async","rv","cr","cc","anim","finished","centerEntity","Ve","tx","furniResources","ix","Furni","furniName","_loadingSprite","loading","FurniManager","urls","url","cb","_display","_loader","managers","addManager","manager","managerClass","find","loadingView","addDefaultManagers","realLoad","onLoadingStage0Done","onLoadingStage1Done","avatars","furnis","roomViewer","associateEntityToTile","once","resource","resources","exports","__esModule","prepare","particles","mesh","interaction","extract","accessibility","_polyfill","require","keys","defineProperty","$x","get","_core","obj","_deprecation","_deprecation2","Mx","_interopRequireWildcard","newObj","prototype","hasOwnProperty","default","mixins","performMixins","shared","global","Array","entries","self","settings","SCALE_MODE","SCALE_MODES","NEAREST","create","run"],"mappings":"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"}