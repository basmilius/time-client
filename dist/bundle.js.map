{"version":3,"file":"bundle.js.map","sources":["../src/core/dom-utils.js","../src/core/pixi-utils.js","../src/preferences.js","../src/view/avatar/shared.js","../src/core/json-utils.js","../src/view/room/tiles.js","../src/view/room/shared.js","../src/view/loading-view.js","../src/view/avatar/avatar.js","../src/core/logging.js","../src/view/avatar/figure.js","../src/core/manager/manager.js","../src/view/avatar/manager.js","../src/core/config/config.js","../src/core/i18n/i18n.js","../src/display.js","../src/ui/interface/bottombar.js","../src/ui/interface/bottomBar.js","../src/ui/window.js","../src/ui/ui.js","../src/ui/interface/interface.js","../src/ui/interface/manager.js","../src/view/furni/furni.js","../src/view/room/cursor.js","../src/view/room/walls.js","../src/view/room/scenery.js","../src/view/room/room-view.js","../src/view/room/manager.js","../src/dev/avatars.js","../src/dev/rooms.js","../src/ui/navigator/window.js","../src/view/hotel-view.js","../src/dev/gameplay.js","../src/application.js","../src/bootstrapper.js","../src/main.js"],"sourcesContent":["/**\r\n * Applies styles to an element.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Object} styles\r\n */\r\nexport function applyStyles(element, styles)\r\n{\r\n\tstyles.forEach((value, key) => element.style.setProperty(key, value));\r\n}\r\n\r\n/**\r\n * Creates an element.\r\n *\r\n * @param {String} tagName\r\n * @param {Function} callback\r\n *\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tagName, callback = null)\r\n{\r\n\tconst element = document.createElement(tagName);\r\n\r\n\tif (callback !== null)\r\n\t\tcallback(element);\r\n\r\n\treturn element;\r\n}\r\n\r\n/**\r\n * Removes contents.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nexport function removeHtml(element)\r\n{\r\n\telement.innerHTML = \"\";\r\n}\r\n\r\n/**\r\n * Query Selector All to Array.\r\n *\r\n * @param selector\r\n * @param container\r\n *\r\n * @returns {Array<Element>}\r\n */\r\nexport function querySelectorAllArray(selector, container = document)\r\n{\r\n\treturn [].slice.call(container.querySelectorAll(selector));\r\n}\r\n","export function getTextureFromRectangle(base, x, y, width, height)\r\n{\r\n\tconst texture = new PIXI.Texture(base);\r\n\ttexture.frame = new PIXI.Rectangle(x, y, width, height);\r\n\r\n\treturn texture;\r\n}\r\n\r\nexport function setInteractive(target)\r\n{\r\n\ttarget.interactive = true;\r\n}\r\n\r\nexport function advancedDraggable(target, el, fn)\r\n{\r\n\tsetInteractive(el);\r\n\r\n\tlet simpleDraggableTarget = null;\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\tel.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\r\n\t\tif (typeof target.getDraggableRegion === \"undefined\")\r\n\t\t\treturn;\r\n\r\n\t\tconst {x, y, width, height} = target.getDraggableRegion();\r\n\r\n\t\tif (pos.x < x || pos.x > width || pos.y < y || pos.y > height)\r\n\t\t{\r\n\t\t\tdata = null;\r\n\t\t\tpos = null;\r\n\t\t\tsimpleDraggableTarget = null;\r\n\t\t}\r\n\t});\r\n\r\n\tel.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\tel.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tlet newX = p.x - pos.x;\r\n\t\tlet newY = p.y - pos.y;\r\n\r\n\t\tif (typeof target.getDraggingRegion !== \"undefined\")\r\n\t\t{\r\n\t\t\tconst {x, y, width, height} = target.getDraggingRegion();\r\n\t\t\tconst bounds = typeof target.getDraggableRegion !== \"undefined\" ? target.getDraggableRegion() : target;\r\n\r\n\t\t\tif (newX < x)\r\n\t\t\t\tnewX = x;\r\n\r\n\t\t\tif ((newX + bounds.width) > width)\r\n\t\t\t\tnewX = (width - bounds.width);\r\n\r\n\t\t\tif (newY < y)\r\n\t\t\t\tnewY = y;\r\n\r\n\t\t\tif ((newY + bounds.height) > height)\r\n\t\t\t\tnewY = (height - bounds.height);\r\n\t\t}\r\n\r\n\t\tfn(newX, newY);\r\n\t});\r\n}\r\n\r\nexport function simpleDraggable(target)\r\n{\r\n\tsetInteractive(target);\r\n\r\n\tlet simpleDraggableTarget = null;\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\ttarget.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\r\n\t\tif (typeof target.getDraggableRegion === \"undefined\")\r\n\t\t\treturn;\r\n\r\n\t\tconst {x, y, width, height} = target.getDraggableRegion();\r\n\r\n\t\tif (pos.x < x || pos.x > width || pos.y < y || pos.y > height)\r\n\t\t{\r\n\t\t\tdata = null;\r\n\t\t\tpos = null;\r\n\t\t\tsimpleDraggableTarget = null;\r\n\t\t}\r\n\t});\r\n\r\n\ttarget.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\ttarget.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tlet newX = p.x - pos.x;\r\n\t\tlet newY = p.y - pos.y;\r\n\r\n\t\tif (typeof target.getDraggingRegion !== \"undefined\")\r\n\t\t{\r\n\t\t\tconst {x, y, width, height} = target.getDraggingRegion();\r\n\t\t\tconst bounds = typeof target.getDraggableRegion !== \"undefined\" ? target.getDraggableRegion() : target;\r\n\r\n\t\t\tif (newX < x)\r\n\t\t\t\tnewX = x;\r\n\r\n\t\t\tif ((newX + bounds.width) > width)\r\n\t\t\t\tnewX = (width - bounds.width);\r\n\r\n\t\t\tif (newY < y)\r\n\t\t\t\tnewY = y;\r\n\r\n\t\t\tif ((newY + bounds.height) > height)\r\n\t\t\t\tnewY = (height - bounds.height);\r\n\t\t}\r\n\r\n\t\tsimpleDraggableTarget.position.x = newX;\r\n\t\tsimpleDraggableTarget.position.y = newY;\r\n\t});\r\n}\r\n\r\nexport function withInstance(instance, callback)\r\n{\r\n\tcallback(instance);\r\n\r\n\treturn instance;\r\n}\r\n","export const deliveryRoot = \"https://cdn.mili.us/time\";\r\nexport const initialLoadingDelay = 0;\r\n\r\nexport function getDeliveryUrl(path)\r\n{\r\n\treturn deliveryRoot + path;\r\n}\r\n\r\nexport function getDeliveryAssetsUrl(path)\r\n{\r\n\treturn getDeliveryUrl(\"/assets\" + path);\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { Logger } from \"../../core/logging.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { InitializerLoader } from \"../../application.js\";\r\n\r\nexport const LOADED_CONFIGS = {};\r\nexport const LOADED_LIBS = {};\r\nexport const LOADED_TEXTURES = {};\r\nexport const LOADING_LIBS = {};\r\n\r\nexport let actionsSorted = null;\r\nexport let defaultAction = null;\r\nexport let loadingAvatar = null;\r\nexport let radiusComparator = (a, b) => b.getAttribute(\"z\") - a.getAttribute(\"z\");\r\n\r\nexport function initializeAvatarRenderer()\r\n{\r\n\tif (actionsSorted === null)\r\n\t\tactionsSorted = querySelectorAllArray(\"action\", getActions()).map(action => action.getAttribute(\"id\"));\r\n\r\n\tif (defaultAction === null)\r\n\t\tdefaultAction = getAction(\"Default\");\r\n\r\n\tif (loadingAvatar === null)\r\n\t\tloadingAvatar = new Avatar(\"hd-195-1\");\r\n}\r\n\r\nexport function getAvatarClothingConfigUrl(config)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/${config}.xml`);\r\n}\r\n\r\nexport function getAvatarClothingLibraryUrl(library)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/sprite/${library}.json`);\r\n}\r\n\r\nexport function getValidActionsForPart(partType)\r\n{\r\n\tconst actions = [\"std\"];\r\n\r\n\tswitch (partType)\r\n\t{\r\n\t\tcase \"bd\":\r\n\t\t\tactions.push(\"sit\", \"lay\", \"wlk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hd\":\r\n\t\t\tactions.push(\"lsp\", \"lay\", \"spk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fa\":\r\n\t\t\tactions.push(\"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ea\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ey\":\r\n\t\t\tactions.push(\"agr\", \"sad\", \"sml\", \"srp\", \"lag\", \"lsp\", \"lay\", \"eyb\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fc\":\r\n\t\t\tactions.push(\"agr\", \"blw\", \"sad\", \"spk\", \"srp\", \"sml\", \"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hr\":\r\n\t\tcase \"hrb\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"he\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ha\":\r\n\t\t\tactions.push(\"spk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ch\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"cc\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ca\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lg\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lh\":\r\n\t\t\tactions.push(\"respect\", \"sig\", \"wav\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ls\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lc\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rh\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\", \"blw\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rs\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rc\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ri\":\r\n\t\t\tactions.push(\"crr\", \"drk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"li\":\r\n\t\t\tactions.push(\"sig\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"sh\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn actions;\r\n}\r\n\r\nexport function isLibraryLoaded(library)\r\n{\r\n\treturn LOADED_LIBS[library] !== undefined;\r\n}\r\n\r\nexport function loadAvatarClothingConfig(config, loader)\r\n{\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tconst configUrl = getAvatarClothingConfigUrl(config);\r\n\r\n\t\tloader\r\n\t\t\t.add(configUrl)\r\n\t\t\t.on(\"complete\", () => application.getResource(configUrl) !== undefined ? LOADED_CONFIGS[config] = application.getResource(configUrl).data : undefined);\r\n\r\n\t\tresolve();\r\n\t});\r\n}\r\n\r\nexport function loadAvatarClothingLibrary(library, loader)\r\n{\r\n\tif (LOADING_LIBS[library] !== undefined)\r\n\t\treturn LOADING_LIBS[library];\r\n\r\n\tif (isLibraryLoaded(library))\r\n\t\treturn Promise.resolve(LOADED_LIBS[library]);\r\n\r\n\treturn LOADING_LIBS[library] = new Promise(resolve =>\r\n\t{\r\n\t\tconst libraryUrl = getAvatarClothingLibraryUrl(library);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.use((asset, next) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tif (asset.name !== libraryUrl)\r\n\t\t\t\t\t\treturn next();\r\n\r\n\t\t\t\t\tLOADED_LIBS[library] = asset.data;\r\n\r\n\t\t\t\t\tgetTexture(library, true)\r\n\t\t\t\t\t\t.then(() => next());\r\n\t\t\t\t});\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing library: ${library}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADED_LIBS[library] = application.getResource(libraryUrl, loader).data;\r\n\t\t\t\t\tLOADING_LIBS[library] = undefined;\r\n\r\n\t\t\t\t\tgetTexture(library, true)\r\n\t\t\t\t\t\t.then(() => resolve(LOADED_LIBS[library]));\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function getAction(id)\r\n{\r\n\tconst action = getActions().querySelector(`action[id=\"${id}\"]`);\r\n\tconst definition = {};\r\n\r\n\tif (action === null)\r\n\t\treturn undefined;\r\n\r\n\taction.attributes.forEach(attribute => definition[attribute.name] = attribute.value);\r\n\r\n\treturn definition;\r\n}\r\n\r\nexport function getActions()\r\n{\r\n\treturn LOADED_CONFIGS[\"actions\"];\r\n}\r\n\r\nexport function getAnimations()\r\n{\r\n\treturn LOADED_CONFIGS[\"animations\"];\r\n}\r\n\r\nexport function getDraworder()\r\n{\r\n\treturn LOADED_CONFIGS[\"draworder\"];\r\n}\r\n\r\nexport function getFigureData()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuredata\"];\r\n}\r\n\r\nexport function getFigureMap()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuremap\"];\r\n}\r\n\r\nexport function getGeometry()\r\n{\r\n\treturn LOADED_CONFIGS[\"geometry\"];\r\n}\r\n\r\nexport function getPartSets()\r\n{\r\n\treturn LOADED_CONFIGS[\"partsets\"];\r\n}\r\n\r\nexport function getSprite(library, asset, center = {x: 0, y: 0})\r\n{\r\n\tif (LOADED_LIBS[library] === undefined)\r\n\t\treturn null;\r\n\r\n\ttry\r\n\t{\r\n\t\tconst data = LOADED_LIBS[library][\"assets\"][asset];\r\n\r\n\t\tif (data === undefined)\r\n\t\t\treturn null;\r\n\r\n\t\tconst texture = new PIXI.Texture(getTexture(library));\r\n\t\ttexture.frame = new PIXI.Rectangle(data[0], data[1], data[2], data[3]);\r\n\r\n\t\tconst sprite = new PIXI.Sprite(texture);\r\n\r\n\t\tsprite.x = center.x - (data[4] + center.x - 12);\r\n\t\tsprite.y = center.y - (data[5] - (center.y / 2) - 6);\r\n\r\n\t\treturn sprite;\r\n\t}\r\n\tcatch (err)\r\n\t{\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nexport function getTexture(library, promise = false)\r\n{\r\n\tif (LOADED_LIBS[library] === undefined)\r\n\t\treturn null;\r\n\r\n\tif (LOADED_TEXTURES[library] !== undefined)\r\n\t\treturn promise ? Promise.resolve(LOADED_TEXTURES[library]) : LOADED_TEXTURES[library];\r\n\r\n\tif (!promise)\r\n\t{\r\n\t\tconst texture = LOADED_TEXTURES[library] = PIXI.Texture.from(\"data:image/png;base64,\" + LOADED_LIBS[library].resource);\r\n\t\tLOADED_LIBS[library].resource = undefined;\r\n\t\treturn texture;\r\n\t}\r\n\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tLOADED_TEXTURES[library] = PIXI.Texture.from(\"data:image/png;base64,\" + LOADED_LIBS[library].resource);\r\n\t\tLOADED_LIBS[library].resource = undefined;\r\n\t\tresolve(LOADED_TEXTURES[library]);\r\n\t});\r\n}\r\n\r\nexport function getFlippedSetType(setType)\r\n{\r\n\tlet flippedSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"flipped-set-type\");\r\n\r\n\tif (flippedSetType !== null && flippedSetType !== \"\")\r\n\t\treturn flippedSetType;\r\n\r\n\treturn setType;\r\n}\r\n\r\nexport function getRemoveSetType(setType)\r\n{\r\n\tlet removeSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"remove-set-type\");\r\n\r\n\tif (removeSetType !== null && removeSetType !== \"\")\r\n\t\treturn removeSetType;\r\n\r\n\treturn null;\r\n}\r\n\r\nexport function getActivePartSets(id)\r\n{\r\n\tconst result = [];\r\n\tconst activeParts = getPartSets().querySelectorAll(`activePartSet[id=\"${id}\"] activePart`);\r\n\r\n\tactiveParts.forEach(activePart => result.push(activePart.getAttribute(\"set-type\")));\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function getAnimationFrames(id, type)\r\n{\r\n\tconst defs = getAnimations().querySelectorAll(`action[id=\"${id}\"] part[set-type=\"${type}\"] frame`);\r\n\tconst frames = [];\r\n\r\n\tdefs.forEach(def =>\r\n\t{\r\n\t\tconst repeats = def.hasAttribute(\"repeats\") ? parseInt(def.getAttribute(\"repeats\")) : 1;\r\n\r\n\t\tfor (let i = 0; i < repeats; i++)\r\n\t\t\tframes.push({number: parseInt(def.getAttribute(\"number\")), assetpartdefinition: def.getAttribute(\"assetpartdefinition\")});\r\n\t});\r\n\r\n\treturn frames;\r\n}\r\n\r\nexport function getAnimationFramesCount(id)\r\n{\r\n\tconst frames = getAnimations().querySelectorAll(`action[id=\"${id}\"] part:first-child frame`).length;\r\n\tconst offsets = getAnimations().querySelectorAll(`action[id=\"${id}\"] offsets frame`).length;\r\n\r\n\treturn Math.max(frames, offsets);\r\n}\r\n\r\nexport function getAnimationOffset(id, geometryId, frame, direction)\r\n{\r\n\tif (isNaN(frame) || isNaN(direction))\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\tconst bodypart = getAnimations().querySelector(`action[id=\"${id}\"] offsets frame[id=\"${frame}\"] directions direction[id=\"${direction}\"] bodypart[id=\"${geometryId}\"]`);\r\n\r\n\tif (bodypart === null)\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\treturn {\r\n\t\tx: parseInt(bodypart.getAttribute(\"dx\")),\r\n\t\ty: parseInt(bodypart.getAttribute(\"dy\"))\r\n\t};\r\n}\r\n","\r\nexport function evaluateString(string, context = {})\r\n{\r\n\tstring = string.replace(new RegExp(\"\\\\${(.*?)}\", \"g\"), (matches, contents) => findKey(contents, context));\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function findKey(key, object, defaultValue = undefined)\r\n{\r\n\tconst keyParts = key.split(\".\");\r\n\tlet current = object;\r\n\r\n\tfor (const keyPart of keyParts)\r\n\t{\r\n\t\tif (current[keyPart] === undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\tcurrent = current[keyPart];\r\n\t}\r\n\r\n\treturn current;\r\n}\r\n","import { tileHeight, tileWidth } from \"./shared.js\";\r\n\r\nfunction drawTile(g, points, thickness)\r\n{\r\n\tg.beginFill(0x989865);\r\n\t// g.lineStyle(.5, 0x838357);\r\n\tg.moveTo(points[0].x, points[0].y);\r\n\tg.lineTo(points[1].x, points[1].y);\r\n\tg.lineTo(points[2].x, points[2].y);\r\n\tg.lineTo(points[3].x, points[3].y);\r\n\tg.endFill();\r\n\r\n\tif (thickness > 0)\r\n\t{\r\n\t\tg.beginFill(0x838357);\r\n\t\tg.moveTo(points[1].x, points[1].y);\r\n\t\tg.lineTo(points[1].x, points[1].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\r\n\t\tg.beginFill(0x6F6F49);\r\n\t\tg.moveTo(points[3].x, points[3].y);\r\n\t\tg.lineTo(points[3].x, points[3].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\t}\r\n}\r\n\r\nexport class TileBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.row = 0;\r\n\t\tthis.column = 0;\r\n\r\n\t\tthis.cacheAsBitmap = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.thickness = thickness;\r\n\r\n\t\tthis.on(\"pointertap\", () => this.onClick());\r\n\t\tthis.on(\"pointerover\", () => this.onMouseOver());\r\n\t\tthis.on(\"pointerout\", () => this.onMouseOut());\r\n\t}\r\n\r\n\tonClick()\r\n\t{\r\n\t\tthis.emit(\"tile-tap\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOver()\r\n\t{\r\n\t\tthis.emit(\"tile-hover\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOut()\r\n\t{\r\n\t\tthis.emit(\"tile-leave\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouth extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthEast extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst allPoints = [];\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * 8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + (tileWidth / 8) + ax, (tileHeight / 8) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point(ax, (tileHeight / 2) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tallPoints.push(...points);\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthWest extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * -8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point(tileWidth + ax, (tileHeight / 2) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - (tileWidth / 8) + ax, (tileHeight / 8) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class Tile extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tdrawTile(this, points, this.thickness);\r\n\t}\r\n\r\n}\r\n","import { StairsSouth, StairsSouthEast, StairsSouthWest, Tile } from \"./tiles.js\";\r\n\r\nconst HeadingNorthEast = 0;\r\nconst HeadingNorthWest = 1;\r\nconst HeadingSouthEast = 2;\r\nconst HeadingSouthWest = 3;\r\n\r\nconst StairsTypeSouth = 3;\r\nconst StairsTypeSouthEast = 2;\r\nconst StairsTypeSouthWest = 4;\r\n\r\nexport const hitAreaOffset = 5000;\r\n\r\nexport const tileHeight = 32;\r\nexport const tileHeightHalf = tileHeight / 2;\r\nexport const tileWidth = 64;\r\nexport const tileWidthHalf = tileWidth / 2;\r\n\r\nexport function getDistance(a, b)\r\n{\r\n\treturn Math.max(Math.abs(a.row - b.row), Math.abs(a.column - b.column));\r\n}\r\n\r\nexport function getHeading(a, b)\r\n{\r\n\tif (a.row === b.row && a.column === b.column)\r\n\t\treturn undefined;\r\n\r\n\tif (b.row < a.row && b.column > a.column)\r\n\t\treturn 1;\r\n\telse if (b.row === a.row && b.column > a.column)\r\n\t\treturn 2;\r\n\telse if (b.row > a.row && b.column > a.column)\r\n\t\treturn 3;\r\n\telse if (b.row > a.row && b.column === a.column)\r\n\t\treturn 4;\r\n\telse if (b.row > a.row && b.column < a.column)\r\n\t\treturn 5;\r\n\telse if (b.row === a.row && b.column < a.column)\r\n\t\treturn 6;\r\n\telse if (b.row < a.row && b.column < a.column)\r\n\t\treturn 7;\r\n\telse\r\n\t\treturn 0;\r\n}\r\n\r\nexport function getDoorDirection(tiles, row, column)\r\n{\r\n\tif (!isDoor(tiles, row, column))\r\n\t\treturn null;\r\n\r\n\treturn [HeadingNorthEast, HeadingNorthWest, HeadingSouthEast, HeadingSouthWest][getSurroundings(tiles, row, column).findIndex(t => t !== null)];\r\n}\r\n\r\nexport function getStairsType(tiles, row, column)\r\n{\r\n\tlet tileHeight = getTile(tiles, row, column);\r\n\tlet [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest] = getSurroundings(tiles, row, column);\r\n\r\n\tif (tileNorthEast !== null && tileNorthWest !== null && Math.abs(tileHeight - tileNorthEast) === 1 && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsTypeSouth;\r\n\telse if (tileNorthWest !== null && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsTypeSouthEast;\r\n\telse if (tileNorthEast !== null && Math.abs(tileHeight - tileNorthEast) === 1)\r\n\t\treturn StairsTypeSouthWest;\r\n\r\n\t// TODO: Other stairs.\r\n\r\n\treturn -1;\r\n}\r\n\r\nexport function getSurroundings(tiles, row, column)\r\n{\r\n\tlet tileNorthEast = getTile(tiles, row - 1, column);\r\n\tlet tileNorthWest = getTile(tiles, row, column - 1);\r\n\tlet tileSouthEast = getTile(tiles, row, column + 1);\r\n\tlet tileSouthWest = getTile(tiles, row + 1, column);\r\n\r\n\treturn [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest];\r\n}\r\n\r\nexport function getTile(tiles, row, column)\r\n{\r\n\tif (typeof tiles[row] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\tif (typeof tiles[row][column] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\treturn tiles[row][column];\r\n}\r\n\r\nexport function getTileHeightIndex(char)\r\n{\r\n\tif (char === \"x\")\r\n\t\treturn null;\r\n\r\n\treturn [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"].indexOf(char);\r\n}\r\n\r\nexport function getTileImplementation(type = -1)\r\n{\r\n\tif (type === StairsTypeSouth)\r\n\t\treturn StairsSouth;\r\n\r\n\tif (type === StairsTypeSouthEast)\r\n\t\treturn StairsSouthEast;\r\n\r\n\tif (type === StairsTypeSouthWest)\r\n\t\treturn StairsSouthWest;\r\n\r\n\treturn Tile;\r\n}\r\n\r\nexport function isDoor(tiles, row, column)\r\n{\r\n\tif (getTile(tiles, row, column) === null)\r\n\t\treturn false;\r\n\r\n\treturn getSurroundings(tiles, row, column).filter(t => t !== null).length === 1;\r\n}\r\n\r\nexport function isValid(tiles, row, column)\r\n{\r\n\treturn tiles[row][column] !== null;\r\n}\r\n\r\nexport function needsWallColumn(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column) || !isValid(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cy = row;\r\n\r\n\twhile (cy > -1)\r\n\t\tif (getTile(tiles, --cy, column) !== null && !isDoor(tiles, cy, column))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row - 1, column + 1) !== null && !isDoor(tiles, row - 1, column + 1)));\r\n}\r\n\r\nexport function needsWallRow(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column) || !isValid(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cx = column;\r\n\r\n\twhile (cx > -1)\r\n\t\tif (getTile(tiles, row, --cx) !== null && !isDoor(tiles, row, cx))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row + 1, column - 1) !== null && !isDoor(tiles, row + 1, column - 1)));\r\n}\r\n\r\nexport function getHighestAndLowest(heightmap)\r\n{\r\n\tlet highest = 0, lowest = 36;\r\n\r\n\tfor (let row = 0; row < heightmap.length; row++)\r\n\t{\r\n\t\tfor (let column = 0; column < heightmap[row].length; column++)\r\n\t\t{\r\n\t\t\tlet h = heightmap[row][column];\r\n\r\n\t\t\tif (h > highest)\r\n\t\t\t\thighest = h;\r\n\r\n\t\t\tif (h < lowest)\r\n\t\t\t\tlowest = 0;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {highest, lowest};\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { I18nManager } from \"../core/i18n/i18n.js\";\r\n\r\nconst resourceLogo = \"/resource/image/logo.png\";\r\n\r\nclass LoadingBar extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this._percentage;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis._percentage = value;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.barHeight = 30;\r\n\t\tthis.barThickness = 2;\r\n\t\tthis.barWidth = 300;\r\n\t\tthis.percentage = 0;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x000000);\r\n\t\tthis.lineStyle(this.barThickness, 0x434343);\r\n\t\tthis.drawRoundedRect(0, 0, this.barWidth, this.barHeight, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x575757);\r\n\t\tthis.lineStyle(null);\r\n\t\tthis.drawRoundedRect(this.barThickness, this.barThickness, Math.round(this.percentage / 100 * (this.barWidth - this.barThickness * 2)), this.barHeight - this.barThickness * 2, 4);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class LoadingView extends PIXI.Container\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this.loadingBar.percentage || 0;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis.loadingBar.percentage = Math.round(value);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingBar = new LoadingBar();\r\n\r\n\t\tthis.logo = null;\r\n\r\n\t\tthis.init();\r\n\t\tthis.loadResources();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 300,\r\n\t\t\tfill: 0xFFFFFF,\r\n\t\t\twordWrap: true,\r\n\t\t\twordWrapWidth: this.loadingBar.barWidth\r\n\t\t});\r\n\r\n\t\tthis.text = new PIXI.Text(\"Initializing...\", style);\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.render());\r\n\t}\r\n\r\n\tloadResources()\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(resourceLogo)\r\n\t\t\t.load(() => this.onResourcesLoaded())\r\n\t}\r\n\r\n\tonResourcesLoaded()\r\n\t{\r\n\t\tthis.logo = new PIXI.Sprite(application.getResource(resourceLogo, this.loader).texture);\r\n\r\n\t\tthis.addChild(this.logo);\r\n\t\tthis.addChild(this.loadingBar);\r\n\t\tthis.addChild(this.text);\r\n\r\n\t\tapplication.loader.on(\"progress\", state => this.percentage = state.progress);\r\n\r\n\t\tthis.render();\r\n\t\tthis.emit(\"loader-ready\");\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst percentage = this.percentage;\r\n\r\n\t\tconst height = application.display.height;\r\n\t\tconst width = application.display.width;\r\n\r\n\t\tthis.loadingBar.position.x = (width / 2) - (this.loadingBar.barWidth / 2);\r\n\t\tthis.loadingBar.position.y = height - (this.loadingBar.barHeight + 60);\r\n\r\n\t\tif (this.logo !== null)\r\n\t\t{\r\n\t\t\tthis.logo.x = Math.round((width / 2) - (this.logo.width / 2));\r\n\t\t\tthis.logo.y = Math.round((height / 2) - (this.logo.height / 2));\r\n\t\t}\r\n\r\n\t\tthis.text.text = application.getManager(I18nManager).getString(\"loading-view.starting-up\", {percentage}, \"\");\r\n\r\n\t\tthis.text.position.set(\r\n\t\t\t(this.loadingBar.position.x + (this.loadingBar.barWidth / 2)) - (this.text.width / 2),\r\n\t\t\tthis.loadingBar.position.y - 30\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { setInteractive } from \"../../core/pixi-utils.js\";\r\nimport { FigureString } from \"./figure.js\";\r\nimport { actionsSorted, defaultAction, getAction, getActivePartSets, getAnimationFrames, getAnimationFramesCount, getAnimationOffset, getDraworder, getFigureData, getFigureMap, getFlippedSetType, getGeometry, getRemoveSetType, getSprite, getValidActionsForPart, isLibraryLoaded, loadAvatarClothingLibrary, loadingAvatar, radiusComparator } from \"./shared.js\";\r\nimport { AvatarManager, avatarResources } from \"./manager.js\";\r\n\r\nexport class Avatar extends PIXI.Container\r\n{\r\n\r\n\tget actions()\r\n\t{\r\n\t\treturn this._actions;\r\n\t}\r\n\r\n\tget avatarSet()\r\n\t{\r\n\t\treturn this._avatarSet;\r\n\t}\r\n\r\n\tset avatarSet(value)\r\n\t{\r\n\t\tthis._avatarSet = value;\r\n\t}\r\n\r\n\tget direction()\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction(value)\r\n\t{\r\n\t\tthis._direction = value;\r\n\t}\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this._figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tif (value === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._figure = new FigureString(value);\r\n\r\n\t\tif (!this.initialBuild)\r\n\t\t\tthis.build();\r\n\r\n\t\tthis.poof();\r\n\t}\r\n\r\n\tget geometry()\r\n\t{\r\n\t\treturn this._geometry;\r\n\t}\r\n\r\n\tset geometry(value)\r\n\t{\r\n\t\tthis._geometry = value;\r\n\t}\r\n\r\n\tget headDirection()\r\n\t{\r\n\t\treturn this._headDirection;\r\n\t}\r\n\r\n\tset headDirection(value)\r\n\t{\r\n\t\tthis._headDirection = value;\r\n\t}\r\n\r\n\tconstructor(figure = \"hd-195-4\", geometry = \"vertical\", avatarSet = \"full\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tsetInteractive(this);\r\n\r\n\t\tthis.initialBuild = true;\r\n\t\tthis.canPoof = false;\r\n\t\tthis.id = \"avatar-\" + window.performance.now();\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.needsUpdate = false;\r\n\t\tthis.partContainer = new PIXI.Container();\r\n\r\n\t\tthis.addChild(this.partContainer);\r\n\r\n\t\tthis._alsoUpdate = [];\r\n\t\tthis._ticker = false;\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\r\n\t\tthis._actions = [defaultAction];\r\n\t\tthis._frames = {};\r\n\r\n\t\tthis.avatarSet = avatarSet;\r\n\t\tthis.direction = 2;\r\n\t\tthis.figure = figure;\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.headDirection = this.direction;\r\n\r\n\t\tthis.build();\r\n\t\tthis.canPoof = true;\r\n\t\tthis.initialBuild = false;\r\n\t}\r\n\r\n\taddAction(action)\r\n\t{\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\treturn;\r\n\r\n\t\taction = getAction(action);\r\n\r\n\t\tif (action === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions\r\n\t\t\t.pushChain(action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\r\n\t\tthis._frames[action.id] = 0;\r\n\r\n\t\tif (action[\"preventheadturn\"] === \"true\")\r\n\t\t\tthis._headDirection = this.direction;\r\n\t}\r\n\r\n\thasAction(action)\r\n\t{\r\n\t\tlet found = false;\r\n\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\tfound = true;\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tremoveAction(action)\r\n\t{\r\n\t\tif (!this.hasAction(action))\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions = this._actions\r\n\t\t\t.filter(a => a.id !== action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\t}\r\n\r\n\tsetPosition(x, y, dir = 3)\r\n\t{\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\tthis.direction = dir;\r\n\t\tthis.headDirection = dir;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tbuild()\r\n\t{\r\n\t\tif (this.isBuilding)\r\n\t\t\treturn;\r\n\r\n\t\tthis.isBuilding = true;\r\n\t\tthis.needsUpdate = true;\r\n\r\n\t\tthis.emit(\"avatar-build\", this);\r\n\t\tthis.invalidate();\r\n\r\n\t\tconst libraries = this.getLibraries().filter(library => !isLibraryLoaded(library));\r\n\r\n\t\tif (libraries.length > 0)\r\n\t\t{\r\n\t\t\tthis._loading = true;\r\n\r\n\t\t\tconst download = () =>\r\n\t\t\t{\r\n\t\t\t\tif (libraries.length === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._loading = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloadAvatarClothingLibrary(libraries.shift(), this.loader).then(download);\r\n\t\t\t};\r\n\r\n\t\t\tdownload();\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\r\n\t\tthis.isBuilding = false;\r\n\t}\r\n\r\n\tdecideGeometry()\r\n\t{\r\n\t\tconst geometry = getGeometry().querySelector(`canvas[scale=\"h\"] geometry[id=\"${this.geometry}\"]`);\r\n\t\tthis._height = parseInt(geometry.getAttribute(\"height\"));\r\n\t\tthis._width = parseInt(geometry.getAttribute(\"width\"));\r\n\r\n\t\tif (this.geometry === \"head\")\r\n\t\t\tthis._height = this._width;\r\n\t}\r\n\r\n\tgetActivePartSets(action = null)\r\n\t{\r\n\t\tlet activePartSets = [];\r\n\r\n\t\tif (action === null)\r\n\t\t\tactivePartSets.push(...getActivePartSets(\"figure\"));\r\n\t\telse\r\n\t\t\tactivePartSets.push(...getActivePartSets(action[\"activepartset\"]));\r\n\r\n\t\treturn activePartSets.unique();\r\n\t}\r\n\r\n\thasActivePartSet(id)\r\n\t{\r\n\t\tfor (let action of this.actions)\r\n\t\t\tif (action !== null && action[\"activepartset\"] === id)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetBodyparts()\r\n\t{\r\n\t\tconst bodyparts = [];\r\n\r\n\t\tquerySelectorAllArray(`avatarset[id=\"${this.avatarSet}\"] bodypart`, getGeometry())\r\n\t\t\t.forEach(part => bodyparts.push(part.getAttribute(\"id\")));\r\n\r\n\t\treturn bodyparts;\r\n\t}\r\n\r\n\tgetLibraries()\r\n\t{\r\n\t\tconst libraries = [];\r\n\r\n\t\tthis._parts.forEach((settype, type) =>\r\n\t\t{\r\n\t\t\tsettype.parts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tlet lib = getFigureMap().querySelector(`part[id=\"${part.id}\"][type=\"${type}\"]`);\r\n\r\n\t\t\t\tif (lib === null || lib.parentNode === null)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tlib = lib.parentNode;\r\n\r\n\t\t\t\tlibraries.push(part[\"library\"] = lib.getAttribute(\"id\").toLowerCase());\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn libraries.unique();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\tlet x = -(this._width / 2);\r\n\t\tlet y = -104;\r\n\r\n\t\treturn {x, y};\r\n\t}\r\n\r\n\tgatherParts()\r\n\t{\r\n\t\tthis.figure.parts.forEach((data, type) =>\r\n\t\t{\r\n\t\t\tconst settype = getFigureData().querySelector(`sets > settype[type=\"${type}\"]`);\r\n\r\n\t\t\tif (settype === null)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst set = settype.querySelector(`set[id=\"${data.id}\"]`);\r\n\t\t\tconst parts = set.getElementsByTagName(\"part\");\r\n\r\n\t\t\tconst colorable = set.getAttribute(\"colorable\") === \"1\";\r\n\t\t\tconst hiddenlayers = [];\r\n\t\t\tconst paletteid = settype.getAttribute(\"paletteid\");\r\n\r\n\t\t\tconst setHiddenlayers = set.querySelectorAll(\"hiddenlayers layer\");\r\n\t\t\tif (setHiddenlayers !== null)\r\n\t\t\t\tsetHiddenlayers.forEach(layer => hiddenlayers.push(layer.getAttribute(\"parttype\")));\r\n\r\n\t\t\tparts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tconst partType = part.getAttribute(\"type\");\r\n\r\n\t\t\t\tif (this._parts[partType] === undefined)\r\n\t\t\t\t\tthis._parts[partType] = {hiddenlayers, parts: []};\r\n\r\n\t\t\t\tthis._parts[partType].parts.push({\r\n\t\t\t\t\tid: parseInt(part.getAttribute(\"id\")),\r\n\t\t\t\t\tcolorable: part.getAttribute(\"colorable\") === \"1\" && colorable,\r\n\t\t\t\t\tcolorindex: parseInt(part.getAttribute(\"colorindex\")),\r\n\t\t\t\t\tindex: parseInt(part.getAttribute(\"index\")),\r\n\t\t\t\t\tpaletteid,\r\n\t\t\t\t\tset: type,\r\n\t\t\t\t\ttype: partType\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tinvalidate()\r\n\t{\r\n\t\tthis._parts = {};\r\n\t\tthis._sprites = {};\r\n\r\n\t\tthis.decideGeometry();\r\n\t\tthis.gatherParts();\r\n\t}\r\n\r\n\tpoof()\r\n\t{\r\n\t\tif (!this.canPoof)\r\n\t\t\treturn;\r\n\r\n\t\tconst clouds = [\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: -36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: 36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: 16\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: -16\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\tlet cx = this._width / 2, cy = this._height / 2;\r\n\t\tlet fn = cloud =>\r\n\t\t{\r\n\t\t\tthis.addChild(cloud.sprite);\r\n\t\t\tcloud.sprite.anchor.set(0.5);\r\n\t\t\tcloud.sprite.animationSpeed = 0.2;\r\n\t\t\tcloud.sprite.loop = false;\r\n\t\t\tcloud.sprite.hitArea = null;\r\n\t\t\tcloud.sprite.position.x = cx + cloud.x;\r\n\t\t\tcloud.sprite.position.y = cy + cloud.y;\r\n\t\t\tcloud.sprite.play();\r\n\r\n\t\t\tsetTimeout(() => this.removeChild(cloud.sprite), 330);\r\n\r\n\t\t\tif (clouds[0] !== undefined)\r\n\t\t\t\tsetTimeout(() => fn(clouds.shift()), 45);\r\n\t\t};\r\n\r\n\t\tfn(clouds.shift());\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.partContainer.cacheAsBitmap = false;\r\n\t\tthis.alpha = this._loading ? 0.8 : 1.0;\r\n\r\n\t\tlet draworderId = \"std\";\r\n\r\n\t\tif (this.hasActivePartSet(\"handLeft\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"rh-up\" : \"lh-up\";\r\n\t\telse if (this.hasActivePartSet(\"handRightAndHead\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"lh-up\" : \"rh-up\";\r\n\r\n\t\tlet draworder = querySelectorAllArray(`action[id=\"${draworderId}\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\tif (draworder.length === 0)\r\n\t\t\tdraworder = querySelectorAllArray(`action[id=\"std\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\twhile (this.partContainer.children[0])\r\n\t\t\tthis.partContainer.removeChild(this.partContainer.children[0]);\r\n\r\n\t\tfor (let type of draworder)\r\n\t\t\tif (this._sprites[type] !== undefined)\r\n\t\t\t\tthis._sprites[type].forEach(part => this.partContainer.addChild(part));\r\n\r\n\t\tthis.partContainer.cacheAsBitmap = true;\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tif (!this.needsUpdate)\r\n\t\t\treturn;\r\n\r\n\t\tthis.actions.forEach(action => this.updateAction(action));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tupdateAction(action = null)\r\n\t{\r\n\t\tconst center = {\r\n\t\t\tx: this._width / 2,\r\n\t\t\ty: this._height / 2\r\n\t\t};\r\n\r\n\t\tif (action === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst activePartSets = this.getActivePartSets(action);\r\n\t\tconst frame = ++this._frames[action.id] || 0;\r\n\r\n\t\tconst hiddenlayers = [];\r\n\t\tconst avatarParts = this._loading ? (loadingAvatar !== null ? loadingAvatar._parts : {}) : this._parts;\r\n\r\n\t\tif (avatarParts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tavatarParts.forEach(data => hiddenlayers.push(...data.hiddenlayers));\r\n\r\n\t\tlet bodyparts = [];\r\n\t\tthis.getBodyparts().forEach(bodypart => bodyparts.push(getGeometry().querySelector(`type[id=\"${this.geometry}\"] bodypart[id=\"${bodypart}\"]`)));\r\n\r\n\t\tfor (const partset of bodyparts.sort(radiusComparator))\r\n\t\t{\r\n\t\t\tlet bodypart = partset.getAttribute(\"id\");\r\n\t\t\tlet items = querySelectorAllArray(\"item\", partset).sort(radiusComparator);\r\n\r\n\t\t\tfor (const item of items)\r\n\t\t\t{\r\n\t\t\t\tlet partDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\tlet partType = item.getAttribute(\"id\");\r\n\t\t\t\tlet partDirectionWithoutFlip = partDirection;\r\n\t\t\t\tlet partTypeWithoutFlip = partType;\r\n\t\t\t\tlet partSwapped = false;\r\n\t\t\t\tlet removeSetType = getRemoveSetType(partType);\r\n\r\n\t\t\t\tif (removeSetType !== null)\r\n\t\t\t\t\thiddenlayers.push(removeSetType);\r\n\r\n\t\t\t\tif (partDirection > 3 && partDirection < 7)\r\n\t\t\t\t{\r\n\t\t\t\t\tpartSwapped = true;\r\n\t\t\t\t\tpartType = getFlippedSetType(partType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet partValidActions = getValidActionsForPart(partType);\r\n\t\t\t\tlet partFrames = getAnimationFrames(action.id, partType);\r\n\r\n\t\t\t\tif (activePartSets.indexOf(partTypeWithoutFlip) === -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (this._sprites[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip] = {};\r\n\r\n\t\t\t\tif (hiddenlayers.indexOf(partType) > -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (avatarParts[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tfor (const part of avatarParts[partTypeWithoutFlip].parts)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._loading && part.library !== \"hh_human_body\")\r\n\t\t\t\t\t\tbreak; // Other parts are probably from another library.\r\n\r\n\t\t\t\t\tlet offset = {\r\n\t\t\t\t\t\tx: parseInt(partset.getAttribute(\"x\")),\r\n\t\t\t\t\t\ty: parseInt(partset.getAttribute(\"y\"))\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tlet partFlipped = false;\r\n\t\t\t\t\tlet partFrame = frame % (partFrames !== null ? Object.values(partFrames).length : 1);\r\n\t\t\t\t\tlet partAction = (partFrames && partFrames[partFrame] ? partFrames[partFrame].assetpartdefinition : action.assetpartdefinition);\r\n\r\n\t\t\t\t\tif (partValidActions.indexOf(partAction) === -1)\r\n\t\t\t\t\t\tpartAction = partValidActions[0];\r\n\r\n\t\t\t\t\tpartDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\t\tpartFrame = partFrames && partFrames[partFrame] ? partFrames[partFrame].number : 0;\r\n\r\n\t\t\t\t\tlet animationOffset = getAnimationOffset(action.id, bodypart, frame % getAnimationFramesCount(action.id), partDirection);\r\n\t\t\t\t\tlet generateAssetName = () => `h_${partAction}_${partType}_${part.id}_${partDirection}_${partFrame}`;\r\n\t\t\t\t\tlet sprite = getSprite(part.library, generateAssetName(), center);\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opf = partFrame;\r\n\t\t\t\t\t\tpartFrame = 0;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartFrame = opf;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpartDirection = 6 - partDirection;\r\n\t\t\t\t\t\tpartFlipped = partDirectionWithoutFlip > 3 && partDirectionWithoutFlip < 7;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opa = partAction;\r\n\t\t\t\t\t\tpartAction = \"std\";\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartAction = opa;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// if (partType !== \"ey\" && partType !== \"fc\")\r\n\t\t\t\t\t\t// \tLogger.debug(\"Sprite not found!\", generateAssetName(), part.library, partType);\r\n\r\n\t\t\t\t\t\tbreak; // Don't draw incomplete pieces.\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!partSwapped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x += offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y += offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x -= offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y -= offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (partFlipped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.scale.x = -1;\r\n\t\t\t\t\t\tsprite.x = (((this._width - sprite.width) - sprite.x) + sprite.width) + animationOffset.x;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsprite.x = Math.floor(sprite.x);\r\n\t\t\t\t\tsprite.y = Math.floor(sprite.y);\r\n\r\n\t\t\t\t\tif (part.colorable && partType !== \"ey\" && !this._loading)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst colors = this.figure.parts[part.set].color;\r\n\t\t\t\t\t\tconst color = colors[part.colorindex - 1] || colors[0];\r\n\t\t\t\t\t\tconst fdColor = getFigureData().querySelector(`palette[id=\"${part.paletteid}\"] color[id=\"${color}\"]`);\r\n\r\n\t\t\t\t\t\tif (fdColor !== null)\r\n\t\t\t\t\t\t\tsprite.tint = parseInt(`0x${fdColor.textContent}`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this._sprites[partTypeWithoutFlip][part.index] !== undefined)\r\n\t\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index].destroy(false);\r\n\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index] = sprite;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\t\tapplication.getManager(AvatarManager).removeAvatar(this);\r\n\t}\r\n\r\n}\r\n","const debugMode = false;\r\n\r\nexport class Logger\r\n{\r\n\r\n\tstatic debug(...data)\r\n\t{\r\n\t\tif (!debugMode)\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(\"[D]\", ...data);\r\n\t}\r\n\r\n\tstatic error(...data)\r\n\t{\r\n\t\tconsole.error(\"[E]\", ...data);\r\n\t}\r\n\r\n}\r\n","export class FigureString\r\n{\r\n\r\n\tget parts()\r\n\t{\r\n\t\treturn this._parts;\r\n\t}\r\n\r\n\tconstructor(figure)\r\n\t{\r\n\t\tthis._parts = {};\r\n\r\n\t\tthis.parse(figure);\r\n\t}\r\n\r\n\thasPartId(type, id)\r\n\t{\r\n\t\tif (!this.hasPartType(type))\r\n\t\t\treturn false;\r\n\r\n\t\treturn this._parts[type].id === id;\r\n\t}\r\n\r\n\thasPartType(type)\r\n\t{\r\n\t\treturn this._parts[type] !== undefined;\r\n\t}\r\n\r\n\tparse(figure)\r\n\t{\r\n\t\tfigure = figure.split(\".\");\r\n\t\tfigure = figure.map(part => part.split(\"-\"));\r\n\t\tfigure = figure.sort((a, b) => a[0].localeCompare(b[0]));\r\n\t\tfigure.forEach(part => this._parts[part[0]] = {id: parseInt(part[1]), color: [part[2], part[3]].filter(n => n !== null)});\r\n\t}\r\n\r\n\ttoString()\r\n\t{\r\n\t\tconst str = [];\r\n\r\n\t\tthis.parts.forEach((data, type) => str.push([type, data.id, ...data.color].join(\"-\")));\r\n\r\n\t\treturn str.join(\".\");\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../logging.js\";\r\n\r\nexport class Manager\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn application.display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn application.loader;\r\n\t}\r\n\r\n\tget name()\r\n\t{\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn application.stage;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._name = this.constructor.name;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tLogger.debug(`Initializing manager: ${this.name}`)\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t}\r\n\r\n\tlog(...data)\r\n\t{\r\n\t\tconsole.log(this.name, ...data);\r\n\t}\r\n\r\n\tlogDebug(...data)\r\n\t{\r\n\t\tconsole.debug(this.name, ...data);\r\n\t}\r\n\r\n\tlogError(...data)\r\n\t{\r\n\t\tconsole.error(this.name, ...data);\r\n\t}\r\n\r\n\tlogWarning(...data)\r\n\t{\r\n\t\tconsole.warn(this.name, ...data);\r\n\t}\r\n\r\n}\r\n","import { initializeAvatarRenderer, loadAvatarClothingConfig, loadAvatarClothingLibrary } from \"./shared.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport const avatarResources = {\r\n\tpoof: {\r\n\t\t\"1_1\": \"./resource/image/avatar/poof/1-1.png\",\r\n\t\t\"1_2\": \"./resource/image/avatar/poof/1-2.png\",\r\n\t\t\"1_3\": \"./resource/image/avatar/poof/1-3.png\",\r\n\t\t\"1_4\": \"./resource/image/avatar/poof/1-4.png\",\r\n\t\t\"2_1\": \"./resource/image/avatar/poof/2-1.png\",\r\n\t\t\"2_2\": \"./resource/image/avatar/poof/2-2.png\",\r\n\t\t\"2_3\": \"./resource/image/avatar/poof/2-3.png\",\r\n\t\t\"2_4\": \"./resource/image/avatar/poof/2-4.png\",\r\n\t\t\"3_1\": \"./resource/image/avatar/poof/3-1.png\",\r\n\t\t\"3_2\": \"./resource/image/avatar/poof/3-2.png\",\r\n\t\t\"3_3\": \"./resource/image/avatar/poof/3-3.png\",\r\n\t\t\"3_4\": \"./resource/image/avatar/poof/3-4.png\",\r\n\t\t\"4_1\": \"./resource/image/avatar/poof/4-1.png\",\r\n\t\t\"4_2\": \"./resource/image/avatar/poof/4-2.png\",\r\n\t\t\"4_3\": \"./resource/image/avatar/poof/4-3.png\",\r\n\t\t\"4_4\": \"./resource/image/avatar/poof/4-4.png\"\r\n\t}\r\n};\r\n\r\nexport class AvatarManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatars = [];\r\n\t\tthis.lastUpdate = 0;\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => this.initializeRenderer());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tawait loadAvatarClothingConfig(\"actions\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"animations\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"draworder\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"effectmap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuredata\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuremap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"geometry\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"offsets\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"partsets\", this.loader);\r\n\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_body\", this.loader);\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_face\", this.loader);\r\n\r\n\t\tavatarResources.poof.forEach(image => this.loader.add(image));\r\n\t}\r\n\r\n\tinitializeRenderer()\r\n\t{\r\n\t\tinitializeAvatarRenderer();\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.onGameTick());\r\n\t}\r\n\r\n\tnewAvatar(...options)\r\n\t{\r\n\t\tconst avatar = new Avatar(...options);\r\n\r\n\t\tthis.avatars.push(avatar);\r\n\r\n\t\treturn avatar;\r\n\t}\r\n\r\n\tremoveAvatar(avatar)\r\n\t{\r\n\t\tthis.avatars = this.avatars.filter(a => a.id !== avatar.id);\r\n\t}\r\n\r\n\tonGameTick()\r\n\t{\r\n\t\tif (this.lastUpdate === -1 || (application.ticker.lastTime - this.lastUpdate) > 90)\r\n\t\t{\r\n\t\t\tthis.lastUpdate = application.ticker.lastTime;\r\n\r\n\t\t\tthis.avatars.forEach(avatar => avatar.update());\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst configJson = \"./resource/config/config.json\";\r\n\r\nexport class ConfigManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.config = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(configJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onConfigLoaded(application.getResource(configJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.config);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.config));\r\n\t}\r\n\r\n\tonConfigLoaded(config)\r\n\t{\r\n\t\tif (config === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.config = config.data;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { ConfigManager } from \"../config/config.js\";\r\n\r\nconst textsJson = \"./resource/config/texts.json\";\r\n\r\nexport class I18nManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.texts = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(textsJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onTextsLoaded(application.getResource(textsJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.texts);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.text, application.getManager(ConfigManager).config));\r\n\t}\r\n\r\n\tonTextsLoaded(texts)\r\n\t{\r\n\t\tif (texts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.texts = texts.data;\r\n\t}\r\n\r\n}\r\n","import { removeHtml } from \"./core/dom-utils.js\";\r\n\r\nlet frame = 0;\r\n\r\nconst stageElement = \"main#stage-mount\";\r\n\r\nexport class Display extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget frame()\r\n\t{\r\n\t\treturn frame;\r\n\t}\r\n\r\n\tget renderer()\r\n\t{\r\n\t\treturn this.app.renderer;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.app.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.app.ticker;\r\n\t}\r\n\r\n\tget view()\r\n\t{\r\n\t\treturn this.app.view;\r\n\t}\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this.renderer.height / this.dpi;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this.renderer.width / this.dpi;\r\n\t}\r\n\r\n\tget size()\r\n\t{\r\n\t\treturn {width: this.width, height: this.height};\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.dpi = window.devicePixelRatio;\r\n\t\tthis.mount = document.querySelector(stageElement);\r\n\r\n\t\tif (this.mount === null)\r\n\t\t\tthrow new Error(\"Display mount not found!\");\r\n\r\n\t\tremoveHtml(this.mount);\r\n\r\n\t\tthis.initApp();\r\n\t\tthis.initEvents();\r\n\r\n\t\tthis.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tinitApp()\r\n\t{\r\n\t\tthis.app = new PIXI.Application({\r\n\t\t\theight: window.innerHeight,\r\n\t\t\twidth: window.innerWidth,\r\n\t\t\tantialiasing: true,\r\n\t\t\ttransparent: false,\r\n\t\t\tresolution: this.dpi,\r\n\t\t\troundPixels: false,\r\n\t\t\tpowerPreference: \"high-performance\",\r\n\t\t\tforceFXAA: true\r\n\t\t});\r\n\r\n\t\tthis.mount.appendChild(this.view);\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n\tinitEvents()\r\n\t{\r\n\t\twindow.addEventListener(\"resize\", () => this.onWindowResize());\r\n\t}\r\n\r\n\tonTick(delta)\r\n\t{\r\n\t\tframe++;\r\n\r\n\t\tthis.emit(\"tick\", delta);\r\n\r\n\t\tif (frame % 12 === 0)\r\n\t\t\tthis.emit(\"tick-update\", delta);\r\n\r\n\t\tthis.stage.updateLayerOrder();\r\n\t}\r\n\r\n\tonWindowResize()\r\n\t{\r\n\t\tthis.renderer.resize(window.innerWidth, window.innerHeight);\r\n\t\tthis.emit(\"resize\");\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.meButton = new BottomBarButtonMe());\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.meButton.x = 12;\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonMe extends PIXI.Graphics\r\n{\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this.avatar.figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tthis.avatar.figure = value;\r\n\t}\r\n\r\n\tconstructor(figure = undefined)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatar = application.getManager(AvatarManager).newAvatar(figure, \"vertical\", \"head\");\r\n\t\tthis.addChild(this.avatar);\r\n\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.direction = this.avatar.headDirection = 3;\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\r\n\t\tthis.avatar.x = -10;\r\n\t\tthis.avatar.y = -5;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarChatBubble extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.meButton = new BottomBarButtonMe());\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.meButton.x = 12;\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonMe extends PIXI.Graphics\r\n{\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this.avatar.figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tthis.avatar.figure = value;\r\n\t}\r\n\r\n\tconstructor(figure = undefined)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatar = application.getManager(AvatarManager).newAvatar(figure, \"vertical\", \"head\");\r\n\t\tthis.addChild(this.avatar);\r\n\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.direction = this.avatar.headDirection = 3;\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\r\n\t\tthis.avatar.x = -10;\r\n\t\tthis.avatar.y = -5;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarChatBubble extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../core/pixi-utils.js\";\r\nimport { application } from \"../bootstrapper.js\";\r\nimport { bottomBarHeight } from \"./interface/bottomBar.js\";\r\n\r\nconst contentMargin = 6;\r\nconst cornerRadius = 6;\r\n\r\nexport class Window extends PIXI.Container\r\n{\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height(value)\r\n\t{\r\n\t\tthis._height = value;\r\n\t}\r\n\r\n\tget opened()\r\n\t{\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\tget title()\r\n\t{\r\n\t\treturn this.titleText.text.trim();\r\n\t}\r\n\r\n\tset title(value)\r\n\t{\r\n\t\tthis.titleText.text = value;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width(value)\r\n\t{\r\n\t\tthis._width = value;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.x = 100;\r\n\t\tthis.y = 100;\r\n\t\tthis.z = 10000;\r\n\t\tthis.visible = false;\r\n\r\n\t\tthis.bg = new PIXI.Graphics();\r\n\t\tthis.addChild(this.bg);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.title = \"\";\r\n\r\n\t\tthis.render();\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.render());\r\n\r\n\t\tsimpleDraggable(this);\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 700,\r\n\t\t\tfill: 0xE4E4E4\r\n\t\t});\r\n\r\n\t\tthis.titleText = new PIXI.Text(\"\", style);\r\n\t\tthis.addChild(this.titleText);\r\n\r\n\t\tthis.filters = [\r\n\t\t\twithInstance(new PIXI.filters.DropShadowFilter(), shadow =>\r\n\t\t\t{\r\n\t\t\t\tshadow.color = 0x000000;\r\n\t\t\t\tshadow.alpha = 0.2;\r\n\t\t\t\tshadow.blur = 2;\r\n\t\t\t\tshadow.distance = 1;\r\n\t\t\t\tshadow.rotation = 90;\r\n\t\t\t})\r\n\t\t];\r\n\t}\r\n\r\n\tgetDraggableRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.title !== \"\" ? 42 : 0\r\n\t\t};\r\n\t}\r\n\r\n\tgetDraggingRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 12,\r\n\t\t\ty: 12,\r\n\t\t\twidth: application.display.width - 12,\r\n\t\t\theight: application.display.height - bottomBarHeight - 12\r\n\t\t};\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [1, 0],\r\n\t\t\ty: [this.y, this.y + 24]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t\tthis.y -= 24;\r\n\t\t\tthis.visible = false;\r\n\t\t});\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [this.y + 24, this.y]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.bg.clear();\r\n\r\n\t\tconst width = Math.max(this.width || 0, super.width);\r\n\t\tconst height = Math.max(this.height || 0, super.height);\r\n\r\n\t\tlet contentOffset = 0;\r\n\r\n\t\tthis.bg.beginFill(0x165679);\r\n\t\tthis.bg.lineStyle(3, 0x1a658f);\r\n\t\tthis.bg.drawRoundedRect(0, 0, width, height, cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\r\n\t\tthis.bg.lineStyle(0);\r\n\r\n\t\tif (this.title !== \"\")\r\n\t\t{\r\n\t\t\tcontentOffset = 39;\r\n\t\t\tthis.titleText.x = width / 2;\r\n\t\t\tthis.titleText.y = 15;\r\n\t\t\tthis.titleText.anchor.x = 0.5;\r\n\t\t\tthis.titleText.visible = true;\r\n\r\n\t\t\tlet old = this.title;\r\n\t\t\tthis.title = \"\";\r\n\t\t\tthis.title = old;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.titleText.visible = false;\r\n\t\t}\r\n\r\n\t\tthis.bg.beginFill(0xFFFFFF);\r\n\t\tthis.bg.drawRoundedRect(contentMargin, contentMargin + contentOffset, width - (contentMargin * 2), height - ((contentMargin * 2) + contentOffset), cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\t}\r\n\r\n}\r\n","import { Window } from \"./window.js\";\r\n\r\nexport const UI = {\r\n\tWindow\r\n};\r\n\r\nexport const Easings = {\r\n\tAccelerationCurve: [0.4, 0.0, 1, 1],\r\n\tDecelerationCurve: [0.0, 0.0, 0.2, 1],\r\n\tSharpCurve: [0.4, 0.0, 0.6, 1],\r\n\tStandardCurve: [0.4, 0.0, 0.2, 1],\r\n\tSwiftOut: [.55, 0, .1, 1]\r\n};\r\n","import { BottomBar, bottomBarHeight } from \"./bottombar.js\";\r\nimport { Easings } from \"../ui.js\";\r\n\r\nexport const interfaceResources = {\r\n\tchatBubble: {\r\n\t\tleft: \"./resource/image/interface/chat-bubble/left.png\",\r\n\t\tmiddle: \"./resource/image/interface/chat-bubble/middle.png\",\r\n\t\tright: \"./resource/image/interface/chat-bubble/right.png\"\r\n\t},\r\n\tbottomBar: {\r\n\t\tbackground: \"./resource/image/interface/bottom-bar/background.png\",\r\n\t\tnavigator: \"./resource/image/interface/bottom-bar/navigator.png\",\r\n\t\tfriends: \"./resource/image/interface/bottom-bar/friends.png\",\r\n\t\tfriendsInvited: \"./resource/image/interface/bottom-bar/friends-invited.png\",\r\n\t\tchat: \"./resource/image/interface/bottom-bar/chat.png\",\r\n\t\tchatMessages: \"./resource/image/interface/bottom-bar/chat-messages.png\",\r\n\t\tcatalogue: \"./resource/image/interface/bottom-bar/catalogue.png\",\r\n\t\tinventory: \"./resource/image/interface/bottom-bar/inventory.png\",\r\n\t\thelp: \"./resource/image/interface/bottom-bar/help.png\"\r\n\t}\r\n};\r\n\r\nexport class InterfaceContainer extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 100000;\r\n\r\n\t\tthis.init();\r\n\t\tthis.hello();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.bottomBar = new BottomBar();\r\n\t\tthis.addChild(this.bottomBar);\r\n\t}\r\n\r\n\thello()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this.bottomBar,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [this.bottomBar.y + bottomBarHeight, this.bottomBar.y]\r\n\t\t})\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { InterfaceContainer, interfaceResources } from \"./interface.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nlet localInterface;\r\n\r\nfunction initInterface()\r\n{\r\n\tlocalInterface = new InterfaceContainer();\r\n\r\n\tapplication.display.stage.addChild(localInterface);\r\n}\r\n\r\nexport class InterfaceManager extends Manager\r\n{\r\n\r\n\tget interface()\r\n\t{\r\n\t\treturn localInterface;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => initInterface());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(interfaceResources.bottomBar.background);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.catalogue);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chat);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chatMessages);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friends);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friendsInvited);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.help);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.inventory);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.navigator);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.left);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.middle);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.right);\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { tileHeightHalf, tileWidthHalf } from \"../room/shared.js\";\r\n\r\nconst furniResources = {\r\n\tloading: \"./resource/image/furni/loading.png\"\r\n};\r\n\r\nexport class Furni extends PIXI.Container\r\n{\r\n\r\n\tget loading()\r\n\t{\r\n\t\treturn this._loading;\r\n\t}\r\n\r\n\tset loading(value)\r\n\t{\r\n\t\tthis._loading = value;\r\n\t}\r\n\r\n\tconstructor(furniName)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.furniName = furniName;\r\n\r\n\t\tthis._loadingSprite = new PIXI.Sprite(application.getResource(furniResources.loading).texture);\r\n\t\tthis.addChild(this._loadingSprite);\r\n\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -(tileWidthHalf + 2),\r\n\t\t\ty: -(tileHeightHalf + 34)\r\n\t\t};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t}\r\n\r\n}\r\n\r\nexport class FurniManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(furniResources.loading);\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidth, tileWidthHalf } from \"./shared.js\";\r\n\r\nconst tileOffset = 1;\r\n\r\nexport class TileCursor extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tthis.lineStyle(4, 0x000000, 0.2);\r\n\t\tthis.moveTo(points[0].x, points[0].y);\r\n\t\tthis.lineTo(points[1].x, points[1].y);\r\n\t\tthis.lineTo(points[2].x, points[2].y);\r\n\t\tthis.lineTo(points[3].x, points[3].y);\r\n\t\tthis.lineTo(points[0].x, points[0].y);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(4, 0xFFFFFF);\r\n\t\tthis.moveTo(points[0].x, points[0].y - tileOffset);\r\n\t\tthis.lineTo(points[1].x, points[1].y - tileOffset);\r\n\t\tthis.lineTo(points[2].x, points[2].y - tileOffset);\r\n\t\tthis.lineTo(points[3].x, points[3].y - tileOffset);\r\n\t\tthis.lineTo(points[0].x, points[0].y - tileOffset);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n\thover(x, y, z)\r\n\t{\r\n\t\tthis.position.x = x;\r\n\t\tthis.position.y = y - 2;\r\n\t\tthis.z = z;\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -tileWidthHalf,\r\n\t\t\ty: -tileHeightHalf\r\n\t\t};\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\n\r\nexport class WallBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = false;\r\n\r\n\t\tthis.cacheAsBitmap = false;\r\n\t\tthis.doorHeight = 85;\r\n\t\tthis.floorThickness = floorThickness;\r\n\t\tthis.wallHeight = 115 + (top * tileHeight);\r\n\t\tthis.wallThickness = wallThickness;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.clear();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallColumn extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, isDoor, isEnding, sceneryConfig)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.isDoor = isDoor;\r\n\t\tthis.isEnding = isEnding;\r\n\t\tthis.sceneryConfig = sceneryConfig;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tlet hole = this.isDoor ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!this.isDoor)\r\n\t\t{\r\n\t\t\tthis.beginFill(0x9697A1);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + (this.isEnding ? this.floorThickness : 0));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf + (this.isEnding ? this.floorThickness : 0) - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - (this.wallThickness / 2) - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + (this.isEnding ? this.floorThickness : 0));\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tif (this.sceneryConfig !== undefined)\r\n\t\t{\r\n\t\t\tconst sprite = new PIXI.extras.TilingSprite(this.sceneryConfig.getWallTexture());\r\n\t\t\tsprite.x = 0;\r\n\t\t\tsprite.y = -this.wallHeight;\r\n\t\t\tsprite.height = this.wallHeight - hole;\r\n\t\t\tsprite.width = tileWidthHalf;\r\n\t\t\tsprite.skew.y = -5.82;\r\n\t\t\tsprite.scale.x = 1.13;\r\n\r\n\t\t\tconst filter = new PIXI.filters.AdjustmentFilter({\r\n\t\t\t\tbrightness: 1.1\r\n\t\t\t});\r\n\r\n\t\t\tsprite.filters = [filter];\r\n\r\n\t\t\tthis.addChild(sprite);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.beginFill(0xB5B9C9);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + hole);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\t\tthis.lineTo(0, hole);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + hole);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallCorner extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(0, -this.wallHeight);\r\n\t\tthis.lineTo(this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight - this.wallThickness);\r\n\t\tthis.lineTo(-this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallRow extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, isDoor, isEnding, sceneryConfig)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.isDoor = isDoor;\r\n\t\tthis.isEnding = isEnding;\r\n\t\tthis.sceneryConfig = sceneryConfig;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tlet hole = this.isDoor ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!this.isDoor)\r\n\t\t{\r\n\t\t\tthis.beginFill(0xBABECE);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + (this.isEnding ? this.floorThickness : 0));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf + (this.isEnding ? this.floorThickness : 0) - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + (this.isEnding ? this.floorThickness : 0));\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tif (this.sceneryConfig !== undefined)\r\n\t\t{\r\n\t\t\tconst sprite = new PIXI.extras.TilingSprite(this.sceneryConfig.getWallTexture());\r\n\t\t\tsprite.x = -tileWidthHalf;\r\n\t\t\tsprite.y = -(this.wallHeight - tileHeightHalf);\r\n\t\t\tsprite.height = this.wallHeight - hole;\r\n\t\t\tsprite.width = tileWidthHalf;\r\n\t\t\tsprite.skew.y = 5.82;\r\n\t\t\tsprite.scale.x = 1.13;\r\n\r\n\t\t\tthis.addChild(sprite);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.beginFill(0x92939D);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - hole);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\t\tthis.lineTo(0, -hole);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - hole);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(-this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { RoomManager } from \"./manager.js\";\r\n\r\nexport class SceneryConfig\r\n{\r\n\r\n\tget floor()\r\n\t{\r\n\t\treturn this._floor;\r\n\t}\r\n\r\n\tset floor(value)\r\n\t{\r\n\t\tthis._floor = value;\r\n\t}\r\n\r\n\tget landscape()\r\n\t{\r\n\t\treturn this._landscape;\r\n\t}\r\n\r\n\tset landscape(value)\r\n\t{\r\n\t\tthis._landscape = value;\r\n\t}\r\n\r\n\tget wall()\r\n\t{\r\n\t\treturn this._wall;\r\n\t}\r\n\r\n\tset wall(value)\r\n\t{\r\n\t\tthis._wall = value;\r\n\t}\r\n\r\n\tconstructor(floor, landscape, wall)\r\n\t{\r\n\t\tthis.floor = floor;\r\n\t\tthis.landscape = landscape;\r\n\t\tthis.wall = wall;\r\n\t}\r\n\r\n\tgetFloorTexture()\r\n\t{\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tgetLandscapeTexture()\r\n\t{\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tgetWallTexture()\r\n\t{\r\n\t\treturn getSceneryTexture(\"wall_texture_64_3_wall_color_lsd2\");\r\n\t}\r\n\r\n}\r\n\r\nexport function getSceneryTexture(asset)\r\n{\r\n\tconst roomManager = application.getManager(RoomManager);\r\n\tconst sprites = roomManager.sprites.assets;\r\n\tconst base = roomManager.sceneryTexture;\r\n\r\n\tif (sprites[asset] === undefined)\r\n\t\tsprites[asset] = [0, 0, 1, 1]; // Omit errors for now.\r\n\r\n\tconst texture = new PIXI.Texture(base);\r\n\ttexture.frame = new PIXI.Rectangle(...sprites[asset]);\r\n\r\n\treturn texture;\r\n}\r\n","import { advancedDraggable, withInstance } from \"../../core/pixi-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { TileCursor } from \"./cursor.js\";\r\nimport { getDoorDirection, getHighestAndLowest, getStairsType, getTileHeightIndex, getTileImplementation, isDoor, needsWallColumn, needsWallRow, tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\nimport { Tile } from \"./tiles.js\";\r\nimport { WallColumn, WallCorner, WallRow } from \"./walls.js\";\r\nimport { Easings } from \"../../ui/ui.js\";\r\nimport { SceneryConfig } from \"./scenery.js\";\r\n\r\nconst buildWalls = true;\r\nconst enableScenery = true;\r\n\r\nexport class RoomView extends PIXI.Graphics\r\n{\r\n\r\n\tget entities()\r\n\t{\r\n\t\treturn this._entities;\r\n\t}\r\n\r\n\tget heightmap()\r\n\t{\r\n\t\treturn this._heightmap;\r\n\t}\r\n\r\n\tget roomScale()\r\n\t{\r\n\t\treturn this.scale.x;\r\n\t}\r\n\r\n\tset roomScale(value)\r\n\t{\r\n\t\tthis.scale.x = value;\r\n\t\tthis.scale.y = value;\r\n\t}\r\n\r\n\tget tiles()\r\n\t{\r\n\t\treturn this._tiles;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 1000;\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._heightmap = {};\r\n\t\tthis._tiles = {};\r\n\r\n\t\tthis.columns = 0;\r\n\t\tthis.rows = 0;\r\n\r\n\t\tthis.posfix = {x: 0, y: 0};\r\n\r\n\t\tthis.floorThickness = 8;\r\n\t\tthis.wallThickness = 8;\r\n\r\n\t\tthis.highest = 0;\r\n\t\tthis.lowest = 0;\r\n\r\n\t\tthis.offsets = {x: 0, y: 0};\r\n\r\n\t\tthis.roomScale = 1;\r\n\t\tthis.tileCursor = new TileCursor();\r\n\t\tthis.tileCursor.visible = false;\r\n\r\n\t\tthis.root = new PIXI.Container();\r\n\r\n\t\tthis.tileSprites = new PIXI.Container();\r\n\t\tthis.tileSprites.z = 10;\r\n\r\n\t\tthis.wallSprites = new PIXI.Container();\r\n\t\tthis.wallSprites.z = 20;\r\n\r\n\t\tthis.root.addChild(this.tileSprites);\r\n\t\tthis.root.addChild(this.wallSprites);\r\n\t\tthis.root.addChild(this.tileCursor);\r\n\r\n\t\tthis.addChild(this.root);\r\n\r\n\t\tconst {width, height} = application.display.size;\r\n\r\n\t\tthis.beginFill(0x000000);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tadvancedDraggable(this.root, this, (x, y) =>\r\n\t\t{\r\n\t\t\tthis.root.x = x;\r\n\t\t\tthis.root.y = y;\r\n\t\t});\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.root.updateLayerOrder());\r\n\t}\r\n\r\n\tclearEverything()\r\n\t{\r\n\t\twhile (this.tileSprites.children[0])\r\n\t\t\tthis.tileSprites.removeChild(this.tileSprites.children[0]);\r\n\r\n\t\twhile (this.wallSprites.children[0])\r\n\t\t\tthis.wallSprites.removeChild(this.wallSprites.children[0]);\r\n\r\n\t\twhile (this.root.children[0])\r\n\t\t\tthis.root.removeChild(this.root.children[0]);\r\n\r\n\t\tthis.root.addChild(this.tileSprites);\r\n\t\tthis.root.addChild(this.wallSprites);\r\n\t\tthis.root.addChild(this.tileCursor);\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._tiles = {};\r\n\t}\r\n\r\n\tprepareHeightmap(floorplan, sceneryConfig = undefined)\r\n\t{\r\n\t\tthis.emit(\"room-view-emptied\");\r\n\r\n\t\tthis.clearEverything();\r\n\r\n\t\tif (!enableScenery)\r\n\t\t\tsceneryConfig = undefined;\r\n\t\telse if (sceneryConfig === undefined)\r\n\t\t\tsceneryConfig = new SceneryConfig(\"default\", \"default\", \"default\");\r\n\r\n\t\tconst tiles = this._heightmap = floorplan\r\n\t\t\t.trim()\r\n\t\t\t.split(\"\\n\")\r\n\t\t\t.map(row => row.split(\"\").map(char => getTileHeightIndex(char)));\r\n\r\n\t\tconst {highest, lowest} = getHighestAndLowest(this.heightmap);\r\n\t\tthis.highest = highest;\r\n\t\tthis.lowest = lowest;\r\n\t\tthis.posfix = {x: 0, y: 0};\r\n\r\n\t\tif (tiles.length === 0)\r\n\t\t\treturn;\r\n\r\n\t\tthis.columns = tiles[0].length;\r\n\t\tthis.rows = tiles.length;\r\n\r\n\t\tthis.doors = [];\r\n\r\n\t\tfor (let row = 0; row < tiles.length; row++)\r\n\t\t{\r\n\t\t\tthis._tiles[row] = {};\r\n\r\n\t\t\tfor (let column = 0; column < tiles[row].length; column++)\r\n\t\t\t{\r\n\t\t\t\tlet tileHeightLocal = this.getTileHeight(row, column);\r\n\r\n\t\t\t\tif (tileHeightLocal === null)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlet stairsType = getStairsType(tiles, row, column);\r\n\t\t\t\tlet implementation = getTileImplementation(stairsType);\r\n\r\n\t\t\t\tlet wallC = needsWallColumn(tiles, row, column);\r\n\t\t\t\tlet wallR = needsWallRow(tiles, row, column);\r\n\t\t\t\tlet wall = wallC || wallR;\r\n\r\n\t\t\t\tlet x = this.getX(row, column);\r\n\t\t\t\tlet y = this.getY(row, column);\r\n\r\n\t\t\t\tlet isDoorColumn = isDoor(tiles, row - 1, column);\r\n\t\t\t\tlet isDoorRow = isDoor(tiles, row, column - 1);\r\n\t\t\t\tlet isADoor = isDoorColumn || isDoorRow;\r\n\r\n\t\t\t\tif (isADoor)\r\n\t\t\t\t\tif (isDoorColumn)\r\n\t\t\t\t\t\tthis.doors.push({row: row - 1, column: column, direction: getDoorDirection(tiles, row - 1, column)});\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis.doors.push({row: row, column: column - 1, direction: getDoorDirection(tiles, row, column - 1)});\r\n\r\n\t\t\t\tif (wall && buildWalls)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet wallImplementations = [];\r\n\t\t\t\t\tlet top = Math.abs(this.highest - tileHeightLocal);\r\n\r\n\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallCorner(this.floorThickness, this.wallThickness, top, sceneryConfig));\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn, !needsWallColumn(tiles, row, column + 1), sceneryConfig));\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow, !needsWallRow(tiles, row + 1, column), sceneryConfig));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn, !needsWallColumn(tiles, row, column + 1), sceneryConfig));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow, !needsWallRow(tiles, row + 1, column), sceneryConfig));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const wi of wallImplementations)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.wallSprites.addChild(withInstance(wi, wall =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\twall.x = x + tileWidthHalf;\r\n\t\t\t\t\t\t\twall.y = y + (stairsType !== -1 ? tileHeight : 0);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.tileSprites.addChild(withInstance(new implementation(this.floorThickness, sceneryConfig), tile =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._tiles[row][column] = tile;\r\n\r\n\t\t\t\t\ttile.row = row;\r\n\t\t\t\t\ttile.column = column;\r\n\r\n\t\t\t\t\ttile.on(\"tile-tap\", evt => this.onTileClick(evt));\r\n\t\t\t\t\ttile.on(\"tile-hover\", evt => this.onTileHover(evt));\r\n\t\t\t\t\ttile.on(\"tile-leave\", evt => this.onTileLeave(evt));\r\n\r\n\t\t\t\t\ttile.x = x;\r\n\t\t\t\t\ttile.y = y;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.tileSprites.children.forEach(child =>\r\n\t\t{\r\n\t\t\tif (child.x < this.posfix.x)\r\n\t\t\t\tthis.posfix.x = child.x;\r\n\r\n\t\t\tif (child.y < this.posfix.y)\r\n\t\t\t\tthis.posfix.y = child.y;\r\n\t\t});\r\n\r\n\t\tthis.posfix.x = Math.abs(this.posfix.x);\r\n\t\tthis.posfix.y = Math.abs(this.posfix.y);\r\n\r\n\t\tthis.tileSprites.children.forEach(child =>\r\n\t\t{\r\n\t\t\tchild.x += this.posfix.x;\r\n\t\t\tchild.y += this.posfix.y;\r\n\t\t});\r\n\r\n\t\tthis.wallSprites.children.forEach(child =>\r\n\t\t{\r\n\t\t\tchild.x += this.posfix.x;\r\n\t\t\tchild.y += this.posfix.y;\r\n\t\t});\r\n\r\n\t\tthis.centerRoom();\r\n\r\n\t\tthis.emit(\"room-view-ready\");\r\n\t}\r\n\r\n\taddEntityToTile(entity, row, column, h)\r\n\t{\r\n\t\tthis.root.addChild(entity);\r\n\r\n\t\tthis.associateEntityToTile(entity, row, column, h);\r\n\t}\r\n\r\n\tremoveEntity(entity)\r\n\t{\r\n\t\tthis.removeChild(entity);\r\n\t}\r\n\r\n\tanimateBuildingTiles()\r\n\t{\r\n\t\tif (true !== false)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let row = 0; row < this.rows; row++)\r\n\t\t{\r\n\t\t\tfor (let column = 0; column < this.columns; column++)\r\n\t\t\t{\r\n\t\t\t\tif (this.tiles[row][column] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tanime({\r\n\t\t\t\t\ttargets: this.tiles[row][column],\r\n\t\t\t\t\tdelay: (row + column) * 50,\r\n\t\t\t\t\tduration: 900,\r\n\t\t\t\t\teasing: Easings.DecelerationCurve,\r\n\t\t\t\t\talpha: [0, 1],\r\n\t\t\t\t\ty: [this.tiles[row][column].y + application.display.height, this.tiles[row][column].y]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassociateEntityToTile(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet pos = this.getEntityPosition(entity, row, column, h);\r\n\r\n\t\tentity.position.x = pos.x;\r\n\t\tentity.position.y = pos.y;\r\n\t\tentity.z = pos.z;\r\n\t}\r\n\r\n\tcenterEntity(entity, animate = true)\r\n\t{\r\n\t\tlet x = application.display.width / 2;\r\n\t\tlet y = application.display.height / 2;\r\n\r\n\t\tx -= Math.round(entity.x + entity.width / 2);\r\n\t\ty -= Math.round(entity.y + entity.height / 2);\r\n\r\n\t\tx = x - (x % 2);\r\n\r\n\t\tif (animate)\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this.root,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 800,\r\n\t\t\t\teasing: Easings.DecelerationCurve\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this.root,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 45,\r\n\t\t\t\teasing: \"linear\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcenterRoom()\r\n\t{\r\n\t\tthis.root.x = this.width / 2 - this.root.width / 2;\r\n\t\tthis.root.y = this.height / 2 - this.root.height / 2;\r\n\t}\r\n\r\n\tgetClosestTile(x, y)\r\n\t{\r\n\t}\r\n\r\n\tgetDoorTile(random = true)\r\n\t{\r\n\t\tif (!random)\r\n\t\t\treturn this.doors[0];\r\n\r\n\t\treturn this.doors[Math.floor(Math.random() * this.doors.length)];\r\n\t}\r\n\r\n\tgetEntityPosition(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet offsets = {x: 0, y: 0};\r\n\t\tlet tile = this.getTile(row, column);\r\n\r\n\t\tif (entity.getRoomOffsets !== undefined)\r\n\t\t\toffsets = entity.getRoomOffsets();\r\n\r\n\t\tlet isStairs = !(tile instanceof Tile);\r\n\r\n\t\tlet x = (this.getX(row, column) + tileWidthHalf) + (offsets.x + this.offsets.x);\r\n\t\tlet y = (this.getY(row, column) + tileHeightHalf) + (offsets.y + this.offsets.y) + (tile && isStairs ? tileHeightHalf : 0);\r\n\t\tlet z = this.getZ(row, column) + h;\r\n\r\n\t\treturn {x, y, z, isStairs};\r\n\t}\r\n\r\n\tgetRandomTile()\r\n\t{\r\n\t\tlet row = Math.floor(Math.random() * this.rows);\r\n\t\tlet column = Math.floor(Math.random() * this.columns);\r\n\r\n\t\tif (!this.isValidTile(row, column))\r\n\t\t\treturn this.getRandomTile();\r\n\r\n\t\treturn {row, column};\r\n\t}\r\n\r\n\tgetTile(row, column)\r\n\t{\r\n\t\tif (this.tiles[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.tiles[row][column] || undefined;\r\n\t}\r\n\r\n\tgetTileHeight(row, column)\r\n\t{\r\n\t\tif (this.heightmap[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.heightmap[row][column];\r\n\t}\r\n\r\n\tgetX(row, column)\r\n\t{\r\n\t\treturn (column - row) * tileWidthHalf + this.posfix.x;\r\n\t}\r\n\r\n\tgetY(row, column)\r\n\t{\r\n\t\tlet h = this.getTileHeight(row, column);\r\n\r\n\t\tif (h === undefined)\r\n\t\t\th = 0;\r\n\r\n\t\tif (getStairsType(this.heightmap, row, column) !== -1)\r\n\t\t\th += 1;\r\n\r\n\t\treturn (column + row) * tileHeightHalf - (h * tileWidthHalf) + this.posfix.y;\r\n\t}\r\n\r\n\tgetZ(row, column, add = 0)\r\n\t{\r\n\t\tif (isDoor(this.tiles, row, column))\r\n\t\t\treturn (11 + add);\r\n\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tisValidTile(row, column)\r\n\t{\r\n\t\treturn this.getTile(row, column) !== undefined;\r\n\t}\r\n\r\n\tonTileClick(evt)\r\n\t{\r\n\t\tthis.emit(\"tile-tap\", evt);\r\n\t}\r\n\r\n\tonTileHover(evt)\r\n\t{\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tlet {x, y} = this.getEntityPosition(this.tileCursor, evt.row, evt.column);\r\n\r\n\t\t\tthis.currentHover = [evt.row, evt.column];\r\n\t\t\tthis.tileCursor.visible = true;\r\n\t\t\tthis.tileCursor.hover(x, y, 11);\r\n\t\t}, 1);\r\n\t}\r\n\r\n\tonTileLeave(evt)\r\n\t{\r\n\t\tthis.currentHover = undefined;\r\n\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tif (this.currentHover !== undefined && (evt.x !== this.currentHover.x || evt.y !== this.currentHover.y))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis.tileCursor.visible = false;\r\n\t\t}, 2);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { RoomView } from \"./room-view.js\";\r\n\r\nconst roomAssets = {\r\n\tassets: getDeliveryAssetsUrl(\"/room-content/room_assets.xml\"),\r\n\tsprites: getDeliveryAssetsUrl(\"/room-content/assets.json\"),\r\n\tvisualization: getDeliveryAssetsUrl(\"/room-content/room_visualization.xml\")\r\n};\r\n\r\nlet localRoomViewer;\r\n\r\nfunction initRoomViewer()\r\n{\r\n\tlocalRoomViewer = new RoomView();\r\n}\r\n\r\nexport class RoomManager extends Manager\r\n{\r\n\r\n\tget assets()\r\n\t{\r\n\t\treturn this._assets;\r\n\t}\r\n\r\n\tget roomViewer()\r\n\t{\r\n\t\treturn localRoomViewer;\r\n\t}\r\n\r\n\tget sceneryTexture()\r\n\t{\r\n\t\treturn this._sceneryTexture;\r\n\t}\r\n\r\n\tget sprites()\r\n\t{\r\n\t\treturn this._sprites;\r\n\t}\r\n\r\n\tget visualization()\r\n\t{\r\n\t\treturn this._visualization;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._assets = null;\r\n\t\tthis._sprites = null;\r\n\t\tthis._visualization = null;\r\n\r\n\t\tinitRoomViewer();\r\n\r\n\t\tthis.roomViewer.visible = false;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loadConfig(roomAssets.assets);\r\n\t\tthis.loadConfig(roomAssets.sprites);\r\n\t\tthis.loadConfig(roomAssets.visualization);\r\n\t}\r\n\r\n\tloadConfig(url)\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(url)\r\n\t\t\t.on(\"complete\", (loader, file) => loader.resources[url] !== undefined ? this.onConfigLoaded(url, file[url]) : undefined);\r\n\t}\r\n\r\n\tonConfigLoaded(url, file)\r\n\t{\r\n\t\tswitch (url)\r\n\t\t{\r\n\t\t\tcase roomAssets.assets:\r\n\t\t\t\tthis._assets = file.data;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase roomAssets.sprites:\r\n\t\t\t\tthis._sprites = file.data;\r\n\t\t\t\tthis._sceneryTexture = PIXI.Texture.from(`data:image/png;base64,${this.sprites.resource}`);\r\n\t\t\t\tthis.sprites.resource = undefined;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase roomAssets.visualization:\r\n\t\t\t\tthis._visualization = file.data;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tensureRoomViewerIsMounted()\r\n\t{\r\n\t\tif (this.roomViewer.parent !== null)\r\n\t\t\treturn;\r\n\r\n\t\tapplication.display.stage.addChild(this.roomViewer);\r\n\t}\r\n\r\n\tremoveRoomViewer()\r\n\t{\r\n\t\tthis.roomViewer.removeAllListeners();\r\n\t\tapplication.display.stage.removeChild(this.roomViewer);\r\n\t}\r\n\r\n\tshowRoomViewer(heightmap, scenery = undefined)\r\n\t{\r\n\t\tthis.ensureRoomViewerIsMounted();\r\n\r\n\t\tthis.roomViewer.prepareHeightmap(heightmap, scenery);\r\n\t\tthis.roomViewer.visible = true;\r\n\t}\r\n\r\n}\r\n","const figures = [\r\n\t\"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\",\r\n\t\"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\",\r\n\t\"hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97\",\r\n\t\"hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106\",\r\n\t\"hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324\",\r\n\t\"hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110\",\r\n\t\"hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586\"\r\n];\r\n\r\nexport const randomFigure = () => figures[Math.floor(Math.random() * (figures.length * 100)) % figures.length];\r\n","export const heightMaps = [];\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx000x\r\n0000x\r\nx000x\r\nx000x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx110x\r\nx110x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx2222xxxxxxxxxxxxxx\r\nx2222xxxxxxxxxxxxxx\r\nx2222211111xx000000\r\nx222221111110000000\r\nx222221111110000000\r\nx2222211111xx000000\r\nxx22xxx1111xxxxxxxx\r\nxx11xxx1111xxxxxxxx\r\nx1111xx1111xx000000\r\nx1111xx111110000000\r\nx1111xx111110000000\r\nx1111xx1111xx000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxxx\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nxxxxx11xxxxxxxx11xxxxx\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\n000000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx2222xx111111111111\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\n22222xx000000000000\r\nx2222xx000000000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x00000000xxxxxxxx00000000xxxx\r\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\n0000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n","import { Window } from \"../window.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport class NavigatorWindow extends Window\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.height = 540;\r\n\t\tthis.width = 420;\r\n\t\tthis.title = \"Navigator\";\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.x = application.display.width / 2 - this.width / 2;\r\n\t\tthis.y = application.display.height / 2 - this.height / 2;\r\n\r\n\t\tsuper.open();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { Easings } from \"../ui/ui.js\";\r\nimport { Manager } from \"../core/manager/manager.js\";\r\nimport { bottomBarHeight } from \"../ui/interface/bottomBar.js\";\r\n\r\nexport const hotelViewAssets = {\r\n\thotel: \"./resource/image/hotel-view/hotel.png\",\r\n\tskyline: \"./resource/image/hotel-view/skyline.png\"\r\n};\r\n\r\nexport class HotelView extends PIXI.Graphics\r\n{\r\n\r\n\tget opened()\r\n\t{\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.skyline = new PIXI.extras.TilingSprite(application.getResource(hotelViewAssets.skyline).texture);\r\n\t\tthis.addChild(this.skyline);\r\n\r\n\t\tthis.hotel = new PIXI.Sprite(application.getResource(hotelViewAssets.hotel).texture);\r\n\t\tthis.addChild(this.hotel);\r\n\r\n\t\tthis.visible = false;\r\n\t\tthis.render();\r\n\r\n\t\tthis.interactive = false;\r\n\t\tthis.interactiveChildren = false;\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.render());\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [1, 0]\r\n\t\t}).finished.then(() => this.visible = false);\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.visible = true;\r\n\r\n\t\tconst height = application.display.height;\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.skyline,\r\n\t\t\tdelay: 75,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [height, this.skyline.y]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.hotel,\r\n\t\t\tdelay: 150,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [height, this.hotel.y]\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst {width, height} = application.display.size;\r\n\t\tconst bottomOffset = bottomBarHeight;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x25B8EE);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.hotel.x = width - 750;\r\n\t\tthis.hotel.y = height - (568 + bottomOffset);\r\n\r\n\t\tthis.skyline.height = 120;\r\n\t\tthis.skyline.width = width;\r\n\t\tthis.skyline.x = 0;\r\n\t\tthis.skyline.y = height - (120 + bottomOffset);\r\n\t}\r\n\r\n}\r\n\r\nexport class HotelViewManager extends Manager\r\n{\r\n\r\n\tget hotelView()\r\n\t{\r\n\t\treturn this._hotelView;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => this.onApplicationLoadingDone());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tthis.loader.add(hotelViewAssets.hotel);\r\n\t\tthis.loader.add(hotelViewAssets.skyline);\r\n\t}\r\n\r\n\tonApplicationLoadingDone()\r\n\t{\r\n\t\tthis._hotelView = new HotelView();\r\n\t\tapplication.display.stage.addChild(this.hotelView);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { AvatarManager } from \"../view/avatar/manager.js\";\r\nimport { Furni } from \"../view/furni/furni.js\";\r\nimport { RoomManager } from \"../view/room/manager.js\";\r\nimport { getDistance, getHeading } from \"../view/room/shared.js\";\r\nimport { randomFigure } from \"./avatars.js\";\r\nimport { heightMaps } from \"./rooms.js\";\r\nimport { NavigatorWindow } from \"../ui/navigator/window.js\";\r\nimport { InterfaceManager } from \"../ui/interface/manager.js\";\r\nimport { HotelViewManager } from \"../view/hotel-view.js\";\r\nimport { SceneryConfig } from \"../view/room/scenery.js\";\r\n\r\nlet generateFurnis = 0;\r\nlet generateHumans = 10;\r\n\r\nlet furnis = [];\r\nlet humans = [];\r\n\r\nlet controllingHuman = 0;\r\n\r\nexport function fakeGamePlay()\r\n{\r\n\tconst theRandomFigure = randomFigure();\r\n\r\n\tconst avatarManager = application.getManager(AvatarManager);\r\n\tconst roomManager = application.getManager(RoomManager);\r\n\tconst hotelViewManager = application.getManager(HotelViewManager);\r\n\tconst interfaceManager = application.getManager(InterfaceManager);\r\n\r\n\thotelViewManager.hotelView.open();\r\n\r\n\tconst nav = new NavigatorWindow();\r\n\tapplication.stage.addChild(nav);\r\n\r\n\tinterfaceManager.interface.bottomBar.navigatorButton.on(\"pointertap\", () =>\r\n\t{\r\n\t\tif (nav.opened)\r\n\t\t\tnav.close();\r\n\t\telse\r\n\t\t\tnav.open();\r\n\t});\r\n\r\n\tinterfaceManager.interface.bottomBar.friendsButton.on(\"pointertap\", () =>\r\n\t{\r\n\t\tif (hotelViewManager.hotelView.opened)\r\n\t\t{\r\n\t\t\thotelViewManager.hotelView.close();\r\n\r\n\t\t\tsetTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\troomManager.roomViewer.on(\"room-view-ready\", () => roomManager.roomViewer.animateBuildingTiles());\r\n\t\t\t\troomManager.roomViewer.on(\"tile-tap\", evt => humans[controllingHuman].walkTo(evt.row, evt.column));\r\n\t\t\t\troomManager.showRoomViewer(heightMaps[3], new SceneryConfig(\"default\", \"default\", \"default\"));\r\n\r\n\t\t\t\tfor (let i = 0; i < generateHumans; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet human = avatarManager.newAvatar(randomFigure());\r\n\t\t\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\t\t\tif (i === controllingHuman)\r\n\t\t\t\t\t\tposition = roomManager.roomViewer.getDoorTile(true);\r\n\r\n\t\t\t\t\thuman.direction = human.headDirection = position.direction || Math.floor(Math.random() * 8) % 8;\r\n\t\t\t\t\t// human.addAction(\"Wave\");\r\n\r\n\t\t\t\t\thumans.push(new RoomUser(roomManager.roomViewer, human, position.row, position.column));\r\n\t\t\t\t\thuman.on(\"pointertap\", () => human.figure = randomFigure());\r\n\t\t\t\t\thuman.on(\"pointertap\", () => roomManager.roomViewer.centerEntity(human, true));\r\n\r\n\t\t\t\t\troomManager.roomViewer.addEntityToTile(human, position.row, position.column);\r\n\t\t\t\t}\r\n\t\t\t}, 300);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\thumans.forEach(human => roomManager.roomViewer.removeEntity(human.avatar));\r\n\t\t\thumans.forEach(human => avatarManager.removeAvatar(human.avatar));\r\n\r\n\t\t\thumans = undefined;\r\n\t\t\thumans = [];\r\n\r\n\t\t\thotelViewManager.hotelView.open();\r\n\t\t\troomManager.removeRoomViewer();\r\n\t\t}\r\n\t});\r\n\r\n\tinterfaceManager.interface.bottomBar.meButton.figure = theRandomFigure;\r\n\r\n\tif (true === false)\r\n\t{\r\n\t\tfor (let i = 0; i < generateFurnis; i++)\r\n\t\t{\r\n\t\t\tlet furni = new Furni(\"throne\");\r\n\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\tfurnis.push(furni);\r\n\r\n\t\t\troomManager.roomViewer.addEntityToTile(furni, position.row, position.column);\r\n\t\t}\r\n\t}\r\n\r\n\tinterfaceManager.interface.bottomBar.friendsButton.emit(\"pointertap\");\r\n}\r\n\r\nclass RoomUser\r\n{\r\n\r\n\tget position()\r\n\t{\r\n\t\treturn {row: this.row, column: this.column};\r\n\t}\r\n\r\n\tconstructor(roomViewer, avatar, row, column)\r\n\t{\r\n\t\tthis.roomViewer = roomViewer;\r\n\t\tthis.avatar = avatar;\r\n\t\tthis.row = row;\r\n\t\tthis.column = column;\r\n\t}\r\n\r\n\tmoveTo(row, column, heading = undefined)\r\n\t{\r\n\t\tlet distance = getDistance(this.position, {row, column});\r\n\t\theading = heading !== undefined ? heading : getHeading(this.position, {row, column}) || this.avatar.direction;\r\n\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column, 1);\r\n\r\n\t\tif (distance > 1)\r\n\t\t{\r\n\t\t\tthis.teleportTo(row, column);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.avatar.direction = this.avatar.headDirection = heading;\r\n\r\n\t\tlet animationDuration = 360;\r\n\t\tlet anim = anime({\r\n\t\t\ttargets: this.avatar,\r\n\t\t\tduration: animationDuration,\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\teasing: \"linear\"\r\n\t\t});\r\n\r\n\t\tanim.update = a =>\r\n\t\t{\r\n\t\t\tif (a.currentTime < 180)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tanim.update = undefined;\r\n\r\n\t\t\tthis.avatar.z = z;\r\n\t\t\tthis.roomViewer.updateLayerOrder();\r\n\t\t};\r\n\t}\r\n\r\n\tteleportTo(row, column)\r\n\t{\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column);\r\n\r\n\t\tthis.avatar.position.x = x;\r\n\t\tthis.avatar.position.y = y;\r\n\t\tthis.avatar.z = z;\r\n\r\n\t\tthis.roomViewer.updateLayerOrder();\r\n\t}\r\n\r\n\twalkTo(row, column)\r\n\t{\r\n\t\tlet current = this.position;\r\n\r\n\t\tif (current.row === row && current.column === column)\r\n\t\t\treturn;\r\n\r\n\t\tthis.avatar.addAction(\"Move\");\r\n\r\n\t\tconst walk = () =>\r\n\t\t{\r\n\t\t\tlet nextRow = current.row > row ? --current.row : current.row < row ? ++current.row : row;\r\n\t\t\tlet nextColumn = current.column > column ? --current.column : current.column < column ? ++current.column : column;\r\n\r\n\t\t\tlet heading = getHeading(this.position, {row: nextRow, column: nextColumn});\r\n\r\n\t\t\tthis.column = nextColumn;\r\n\t\t\tthis.row = nextRow;\r\n\r\n\t\t\tthis.moveTo(nextRow, nextColumn, heading);\r\n\r\n\t\t\tsetTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\tif (!(current.row === row && current.column === column))\r\n\t\t\t\t\twalk();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.avatar.removeAction(\"Move\");\r\n\t\t\t}, 360);\r\n\t\t};\r\n\r\n\t\twalk();\r\n\t}\r\n\r\n}\r\n","import { AvatarManager } from \"./view/avatar/manager.js\";\r\nimport { Logger } from \"./core/logging.js\";\r\nimport { LoadingView } from \"./view/loading-view.js\";\r\nimport { Display } from \"./display.js\";\r\nimport { I18nManager } from \"./core/i18n/i18n.js\";\r\nimport { ConfigManager } from \"./core/config/config.js\";\r\nimport { initialLoadingDelay } from \"./preferences.js\";\r\nimport { InterfaceManager } from \"./ui/interface/manager.js\";\r\nimport { FurniManager } from \"./view/furni/furni.js\";\r\nimport { RoomManager } from \"./view/room/manager.js\";\r\nimport { fakeGamePlay } from \"./dev/gameplay.js\";\r\nimport { HotelViewManager } from \"./view/hotel-view.js\";\r\nimport { LOADED_LIBS } from \"./view/avatar/shared.js\";\r\n\r\nexport class InitializerLoader extends PIXI.loaders.Loader\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.urls = [];\r\n\t}\r\n\r\n\tadd(url, stage = 1)\r\n\t{\r\n\t\tthis.urls.push({\r\n\t\t\tstage,\r\n\t\t\turl\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tload()\r\n\t{\r\n\t\tLogger.debug(\"InitializerLoader\", \"Skipped load() initializing..\");\r\n\t}\r\n\r\n\trealLoad(cb, stage = 1)\r\n\t{\r\n\t\tconst valid = this.urls\r\n\t\t\t.filter(url => url.stage === stage)\r\n\t\t\t.map(url => url.url);\r\n\r\n\t\tconst urls = valid.filter(url => typeof url === \"string\");\r\n\t\tconst promises = valid.filter(url => typeof url !== \"string\");\r\n\r\n\t\turls.forEach(url => super.add(url));\r\n\r\n\t\tconst executor = async () =>\r\n\t\t{\r\n\t\t\tawait new Promise(resolve => super.load(resolve));\r\n\r\n\t\t\tfor (let promise of promises)\r\n\t\t\t\tawait promise;\r\n\t\t};\r\n\r\n\t\texecutor()\r\n\t\t\t.then(() => cb());\r\n\t}\r\n\r\n}\r\n\r\nexport class Application extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.display.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.display.ticker;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.display = new Display();\r\n\t\tthis.loader = new InitializerLoader();\r\n\t\tthis.managers = [];\r\n\t}\r\n\r\n\taddDefaultManagers()\r\n\t{\r\n\t\tthis.addManager(new ConfigManager());\r\n\t\tthis.addManager(new I18nManager());\r\n\r\n\t\tthis.addManager(new AvatarManager());\r\n\t\tthis.addManager(new FurniManager());\r\n\t\tthis.addManager(new HotelViewManager());\r\n\t\tthis.addManager(new RoomManager());\r\n\r\n\t\tthis.addManager(new InterfaceManager());\r\n\t}\r\n\r\n\taddManager(manager)\r\n\t{\r\n\t\tLogger.debug(\"Application\", `Added manager ${manager.constructor.name}`);\r\n\t\tthis.managers.push(manager);\r\n\t}\r\n\r\n\tgetManager(managerClass)\r\n\t{\r\n\t\treturn this.managers.find(manager => manager instanceof managerClass);\r\n\t}\r\n\r\n\tcreate()\r\n\t{\r\n\t\tthis.loadingView = new LoadingView();\r\n\t\tthis.loadingView.on(\"loader-ready\", () => this.emit(\"application-can-run\"));\r\n\t\tthis.stage.addChild(this.loadingView);\r\n\r\n\t\tthis.addDefaultManagers();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait this.managers.forEach(async manager => await manager.initialize());\r\n\t}\r\n\r\n\tasync run()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 0;\r\n\t\tsetTimeout(() => this.loader.realLoad(() => this.onLoadingStage0Done(), 0), initialLoadingDelay);\r\n\t}\r\n\r\n\tonLoadingStage0Done()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 1;\r\n\t\tthis.loadingView.percentage = 0;\r\n\t\tthis.loader.realLoad(() => this.onLoadingStage1Done(), 1);\r\n\t}\r\n\r\n\tonLoadingStage1Done()\r\n\t{\r\n\t\tLogger.debug(\"Application\", \"Loading of manager data done!\");\r\n\t\tthis.emit(\"application-loading-done\");\r\n\r\n\t\tdelete this.loader;\r\n\r\n\t\tthis.stage.removeChild(this.loadingView);\r\n\r\n\t\tfakeGamePlay();\r\n\t}\r\n\r\n\tgetResource(resource, loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources[resource];\r\n\t}\r\n\r\n\tgetResources(loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources;\r\n\t}\r\n\r\n}\r\n","import { Logger } from \"./core/logging.js\";\r\nimport { Application } from \"./application.js\";\r\n\r\n/**\r\n * @type {Application}\r\n */\r\nexport const application = new Application();\r\n\r\n/**\r\n * Class Bootstrapper.\r\n */\r\nexport class Bootstrapper\r\n{\r\n\r\n\t/**\r\n\t * Initializes everything.\r\n\t */\r\n\tstatic async init()\r\n\t{\r\n\t\tLogger.debug(\"Bootstrapper\", \"Loading everything..\");\r\n\r\n\t\tPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n\r\n\t\tapplication.create();\r\n\t\tapplication.on(\"application-can-run\", () => application.run());\r\n\r\n\t\tawait application.initialize();\r\n\t}\r\n\r\n}\r\n","import { Bootstrapper } from \"./bootstrapper.js\";\r\n\r\nArray.prototype.pushChain = function (...entries)\r\n{\r\n\tthis.push(...entries);\r\n\r\n\treturn this;\r\n};\r\n\r\nArray.prototype.unique = function ()\r\n{\r\n\treturn this.filter((value, index, self) => self.indexOf(value) === index);\r\n};\r\n\r\nObject.prototype.forEach = function (callback)\r\n{\r\n\tfor (let key in this)\r\n\t\tif (this.hasOwnProperty(key))\r\n\t\t\tcallback(this[key], key);\r\n};\r\n\r\nPIXI.Container.prototype.updateLayerOrder = function ()\r\n{\r\n\tlet i = 0;\r\n\r\n\tthis.children.sort((a, b) =>\r\n\t{\r\n\t\tlet az = a.z || 0;\r\n\t\tlet bz = b.z || 0;\r\n\r\n\t\tif (az === bz)\r\n\t\t\treturn this.children.indexOf(a) - this.children.indexOf(b);\r\n\r\n\t\treturn az - bz;\r\n\t});\r\n};\r\n\r\nBootstrapper.init().then(() =>\r\n{\r\n});\r\n"],"names":["selector","document","slice","call","container","querySelectorAll","base","x","y","width","height","Texture","frame","Rectangle","texture","target","interactive","instance","callback","path","deliveryRoot","library","config","loader","add","configUrl","on","getResource","LOADED_CONFIGS","application","data","isLibraryLoaded","Promise","resolve","LOADED_LIBS","LOADING_LIBS","libraryUrl","use","asset","next","name","then","debug","load","id","getActions","querySelector","definition","attributes","forEach","attribute","value","getTexture","Sprite","center","sprite","err","LOADED_TEXTURES","promise","PIXI","from","resource","getPartSets","push","activePart","getAttribute","result","geometryId","direction","isNaN","getAnimations","parseInt","bodypart","string","replace","matches","contents","context","key","object","keyParts","split","current","keyPart","g","points","thickness","beginFill","moveTo","lineTo","endFill","a","b","row","column","tiles","getSurroundings","findIndex","getTile","tileNorthEast","tileNorthWest","tileHeight","filter","length","isDoor","isValid","cy","cx","Math","abs","round","max","floor","Logger","error","FigureString","figure","_parts","parse","type","this","hasPartType","map","sort","localeCompare","part","color","parts","join","str","Avatar","geometry","avatarSet","initialBuild","canPoof","window","performance","now","loaders","Loader","needsUpdate","partContainer","Container","addChild","_this","_alsoUpdate","_ticker","_width","_height","_actions","defaultAction","_frames","headDirection","build","_avatarSet","_direction","_figure","poof","_geometry","_headDirection","action","getAction","pushChain","indexOf","actionsSorted","found","hasAction","dir","isBuilding","emit","invalidate","getLibraries","_loading","libraries","shift","_this2","download","update","getGeometry","activePartSets","getActivePartSets","unique","actions","bodyparts","settype","parentNode","lib","toLowerCase","getFigureData","set","getElementsByTagName","colorable","hiddenlayers","paletteid","setHiddenlayers","layer","partType","_this3","_sprites","decideGeometry","gatherParts","extras","AnimatedSprite","avatarResources","cloud","anchor","animationSpeed","loop","hitArea","position","play","removeChild","clouds","setTimeout","cacheAsBitmap","alpha","hasActivePartSet","draworderId","querySelectorAllArray","getDraworder","draworder","children","updateAction","render","avatarParts","loadingAvatar","getBodyparts","_this7","radiusComparator","partset","items","setType","partDirection","item","partDirectionWithoutFlip","partTypeWithoutFlip","partSwapped","removeSetType","flippedSetType","frames","partFrames","def","hasAttribute","i","repeats","number","assetpartdefinition","partFlipped","partFrame","Object","values","partAction","partValidActions","offsets","getAnimationOffset","generateAssetName","getSprite","opf","opa","offset","animationOffset","scale","colors","colorindex","fdColor","tint","textContent","index","destroy","getManager","AvatarManager","removeAvatar","Manager","_name","constructor","display","stage","log","warn","avatars","lastUpdate","once","initializeRenderer","loadAvatarClothingConfig","loadAvatarClothingLibrary","image","onGameTick","options","avatar","ticker","lastTime","ConfigManager","onConfigLoaded","defaultValue","findKey","evaluateString","assign","I18nManager","texts","onTextsLoaded","text","LoadingBar","barHeight","barThickness","barWidth","percentage","_percentage","clear","lineStyle","drawRoundedRect","Graphics","LoadingView","loadingBar","logo","init","loadResources","style","TextStyle","Text","onResourcesLoaded","state","progress","getString","Display","dpi","devicePixelRatio","mount","innerHTML","initApp","initEvents","onTick","delta","app","renderer","view","Application","innerHeight","innerWidth","appendChild","addEventListener","onWindowResize","updateLayerOrder","resize","utils","EventEmitter","BottomBar","background","interfaceResources","bottomBar","meButton","navigatorButton","friendsButton","chatButton","catalogueButton","inventoryButton","helpButton","draw","size","BottomBarButton","textures","buttonMode","BottomBarButtonMe","newAvatar","addAction","BottomBarButtonAnimatedHover","onPointerOver","onPointerOut","BottomBarButtonCatalogue","catalogue","getTextureFromRectangle","BottomBarButtonChat","chat","BottomBarButtonFriends","chatMessages","friends","BottomBarButtonHelp","friendsInvited","help","BottomBarButtonInventory","inventory","BottomBarButtonNavigator","navigator","Window","z","visible","bg","title","pos","evt","getLocalPosition","simpleDraggableTarget","getDraggableRegion","parent","newX","p","newY","getDraggingRegion","bounds","titleText","trim","filters","withInstance","DropShadowFilter","blur","distance","rotation","currentAnimation","anime","finished","contentOffset","old","contentMargin","Easings","InterfaceContainer","hello","SwiftOut","localInterface","InterfaceManager","chatBubble","left","middle","right","TileBase","onClick","onMouseOver","onMouseOut","StairsSouth","StairsSouthEast","allPoints","step","ay","Point","tileWidth","ax","StairsSouthWest","_this4","Tile","_this5","furniResources","FurniManager","furniName","_loadingSprite","loading","TileCursor","WallBase","floorThickness","wallThickness","top","doorHeight","wallHeight","WallColumn","isEnding","sceneryConfig","tileHeightHalf","tileWidthHalf","TilingSprite","getWallTexture","hole","skew","AdjustmentFilter","WallCorner","WallRow","SceneryConfig","landscape","wall","_floor","_landscape","_wall","RoomManager","sprites","roomManager","assets","sceneryTexture","RoomView","_entities","_heightmap","_tiles","columns","rows","posfix","highest","lowest","roomScale","tileCursor","root","tileSprites","wallSprites","drawRect","el","fn","floorplan","clearEverything","char","heightmap","h","getHighestAndLowest","doors","getTileHeight","getStairsType","implementation","getTileImplementation","stairsType","wallC","needsWallColumn","wallR","needsWallRow","getX","getY","isDoorColumn","isDoorRow","getDoorDirection","tileHeightLocal","wi","wallImplementations","tile","onTileClick","onTileHover","onTileLeave","child","centerRoom","entity","associateEntityToTile","getEntityPosition","animate","DecelerationCurve","random","getRoomOffsets","isStairs","getZ","isValidTile","getRandomTile","currentHover","hover","roomAssets","getDeliveryAssetsUrl","localRoomViewer","_assets","_visualization","roomViewer","_sceneryTexture","loadConfig","visualization","url","file","resources","removeAllListeners","ensureRoomViewerIsMounted","prepareHeightmap","scenery","figures","randomFigure","heightMaps","hotelViewAssets","HotelView","skyline","hotel","interactiveChildren","HotelViewManager","onApplicationLoadingDone","_hotelView","hotelView","humans","RoomUser","heading","getHeading","teleportTo","currentTime","nextColumn","nextRow","removeAction","walk","InitializerLoader","urls","cb","valid","promises","managers","addManager","manager","managerClass","find","loadingView","addDefaultManagers","initialize","realLoad","onLoadingStage0Done","onLoadingStage1Done","avatarManager","hotelViewManager","interfaceManager","open","nav","interface","opened","close","animateBuildingTiles","walkTo","showRoomViewer","getDoorTile","human","centerEntity","addEntityToTile","removeEntity","removeRoomViewer","theRandomFigure","Bootstrapper","settings","SCALE_MODE","SCALE_MODES","NEAREST","create","run","Array","prototype","self","hasOwnProperty","bz","az"],"mappings":"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"}