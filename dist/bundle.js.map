{"version":3,"file":"bundle.js.map","sources":["../src/core/pixi-utils.js","../src/preferences.js","../src/core/json-utils.js","../src/view/room/tiles.js","../src/view/room/shared.js","../src/ui/window.js","../src/view/loading-view.js","../src/core/logging.js","../src/core/manager/manager.js","../src/view/avatar/figure.js","../src/view/avatar/action.js","../src/view/avatar/animation.js","../src/view/avatar/figuredata.js","../src/view/avatar/shared.js","../src/view/avatar/config.js","../src/view/avatar/avatar.js","../src/view/avatar/manager.js","../src/core/config/config.js","../src/core/i18n/i18n.js","../src/display.js","../src/core/dom-utils.js","../src/ui/interface/bottombar.js","../src/ui/interface/memenu.js","../src/ui/interface/bottomBar.js","../src/ui/ui.js","../src/ui/interface/interface.js","../src/ui/interface/manager.js","../src/view/furni/furni.js","../src/view/room/cursor.js","../src/view/room/walls.js","../src/view/room/room-view.js","../src/view/room/manager.js","../src/ui/navigator/window.js","../src/view/hotel-view.js","../src/application.js","../src/dev/gameplay.js","../src/bootstrapper.js","../src/main.js"],"sourcesContent":["export function getTextureFromRectangle(base, x, y, width, height)\r\n{\r\n\tconst texture = new PIXI.Texture(base);\r\n\ttexture.frame = new PIXI.Rectangle(x, y, width, height);\r\n\r\n\treturn texture;\r\n}\r\n\r\nexport function setInteractive(target)\r\n{\r\n\ttarget.interactive = true;\r\n}\r\n\r\nexport function simpleDraggable(target)\r\n{\r\n\tsetInteractive(target);\r\n\r\n\tlet simpleDraggableTarget = null;\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\ttarget.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\r\n\t\tif (typeof target.getDraggableRegion === \"undefined\")\r\n\t\t\treturn;\r\n\r\n\t\tconst {x, y, width, height} = target.getDraggableRegion();\r\n\r\n\t\tif (pos.x < x || pos.x > width || pos.y < y || pos.y > height)\r\n\t\t{\r\n\t\t\tdata = null;\r\n\t\t\tpos = null;\r\n\t\t\tsimpleDraggableTarget = null;\r\n\t\t}\r\n\t});\r\n\r\n\ttarget.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\ttarget.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tlet newX = p.x - pos.x;\r\n\t\tlet newY = p.y - pos.y;\r\n\r\n\t\tif (typeof target.getDraggingRegion !== \"undefined\")\r\n\t\t{\r\n\t\t\tconst {x, y, width, height} = target.getDraggingRegion();\r\n\t\t\tconst bounds = typeof target.getDraggableRegion !== \"undefined\" ? target.getDraggableRegion() : target;\r\n\r\n\t\t\tif (newX < x)\r\n\t\t\t\tnewX = x;\r\n\r\n\t\t\tif ((newX + bounds.width) > width)\r\n\t\t\t\tnewX = (width - bounds.width);\r\n\r\n\t\t\tif (newY < y)\r\n\t\t\t\tnewY = y;\r\n\r\n\t\t\tif ((newY + bounds.height) > height)\r\n\t\t\t\tnewY = (height - bounds.height);\r\n\t\t}\r\n\r\n\t\tsimpleDraggableTarget.position.x = newX;\r\n\t\tsimpleDraggableTarget.position.y = newY;\r\n\t});\r\n}\r\n\r\nexport function withInstance(instance, callback)\r\n{\r\n\tcallback(instance);\r\n\r\n\treturn instance;\r\n}\r\n","export const deliveryRoot = \"https://cdn.mili.us/time\";\r\nexport const initialLoadingDelay = 0;\r\n\r\nexport function getDeliveryUrl(path)\r\n{\r\n\treturn deliveryRoot + path;\r\n}\r\n\r\nexport function getDeliveryAssetsUrl(path)\r\n{\r\n\treturn getDeliveryUrl(\"/assets\" + path);\r\n}\r\n","\r\nexport function evaluateString(string, context = {})\r\n{\r\n\tstring = string.replace(new RegExp(\"\\\\${(.*?)}\", \"g\"), (matches, contents) => findKey(contents, context));\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function findKey(key, object, defaultValue = undefined)\r\n{\r\n\tconst keyParts = key.split(\".\");\r\n\tlet current = object;\r\n\r\n\tfor (const keyPart of keyParts)\r\n\t{\r\n\t\tif (current[keyPart] === undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\tcurrent = current[keyPart];\r\n\t}\r\n\r\n\treturn current;\r\n}\r\n","import { tileHeight, tileWidth } from \"./shared.js\";\r\n\r\nfunction drawTile(g, points, thickness)\r\n{\r\n\tg.beginFill(0x989865);\r\n\tg.moveTo(points[0].x, points[0].y);\r\n\tg.lineTo(points[1].x, points[1].y);\r\n\tg.lineTo(points[2].x, points[2].y);\r\n\tg.lineTo(points[3].x, points[3].y);\r\n\tg.endFill();\r\n\r\n\tif (thickness > 0)\r\n\t{\r\n\t\tg.beginFill(0x838357);\r\n\t\tg.moveTo(points[1].x, points[1].y);\r\n\t\tg.lineTo(points[1].x, points[1].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\r\n\t\tg.beginFill(0x6F6F49);\r\n\t\tg.moveTo(points[3].x, points[3].y);\r\n\t\tg.lineTo(points[3].x, points[3].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\t}\r\n}\r\n\r\nexport class TileBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.row = 0;\r\n\t\tthis.column = 0;\r\n\r\n\t\tthis.interactive = true;\r\n\t\tthis.thickness = thickness;\r\n\r\n\t\tthis.on(\"click\", () => this.onClick());\r\n\t\tthis.on(\"pointerover\", () => this.onMouseOver());\r\n\t\tthis.on(\"pointerout\", () => this.onMouseOut());\r\n\t}\r\n\r\n\tonClick()\r\n\t{\r\n\t\tthis.emit(\"tile-click\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOver()\r\n\t{\r\n\t\tthis.emit(\"tile-hover\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOut()\r\n\t{\r\n\t\tthis.emit(\"tile-leave\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouth extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthEast extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst allPoints = [];\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * 8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + (tileWidth / 8) + ax, (tileHeight / 8) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point(ax, (tileHeight / 2) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tallPoints.push(...points);\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthWest extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * -8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point(tileWidth + ax, (tileHeight / 2) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - (tileWidth / 8) + ax, (tileHeight / 8) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class Tile extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tdrawTile(this, points, this.thickness);\r\n\t}\r\n\r\n}\r\n","import { StairsSouth, StairsSouthEast, StairsSouthWest, Tile } from \"./tiles.js\";\r\n\r\nexport const hitAreaOffset = 5000;\r\n\r\nexport const tileHeight = 32;\r\nexport const tileHeightHalf = tileHeight / 2;\r\nexport const tileWidth = 64;\r\nexport const tileWidthHalf = tileWidth / 2;\r\n\r\nexport const Heading = {\r\n\tNorthEast: 0,\r\n\tNorthWest: 1,\r\n\tSouthEast: 2,\r\n\tSouthWest: 3\r\n};\r\n\r\nexport const StairsType = {\r\n\tSouth: 3,\r\n\tSouthEast: 2,\r\n\tSouthWest: 4\r\n};\r\n\r\nexport function getDistance(a, b)\r\n{\r\n\treturn Math.max(Math.abs(a.row - b.row), Math.abs(a.column - b.column));\r\n}\r\n\r\nexport function getHeading(a, b)\r\n{\r\n\tif (a.row === b.row && a.column === b.column)\r\n\t\treturn undefined;\r\n\r\n\tif (b.row < a.row && b.column > a.column)\r\n\t\treturn 1;\r\n\telse if (b.row === a.row && b.column > a.column)\r\n\t\treturn 2;\r\n\telse if (b.row > a.row && b.column > a.column)\r\n\t\treturn 3;\r\n\telse if (b.row > a.row && b.column === a.column)\r\n\t\treturn 4;\r\n\telse if (b.row > a.row && b.column < a.column)\r\n\t\treturn 5;\r\n\telse if (b.row === a.row && b.column < a.column)\r\n\t\treturn 6;\r\n\telse if (b.row < a.row && b.column < a.column)\r\n\t\treturn 7;\r\n\telse\r\n\t\treturn 0;\r\n}\r\n\r\nexport function getDoorDirection(tiles, row, column)\r\n{\r\n\tif (!isDoor(tiles, row, column))\r\n\t\treturn null;\r\n\r\n\treturn [Heading.NorthEast, Heading.NorthWest, Heading.SouthEast, Heading.SouthWest][getSurroundings(tiles, row, column).findIndex(t => t !== null)];\r\n}\r\n\r\nexport function getStairsType(tiles, row, column)\r\n{\r\n\tlet tileHeight = getTile(tiles, row, column);\r\n\tlet [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest] = getSurroundings(tiles, row, column);\r\n\r\n\tif (tileNorthEast !== null && tileNorthWest !== null && Math.abs(tileHeight - tileNorthEast) === 1 && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsType.South;\r\n\telse if (tileNorthWest !== null && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsType.SouthEast;\r\n\telse if (tileNorthEast !== null && Math.abs(tileHeight - tileNorthEast) === 1)\r\n\t\treturn StairsType.SouthWest;\r\n\r\n\t// TODO: Other stairs.\r\n\r\n\treturn undefined;\r\n}\r\n\r\nexport function getSurroundings(tiles, row, column)\r\n{\r\n\tlet tileNorthEast = getTile(tiles, row - 1, column);\r\n\tlet tileNorthWest = getTile(tiles, row, column - 1);\r\n\tlet tileSouthEast = getTile(tiles, row, column + 1);\r\n\tlet tileSouthWest = getTile(tiles, row + 1, column);\r\n\r\n\treturn [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest];\r\n}\r\n\r\nexport function getTile(tiles, row, column)\r\n{\r\n\tif (typeof tiles[row] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\tif (typeof tiles[row][column] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\treturn tiles[row][column];\r\n}\r\n\r\nexport function getTileHeightIndex(char)\r\n{\r\n\tif (char === \"x\")\r\n\t\treturn null;\r\n\r\n\treturn [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"].indexOf(char);\r\n}\r\n\r\nexport function getTileImplementation(stairsType = undefined)\r\n{\r\n\tif (stairsType === StairsType.South)\r\n\t\treturn StairsSouth;\r\n\r\n\tif (stairsType === StairsType.SouthEast)\r\n\t\treturn StairsSouthEast;\r\n\r\n\tif (stairsType === StairsType.SouthWest)\r\n\t\treturn StairsSouthWest;\r\n\r\n\treturn Tile;\r\n}\r\n\r\nexport function isDoor(tiles, row, column)\r\n{\r\n\tif (getTile(tiles, row, column) === null)\r\n\t\treturn false;\r\n\r\n\treturn getSurroundings(tiles, row, column).filter(t => t !== null).length === 1;\r\n}\r\n\r\nexport function needsWallC(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cy = row;\r\n\r\n\twhile (cy > -1)\r\n\t\tif (getTile(tiles, --cy, column) !== null && !isDoor(tiles, cy, column))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row - 1, column + 1) !== null && !isDoor(tiles, row - 1, column + 1)));\r\n}\r\n\r\nexport function needsWallR(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cx = column;\r\n\r\n\twhile (cx > -1)\r\n\t\tif (getTile(tiles, row, --cx) !== null && !isDoor(tiles, row, cx))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row + 1, column - 1) !== null && !isDoor(tiles, row + 1, column - 1)));\r\n}\r\n\r\nexport function getHighestAndLowest(heightmap)\r\n{\r\n\tlet highest = 0, lowest = 36;\r\n\r\n\tfor (let row = 0; row < heightmap.length; row++)\r\n\t{\r\n\t\tfor (let column = 0; column < heightmap[row].length; column++)\r\n\t\t{\r\n\t\t\tlet h = heightmap[row][column];\r\n\r\n\t\t\tif (h > highest)\r\n\t\t\t\thighest = h;\r\n\r\n\t\t\tif (h < lowest)\r\n\t\t\t\tlowest = 0;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {highest, lowest};\r\n}\r\n","import { simpleDraggable, withInstance } from \"../core/pixi-utils.js\";\r\nimport { application } from \"../bootstrapper.js\";\r\nimport { bottomBarHeight } from \"./interface/bottomBar.js\";\r\n\r\nconst contentMargin = 6;\r\nconst cornerRadius = 6;\r\n\r\nexport class Window extends PIXI.Container\r\n{\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height(value)\r\n\t{\r\n\t\tthis._height = value;\r\n\t}\r\n\r\n\tget opened()\r\n\t{\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\tget title()\r\n\t{\r\n\t\treturn this.titleText.text.trim();\r\n\t}\r\n\r\n\tset title(value)\r\n\t{\r\n\t\tthis.titleText.text = value;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width(value)\r\n\t{\r\n\t\tthis._width = value;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.x = 100;\r\n\t\tthis.y = 100;\r\n\t\tthis.z = 10000;\r\n\t\tthis.visible = false;\r\n\r\n\t\tthis.bg = new PIXI.Graphics();\r\n\t\tthis.addChild(this.bg);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.title = \"\";\r\n\r\n\t\tthis.render();\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.render());\r\n\r\n\t\tsimpleDraggable(this);\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 700,\r\n\t\t\tfill: 0xE4E4E4\r\n\t\t});\r\n\r\n\t\tthis.titleText = new PIXI.Text(\"\", style);\r\n\t\tthis.addChild(this.titleText);\r\n\r\n\t\tthis.filters = [\r\n\t\t\twithInstance(new PIXI.filters.DropShadowFilter(), shadow =>\r\n\t\t\t{\r\n\t\t\t\tshadow.color = 0x000000;\r\n\t\t\t\tshadow.alpha = 0.2;\r\n\t\t\t\tshadow.blur = 2;\r\n\t\t\t\tshadow.distance = 1;\r\n\t\t\t\tshadow.rotation = 90;\r\n\t\t\t})\r\n\t\t];\r\n\t}\r\n\r\n\tgetDraggableRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.title !== \"\" ? 42 : 0\r\n\t\t};\r\n\t}\r\n\r\n\tgetDraggingRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 24,\r\n\t\t\ty: 24,\r\n\t\t\twidth: application.display.width - 24,\r\n\t\t\theight: application.display.height - bottomBarHeight - 24\r\n\t\t};\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [1, 0],\r\n\t\t\ty: [this.y, this.y + 24]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t\tthis.y -= 24;\r\n\t\t\tthis.visible = false;\r\n\t\t});\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [this.y + 24, this.y]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.bg.clear();\r\n\r\n\t\tconst width = Math.max(this.width || 0, super.width);\r\n\t\tconst height = Math.max(this.height || 0, super.height);\r\n\r\n\t\tlet contentOffset = 0;\r\n\r\n\t\tthis.bg.beginFill(0x165679);\r\n\t\tthis.bg.lineStyle(3, 0x1a658f);\r\n\t\tthis.bg.drawRoundedRect(0, 0, width, height, cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\r\n\t\tthis.bg.lineStyle(0);\r\n\r\n\t\tif (this.title !== \"\")\r\n\t\t{\r\n\t\t\tcontentOffset = 39;\r\n\t\t\tthis.titleText.x = width / 2;\r\n\t\t\tthis.titleText.y = 15;\r\n\t\t\tthis.titleText.anchor.x = 0.5;\r\n\t\t\tthis.titleText.visible = true;\r\n\r\n\t\t\tlet old = this.title;\r\n\t\t\tthis.title = \"\";\r\n\t\t\tthis.title = old;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.titleText.visible = false;\r\n\t\t}\r\n\r\n\t\tthis.bg.beginFill(0xFFFFFF);\r\n\t\tthis.bg.drawRoundedRect(contentMargin, contentMargin + contentOffset, width - (contentMargin * 2), height - ((contentMargin * 2) + contentOffset), cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { I18nManager } from \"../core/i18n/i18n.js\";\r\n\r\nconst resourceLogo = \"/resource/image/logo.png\";\r\n\r\nclass LoadingBar extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this._percentage;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis._percentage = value;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.barColor = 0x454c5d;\r\n\t\tthis.barHeight = 18;\r\n\t\tthis.barThickness = 2;\r\n\t\tthis.barWidth = 300;\r\n\t\tthis.percentage = 0;\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(this.barColor);\r\n\t\tthis.drawRect(0, 0, Math.round(this.percentage / 100 * this.barWidth), this.barHeight);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(this.barThickness, this.barColor);\r\n\r\n\t\tthis.moveTo(-this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, -this.barThickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class LoadingView extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this.loadingBar.percentage || 0;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis.loadingBar.percentage = Math.round(value);\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingBar = new LoadingBar();\r\n\r\n\t\tthis.logo = null;\r\n\r\n\t\tthis.init();\r\n\t\tthis.loadResources();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 300,\r\n\t\t\tfill: 0x989ca5,\r\n\t\t\twordWrap: true,\r\n\t\t\twordWrapWidth: this.loadingBar.barWidth\r\n\t\t});\r\n\r\n\t\tthis.text = new PIXI.Text(\"\", style);\r\n\t}\r\n\r\n\tloadResources()\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(resourceLogo)\r\n\t\t\t.load(() => this.onResourcesLoaded())\r\n\t}\r\n\r\n\tonResourcesLoaded()\r\n\t{\r\n\t\tthis.logo = new PIXI.Sprite(application.getResource(resourceLogo, this.loader).texture);\r\n\r\n\t\tthis.addChild(this.logo);\r\n\r\n\t\tthis.addChild(this.loadingBar);\r\n\t\tthis.addChild(this.text);\r\n\r\n\t\tthis.logo.visible = false;\r\n\r\n\t\tapplication.loader.on(\"progress\", state => this.percentage = state.progress);\r\n\r\n\t\tthis.update();\r\n\t\tthis.emit(\"loader-ready\");\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tconst percentage = this.percentage;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst height = application.display.height;\r\n\t\tconst width = application.display.width;\r\n\r\n\t\tthis.beginFill(0x000000);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.loadingBar.position.x = (width / 2) - (this.loadingBar.barWidth / 2);\r\n\t\tthis.loadingBar.position.y = height - (this.loadingBar.barHeight + 24);\r\n\r\n\t\tthis.logo.visible = true;\r\n\t\tthis.logo.x = Math.round((width / 2) - (this.logo.width / 2));\r\n\t\tthis.logo.y = Math.round((height / 2) - (this.logo.height / 2));\r\n\r\n\t\tthis.text.text = application.getManager(I18nManager).getString(\"loading-view.starting-up\", {percentage}, \"\");\r\n\r\n\t\tthis.text.position.set(\r\n\t\t\t(this.loadingBar.position.x + (this.loadingBar.barWidth / 2)) - (this.text.width / 2),\r\n\t\t\tthis.loadingBar.position.y - 30\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","const debugMode = false;\r\n\r\nexport class Logger\r\n{\r\n\r\n\tstatic debug(...data)\r\n\t{\r\n\t\tif (!debugMode)\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(\"[D]\", ...data);\r\n\t}\r\n\r\n\tstatic error(...data)\r\n\t{\r\n\t\tconsole.error(\"[E]\", ...data);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../logging.js\";\r\n\r\nexport class Manager\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn application.display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn application.loader;\r\n\t}\r\n\r\n\tget name()\r\n\t{\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn application.stage;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._name = this.constructor.name;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tLogger.debug(`Initializing manager: ${this.name}`)\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t}\r\n\r\n\tlog(...data)\r\n\t{\r\n\t\tconsole.log(this.name, ...data);\r\n\t}\r\n\r\n\tlogDebug(...data)\r\n\t{\r\n\t\tconsole.debug(this.name, ...data);\r\n\t}\r\n\r\n\tlogError(...data)\r\n\t{\r\n\t\tconsole.error(this.name, ...data);\r\n\t}\r\n\r\n\tlogWarning(...data)\r\n\t{\r\n\t\tconsole.warn(this.name, ...data);\r\n\t}\r\n\r\n}\r\n","/**\r\n * Class AvatarFigure.\r\n *\r\n * @author Bas Milius <bas@mili.us>\r\n * @since 2018-05-20\r\n */\r\nexport class AvatarFigure\r\n{\r\n\r\n\t/**\r\n\t * AvatarFigure Constructor.\r\n\t *\r\n\t * @param {String} figure\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tconstructor(figure)\r\n\t{\r\n\t\tthis.parts = [];\r\n\r\n\t\tthis.parse(figure);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a figure part.\r\n\t *\r\n\t * @param {String} type\r\n\t *\r\n\t * @returns {AvatarFigurePart|undefined}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tgetPart(type)\r\n\t{\r\n\t\tfor (let part of this.parts)\r\n\t\t\tif (part.type === type)\r\n\t\t\t\treturn part;\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the set id for a part type.\r\n\t *\r\n\t * @param {String} type\r\n\t *\r\n\t * @returns {Number}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tgetPartSetId(type)\r\n\t{\r\n\t\tfor (let part of this.parts)\r\n\t\t\tif (part.type === type)\r\n\t\t\t\treturn part.setId;\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the colors for a part type.\r\n\t *\r\n\t * @param {String} type\r\n\t *\r\n\t * @returns {Array<Number>|null}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tgetPartSetColorIds(type)\r\n\t{\r\n\t\tfor (let part of this.parts)\r\n\t\t\tif (part.type === type)\r\n\t\t\t\treturn part.colorIds;\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses our figure string into parts.\r\n\t *\r\n\t * @param {String} figure\r\n\t *\r\n\t * @private\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tparse(figure)\r\n\t{\r\n\t\tfor (let part of figure.split(\".\"))\r\n\t\t{\r\n\t\t\tlet data = part.split(\"-\");\r\n\t\t\tlet type = data.shift();\r\n\t\t\tlet setId = parseInt(data.shift());\r\n\t\t\tlet colors = data.map(color => parseInt(color));\r\n\r\n\t\t\tthis.parts.push(new AvatarFigurePart(type, setId, colors));\r\n\t\t}\r\n\r\n\t\tthis.parts.sort((a, b) => a.type.localeCompare(b.type));\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a type from figure.\r\n\t *\r\n\t * @param {String} type\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tremoveType(type)\r\n\t{\r\n\t\tthis.parts = this.parts.filter(part => part.type !== type);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the String representation of this figure.\r\n\t *\r\n\t * @returns {String}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\ttoString()\r\n\t{\r\n\t\treturn this.parts.map(part => part.toString()).join(\".\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Class AvatarFigurePart.\r\n *\r\n * @author Bas Milius <bas@mili.us>\r\n * @since 2018-05-20\r\n */\r\nexport class AvatarFigurePart\r\n{\r\n\r\n\t/**\r\n\t * Gets the color ids.\r\n\t *\r\n\t * @returns {Array<Number>}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tget colorIds()\r\n\t{\r\n\t\treturn this._colorIds;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the set id.\r\n\t *\r\n\t * @returns {Number}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tget setId()\r\n\t{\r\n\t\treturn this._setId;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the type.\r\n\t *\r\n\t * @returns {String}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tget type()\r\n\t{\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * AvatarFigurePart Constructor.\r\n\t *\r\n\t * @param {String} type\r\n\t * @param {Number} setId\r\n\t * @param {Array<Number>} colorIds\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\tconstructor(type, setId, colorIds)\r\n\t{\r\n\t\tthis._type = type;\r\n\t\tthis._setId = setId;\r\n\t\tthis._colorIds = colorIds;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the String representation of this figure part.\r\n\t *\r\n\t * @returns {String}\r\n\t *\r\n\t * @author Bas Milius <bas@mili.us>\r\n\t * @since 2018-05-20\r\n\t */\r\n\ttoString()\r\n\t{\r\n\t\treturn [this.type, this.setId, ...this.colorIds].join(\"-\");\r\n\t}\r\n\r\n}\r\n","export function parseActions(data)\r\n{\r\n\tlet actions = [];\r\n\r\n\tdata.querySelectorAll(\"action\").forEach(action =>\r\n\t{\r\n\t\tlet definition = new ActionDefinition(\r\n\t\t\taction.getAttribute(\"id\"),\r\n\t\t\taction.getAttribute(\"state\"),\r\n\t\t\tparseInt(action.getAttribute(\"precedence\")),\r\n\t\t\taction.getAttribute(\"activepartset\"),\r\n\t\t\taction.getAttribute(\"assetpartdefinition\"),\r\n\t\t\taction.getAttribute(\"lay\"),\r\n\t\t\taction.getAttribute(\"geometrytype\"),\r\n\t\t\taction.getAttribute(\"main\") === \"1\",\r\n\t\t\taction.getAttribute(\"isdefault\") === \"1\",\r\n\t\t\taction.getAttribute(\"animation\") === \"1\",\r\n\t\t\taction.getAttribute(\"startfromframezero\") === \"true\",\r\n\t\t\taction.getAttribute(\"preventheadturn\") === \"true\",\r\n\t\t\t(action.getAttribute(\"prevents\") || \"\").split(\",\").filter(p => p !== \"\")\r\n\t\t);\r\n\r\n\t\taction.querySelectorAll(\"param\").forEach(param =>\r\n\t\t{\r\n\t\t\tlet id = param.getAttribute(\"id\");\r\n\t\t\tlet value = param.getAttribute(\"value\");\r\n\r\n\t\t\tif (id === \"default\")\r\n\t\t\t\tdefinition.defaultParam = value;\r\n\t\t\telse\r\n\t\t\t\tdefinition.params[id] = value;\r\n\t\t});\r\n\r\n\t\taction.querySelectorAll(\"type\").forEach(type =>\r\n\t\t{\r\n\t\t\tlet typeDefinition = new ActionType(\r\n\t\t\t\tparseInt(type.getAttribute(\"id\")),\r\n\t\t\t\tparseInt(type.getAttribute(\"value\")),\r\n\t\t\t\t(type.getAttribute(\"prevents\") || \"\").split(\",\").filter(p => p !== \"\"),\r\n\t\t\t\ttype.getAttribute(\"preventheadturn\") === \"1\",\r\n\t\t\t\ttype.getAttribute(\"animated\") === \"1\"\r\n\t\t\t);\r\n\r\n\t\t\tdefinition.types[typeDefinition.id] = typeDefinition;\r\n\t\t});\r\n\r\n\t\tactions.push(definition);\r\n\t});\r\n\r\n\treturn actions;\r\n}\r\n\r\nexport class ActionDefinition\r\n{\r\n\r\n\tconstructor(id, state, precedence, activePartSet, assetPartDefinition, lay, geometryType, main, isDefault, animation, startFromFrameZero, preventHeadTurn, prevents)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.state = state;\r\n\t\tthis.precedence = precedence;\r\n\t\tthis.activePartSet = activePartSet;\r\n\t\tthis.assetPartDefinition = assetPartDefinition;\r\n\t\tthis.lay = lay;\r\n\t\tthis.geometryType = geometryType;\r\n\t\tthis.main = main;\r\n\t\tthis.isDefault = isDefault;\r\n\t\tthis.animation = animation;\r\n\t\tthis.startFromFrameZero = startFromFrameZero;\r\n\t\tthis.preventHeadTurn = preventHeadTurn;\r\n\t\tthis.prevents = prevents;\r\n\r\n\t\tthis.defaultParam = null;\r\n\r\n\t\tthis.params = {};\r\n\t\tthis.types = {};\r\n\t}\r\n\r\n}\r\n\r\nexport class ActionType\r\n{\r\n\r\n\tconstructor(id, value, prevents, preventHeadTurn, animated)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.value = isNaN(value) ? id : value;\r\n\t\tthis.prevents = prevents;\r\n\t\tthis.preventHeadTurn = preventHeadTurn;\r\n\t\tthis.animated = animated;\r\n\t}\r\n\r\n}\r\n","import { AvatarBodyPart } from \"./shared.js\";\r\n\r\nexport function parseAnimations(data)\r\n{\r\n\tlet animations = [];\r\n\r\n\tdata.querySelectorAll(\"action\").forEach(action =>\r\n\t{\r\n\t\tlet definition = new AnimationActionDefinition(action.getAttribute(\"id\"));\r\n\r\n\t\taction.querySelectorAll(\"offsets frame\").forEach(frame =>\r\n\t\t{\r\n\t\t\tconst number = parseInt(frame.getAttribute(\"id\"));\r\n\t\t\tlet fDef = new AnimationActionOffsetFrameDefinition(number);\r\n\r\n\t\t\tframe.querySelectorAll(\"directions direction\").forEach(direction =>\r\n\t\t\t{\r\n\t\t\t\tconst dir = parseInt(direction.getAttribute(\"id\"));\r\n\t\t\t\tlet dDef = new AnimationActionOffsetFrameDirectionDefinition(dir);\r\n\r\n\t\t\t\tdirection.querySelectorAll(\"bodypart\").forEach(bodypart =>\r\n\t\t\t\t{\r\n\t\t\t\t\tconst bp = new AvatarBodyPart(bodypart.getAttribute(\"id\"));\r\n\r\n\t\t\t\t\tbp.dx = parseInt(bodypart.getAttribute(\"dx\"));\r\n\t\t\t\t\tbp.dy = parseInt(bodypart.getAttribute(\"dy\"));\r\n\r\n\t\t\t\t\tdDef.bodyparts.push(bp);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfDef.directions.push(dDef);\r\n\t\t\t});\r\n\r\n\t\t\tdefinition.offsets.push(fDef);\r\n\t\t});\r\n\r\n\t\taction.querySelectorAll(\"part\").forEach(part =>\r\n\t\t{\r\n\t\t\tlet pDef = new AnimationActionPartDefinition(part.getAttribute(\"set-type\"));\r\n\r\n\t\t\tpart.querySelectorAll(\"frame\").forEach(frame =>\r\n\t\t\t{\r\n\t\t\t\tfor (let i = 0; i < parseInt(frame.getAttribute(\"repeats\") || 1); i++)\r\n\t\t\t\t\tpDef.frames.push(new AnimationActionPartFrameDefinition(parseInt(frame.getAttribute(\"number\")), frame.getAttribute(\"assetpartdefinition\")));\r\n\t\t\t});\r\n\r\n\t\t\tdefinition.parts.push(pDef);\r\n\t\t});\r\n\r\n\t\tanimations.push(definition);\r\n\t});\r\n\r\n\treturn animations;\r\n}\r\n\r\nexport class AnimationActionDefinition\r\n{\r\n\r\n\tconstructor(id)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.offsets = [];\r\n\t\tthis.parts = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AnimationActionOffsetFrameDefinition\r\n{\r\n\r\n\tconstructor(number)\r\n\t{\r\n\t\tthis.number = number;\r\n\t\tthis.directions = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AnimationActionOffsetFrameDirectionDefinition\r\n{\r\n\r\n\tconstructor(direction)\r\n\t{\r\n\t\tthis.direction = direction;\r\n\t\tthis.bodyparts = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AnimationActionPartDefinition\r\n{\r\n\r\n\tconstructor(setType)\r\n\t{\r\n\t\tthis.setType = setType;\r\n\t\tthis.frames = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AnimationActionPartFrameDefinition\r\n{\r\n\r\n\tconstructor(number, partDefinition)\r\n\t{\r\n\t\tthis.number = number;\r\n\t\tthis.partDefinition = partDefinition;\r\n\t}\r\n\r\n}\r\n","import { AvatarColor, AvatarPart, AvatarSet, AvatarSetType } from \"./shared.js\";\r\n\r\nexport function parseFiguredata(data)\r\n{\r\n\tconst colors = [];\r\n\tconst settypes = [];\r\n\r\n\tdata.querySelectorAll(\"colors palette\").forEach(palette =>\r\n\t{\r\n\t\tconst paletteId = parseInt(palette.getAttribute(\"id\"));\r\n\r\n\t\tpalette.querySelectorAll(\"color\").forEach(color =>\r\n\t\t{\r\n\t\t\tcolors.push(new AvatarColor(\r\n\t\t\t\tpaletteId,\r\n\t\t\t\tparseInt(color.getAttribute(\"id\")),\r\n\t\t\t\tparseInt(color.getAttribute(\"index\")),\r\n\t\t\t\tcolor.getAttribute(\"club\") !== \"0\",\r\n\t\t\t\tcolor.getAttribute(\"selectable\") === \"1\",\r\n\t\t\t\tcolor.textContent\r\n\t\t\t));\r\n\t\t});\r\n\t});\r\n\r\n\tdata.querySelectorAll(\"sets settype\").forEach(settype =>\r\n\t{\r\n\t\tconst stDef = new AvatarSetType(settype.getAttribute(\"type\"), parseInt(settype.getAttribute(\"paletteid\")));\r\n\r\n\t\tsettype.querySelectorAll(\"set\").forEach(set =>\r\n\t\t{\r\n\t\t\tconst sDef = new AvatarSet(\r\n\t\t\t\tparseInt(set.getAttribute(\"id\")),\r\n\t\t\t\tset.getAttribute(\"gender\"),\r\n\t\t\t\tset.getAttribute(\"club\") !== \"0\",\r\n\t\t\t\tset.getAttribute(\"colorable\") !== \"0\",\r\n\t\t\t\tset.getAttribute(\"selectable\") !== \"0\",\r\n\t\t\t\tset.getAttribute(\"preselectable\") !== \"0\"\r\n\t\t\t);\r\n\r\n\t\t\tset.querySelectorAll(\"hiddenlayers layer\").forEach(layer =>\r\n\t\t\t{\r\n\t\t\t\tif (sDef.hiddenLayers === undefined)\r\n\t\t\t\t\tsDef.hiddenLayers = [];\r\n\r\n\t\t\t\tsDef.hiddenLayers.push(layer.getAttribute(\"parttype\"));\r\n\t\t\t});\r\n\r\n\t\t\tset.querySelectorAll(\"part\").forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tif (sDef.parts === undefined)\r\n\t\t\t\t\tsDef.parts = [];\r\n\r\n\t\t\t\tsDef.parts.push(new AvatarPart(\r\n\t\t\t\t\tparseInt(part.getAttribute(\"id\")),\r\n\t\t\t\t\tpart.getAttribute(\"type\"),\r\n\t\t\t\t\tparseInt(part.getAttribute(\"index\")),\r\n\t\t\t\t\tpart.getAttribute(\"colorable\") !== \"0\",\r\n\t\t\t\t\tparseInt(part.getAttribute(\"colorindex\"))\r\n\t\t\t\t));\r\n\t\t\t});\r\n\r\n\t\t\tstDef.sets.push(sDef);\r\n\t\t});\r\n\r\n\t\tsettypes.push(stDef);\r\n\t});\r\n\r\n\treturn new AvatarFigureData(colors, settypes);\r\n}\r\n\r\nclass AvatarFigureData\r\n{\r\n\r\n\tconstructor(colors, settypes)\r\n\t{\r\n\t\tthis.colors = colors;\r\n\t\tthis.settypes = settypes;\r\n\t}\r\n\r\n\tgetSetType(settype)\r\n\t{\r\n\t\treturn this.settypes.find(s => s.type === settype);\r\n\t}\r\n\r\n}\r\n","import { AvatarConfig } from \"./config.js\";\r\n\r\nexport const avatarConfig = new AvatarConfig();\r\n\r\nexport class AvatarBodyPart\r\n{\r\n\r\n\tconstructor(id)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.dx = 0;\r\n\t\tthis.dy = 0;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.z = 0.0;\r\n\t\tthis.radius = 0;\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarColor\r\n{\r\n\r\n\tconstructor(paletteId, colorId, index, isClub, isSelectable, color)\r\n\t{\r\n\t\tthis.paletteId = paletteId;\r\n\t\tthis.colorId = colorId;\r\n\t\tthis.index = index;\r\n\t\tthis.isClub = isClub;\r\n\t\tthis.isSelectable = isSelectable;\r\n\t\tthis.color = parseInt(`0x${color}`);\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarLibrary\r\n{\r\n\r\n\tconstructor(id, revision)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.revision = revision;\r\n\t\tthis.parts = [];\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarPart\r\n{\r\n\r\n\tconstructor(id, type, index, isColorable, colorIndex)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.type = type;\r\n\t\tthis.index = index;\r\n\t\tthis.isColorable = isColorable;\r\n\t\tthis.colorIndex = colorIndex;\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarSet\r\n{\r\n\r\n\tconstructor(id, gender, isClub, isColorable, isSelectable, isPreSelectable)\r\n\t{\r\n\t\tthis.id = id;\r\n\t\tthis.gender = gender;\r\n\t\tthis.isClub = isClub;\r\n\t\tthis.isColorable = isColorable;\r\n\t\tthis.isSelectable = isSelectable;\r\n\t\tthis.isPreSelectable = isPreSelectable;\r\n\r\n\t\tthis.hiddenLayers = undefined;\r\n\t\tthis.parts = undefined;\r\n\t}\r\n\r\n}\r\n\r\nexport class AvatarSetType\r\n{\r\n\r\n\tconstructor(type, paletteId)\r\n\t{\r\n\t\tthis.type = type;\r\n\t\tthis.paletteId = paletteId;\r\n\t\tthis.sets = [];\r\n\t}\r\n\r\n\tgetSet(setId)\r\n\t{\r\n\t\treturn this.sets.find(set => set.id === setId);\r\n\t}\r\n\r\n}\r\n\r\nexport function getUsedAvatarLibraries(avatar)\r\n{\r\n\tconst libraries = [];\r\n\r\n\tavatar.partDefinitions.forEach(partDefinition =>\r\n\t{\r\n\t\tlet part = partDefinition.parts[0];\r\n\t\tlet library = avatarConfig.figuremap.querySelector(`part[id=\"${part.id}\"][type=\"${part.type}\"]`);\r\n\r\n\t\tif (library === null || library.parentNode === null)\r\n\t\t\treturn;\r\n\r\n\t\tlibrary = library.parentNode;\r\n\t\tlibraries.push(library.getAttribute(\"id\").toLowerCase());\r\n\t});\r\n\r\n\treturn libraries.unique();\r\n}\r\n","import { InitializerLoader } from \"../../application.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { parseActions } from \"./action.js\";\r\nimport { parseAnimations } from \"./animation.js\";\r\nimport { parseFiguredata } from \"./figuredata.js\";\r\n\r\nexport class AvatarConfig\r\n{\r\n\r\n\tget actions()\r\n\t{\r\n\t\treturn this._actions;\r\n\t}\r\n\r\n\tget animations()\r\n\t{\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\tget draworder()\r\n\t{\r\n\t\treturn this._draworder;\r\n\t}\r\n\r\n\tget effectmap()\r\n\t{\r\n\t\treturn this._effectmap;\r\n\t}\r\n\r\n\tget figuredata()\r\n\t{\r\n\t\treturn this._figuredata;\r\n\t}\r\n\r\n\tget figuremap()\r\n\t{\r\n\t\treturn this._figuremap;\r\n\t}\r\n\r\n\tget geometry()\r\n\t{\r\n\t\treturn this._geometry;\r\n\t}\r\n\r\n\tget offsets()\r\n\t{\r\n\t\treturn this._offsets;\r\n\t}\r\n\r\n\tget partsets()\r\n\t{\r\n\t\treturn this._partsets;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._actions = null;\r\n\t\tthis._animations = null;\r\n\t\tthis._draworder = null;\r\n\t\tthis._effectmap = null;\r\n\t\tthis._figuredata = null;\r\n\t\tthis._figuremap = null;\r\n\t\tthis._geometry = null;\r\n\t\tthis._offsets = null;\r\n\t\tthis._partsets = null;\r\n\r\n\t\tthis.libraries = {};\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingPromises = {};\r\n\t}\r\n\r\n\tgetLibrary(library)\r\n\t{\r\n\t\treturn this.libraries[library] || undefined;\r\n\t}\r\n\r\n\tloadConfig(config, loader)\r\n\t{\r\n\t\tconst configUrl = getDeliveryAssetsUrl(`/clothing/${config}.xml`);\r\n\r\n\t\tloader.add(configUrl).on(\"complete\", () => loader.resources[configUrl] !== undefined ? this.onConfigLoaded(config, loader.resources[configUrl].data) : undefined);\r\n\t}\r\n\r\n\tloadLibrary(library, loader = this.loader)\r\n\t{\r\n\t\tconst isMainLoader = loader instanceof InitializerLoader;\r\n\t\tconst libraryUrl = getDeliveryAssetsUrl(`/clothing/lib/${library}.json`);\r\n\r\n\t\tif (isMainLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () => loader.resources[libraryUrl] !== undefined ? this.libraries[library] = loader.resources[libraryUrl] : undefined);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (this.loadingPromises[library] !== undefined)\r\n\t\t\t\treturn this.loadingPromises[library];\r\n\r\n\t\t\treturn this.loadingPromises[library] = new Promise(resolve =>\r\n\t\t\t{\r\n\t\t\t\tloader\r\n\t\t\t\t\t.reset()\r\n\t\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (loader.resources[libraryUrl] === undefined)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tconsole.log(\"avatar:config\", `Downloaded clothing library ${library}!`);\r\n\r\n\t\t\t\t\t\tresolve(this.libraries[library] = loader.resources[libraryUrl]);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.load();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tonConfigLoaded(config, data)\r\n\t{\r\n\t\tswitch (config)\r\n\t\t{\r\n\t\t\tcase \"actions\":\r\n\t\t\t\tthis._actions = parseActions(data);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"animations\":\r\n\t\t\t\tthis._animations = parseAnimations(data);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"figuredata\":\r\n\t\t\t\tthis._figuredata = parseFiguredata(data);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis[`_${config}`] = data;\r\n\t\t\t\tconsole.log(\"avatar:config\", `No config handler for ${config}!`);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tgetAction(action)\r\n\t{\r\n\t\treturn this._actions.find(a => a.id === action);\r\n\t}\r\n\r\n}\r\n","import { setInteractive } from \"../../core/pixi-utils.js\";\r\nimport { AvatarFigure } from \"./figure.js\";\r\nimport { avatarConfig, getUsedAvatarLibraries } from \"./shared.js\";\r\n\r\nexport class AvatarImage extends PIXI.Container\r\n{\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this._figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tthis._figure = typeof value === \"string\" ? new AvatarFigure(value) : value;\r\n\t\tthis.onFigureChanged();\r\n\t}\r\n\r\n\tconstructor(figure = \"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\", geometry = \"vertical\", avatarSet = \"full\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tsetInteractive(this);\r\n\r\n\t\tthis.canPoof = false;\r\n\t\tthis.id = \"avatar-\" + window.performance.now();\r\n\t\tthis.partContainer = new PIXI.Container();\r\n\t\tthis.size = [0, 0];\r\n\r\n\t\tthis.addChild(this.partContainer);\r\n\r\n\t\tthis.actions = [avatarConfig.getAction(\"Default\")];\r\n\r\n\t\tthis.avatarSet = avatarSet;\r\n\t\tthis.direction = 2;\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.headDirection = this.direction;\r\n\r\n\t\tthis.partDefinitions = {};\r\n\t\tthis.sprites = {};\r\n\r\n\t\tthis.ghost = true;\r\n\r\n\t\tthis.isBuilding = false;\r\n\t\tthis.isDownloading = false;\r\n\t\tthis.isGatheringParts = false;\r\n\r\n\t\tthis.decideGeometry();\r\n\t\tthis.figure = figure;\r\n\t\tthis.build();\r\n\r\n\t\tlet c = new PIXI.Graphics();\r\n\t\tc.fillColor = 0xFF0000;\r\n\t\tc.drawRect(0, 0, this.size[0], this.size[1]);\r\n\t\tthis.addChild(c);\r\n\t}\r\n\r\n\tbuild()\r\n\t{\r\n\t\tif (this.isBuilding)\r\n\t\t\treturn;\r\n\r\n\t\tthis.isBuilding = true;\r\n\r\n\t\tconst usedLibraries = getUsedAvatarLibraries(this).filter(lib => avatarConfig.getLibrary(lib) === undefined);\r\n\r\n\t\tif (usedLibraries.length > 0 && !this.isDownloading)\r\n\t\t{\r\n\t\t\tthis.ghost = true;\r\n\t\t\tthis.isDownloading = true;\r\n\r\n\t\t\tconst download = () =>\r\n\t\t\t{\r\n\t\t\t\tif (usedLibraries.length === 0)\r\n\t\t\t\t\treturn this.isDownloading = false;\r\n\r\n\t\t\t\tavatarConfig\r\n\t\t\t\t\t.loadLibrary(usedLibraries.shift())\r\n\t\t\t\t\t.then(download);\r\n\t\t\t};\r\n\r\n\t\t\tdownload();\r\n\t\t}\r\n\t\telse if (!this.isDownloading)\r\n\t\t{\r\n\t\t\tthis.ghost = false;\r\n\t\t}\r\n\r\n\t\tthis.decidePartStates();\r\n\r\n\t\tthis.isBuilding = false;\r\n\t}\r\n\r\n\tdecidePartStates()\r\n\t{\r\n\t}\r\n\r\n\tdecideGeometry()\r\n\t{\r\n\t\tconst geometry = avatarConfig.geometry.querySelector(`canvas[scale=\"h\"] geometry[id=\"${this.geometry}\"]`);\r\n\t\tconst width = parseInt(geometry.getAttribute(\"width\"));\r\n\t\tconst height = this.geometry === \"head\" ? width : parseInt(geometry.getAttribute(\"height\"));\r\n\r\n\t\tthis.size = [width, height];\r\n\t}\r\n\r\n\tgatherParts()\r\n\t{\r\n\t\tif (this.isBusy())\r\n\t\t\treturn;\r\n\r\n\t\tthis.isGatheringParts = true;\r\n\r\n\t\tthis.figure.parts.forEach(part =>\r\n\t\t{\r\n\t\t\tconst settype = avatarConfig.figuredata.getSetType(part.type);\r\n\r\n\t\t\tif (settype === undefined)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst set = settype.getSet(part.setId);\r\n\t\t\tconst hiddenLayers = (set.hiddenLayers || []);\r\n\r\n\t\t\tset.parts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tif (this.partDefinitions[part.type] === undefined)\r\n\t\t\t\t\tthis.partDefinitions[part.type] = {hiddenLayers, parts: [], set};\r\n\r\n\t\t\t\tthis.partDefinitions[part.type].parts.push(part);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tisBusy()\r\n\t{\r\n\t\treturn this.isGatheringParts;\r\n\t}\r\n\r\n\tonFigureChanged()\r\n\t{\r\n\t\tthis.gatherParts();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { AvatarImage } from \"./avatar.js\";\r\nimport { avatarConfig } from \"./shared.js\";\r\n\r\nexport const avatarResources = {\r\n\tpoof: {\r\n\t\t\"1_1\": \"./resource/image/avatar/poof/1-1.png\",\r\n\t\t\"1_2\": \"./resource/image/avatar/poof/1-2.png\",\r\n\t\t\"1_3\": \"./resource/image/avatar/poof/1-3.png\",\r\n\t\t\"1_4\": \"./resource/image/avatar/poof/1-4.png\",\r\n\t\t\"2_1\": \"./resource/image/avatar/poof/2-1.png\",\r\n\t\t\"2_2\": \"./resource/image/avatar/poof/2-2.png\",\r\n\t\t\"2_3\": \"./resource/image/avatar/poof/2-3.png\",\r\n\t\t\"2_4\": \"./resource/image/avatar/poof/2-4.png\",\r\n\t\t\"3_1\": \"./resource/image/avatar/poof/3-1.png\",\r\n\t\t\"3_2\": \"./resource/image/avatar/poof/3-2.png\",\r\n\t\t\"3_3\": \"./resource/image/avatar/poof/3-3.png\",\r\n\t\t\"3_4\": \"./resource/image/avatar/poof/3-4.png\",\r\n\t\t\"4_1\": \"./resource/image/avatar/poof/4-1.png\",\r\n\t\t\"4_2\": \"./resource/image/avatar/poof/4-2.png\",\r\n\t\t\"4_3\": \"./resource/image/avatar/poof/4-3.png\",\r\n\t\t\"4_4\": \"./resource/image/avatar/poof/4-4.png\"\r\n\t}\r\n};\r\n\r\nexport class AvatarManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatars = [];\r\n\t\tthis.lastUpdate = 0;\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => application.ticker.add(() => this.onGameTick()));\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tavatarConfig.loadConfig(\"actions\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"animations\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"draworder\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"effectmap\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"figuredata\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"figuremap\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"geometry\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"offsets\", this.loader);\r\n\t\tavatarConfig.loadConfig(\"partsets\", this.loader);\r\n\r\n\t\tavatarConfig.loadLibrary(\"hh_human_acc_chest\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_acc_eye\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_acc_face\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_acc_head\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_acc_waist\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_body\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_face\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_hair\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_hats\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_item\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_leg\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_shirt\", this.loader);\r\n\t\tavatarConfig.loadLibrary(\"hh_human_shoe\", this.loader);\r\n\r\n\t\tavatarResources.poof.forEach(image => this.loader.add(image));\r\n\t}\r\n\r\n\tnewAvatar(...options)\r\n\t{\r\n\t\tconst avatar = new AvatarImage(...options);\r\n\r\n\t\tthis.avatars.push(avatar);\r\n\r\n\t\treturn avatar;\r\n\t}\r\n\r\n\tremoveAvatar(avatar)\r\n\t{\r\n\t\tthis.avatars = this.avatars.filter(a => a.id !== avatar.id);\r\n\t}\r\n\r\n\tonGameTick()\r\n\t{\r\n\t\tif (this.lastUpdate === -1 || (application.ticker.lastTime - this.lastUpdate) > 90)\r\n\t\t{\r\n\t\t\tthis.lastUpdate = application.ticker.lastTime;\r\n\r\n\t\t\tthis.avatars.forEach(avatar => avatar.build());\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst configJson = \"./resource/config/config.json\";\r\n\r\nexport class ConfigManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.config = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(configJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onConfigLoaded(application.getResource(configJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.config);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.config));\r\n\t}\r\n\r\n\tonConfigLoaded(config)\r\n\t{\r\n\t\tif (config === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.config = config.data;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { ConfigManager } from \"../config/config.js\";\r\n\r\nconst textsJson = \"./resource/config/texts.json\";\r\n\r\nexport class I18nManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.texts = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(textsJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onTextsLoaded(application.getResource(textsJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.texts);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.text, application.getManager(ConfigManager).config));\r\n\t}\r\n\r\n\tonTextsLoaded(texts)\r\n\t{\r\n\t\tif (texts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.texts = texts.data;\r\n\t}\r\n\r\n}\r\n","import { removeHtml } from \"./core/dom-utils.js\";\r\n\r\nlet frame = 0;\r\n\r\nconst stageElement = \"main#stage-mount\";\r\n\r\nexport class Display extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget frame()\r\n\t{\r\n\t\treturn frame;\r\n\t}\r\n\r\n\tget renderer()\r\n\t{\r\n\t\treturn this.app.renderer;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.app.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.app.ticker;\r\n\t}\r\n\r\n\tget view()\r\n\t{\r\n\t\treturn this.app.view;\r\n\t}\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this.renderer.height / this.dpi;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this.renderer.width / this.dpi;\r\n\t}\r\n\r\n\tget size()\r\n\t{\r\n\t\treturn {width: this.width, height: this.height};\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.dpi = window.devicePixelRatio;\r\n\t\tthis.mount = document.querySelector(stageElement);\r\n\r\n\t\tif (this.mount === null)\r\n\t\t\tthrow new Error(\"Display mount not found!\");\r\n\r\n\t\tremoveHtml(this.mount);\r\n\r\n\t\tthis.initApp();\r\n\t\tthis.initEvents();\r\n\r\n\t\tthis.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tinitApp()\r\n\t{\r\n\t\tthis.app = new PIXI.Application({\r\n\t\t\theight: window.innerHeight,\r\n\t\t\twidth: window.innerWidth,\r\n\t\t\tantialiasing: false,\r\n\t\t\ttransparent: false,\r\n\t\t\tresolution: this.dpi,\r\n\t\t\troundPixels: false\r\n\t\t});\r\n\r\n\t\tthis.mount.appendChild(this.view);\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n\tinitEvents()\r\n\t{\r\n\t\twindow.addEventListener(\"resize\", () => this.onWindowResize());\r\n\t}\r\n\r\n\tonTick(delta)\r\n\t{\r\n\t\tframe++;\r\n\r\n\t\tthis.emit(\"tick\", delta);\r\n\r\n\t\tif (frame % 12 === 0)\r\n\t\t\tthis.emit(\"tick-update\", delta);\r\n\r\n\t\tthis.stage.updateLayerOrder();\r\n\t}\r\n\r\n\tonWindowResize()\r\n\t{\r\n\t\tthis.renderer.resize(window.innerWidth, window.innerHeight);\r\n\t\tthis.emit(\"resize\");\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n}\r\n","/**\r\n * Applies styles to an element.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Object} styles\r\n */\r\nexport function applyStyles(element, styles)\r\n{\r\n\tstyles.forEach((value, key) => element.style.setProperty(key, value));\r\n}\r\n\r\n/**\r\n * Creates an element.\r\n *\r\n * @param {String} tagName\r\n * @param {Function} callback\r\n *\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tagName, callback = null)\r\n{\r\n\tconst element = document.createElement(tagName);\r\n\r\n\tif (callback !== null)\r\n\t\tcallback(element);\r\n\r\n\treturn element;\r\n}\r\n\r\n/**\r\n * Removes contents.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nexport function removeHtml(element)\r\n{\r\n\telement.innerHTML = \"\";\r\n}\r\n\r\n/**\r\n * Query Selector All to Array.\r\n *\r\n * @param selector\r\n * @param container\r\n *\r\n * @returns {Array<Element>}\r\n */\r\nexport function querySelectorAllArray(selector, container = document)\r\n{\r\n\treturn [].slice.call(container.querySelectorAll(selector));\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nconst memenuSize = 60;\r\nconst memenuSizeHalf = Math.floor(memenuSize / 2);\r\n\r\nexport class MeMenu extends PIXI.Container\r\n{\r\n\r\n\tget avatar()\r\n\t{\r\n\t\treturn this._avatar;\r\n\t}\r\n\r\n\tget chatBubble()\r\n\t{\r\n\t\treturn this._chatBubble;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._avatarHolder = new PIXI.Graphics();\r\n\t\tthis._avatarHolder.buttonMode = true;\r\n\t\tthis._avatarHolder.interactive = true;\r\n\t\tthis._avatarHolder.on(\"pointerover\", () => this.onAvatarHover());\r\n\t\tthis._avatarHolder.on(\"pointerout\", () => this.onAvatarLeave());\r\n\r\n\t\tthis._avatar = application.getManager(AvatarManager).newAvatar(\"\", \"vertical\", \"head\");\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.headDirection = 3;\r\n\t\tthis.avatar.position.x = -15;\r\n\t\tthis.avatar.position.y = -11;\r\n\t\tthis._avatarHolder.addChild(this.avatar);\r\n\r\n\t\tthis._chatBubble = new ChatBubble();\r\n\t\tthis.chatBubble.position.x = memenuSize + 8;\r\n\t\tthis.chatBubble.position.y = 8;\r\n\t\tthis.chatBubble.on(\"pointerover\", () => this.onChatBubbleHover());\r\n\t\tthis.chatBubble.on(\"pointerout\", () => this.onChatBubbleLeave());\r\n\r\n\t\tthis.addChild(this._avatarHolder);\r\n\t\tthis.addChild(this.chatBubble);\r\n\r\n\t\tthis.draw();\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\r\n\t\tsetTimeout(() => this.avatar.addAction(\"GestureSmile\"), 500);\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.position.x = 16;\r\n\t\tthis.position.y = application.display.height - (memenuSize + 16);\r\n\r\n\t\tthis._avatarHolder.clear();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x000000, 0.25);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf + 2, memenuSizeHalf + 2);\r\n\t\tthis._avatarHolder.endFill();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x0C3A65);\r\n\t\tthis._avatarHolder.lineStyle(4, 0x244d74);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf, memenuSizeHalf);\r\n\t\tthis._avatarHolder.endFill();\r\n\t}\r\n\r\n\tonAvatarHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"GestureSurprised\");\r\n\t}\r\n\r\n\tonAvatarLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSurprised\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n\tonChatBubbleHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"Talk\");\r\n\t}\r\n\r\n\tonChatBubbleLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"Talk\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n}\r\n\r\nclass ChatBubble extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.imLeft = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.left).texture); // 17x44\r\n\t\tthis.imMiddle = new PIXI.extras.TilingSprite(application.getResource(interfaceResources.chatBubble.middle).texture); // 1x44\r\n\t\tthis.imRight = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.right).texture); // 12x44\r\n\r\n\t\tthis.imLeft.height = 44;\r\n\t\tthis.imMiddle.height = 44;\r\n\t\tthis.imRight.height = 44;\r\n\r\n\t\tthis.addChild(this.imLeft);\r\n\t\tthis.addChild(this.imMiddle);\r\n\t\tthis.addChild(this.imRight);\r\n\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tlet textWidth = 100;\r\n\r\n\t\tthis.imLeft.position.x = 0;\r\n\t\tthis.imLeft.position.y = 0;\r\n\r\n\t\tthis.imMiddle.position.x = 17;\r\n\t\tthis.imMiddle.position.y = 0;\r\n\t\tthis.imMiddle.width = textWidth;\r\n\r\n\t\tthis.imRight.position.x = 17 + textWidth;\r\n\t\tthis.imRight.position.y = 0;\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n","import { Window } from \"./window.js\";\r\n\r\nexport const UI = {\r\n\tWindow\r\n};\r\n\r\nexport const Easings = {\r\n\tSwiftOut: [.55, 0, .1, 1]\r\n};\r\n","import { BottomBar, bottomBarHeight } from \"./bottombar.js\";\r\nimport { MeMenu } from \"./memenu.js\";\r\nimport { Easings } from \"../ui.js\";\r\n\r\nexport const interfaceResources = {\r\n\tchatBubble: {\r\n\t\tleft: \"./resource/image/interface/chat-bubble/left.png\",\r\n\t\tmiddle: \"./resource/image/interface/chat-bubble/middle.png\",\r\n\t\tright: \"./resource/image/interface/chat-bubble/right.png\"\r\n\t},\r\n\tbottomBar: {\r\n\t\tbackground: \"./resource/image/interface/bottom-bar/background.png\",\r\n\t\tnavigator: \"./resource/image/interface/bottom-bar/navigator.png\",\r\n\t\tfriends: \"./resource/image/interface/bottom-bar/friends.png\",\r\n\t\tfriendsInvited: \"./resource/image/interface/bottom-bar/friends-invited.png\",\r\n\t\tchat: \"./resource/image/interface/bottom-bar/chat.png\",\r\n\t\tchatMessages: \"./resource/image/interface/bottom-bar/chat-messages.png\",\r\n\t\tcatalogue: \"./resource/image/interface/bottom-bar/catalogue.png\",\r\n\t\tinventory: \"./resource/image/interface/bottom-bar/inventory.png\",\r\n\t\thelp: \"./resource/image/interface/bottom-bar/help.png\"\r\n\t}\r\n};\r\n\r\nexport class InterfaceContainer extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 100000;\r\n\r\n\t\tthis.init();\r\n\t\tthis.hello();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.bottomBar = new BottomBar();\r\n\t\tthis.addChild(this.bottomBar);\r\n\t}\r\n\r\n\thello()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this.bottomBar,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [this.bottomBar.y + bottomBarHeight, this.bottomBar.y]\r\n\t\t})\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { InterfaceContainer, interfaceResources } from \"./interface.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nlet localInterface;\r\n\r\nfunction initInterface()\r\n{\r\n\tlocalInterface = new InterfaceContainer();\r\n\r\n\tapplication.display.stage.addChild(localInterface);\r\n}\r\n\r\nexport class InterfaceManager extends Manager\r\n{\r\n\r\n\tget interface()\r\n\t{\r\n\t\treturn localInterface;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => initInterface());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(interfaceResources.bottomBar.background);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.catalogue);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chat);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chatMessages);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friends);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friendsInvited);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.help);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.inventory);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.navigator);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.left);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.middle);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.right);\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { tileHeightHalf, tileWidthHalf } from \"../room/shared.js\";\r\n\r\nconst furniResources = {\r\n\tloading: \"./resource/image/furni/loading.png\"\r\n};\r\n\r\nexport class Furni extends PIXI.Container\r\n{\r\n\r\n\tget loading()\r\n\t{\r\n\t\treturn this._loading;\r\n\t}\r\n\r\n\tset loading(value)\r\n\t{\r\n\t\tthis._loading = value;\r\n\t}\r\n\r\n\tconstructor(furniName)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.furniName = furniName;\r\n\r\n\t\tthis._loadingSprite = new PIXI.Sprite(application.getResource(furniResources.loading).texture);\r\n\t\tthis.addChild(this._loadingSprite);\r\n\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -(tileWidthHalf + 2),\r\n\t\t\ty: -(tileHeightHalf + 34)\r\n\t\t};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t}\r\n\r\n}\r\n\r\nexport class FurniManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(furniResources.loading);\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidth, tileWidthHalf } from \"./shared.js\";\r\n\r\nexport class TileCursor extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tthis.lineStyle(4, 0x000000, 0.2);\r\n\t\tthis.moveTo(points[0].x, points[0].y);\r\n\t\tthis.lineTo(points[1].x, points[1].y);\r\n\t\tthis.lineTo(points[2].x, points[2].y);\r\n\t\tthis.lineTo(points[3].x, points[3].y);\r\n\t\tthis.lineTo(points[0].x, points[0].y);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(4, 0xFFFFFF);\r\n\t\tthis.moveTo(points[0].x, points[0].y - 2);\r\n\t\tthis.lineTo(points[1].x, points[1].y - 2);\r\n\t\tthis.lineTo(points[2].x, points[2].y - 2);\r\n\t\tthis.lineTo(points[3].x, points[3].y - 2);\r\n\t\tthis.lineTo(points[0].x, points[0].y - 2);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n\thover(x, y, z)\r\n\t{\r\n\t\tthis.position.x = x;\r\n\t\tthis.position.y = y - 2;\r\n\t\tthis.z = z;\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -tileWidthHalf,\r\n\t\t\ty: -tileHeightHalf\r\n\t\t};\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\n\r\nexport class WallBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.doorHeight = 85;\r\n\t\tthis.floorThickness = floorThickness;\r\n\t\tthis.wallHeight = 115 + (top * tileHeight);\r\n\t\tthis.wallThickness = wallThickness;\r\n\t}\r\n\r\n}\r\n\r\nexport class WallColumn extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tlet hole = doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0x9697A1);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - (this.wallThickness / 2) - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0xB5B9C9);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallCorner extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(0, -this.wallHeight);\r\n\t\tthis.lineTo(this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight - this.wallThickness);\r\n\t\tthis.lineTo(-this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallRow extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tlet hole = doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0xBABECE);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x92939D);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(-this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../../core/pixi-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { TileCursor } from \"./cursor.js\";\r\nimport { getHighestAndLowest, getStairsType, getTileHeightIndex, getTileImplementation, hitAreaOffset, isDoor, needsWallC, needsWallR, tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\nimport { Tile, TileBase } from \"./tiles.js\";\r\nimport { WallColumn, WallCorner, WallRow } from \"./walls.js\";\r\n\r\nconst debugDoor = false;\r\nconst debugWalls = false;\r\n\r\nexport class RoomView extends PIXI.Container\r\n{\r\n\r\n\tget entities()\r\n\t{\r\n\t\treturn this._entities;\r\n\t}\r\n\r\n\tget heightmap()\r\n\t{\r\n\t\treturn this._heightmap;\r\n\t}\r\n\r\n\tget roomScale()\r\n\t{\r\n\t\treturn this.scale.x;\r\n\t}\r\n\r\n\tset roomScale(value)\r\n\t{\r\n\t\tthis.scale.x = value;\r\n\t\tthis.scale.y = value;\r\n\t}\r\n\r\n\tget tiles()\r\n\t{\r\n\t\treturn this._tiles;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 1000;\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._heightmap = {};\r\n\t\tthis._tiles = {};\r\n\r\n\t\tthis.columns = 0;\r\n\t\tthis.rows = 0;\r\n\r\n\t\tthis.floorThickness = 8;\r\n\t\tthis.wallThickness = 8;\r\n\r\n\t\tthis.highest = 0;\r\n\t\tthis.lowest = 0;\r\n\r\n\t\tthis.offsets = {x: 0, y: 0};\r\n\r\n\t\tthis.roomScale = 1;\r\n\t\tthis.tileCursor = new TileCursor();\r\n\t\tthis.tileCursor.visible = false;\r\n\r\n\t\tsimpleDraggable(this);\r\n\r\n\t\t// application.display.on(\"tick\", delta => this.rotation = this.rotation + (.036 * delta) % 1);\r\n\t}\r\n\r\n\tclearEverything()\r\n\t{\r\n\t\twhile (this.children[0])\r\n\t\t\tthis.removeChild(this.children[0]);\r\n\r\n\t\tthis.addChild(this.tileCursor);\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._tiles = {};\r\n\t}\r\n\r\n\tprepareHeightmap(floorplan)\r\n\t{\r\n\t\tthis.emit(\"room-view-emptied\");\r\n\r\n\t\tthis.clearEverything();\r\n\r\n\t\tconst tiles = this._heightmap = floorplan\r\n\t\t\t.trim()\r\n\t\t\t.split(\"\\n\")\r\n\t\t\t.map(row => row.split(\"\").map(char => getTileHeightIndex(char)));\r\n\r\n\t\tconst {highest, lowest} = getHighestAndLowest(this.heightmap);\r\n\t\tthis.highest = highest;\r\n\t\tthis.lowest = lowest;\r\n\r\n\t\tif (tiles.length === 0)\r\n\t\t\treturn;\r\n\r\n\t\tthis.columns = tiles[0].length;\r\n\t\tthis.rows = tiles.length;\r\n\r\n\t\tfor (let row = 0; row < tiles.length; row++)\r\n\t\t{\r\n\t\t\tthis._tiles[row] = {};\r\n\r\n\t\t\tfor (let column = 0; column < tiles[row].length; column++)\r\n\t\t\t{\r\n\t\t\t\tlet tileHeightLocal = this.getTileHeight(row, column);\r\n\r\n\t\t\t\tif (tileHeightLocal === null)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlet door = isDoor(tiles, row, column);\r\n\t\t\t\t// let doorDirection = door ? getDoorDirection(tiles, row, column) : null;\r\n\t\t\t\tlet stairsType = getStairsType(tiles, row, column);\r\n\t\t\t\tlet implementation = getTileImplementation(stairsType);\r\n\r\n\t\t\t\tlet wallC = needsWallC(tiles, row, column);\r\n\t\t\t\tlet wallR = needsWallR(tiles, row, column);\r\n\t\t\t\tlet wall = wallC || wallR;\r\n\r\n\t\t\t\tlet x = this.getX(row, column);\r\n\t\t\t\tlet y = this.getY(row, column);\r\n\t\t\t\tlet z = this.getRealZ(row, column, 1);\r\n\r\n\t\t\t\tif (wall)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet wallImplementations = [];\r\n\t\t\t\t\tlet isDoorColumn = isDoor(tiles, row - 1, column);\r\n\t\t\t\t\tlet isDoorRow = isDoor(tiles, row, column - 1);\r\n\t\t\t\t\tlet isADoor = isDoorColumn || isDoorRow;\r\n\t\t\t\t\tlet top = Math.abs(this.highest - tileHeightLocal);\r\n\r\n\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallCorner(this.floorThickness, this.wallThickness, top));\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const wi of wallImplementations)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.addChild(withInstance(wi, wall =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.entities.push(wall);\r\n\r\n\t\t\t\t\t\t\twall.x = x + tileWidthHalf;\r\n\t\t\t\t\t\t\twall.y = y + (stairsType !== undefined ? tileHeight : 0);\r\n\t\t\t\t\t\t\twall.z = this.getRealZ(row, column, isADoor ? 3 : 0);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.addChild(withInstance(new implementation(this.floorThickness), tile =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.entities.push(tile);\r\n\t\t\t\t\tthis._tiles[row][column] = tile;\r\n\r\n\t\t\t\t\ttile.row = row;\r\n\t\t\t\t\ttile.column = column;\r\n\r\n\t\t\t\t\tif (debugDoor && door)\r\n\t\t\t\t\t\ttile.tint = 0xFF0000;\r\n\r\n\t\t\t\t\tif (debugWalls)\r\n\t\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FFFF;\r\n\t\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FF00;\r\n\t\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x0000FF;\r\n\r\n\t\t\t\t\ttile.on(\"tile-click\", evt => this.onTileClick(evt));\r\n\t\t\t\t\ttile.on(\"tile-hover\", evt => this.onTileHover(evt));\r\n\t\t\t\t\ttile.on(\"tile-leave\", evt => this.onTileLeave(evt));\r\n\r\n\t\t\t\t\ttile.x = x;\r\n\t\t\t\t\ttile.y = y;\r\n\t\t\t\t\ttile.z = z;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.centerRoom();\r\n\r\n\t\tthis.position.x = Math.floor((application.display.width / 2) - (this.width / 2));\r\n\t\tthis.position.y = Math.floor((application.display.height / 2) - (this.height / 2 - 115));\r\n\r\n\t\tthis.hitArea = new PIXI.Rectangle(-hitAreaOffset, -hitAreaOffset, this.width + (hitAreaOffset * 2), this.height + (hitAreaOffset * 2));\r\n\r\n\t\tthis.emit(\"room-view-ready\");\r\n\t}\r\n\r\n\taddEntityToTile(entity, row, column, h)\r\n\t{\r\n\t\tthis.addChild(entity);\r\n\r\n\t\tthis.associateEntityToTile(entity, row, column, h);\r\n\t}\r\n\r\n\tassociateEntityToTile(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet pos = this.getEntityPosition(entity, row, column, h);\r\n\r\n\t\tentity.position.x = pos.x;\r\n\t\tentity.position.y = pos.y;\r\n\t\tentity.z = pos.z;\r\n\r\n\t\tthis.updateLayerOrder();\r\n\t}\r\n\r\n\tcenterEntity(entity, animate = true)\r\n\t{\r\n\t\tlet x = application.display.width / 2;\r\n\t\tlet y = application.display.height / 2;\r\n\r\n\t\tx -= Math.round(entity.x + entity.width / 2);\r\n\t\ty -= Math.round(entity.y + entity.height / 2);\r\n\r\n\t\tx = x - (x % 2);\r\n\r\n\t\tif (animate)\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 800,\r\n\t\t\t\teasing: \"easeInOutSine\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 45,\r\n\t\t\t\teasing: \"linear\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcenterRoom()\r\n\t{\r\n\t\tif (this.entities.length > 0)\r\n\t\t{\r\n\t\t\tlet xred = this.entities.reduce((acc, cur) => acc.x < cur.x ? acc : cur).x;\r\n\t\t\tlet yred = this.entities\r\n\t\t\t\t.filter(acc => acc instanceof TileBase)\r\n\t\t\t\t.reduce((acc, cur) => acc.y < cur.y ? acc : cur).y;\r\n\r\n\t\t\tthis.offsets.x = -xred;\r\n\t\t\tthis.offsets.y = -yred;\r\n\r\n\t\t\tthis.entities.forEach(entity =>\r\n\t\t\t{\r\n\t\t\t\tentity.x -= xred;\r\n\t\t\t\tentity.y -= yred;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetClosestTile(x, y)\r\n\t{\r\n\t}\r\n\r\n\tgetEntityPosition(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet offsets = {x: 0, y: 0};\r\n\t\tlet tile = this.getTile(row, column);\r\n\r\n\t\tif (entity.getRoomOffsets !== undefined)\r\n\t\t\toffsets = entity.getRoomOffsets();\r\n\r\n\t\tlet isStairs = !(tile instanceof Tile);\r\n\r\n\t\tlet x = (this.getX(row, column) + tileWidthHalf) + (offsets.x + this.offsets.x);\r\n\t\tlet y = (this.getY(row, column) + tileHeightHalf) + (offsets.y + this.offsets.y) + (tile && isStairs ? tileHeightHalf : 0);\r\n\t\tlet z = this.getZ(row, column + 2, 5) + h;\r\n\r\n\t\tif (isDoor(this.tiles, row, column))\r\n\t\t\tz = this.getRealZ(row, column, 4);\r\n\r\n\t\treturn {x, y, z, isStairs};\r\n\t}\r\n\r\n\tgetRandomTile()\r\n\t{\r\n\t\tlet row = Math.floor(Math.random() * this.rows);\r\n\t\tlet column = Math.floor(Math.random() * this.columns);\r\n\r\n\t\tif (!this.isValidTile(row, column))\r\n\t\t\treturn this.getRandomTile();\r\n\r\n\t\treturn {row, column};\r\n\t}\r\n\r\n\tgetTile(row, column)\r\n\t{\r\n\t\tif (this.tiles[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.tiles[row][column] || undefined;\r\n\t}\r\n\r\n\tgetTileHeight(row, column)\r\n\t{\r\n\t\tif (this.heightmap[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.heightmap[row][column];\r\n\t}\r\n\r\n\tgetX(row, column)\r\n\t{\r\n\t\treturn (column - row) * tileWidthHalf;\r\n\t}\r\n\r\n\tgetY(row, column)\r\n\t{\r\n\t\tlet h = this.getTileHeight(row, column);\r\n\r\n\t\tif (h === undefined)\r\n\t\t\th = 0;\r\n\r\n\t\tif (getStairsType(this.heightmap, row, column) !== undefined)\r\n\t\t\th += 1;\r\n\r\n\t\treturn (column + row) * tileHeightHalf - (h * tileWidthHalf);\r\n\t}\r\n\r\n\tgetZ(row, column, add = 0)\r\n\t{\r\n\t\trow *= 1000;\r\n\t\tcolumn *= 1000;\r\n\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tgetRealZ(row, column, add = 0)\r\n\t{\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tisValidTile(row, column)\r\n\t{\r\n\t\treturn this.getTile(row, column) !== undefined;\r\n\t}\r\n\r\n\tonTileClick(evt)\r\n\t{\r\n\t\tthis.emit(\"tile-click\", evt);\r\n\t}\r\n\r\n\tonTileHover(evt)\r\n\t{\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tlet {x, y} = this.getEntityPosition(this.tileCursor, evt.row, evt.column);\r\n\r\n\t\t\tthis.currentHover = [evt.row, evt.column];\r\n\t\t\tthis.tileCursor.visible = true;\r\n\t\t\tthis.tileCursor.hover(x, y, this.getRealZ(evt.row, evt.column, 2));\r\n\t\t\tthis.updateLayerOrder();\r\n\t\t}, 1);\r\n\t}\r\n\r\n\tonTileLeave(evt)\r\n\t{\r\n\t\tthis.currentHover = undefined;\r\n\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tif (this.currentHover !== undefined && (evt.x !== this.currentHover.x || evt.y !== this.currentHover.y))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis.tileCursor.visible = false;\r\n\t\t}, 2);\r\n\t}\r\n\r\n}\r\n","import { application} from \"../../bootstrapper.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { RoomView } from \"./room-view.js\";\r\n\r\nconst roomAssets = {\r\n\tindex: getDeliveryAssetsUrl(\"/room-content/index.xml\"),\r\n\tassets: getDeliveryAssetsUrl(\"/room-content/room_assets.xml\"),\r\n\tmanifest: getDeliveryAssetsUrl(\"/room-content/manifest.xml\"),\r\n\tvisualization: getDeliveryAssetsUrl(\"/room-content/room_visualization.xml\")\r\n};\r\n\r\nlet localRoomViewer;\r\n\r\nfunction initRoomViewer()\r\n{\r\n\tlocalRoomViewer = new RoomView();\r\n}\r\n\r\nexport class RoomManager extends Manager\r\n{\r\n\r\n\tget roomViewer()\r\n\t{\r\n\t\treturn localRoomViewer;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tinitRoomViewer();\r\n\r\n\t\tthis.roomViewer.visible = false;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(roomAssets.index);\r\n\t\tthis.loader.add(roomAssets.assets);\r\n\t\tthis.loader.add(roomAssets.manifest);\r\n\t\tthis.loader.add(roomAssets.visualization);\r\n\t}\r\n\r\n\tensureRoomViewerIsMounted()\r\n\t{\r\n\t\tif (this.roomViewer.parent !== null)\r\n\t\t\treturn;\r\n\r\n\t\tapplication.display.stage.addChild(this.roomViewer);\r\n\t}\r\n\r\n\tshowRoomViewer(heightmap)\r\n\t{\r\n\t\tthis.ensureRoomViewerIsMounted();\r\n\r\n\t\tthis.roomViewer.prepareHeightmap(heightmap);\r\n\t\tthis.roomViewer.visible = true;\r\n\t}\r\n\r\n}\r\n","import { Window } from \"../window.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport class NavigatorWindow extends Window\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.height = 540;\r\n\t\tthis.width = 420;\r\n\t\tthis.title = \"Navigator\";\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.x = application.display.width / 2 - this.width / 2;\r\n\t\tthis.y = application.display.height / 2 - this.height / 2;\r\n\r\n\t\tsuper.open();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { Easings } from \"../ui/ui.js\";\r\nimport { Manager } from \"../core/manager/manager.js\";\r\nimport { bottomBarHeight } from \"../ui/interface/bottomBar.js\";\r\n\r\nexport const hotelViewAssets = {\r\n\thotel: \"./resource/image/hotel-view/hotel.png\",\r\n\tskyline: \"./resource/image/hotel-view/skyline.png\"\r\n};\r\n\r\nexport class HotelView extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.skyline = new PIXI.extras.TilingSprite(application.getResource(hotelViewAssets.skyline).texture);\r\n\t\tthis.addChild(this.skyline);\r\n\r\n\t\tthis.hotel = new PIXI.Sprite(application.getResource(hotelViewAssets.hotel).texture);\r\n\t\tthis.addChild(this.hotel);\r\n\r\n\t\tthis.visible = false;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [1, 0]\r\n\t\t}).finished.then(() => this.visible = false);\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.visible = true;\r\n\r\n\t\tconst height = application.display.height;\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.skyline,\r\n\t\t\tdelay: 150,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [height, this.skyline.y]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.hotel,\r\n\t\t\tdelay: 225,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [height, this.hotel.y]\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst {width, height} = application.display.size;\r\n\t\tconst bottomOffset = bottomBarHeight;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x25B8EE);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.hotel.x = width - 750;\r\n\t\tthis.hotel.y = height - (568 + bottomOffset);\r\n\r\n\t\tthis.skyline.height = 120;\r\n\t\tthis.skyline.width = width;\r\n\t\tthis.skyline.x = 0;\r\n\t\tthis.skyline.y = height - (120 + bottomOffset);\r\n\t}\r\n\r\n}\r\n\r\nexport class HotelViewManager extends Manager\r\n{\r\n\r\n\tget hotelView()\r\n\t{\r\n\t\treturn this._hotelView;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => this.onApplicationLoadingDone());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tthis.loader.add(hotelViewAssets.hotel);\r\n\t\tthis.loader.add(hotelViewAssets.skyline);\r\n\t}\r\n\r\n\tonApplicationLoadingDone()\r\n\t{\r\n\t\tthis._hotelView = new HotelView();\r\n\t\tapplication.display.stage.addChild(this.hotelView);\r\n\t}\r\n\r\n}\r\n","import { AvatarManager } from \"./view/avatar/manager.js\";\r\nimport { Logger } from \"./core/logging.js\";\r\nimport { LoadingView } from \"./view/loading-view.js\";\r\nimport { Display } from \"./display.js\";\r\nimport { I18nManager } from \"./core/i18n/i18n.js\";\r\nimport { ConfigManager } from \"./core/config/config.js\";\r\nimport { initialLoadingDelay } from \"./preferences.js\";\r\nimport { InterfaceManager } from \"./ui/interface/manager.js\";\r\nimport { FurniManager } from \"./view/furni/furni.js\";\r\nimport { RoomManager } from \"./view/room/manager.js\";\r\nimport { fakeGamePlay } from \"./dev/gameplay.js\";\r\nimport { HotelViewManager } from \"./view/hotel-view.js\";\r\n\r\nexport class InitializerLoader extends PIXI.loaders.Loader\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.urls = [];\r\n\t}\r\n\r\n\tadd(url, stage = 1)\r\n\t{\r\n\t\tthis.urls.push({\r\n\t\t\tstage,\r\n\t\t\turl\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tload()\r\n\t{\r\n\t\tLogger.debug(\"InitializerLoader\", \"Skipped load() initializing..\");\r\n\t}\r\n\r\n\trealLoad(cb, stage = 1)\r\n\t{\r\n\t\tthis.urls\r\n\t\t\t.filter(url => url.stage === stage)\r\n\t\t\t.map(url => url.url)\r\n\t\t\t.forEach(url => super.add(url));\r\n\r\n\t\tsuper.load(cb);\r\n\t}\r\n\r\n}\r\n\r\nexport class Application extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn this._display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn this._loader;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.display.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.display.ticker;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._display = new Display();\r\n\t\tthis._loader = new InitializerLoader();\r\n\r\n\t\tthis.managers = [];\r\n\t}\r\n\r\n\taddDefaultManagers()\r\n\t{\r\n\t\tthis.addManager(new ConfigManager());\r\n\t\tthis.addManager(new I18nManager());\r\n\r\n\t\tthis.addManager(new AvatarManager());\r\n\t\tthis.addManager(new FurniManager());\r\n\t\tthis.addManager(new HotelViewManager());\r\n\t\tthis.addManager(new RoomManager());\r\n\r\n\t\tthis.addManager(new InterfaceManager());\r\n\t}\r\n\r\n\taddManager(manager)\r\n\t{\r\n\t\tLogger.debug(\"Application\", `Added manager ${manager.constructor.name}`);\r\n\t\tthis.managers.push(manager);\r\n\t}\r\n\r\n\tgetManager(managerClass)\r\n\t{\r\n\t\treturn this.managers.find(manager => manager instanceof managerClass);\r\n\t}\r\n\r\n\tcreate()\r\n\t{\r\n\t\tthis.loadingView = new LoadingView();\r\n\t\tthis.loadingView.on(\"loader-ready\", () => this.emit(\"application-can-run\"));\r\n\t\tthis.stage.addChild(this.loadingView);\r\n\r\n\t\tthis.addDefaultManagers();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait this.managers.forEach(async manager => await manager.initialize());\r\n\t}\r\n\r\n\tasync run()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 0;\r\n\t\tsetTimeout(() => this.loader.realLoad(() => this.onLoadingStage0Done(), 0), initialLoadingDelay);\r\n\t}\r\n\r\n\tonLoadingStage0Done()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 1;\r\n\t\tthis.loadingView.percentage = 0;\r\n\t\tthis.loader.realLoad(() => this.onLoadingStage1Done(), 1);\r\n\t}\r\n\r\n\tonLoadingStage1Done()\r\n\t{\r\n\t\tLogger.debug(\"Application\", \"Loading of manager data done!\");\r\n\t\tthis.emit(\"application-loading-done\");\r\n\r\n\t\tdelete this.loader;\r\n\r\n\t\tthis.stage.removeChild(this.loadingView);\r\n\r\n\t\tfakeGamePlay();\r\n\t}\r\n\r\n\tgetResource(resource, loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources[resource];\r\n\t}\r\n\r\n\tgetResources(loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources;\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { AvatarManager } from \"../view/avatar/manager.js\";\r\nimport { Furni } from \"../view/furni/furni.js\";\r\nimport { RoomManager } from \"../view/room/manager.js\";\r\nimport { getDistance, getHeading } from \"../view/room/shared.js\";\r\nimport { randomFigure } from \"./avatars.js\";\r\nimport { heightMaps } from \"./rooms.js\";\r\nimport { NavigatorWindow } from \"../ui/navigator/window.js\";\r\nimport { InterfaceManager } from \"../ui/interface/manager.js\";\r\nimport { HotelViewManager } from \"../view/hotel-view.js\";\r\n\r\nlet generateFurnis = 0;\r\nlet generateHumans = 1;\r\n\r\nlet furnis = [];\r\nlet humans = [];\r\n\r\nlet controllingHuman = 0;\r\n\r\nexport function fakeGamePlay()\r\n{\r\n\tapplication.getManager(HotelViewManager).hotelView.open();\r\n\r\n\tconst nav = new NavigatorWindow();\r\n\tapplication.stage.addChild(nav);\r\n\r\n\tapplication.getManager(InterfaceManager).interface.bottomBar.navigatorButton.on(\"click\", () =>\r\n\t{\r\n\t\tif (nav.opened)\r\n\t\t\tnav.close();\r\n\t\telse\r\n\t\t\tnav.open();\r\n\t});\r\n\r\n\tif (true === false)\r\n\t{\r\n\t\tconst avatarManager = application.getManager(AvatarManager);\r\n\t\tconst roomManager = application.getManager(RoomManager);\r\n\r\n\t\troomManager.showRoomViewer(heightMaps[5]);\r\n\r\n\t\tfor (let i = 0; i < generateFurnis; i++)\r\n\t\t{\r\n\t\t\tlet furni = new Furni(\"throne\");\r\n\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\tfurnis.push(furni);\r\n\r\n\t\t\troomManager.roomViewer.addEntityToTile(furni, position.row, position.column);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < generateHumans; i++)\r\n\t\t{\r\n\t\t\tlet human = avatarManager.newAvatar(randomFigure());\r\n\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\thuman.direction = human.headDirection = Math.floor(Math.random() * 8) % 8;\r\n\r\n\t\t\thumans.push(new RoomUser(roomManager.roomViewer, human, position.row, position.column));\r\n\r\n\t\t\troomManager.roomViewer.addEntityToTile(human, position.row, position.column);\r\n\t\t}\r\n\r\n\t\troomManager.roomViewer.on(\"tile-click\", evt => humans[controllingHuman].walkTo(evt.row, evt.column));\r\n\t}\r\n}\r\n\r\nclass RoomUser\r\n{\r\n\r\n\tget position()\r\n\t{\r\n\t\treturn {row: this.row, column: this.column};\r\n\t}\r\n\r\n\tconstructor(roomViewer, avatar, row, column)\r\n\t{\r\n\t\tthis.roomViewer = roomViewer;\r\n\t\tthis.avatar = avatar;\r\n\t\tthis.row = row;\r\n\t\tthis.column = column;\r\n\t}\r\n\r\n\tmoveTo(row, column, heading = undefined)\r\n\t{\r\n\t\tlet distance = getDistance(this.position, {row, column});\r\n\t\theading = heading !== undefined ? heading : getHeading(this.position, {row, column}) || this.avatar.direction;\r\n\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column);\r\n\r\n\t\tif (distance > 1)\r\n\t\t{\r\n\t\t\tthis.teleportTo(row, column);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.avatar.direction = this.avatar.headDirection = heading;\r\n\r\n\t\tlet animationDuration = 360;\r\n\t\tlet anim = anime({\r\n\t\t\ttargets: this.avatar,\r\n\t\t\tduration: animationDuration,\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\teasing: \"linear\"\r\n\t\t});\r\n\r\n\t\tanim.update = a =>\r\n\t\t{\r\n\t\t\tif (a.currentTime < 180)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tanim.update = undefined;\r\n\r\n\t\t\tthis.avatar.z = z;\r\n\t\t\tthis.roomViewer.updateLayerOrder();\r\n\t\t};\r\n\t}\r\n\r\n\tteleportTo(row, column)\r\n\t{\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column);\r\n\r\n\t\tthis.avatar.position.x = x;\r\n\t\tthis.avatar.position.y = y;\r\n\t\tthis.avatar.z = z;\r\n\r\n\t\tthis.roomViewer.updateLayerOrder();\r\n\t}\r\n\r\n\twalkTo(row, column)\r\n\t{\r\n\t\tlet current = this.position;\r\n\r\n\t\tif (current.row === row && current.column === column)\r\n\t\t\treturn;\r\n\r\n\t\tthis.avatar.addAction(\"Move\");\r\n\r\n\t\tconst walk = () =>\r\n\t\t{\r\n\t\t\tlet nextRow = current.row > row ? --current.row : current.row < row ? ++current.row : row;\r\n\t\t\tlet nextColumn = current.column > column ? --current.column : current.column < column ? ++current.column : column;\r\n\r\n\t\t\tlet heading = getHeading(this.position, {row: nextRow, column: nextColumn});\r\n\r\n\t\t\tthis.column = nextColumn;\r\n\t\t\tthis.row = nextRow;\r\n\r\n\t\t\tthis.moveTo(nextRow, nextColumn, heading);\r\n\r\n\t\t\tsetTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\tif (!(current.row === row && current.column === column))\r\n\t\t\t\t\twalk();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.avatar.removeAction(\"Move\");\r\n\t\t\t}, 360);\r\n\t\t};\r\n\r\n\t\twalk();\r\n\t}\r\n\r\n}\r\n","import { Logger } from \"./core/logging.js\";\r\nimport { Application } from \"./application.js\";\r\n\r\n/**\r\n * @type {Application}\r\n */\r\nexport const application = new Application();\r\n\r\n/**\r\n * Class Bootstrapper.\r\n */\r\nexport class Bootstrapper\r\n{\r\n\r\n\t/**\r\n\t * Initializes everything.\r\n\t */\r\n\tstatic async init()\r\n\t{\r\n\t\tLogger.debug(\"Bootstrapper\", \"Loading everything..\");\r\n\r\n\t\tPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n\r\n\t\tapplication.create();\r\n\t\tapplication.on(\"application-can-run\", () => application.run());\r\n\r\n\t\tawait application.initialize();\r\n\t}\r\n\r\n}\r\n","import { Bootstrapper } from \"./bootstrapper.js\";\r\n\r\nArray.prototype.pushChain = function (...entries)\r\n{\r\n\tthis.push(...entries);\r\n\r\n\treturn this;\r\n};\r\n\r\nArray.prototype.unique = function ()\r\n{\r\n\treturn this.filter((value, index, self) => self.indexOf(value) === index);\r\n};\r\n\r\nObject.prototype.forEach = function (callback)\r\n{\r\n\tfor (let key in this)\r\n\t\tif (this.hasOwnProperty(key))\r\n\t\t\tcallback(this[key], key);\r\n};\r\n\r\nPIXI.Container.prototype.updateLayerOrder = function ()\r\n{\r\n\tlet i = 0;\r\n\r\n\tthis.children.sort((a, b) =>\r\n\t{\r\n\t\tlet az = a.z || 0;\r\n\t\tlet bz = b.z || 0;\r\n\r\n\t\tif (az === bz)\r\n\t\t\treturn this.children.indexOf(a) - this.children.indexOf(b);\r\n\r\n\t\treturn az - bz;\r\n\t});\r\n};\r\n\r\nBootstrapper.init().then(() =>\r\n{\r\n});\r\n"],"names":["base","x","y","width","height","Texture","frame","Rectangle","texture","target","interactive","data","pos","on","evt","getLocalPosition","simpleDraggableTarget","getDraggableRegion","parent","newX","p","newY","getDraggingRegion","bounds","position","instance","callback","path","deliveryRoot","string","replace","matches","contents","context","key","object","keyParts","split","current","keyPart","g","points","thickness","beginFill","moveTo","lineTo","endFill","a","b","row","column","tiles","getTile","getSurroundings","tileNorthEast","tileNorthWest","tileHeight","South","StairsType","SouthEast","SouthWest","filter","length","Math","abs","max","round","Logger","error","Manager","_name","this","constructor","name","display","loader","stage","debug","log","warn","AvatarFigure","figure","parts","parse","type","part","setId","colorIds","shift","parseInt","colors","map","color","push","sort","localeCompare","toString","join","AvatarFigurePart","_type","_setId","_colorIds","ActionDefinition","id","state","precedence","activePartSet","assetPartDefinition","lay","geometryType","main","isDefault","animation","startFromFrameZero","preventHeadTurn","prevents","defaultParam","params","types","ActionType","value","animated","isNaN","AnimationActionDefinition","offsets","AnimationActionOffsetFrameDefinition","number","directions","AnimationActionOffsetFrameDirectionDefinition","direction","bodyparts","AnimationActionPartDefinition","setType","frames","AnimationActionPartFrameDefinition","partDefinition","AvatarFigureData","settypes","settype","find","avatarConfig","_actions","_animations","_draworder","_effectmap","_figuredata","_figuremap","_geometry","_offsets","_partsets","libraries","loaders","Loader","loadingPromises","library","config","configUrl","getDeliveryAssetsUrl","add","resources","_this","onConfigLoaded","libraryUrl","_this2","reset","load","querySelectorAll","forEach","action","getAttribute","param","definition","typeDefinition","actions","fDef","dDef","dir","bodypart","dx","dy","bp","i","pDef","animations","palette","paletteId","textContent","set","sDef","hiddenLayers","layer","sets","stDef","AvatarBodyPart","z","radius","items","AvatarColor","colorId","index","isClub","isSelectable","AvatarPart","isColorable","colorIndex","AvatarSet","gender","isPreSelectable","AvatarSetType","AvatarImage","geometry","avatarSet","canPoof","window","performance","now","partContainer","Container","size","addChild","getAction","headDirection","partDefinitions","sprites","ghost","isBuilding","isDownloading","isGatheringParts","decideGeometry","build","Graphics","fillColor","drawRect","c","_figure","onFigureChanged","avatar","figuremap","querySelector","parentNode","toLowerCase","unique","getLibrary","lib","loadLibrary","usedLibraries","then","download","decidePartStates","isBusy","figuredata","getSetType","getSet","_this3","gatherParts","PIXI","avatarResources","AvatarManager","avatars","lastUpdate","once","ticker","onGameTick","loadConfig","poof","image","options","lastTime","application","ConfigManager","getResource","defaultValue","findKey","evaluateString","Object","assign","I18nManager","texts","onTextsLoaded","text","getManager","LoadingBar","barColor","barHeight","barThickness","barWidth","percentage","_percentage","update","clear","lineStyle","LoadingView","loadingBar","logo","init","loadResources","TextStyle","Text","style","onResourcesLoaded","Sprite","visible","progress","emit","getString","Display","dpi","devicePixelRatio","mount","document","innerHTML","initApp","initEvents","onTick","delta","app","renderer","view","Application","innerHeight","innerWidth","appendChild","addEventListener","onWindowResize","updateLayerOrder","resize","utils","EventEmitter","BottomBar","background","interfaceResources","bottomBar","navigatorButton","friendsButton","chatButton","catalogueButton","inventoryButton","helpButton","draw","BottomBarButton","textures","animationSpeed","buttonMode","loop","extras","AnimatedSprite","BottomBarButtonAnimatedHover","onPointerOver","onPointerOut","play","BottomBarButtonCatalogue","catalogue","getTextureFromRectangle","BottomBarButtonChat","chat","BottomBarButtonFriends","chatMessages","friends","BottomBarButtonHelp","friendsInvited","help","BottomBarButtonInventory","inventory","BottomBarButtonNavigator","navigator","ChatBubble","_avatarHolder","onAvatarHover","onAvatarLeave","_avatar","newAvatar","_chatBubble","chatBubble","onChatBubbleHover","onChatBubbleLeave","addAction","drawCircle","removeAction","imLeft","left","imMiddle","TilingSprite","middle","imRight","right","Window","bg","title","render","_height","titleText","trim","_width","filters","withInstance","DropShadowFilter","alpha","blur","distance","rotation","currentAnimation","anime","finished","contentOffset","drawRoundedRect","anchor","old","contentMargin","Easings","InterfaceContainer","hello","SwiftOut","localInterface","InterfaceManager","TileBase","onClick","onMouseOver","onMouseOut","StairsSouth","StairsSouthEast","allPoints","step","ay","Point","tileWidth","ax","StairsSouthWest","_this4","Tile","_this5","furniResources","FurniManager","furniName","_loadingSprite","loading","_loading","TileCursor","WallBase","floorThickness","wallThickness","top","doorHeight","wallHeight","WallColumn","doorMode","hole","tileHeightHalf","tileWidthHalf","WallCorner","WallRow","RoomView","_entities","_heightmap","_tiles","columns","rows","highest","lowest","roomScale","tileCursor","floor","scale","children","removeChild","floorplan","clearEverything","char","indexOf","heightmap","h","getHighestAndLowest","getTileHeight","isDoor","stairsType","getStairsType","implementation","getTileImplementation","wallC","cy","needsWallC","wallR","cx","needsWallR","getX","getY","getRealZ","isDoorColumn","isDoorRow","tileHeightLocal","wi","wallImplementations","entities","wall","tile","onTileClick","onTileHover","onTileLeave","centerRoom","hitArea","entity","associateEntityToTile","getEntityPosition","animate","reduce","acc","cur","yred","xred","getRoomOffsets","isStairs","getZ","random","isValidTile","getRandomTile","currentHover","hover","roomAssets","localRoomViewer","RoomManager","roomViewer","assets","manifest","visualization","ensureRoomViewerIsMounted","prepareHeightmap","NavigatorWindow","hotelViewAssets","HotelView","skyline","hotel","HotelViewManager","onApplicationLoadingDone","_hotelView","hotelView","InitializerLoader","heading","getHeading","teleportTo","currentTime","nextColumn","nextRow","walk","urls","url","cb","_display","_loader","managers","addManager","manager","managerClass","loadingView","addDefaultManagers","initialize","realLoad","onLoadingStage0Done","onLoadingStage1Done","open","nav","interface","opened","close","resource","Bootstrapper","settings","SCALE_MODE","SCALE_MODES","NEAREST","create","run","Array","prototype","pushChain","self","hasOwnProperty","bz","az"],"mappings":"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"}