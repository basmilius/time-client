{"version":3,"file":"bundle.js.map","sources":["../src/core/dom-utils.js","../src/core/pixi-utils.js","../src/preferences.js","../src/view/avatar/shared.js","../src/core/json-utils.js","../src/view/room/tiles.js","../src/view/room/shared.js","../src/view/loading-view.js","../src/view/avatar/avatar.js","../src/core/logging.js","../src/view/avatar/figure.js","../src/core/manager/manager.js","../src/view/avatar/manager.js","../src/core/config/config.js","../src/core/i18n/i18n.js","../src/display.js","../src/ui/interface/toolbar.js","../src/ui/interface/memenu.js","../src/ui/interface/interface.js","../src/view/room/cursor.js","../src/view/room/dev.js","../src/view/room/walls.js","../src/view/room/room-view.js","../src/core/dev-utils.js","../src/view/furni/furni.js","../src/view/room/manager.js","../src/application.js","../src/bootstrapper.js","../src/main.js"],"sourcesContent":["/**\r\n * Applies styles to an element.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Object} styles\r\n */\r\nexport function applyStyles(element, styles)\r\n{\r\n\tstyles.forEach((value, key) => element.style.setProperty(key, value));\r\n}\r\n\r\n/**\r\n * Creates an element.\r\n *\r\n * @param {String} tagName\r\n * @param {Function} callback\r\n *\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tagName, callback = null)\r\n{\r\n\tconst element = document.createElement(tagName);\r\n\r\n\tif (callback !== null)\r\n\t\tcallback(element);\r\n\r\n\treturn element;\r\n}\r\n\r\n/**\r\n * Removes contents.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nexport function removeHtml(element)\r\n{\r\n\telement.innerHTML = \"\";\r\n}\r\n\r\n/**\r\n * Query Selector All to Array.\r\n *\r\n * @param selector\r\n * @param container\r\n *\r\n * @returns {Array<Element>}\r\n */\r\nexport function querySelectorAllArray(selector, container = document)\r\n{\r\n\treturn [].slice.call(container.querySelectorAll(selector));\r\n}\r\n","let simpleDraggableTarget = null;\r\n\r\nexport function setInteractive(target)\r\n{\r\n\ttarget.interactive = true;\r\n}\r\n\r\nexport function simpleDraggable(target)\r\n{\r\n\tsetInteractive(target);\r\n\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\ttarget.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\t});\r\n\r\n\ttarget.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\ttarget.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tsimpleDraggableTarget.position.x = p.x - pos.x;\r\n\t\tsimpleDraggableTarget.position.y = p.y - pos.y;\r\n\t});\r\n}\r\n\r\nexport function withInstance(instance, callback)\r\n{\r\n\tcallback(instance);\r\n\r\n\treturn instance;\r\n}\r\n","export const deliveryRoot = \"https://cdn.mili.us/time\";\r\nexport const initialLoadingDelay = 0;\r\n\r\nexport function getDeliveryUrl(path)\r\n{\r\n\treturn deliveryRoot + path;\r\n}\r\n\r\nexport function getDeliveryAssetsUrl(path)\r\n{\r\n\treturn getDeliveryUrl(\"/assets\" + path);\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { Logger } from \"../../core/logging.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { InitializerLoader } from \"../../application.js\";\r\n\r\nexport const LOADED_CONFIGS = {};\r\nexport const LOADED_LIBS = {};\r\nexport const LOADED_TEXTURES = {};\r\nexport const LOADING_LIBS = {};\r\n\r\nexport let actionsSorted = null;\r\nexport let defaultAction = null;\r\nexport let loadingAvatar = null;\r\nexport let radiusComparator = (a, b) => b.getAttribute(\"z\") - a.getAttribute(\"z\");\r\n\r\nfunction onClothingLibraryLoaded(library, data)\r\n{\r\n\tLOADED_LIBS[library] = data;\r\n}\r\n\r\nexport function initializeAvatarRenderer()\r\n{\r\n\tif (actionsSorted === null)\r\n\t\tactionsSorted = querySelectorAllArray(\"action\", getActions()).map(action => action.getAttribute(\"id\"));\r\n\r\n\tif (defaultAction === null)\r\n\t\tdefaultAction = getAction(\"Default\");\r\n\r\n\tif (loadingAvatar === null)\r\n\t\tloadingAvatar = new Avatar(\"hd-195-1\");\r\n}\r\n\r\nexport function getAvatarClothingConfigUrl(config)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/${config}.xml`);\r\n}\r\n\r\nexport function getAvatarClothingLibraryUrl(library)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/lib/${library}.json`);\r\n}\r\n\r\nexport function getValidActionsForPart(partType)\r\n{\r\n\tconst actions = [\"std\"];\r\n\r\n\tswitch (partType)\r\n\t{\r\n\t\tcase \"bd\":\r\n\t\t\tactions.push(\"sit\", \"lay\", \"wlk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hd\":\r\n\t\t\tactions.push(\"lsp\", \"lay\", \"spk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fa\":\r\n\t\t\tactions.push(\"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ea\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ey\":\r\n\t\t\tactions.push(\"agr\", \"sad\", \"sml\", \"srp\", \"lag\", \"lsp\", \"lay\", \"eyb\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fc\":\r\n\t\t\tactions.push(\"agr\", \"blw\", \"sad\", \"spk\", \"srp\", \"sml\", \"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hr\":\r\n\t\tcase \"hrb\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"he\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ha\":\r\n\t\t\tactions.push(\"spk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ch\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"cc\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ca\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lg\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lh\":\r\n\t\t\tactions.push(\"respect\", \"sig\", \"wav\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ls\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lc\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rh\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\", \"blw\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rs\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rc\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ri\":\r\n\t\t\tactions.push(\"crr\", \"drk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"li\":\r\n\t\t\tactions.push(\"sig\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"sh\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn actions;\r\n}\r\n\r\nexport function isLibraryLoaded(library)\r\n{\r\n\treturn LOADED_LIBS[library] !== undefined;\r\n}\r\n\r\nexport function loadAvatarClothingConfig(config, loader)\r\n{\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tconst configUrl = getAvatarClothingConfigUrl(config);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () => application.getResource(configUrl) !== undefined ? LOADED_CONFIGS[config] = application.getResource(configUrl).data : undefined);\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing config: ${config}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADED_CONFIGS[config] = application.getResource(configUrl).data;\r\n\r\n\t\t\t\t\tif (!isInitializerLoader)\r\n\t\t\t\t\t\tresolve(LOADED_CONFIGS[config]);\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function loadAvatarClothingLibrary(library, loader)\r\n{\r\n\tif (LOADING_LIBS[library] !== undefined)\r\n\t\treturn LOADING_LIBS[library];\r\n\r\n\tif (isLibraryLoaded(library))\r\n\t\treturn Promise.resolve(LOADED_LIBS[library]);\r\n\r\n\treturn LOADING_LIBS[library] = new Promise(resolve =>\r\n\t{\r\n\t\tconst libraryUrl = getAvatarClothingLibraryUrl(library);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () => application.getResource(libraryUrl, loader) !== undefined ? onClothingLibraryLoaded(library, application.getResource(libraryUrl, loader).data) : undefined);\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing library: ${library}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADING_LIBS[library] = undefined;\r\n\t\t\t\t\tonClothingLibraryLoaded(library, application.getResource(libraryUrl, loader).data);\r\n\t\t\t\t\tresolve(LOADED_LIBS[library]);\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function getAction(id)\r\n{\r\n\tconst action = getActions().querySelector(`action[id=\"${id}\"]`);\r\n\tconst definition = {};\r\n\r\n\tif (action === null)\r\n\t\treturn undefined;\r\n\r\n\taction.attributes.forEach(attribute => definition[attribute.name] = attribute.value);\r\n\r\n\treturn definition;\r\n}\r\n\r\nexport function getActions()\r\n{\r\n\treturn LOADED_CONFIGS[\"actions\"];\r\n}\r\n\r\nexport function getAnimations()\r\n{\r\n\treturn LOADED_CONFIGS[\"animations\"];\r\n}\r\n\r\nexport function getDraworder()\r\n{\r\n\treturn LOADED_CONFIGS[\"draworder\"];\r\n}\r\n\r\nexport function getFigureData()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuredata\"];\r\n}\r\n\r\nexport function getFigureMap()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuremap\"];\r\n}\r\n\r\nexport function getGeometry()\r\n{\r\n\treturn LOADED_CONFIGS[\"geometry\"];\r\n}\r\n\r\nexport function getPartSets()\r\n{\r\n\treturn LOADED_CONFIGS[\"partsets\"];\r\n}\r\n\r\nexport function getSprite(library, asset, center = {x: 0, y: 0})\r\n{\r\n\tif (LOADED_LIBS[library] === undefined || LOADED_LIBS[library][asset] === undefined)\r\n\t\treturn null;\r\n\r\n\tconst sprite = new PIXI.Sprite(getTexture(library, asset));\r\n\r\n\tsprite.x = center.x - (LOADED_LIBS[library][asset].offset.x + center.x - 12);\r\n\tsprite.y = center.y - (LOADED_LIBS[library][asset].offset.y - (center.y / 2) - 6);\r\n\r\n\treturn sprite;\r\n}\r\n\r\nexport function getTexture(library, asset)\r\n{\r\n\tif (LOADED_LIBS[library] === undefined || LOADED_LIBS[library][asset] === undefined)\r\n\t\treturn null;\r\n\r\n\tif (LOADED_TEXTURES[`${library}:${asset}`] !== undefined)\r\n\t\treturn LOADED_TEXTURES[`${library}:${asset}`];\r\n\r\n\treturn LOADED_TEXTURES[`${library}:${asset}`] = PIXI.Texture.fromImage(\"data:image/png;base64,\" + LOADED_LIBS[library][asset][\"asset\"]);\r\n}\r\n\r\nexport function getFlippedSetType(setType)\r\n{\r\n\tlet flippedSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"flipped-set-type\");\r\n\r\n\tif (flippedSetType !== null && flippedSetType !== \"\")\r\n\t\treturn flippedSetType;\r\n\r\n\treturn setType;\r\n}\r\n\r\nexport function getRemoveSetType(setType)\r\n{\r\n\tlet removeSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"remove-set-type\");\r\n\r\n\tif (removeSetType !== null && removeSetType !== \"\")\r\n\t\treturn removeSetType;\r\n\r\n\treturn null;\r\n}\r\n\r\nexport function getActivePartSets(id)\r\n{\r\n\tconst result = [];\r\n\tconst activeParts = getPartSets().querySelectorAll(`activePartSet[id=\"${id}\"] activePart`);\r\n\r\n\tactiveParts.forEach(activePart => result.push(activePart.getAttribute(\"set-type\")));\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function getAnimationFrames(id, type)\r\n{\r\n\tconst defs = getAnimations().querySelectorAll(`action[id=\"${id}\"] part[set-type=\"${type}\"] frame`);\r\n\tconst frames = [];\r\n\r\n\tdefs.forEach(def =>\r\n\t{\r\n\t\tconst repeats = def.hasAttribute(\"repeats\") ? parseInt(def.getAttribute(\"repeats\")) : 1;\r\n\r\n\t\tfor (let i = 0; i < repeats; i++)\r\n\t\t\tframes.push({number: parseInt(def.getAttribute(\"number\")), assetpartdefinition: def.getAttribute(\"assetpartdefinition\")});\r\n\t});\r\n\r\n\treturn frames;\r\n}\r\n\r\nexport function getAnimationFramesCount(id)\r\n{\r\n\tconst frames = getAnimations().querySelectorAll(`action[id=\"${id}\"] part:first-child frame`).length;\r\n\tconst offsets = getAnimations().querySelectorAll(`action[id=\"${id}\"] offsets frame`).length;\r\n\r\n\treturn Math.max(frames, offsets);\r\n}\r\n\r\nexport function getAnimationOffset(id, geometryId, frame, direction)\r\n{\r\n\tif (isNaN(frame) || isNaN(direction))\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\tconst bodypart = getAnimations().querySelector(`action[id=\"${id}\"] offsets frame[id=\"${frame}\"] directions direction[id=\"${direction}\"] bodypart[id=\"${geometryId}\"]`);\r\n\r\n\tif (bodypart === null)\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\treturn {\r\n\t\tx: parseInt(bodypart.getAttribute(\"dx\")),\r\n\t\ty: parseInt(bodypart.getAttribute(\"dy\"))\r\n\t};\r\n}\r\n","\r\nexport function evaluateString(string, context = {})\r\n{\r\n\tstring = string.replace(new RegExp(\"\\\\${(.*?)}\", \"g\"), (matches, contents) => findKey(contents, context));\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function findKey(key, object, defaultValue = undefined)\r\n{\r\n\tconst keyParts = key.split(\".\");\r\n\tlet current = object;\r\n\r\n\tfor (const keyPart of keyParts)\r\n\t{\r\n\t\tif (current[keyPart] === undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\tcurrent = current[keyPart];\r\n\t}\r\n\r\n\treturn current;\r\n}\r\n","import { tileHeight, tileWidth } from \"./shared.js\";\r\n\r\nfunction drawTile(g, points, thickness)\r\n{\r\n\tg.beginFill(0x989865);\r\n\tg.moveTo(points[0].x, points[0].y);\r\n\tg.lineTo(points[1].x, points[1].y);\r\n\tg.lineTo(points[2].x, points[2].y);\r\n\tg.lineTo(points[3].x, points[3].y);\r\n\tg.endFill();\r\n\r\n\tif (thickness > 0)\r\n\t{\r\n\t\tg.beginFill(0x838357);\r\n\t\tg.moveTo(points[1].x, points[1].y);\r\n\t\tg.lineTo(points[1].x, points[1].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\r\n\t\tg.beginFill(0x6F6F49);\r\n\t\tg.moveTo(points[3].x, points[3].y);\r\n\t\tg.lineTo(points[3].x, points[3].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\t}\r\n}\r\n\r\nexport class TileBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.row = 0;\r\n\t\tthis.column = 0;\r\n\r\n\t\tthis.interactive = true;\r\n\t\tthis.thickness = thickness;\r\n\r\n\t\tthis.on(\"click\", () => this.onClick());\r\n\t\tthis.on(\"pointerover\", () => this.onMouseOver());\r\n\t\tthis.on(\"pointerout\", () => this.onMouseOut());\r\n\t}\r\n\r\n\tonClick()\r\n\t{\r\n\t\tthis.emit(\"tile-click\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOver()\r\n\t{\r\n\t\tthis.emit(\"tile-hover\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOut()\r\n\t{\r\n\t\tthis.emit(\"tile-leave\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouth extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthEast extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst allPoints = [];\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * 8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + (tileWidth / 8) + ax, (tileHeight / 8) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point(ax, (tileHeight / 2) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tallPoints.push(...points);\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthWest extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * -8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point(tileWidth + ax, (tileHeight / 2) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - (tileWidth / 8) + ax, (tileHeight / 8) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class Tile extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tdrawTile(this, points, this.thickness);\r\n\t}\r\n\r\n}\r\n","import { StairsSouth, StairsSouthEast, StairsSouthWest, Tile } from \"./tiles.js\";\r\n\r\nexport const hitAreaOffset = 5000;\r\n\r\nexport const tileHeight = 32;\r\nexport const tileHeightHalf = tileHeight / 2;\r\nexport const tileWidth = 64;\r\nexport const tileWidthHalf = tileWidth / 2;\r\n\r\nexport const Heading = {\r\n\tNorthEast: 0,\r\n\tNorthWest: 1,\r\n\tSouthEast: 2,\r\n\tSouthWest: 3\r\n};\r\n\r\nexport const StairsType = {\r\n\tSouth: 3,\r\n\tSouthEast: 2,\r\n\tSouthWest: 4\r\n};\r\n\r\nexport function getDoorDirection(tiles, row, column)\r\n{\r\n\tif (!isDoor(tiles, row, column))\r\n\t\treturn null;\r\n\r\n\treturn [Heading.NorthEast, Heading.NorthWest, Heading.SouthEast, Heading.SouthWest][getSurroundings(tiles, row, column).findIndex(t => t !== null)];\r\n}\r\n\r\nexport function getStairsType(tiles, row, column)\r\n{\r\n\tlet tileHeight = getTile(tiles, row, column);\r\n\tlet [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest] = getSurroundings(tiles, row, column);\r\n\r\n\tif (tileNorthEast !== null && tileNorthWest !== null && Math.abs(tileHeight - tileNorthEast) === 1 && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsType.South;\r\n\telse if (tileNorthWest !== null && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsType.SouthEast;\r\n\telse if (tileNorthEast !== null && Math.abs(tileHeight - tileNorthEast) === 1)\r\n\t\treturn StairsType.SouthWest;\r\n\r\n\t// TODO: Other stairs.\r\n\r\n\treturn undefined;\r\n}\r\n\r\nexport function getSurroundings(tiles, row, column)\r\n{\r\n\tlet tileNorthEast = getTile(tiles, row - 1, column);\r\n\tlet tileNorthWest = getTile(tiles, row, column - 1);\r\n\tlet tileSouthEast = getTile(tiles, row, column + 1);\r\n\tlet tileSouthWest = getTile(tiles, row + 1, column);\r\n\r\n\treturn [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest];\r\n}\r\n\r\nexport function getTile(tiles, row, column)\r\n{\r\n\tif (typeof tiles[row] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\tif (typeof tiles[row][column] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\treturn tiles[row][column];\r\n}\r\n\r\nexport function getTileHeightIndex(char)\r\n{\r\n\tif (char === \"x\")\r\n\t\treturn null;\r\n\r\n\treturn [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"].indexOf(char);\r\n}\r\n\r\nexport function getTileImplementation(stairsType = undefined)\r\n{\r\n\tif (stairsType === StairsType.South)\r\n\t\treturn StairsSouth;\r\n\r\n\tif (stairsType === StairsType.SouthEast)\r\n\t\treturn StairsSouthEast;\r\n\r\n\tif (stairsType === StairsType.SouthWest)\r\n\t\treturn StairsSouthWest;\r\n\r\n\treturn Tile;\r\n}\r\n\r\nexport function isDoor(tiles, row, column)\r\n{\r\n\tif (getTile(tiles, row, column) === null)\r\n\t\treturn false;\r\n\r\n\treturn getSurroundings(tiles, row, column).filter(t => t !== null).length === 1;\r\n}\r\n\r\nexport function needsWallC(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cy = row;\r\n\r\n\twhile (cy > 0)\r\n\t\tif (getTile(tiles, --cy, column) !== null && !isDoor(tiles, row, cy))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row - 1, column + 1) !== null && !isDoor(tiles, row - 1, column + 1)));\r\n}\r\n\r\nexport function needsWallR(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cx = column;\r\n\r\n\twhile (cx > 0)\r\n\t\tif (getTile(tiles, row, --cx) !== null && !isDoor(tiles, row, cx))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row + 1, column - 1) !== null && !isDoor(tiles, row + 1, column - 1)));\r\n}\r\n\r\nexport function getHighestAndLowest(heightmap)\r\n{\r\n\tlet highest = 0, lowest = 36;\r\n\r\n\tfor (let row = 0; row < heightmap.length; row++)\r\n\t{\r\n\t\tfor (let column = 0; column < heightmap[row].length; column++)\r\n\t\t{\r\n\t\t\tlet h = heightmap[row][column];\r\n\r\n\t\t\tif (h > highest)\r\n\t\t\t\thighest = h;\r\n\r\n\t\t\tif (h < lowest)\r\n\t\t\t\tlowest = 0;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {highest, lowest};\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { I18nManager } from \"../core/i18n/i18n.js\";\r\n\r\nconst resourceLogo = \"/resource/image/logo.png\";\r\n\r\nclass LoadingBar extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.barColor = 0x888888;\r\n\t\tthis.barHeight = 12;\r\n\t\tthis.barThickness = 2;\r\n\t\tthis.barWidth = 300;\r\n\t\tthis.percentage = 0;\r\n\r\n\t\tapplication.display.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(this.barColor);\r\n\t\tthis.drawRect(0, 0, Math.round(this.percentage / 100 * this.barWidth), this.barHeight);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(this.barThickness, this.barColor);\r\n\r\n\t\tthis.moveTo(-this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, -this.barThickness);\r\n\t\tthis.lineTo(this.barWidth + this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, this.barHeight + this.barThickness);\r\n\t\tthis.lineTo(-this.barThickness, -this.barThickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class LoadingView extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this.loadingBar.percentage || 0;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis.loadingBar.percentage = Math.round(value);\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingBar = new LoadingBar();\r\n\r\n\t\tthis.logo = null;\r\n\r\n\t\tthis.init();\r\n\t\tthis.loadResources();\r\n\r\n\t\tapplication.display.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"Segoe UI\",\r\n\t\t\tfontSize: 13,\r\n\t\t\tfill: \"white\",\r\n\t\t\twordWrap: true,\r\n\t\t\twordWrapWidth: 360\r\n\t\t});\r\n\r\n\t\tthis.text = new PIXI.Text(\"\", style);\r\n\t}\r\n\r\n\tloadResources()\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(resourceLogo)\r\n\t\t\t.load(() => this.onResourcesLoaded())\r\n\t}\r\n\r\n\tonResourcesLoaded()\r\n\t{\r\n\t\tthis.logo = new PIXI.Sprite(application.getResource(resourceLogo, this.loader).texture);\r\n\r\n\t\tthis.addChild(this.logo);\r\n\r\n\t\tthis.addChild(this.loadingBar);\r\n\t\tthis.addChild(this.text);\r\n\r\n\t\tthis.emit(\"loader-ready\");\r\n\r\n\t\tapplication.loader.on(\"progress\", state => this.percentage = state.progress);\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tconst percentage = this.percentage;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst height = application.display.height;\r\n\t\tconst width = application.display.width;\r\n\r\n\t\tthis.beginFill(0x0);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.loadingBar.position.x = Math.round((width / 2) - (this.loadingBar.width / 2));\r\n\t\tthis.loadingBar.position.y = height - (this.loadingBar.height + 91);\r\n\r\n\t\tif (this.logo !== null)\r\n\t\t{\r\n\t\t\tthis.logo.x = Math.round((width / 2) - (this.logo.width / 2));\r\n\t\t\tthis.logo.y = Math.round((height / 2) - (this.logo.height / 2));\r\n\t\t}\r\n\r\n\t\tthis.text.text = application.getManager(I18nManager).getString(\"loading-view.starting-up\", {percentage}, \"\");\r\n\r\n\t\tthis.text.position.set(\r\n\t\t\tMath.floor((width / 2) - (this.text.width / 2)),\r\n\t\t\tthis.loadingBar.position.y - 30\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { setInteractive } from \"../../core/pixi-utils.js\";\r\nimport { FigureString } from \"./figure.js\";\r\nimport { actionsSorted, defaultAction, getAction, getActivePartSets, getAnimationFrames, getAnimationFramesCount, getAnimationOffset, getDraworder, getFigureData, getFigureMap, getFlippedSetType, getGeometry, getRemoveSetType, getSprite, getValidActionsForPart, isLibraryLoaded, loadAvatarClothingLibrary, loadingAvatar, radiusComparator } from \"./shared.js\";\r\nimport { AvatarManager, avatarResources } from \"./manager.js\";\r\n\r\nexport class Avatar extends PIXI.Container\r\n{\r\n\r\n\tget actions()\r\n\t{\r\n\t\treturn this._actions;\r\n\t}\r\n\r\n\tget avatarSet()\r\n\t{\r\n\t\treturn this._avatarSet;\r\n\t}\r\n\r\n\tset avatarSet(value)\r\n\t{\r\n\t\tthis._avatarSet = value;\r\n\t}\r\n\r\n\tget direction()\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction(value)\r\n\t{\r\n\t\tthis._direction = value;\r\n\t}\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this._figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tif (value === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._figure = new FigureString(value);\r\n\t\tthis.poof();\r\n\t}\r\n\r\n\tget geometry()\r\n\t{\r\n\t\treturn this._geometry;\r\n\t}\r\n\r\n\tset geometry(value)\r\n\t{\r\n\t\tthis._geometry = value;\r\n\t}\r\n\r\n\tget headDirection()\r\n\t{\r\n\t\treturn this._headDirection;\r\n\t}\r\n\r\n\tset headDirection(value)\r\n\t{\r\n\t\tthis._headDirection = value;\r\n\t}\r\n\r\n\tconstructor(figure = \"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\", geometry = \"vertical\", avatarSet = \"full\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tsetInteractive(this);\r\n\r\n\t\tthis.canPoof = false;\r\n\t\tthis.id = \"avatar-\" + window.performance.now();\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.partContainer = new PIXI.Container();\r\n\r\n\t\tthis.addChild(this.partContainer);\r\n\r\n\t\tthis._alsoUpdate = [];\r\n\t\tthis._ticker = false;\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\r\n\t\tthis._actions = [defaultAction];\r\n\t\tthis._frames = {};\r\n\r\n\t\tthis.avatarSet = avatarSet;\r\n\t\tthis.direction = 2;\r\n\t\tthis.figure = figure;\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.headDirection = this.direction;\r\n\r\n\t\tthis.build();\r\n\r\n\t\tthis.canPoof = true;\r\n\t}\r\n\r\n\taddAction(action)\r\n\t{\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\treturn;\r\n\r\n\t\taction = getAction(action);\r\n\r\n\t\tif (action === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions\r\n\t\t\t.pushChain(action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\r\n\t\tthis._frames[action.id] = 0;\r\n\r\n\t\tif (action[\"preventheadturn\"] === \"true\")\r\n\t\t\tthis._headDirection = this.direction;\r\n\t}\r\n\r\n\thasAction(action)\r\n\t{\r\n\t\tlet found = false;\r\n\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\tfound = true;\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tremoveAction(action)\r\n\t{\r\n\t\tif (!this.hasAction(action))\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions = this._actions\r\n\t\t\t.filter(a => a.id !== action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\t}\r\n\r\n\tsetPosition(x, y, dir = 3)\r\n\t{\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\tthis.direction = dir;\r\n\t\tthis.headDirection = dir;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tbuild()\r\n\t{\r\n\t\tthis.emit(\"avatar-build\", this);\r\n\t\tthis.invalidate();\r\n\r\n\t\tconst libraries = this.getLibraries().filter(library => !isLibraryLoaded(library));\r\n\r\n\t\tif (libraries.length > 0)\r\n\t\t{\r\n\t\t\tthis._loading = true;\r\n\r\n\t\t\tconst download = () =>\r\n\t\t\t{\r\n\t\t\t\tif (libraries.length === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._loading = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloadAvatarClothingLibrary(libraries.shift(), this.loader).then(download);\r\n\t\t\t};\r\n\r\n\t\t\tdownload();\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tdecideGeometry()\r\n\t{\r\n\t\tconst geometry = getGeometry().querySelector(`canvas[scale=\"h\"] geometry[id=\"${this.geometry}\"]`);\r\n\t\tthis._height = parseInt(geometry.getAttribute(\"height\"));\r\n\t\tthis._width = parseInt(geometry.getAttribute(\"width\"));\r\n\r\n\t\tif (this.geometry === \"head\")\r\n\t\t\tthis._height = this._width;\r\n\t}\r\n\r\n\tgetActivePartSets(action = null)\r\n\t{\r\n\t\tlet activePartSets = [];\r\n\r\n\t\tif (action === null)\r\n\t\t\tactivePartSets.push(...getActivePartSets(\"figure\"));\r\n\t\telse\r\n\t\t\tactivePartSets.push(...getActivePartSets(action[\"activepartset\"]));\r\n\r\n\t\treturn activePartSets.unique();\r\n\t}\r\n\r\n\thasActivePartSet(id)\r\n\t{\r\n\t\tfor (let action of this.actions)\r\n\t\t\tif (action[\"activepartset\"] === id)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetBodyparts()\r\n\t{\r\n\t\tconst bodyparts = [];\r\n\r\n\t\tquerySelectorAllArray(`avatarset[id=\"${this.avatarSet}\"] bodypart`, getGeometry())\r\n\t\t\t.forEach(part => bodyparts.push(part.getAttribute(\"id\")));\r\n\r\n\t\treturn bodyparts;\r\n\t}\r\n\r\n\tgetLibraries()\r\n\t{\r\n\t\tconst libraries = [];\r\n\r\n\t\tthis._parts.forEach((settype, type) =>\r\n\t\t{\r\n\t\t\tsettype.parts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tlet lib = getFigureMap().querySelector(`part[id=\"${part.id}\"][type=\"${type}\"]`);\r\n\r\n\t\t\t\tif (lib === null || lib.parentNode === null)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tlib = lib.parentNode;\r\n\r\n\t\t\t\tlibraries.push(part[\"library\"] = lib.getAttribute(\"id\").toLowerCase());\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn libraries.unique();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\tlet x = -(this._width / 2);\r\n\t\tlet y = -104;\r\n\r\n\t\treturn {x, y};\r\n\t}\r\n\r\n\tgatherParts()\r\n\t{\r\n\t\tthis.figure.parts.forEach((data, type) =>\r\n\t\t{\r\n\t\t\tconst settype = getFigureData().querySelector(`sets > settype[type=\"${type}\"]`);\r\n\r\n\t\t\tif (settype === null)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst set = settype.querySelector(`set[id=\"${data.id}\"]`);\r\n\t\t\tconst parts = set.getElementsByTagName(\"part\");\r\n\r\n\t\t\tconst colorable = set.getAttribute(\"colorable\") === \"1\";\r\n\t\t\tconst hiddenlayers = [];\r\n\t\t\tconst paletteid = settype.getAttribute(\"paletteid\");\r\n\r\n\t\t\tconst setHiddenlayers = set.querySelectorAll(\"hiddenlayers layer\");\r\n\t\t\tif (setHiddenlayers !== null)\r\n\t\t\t\tsetHiddenlayers.forEach(layer => hiddenlayers.push(layer.getAttribute(\"parttype\")));\r\n\r\n\t\t\tparts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tconst partType = part.getAttribute(\"type\");\r\n\r\n\t\t\t\tif (this._parts[partType] === undefined)\r\n\t\t\t\t\tthis._parts[partType] = {hiddenlayers, parts: []};\r\n\r\n\t\t\t\tthis._parts[partType].parts.push({\r\n\t\t\t\t\tid: parseInt(part.getAttribute(\"id\")),\r\n\t\t\t\t\tcolorable: part.getAttribute(\"colorable\") === \"1\" && colorable,\r\n\t\t\t\t\tcolorindex: parseInt(part.getAttribute(\"colorindex\")),\r\n\t\t\t\t\tindex: parseInt(part.getAttribute(\"index\")),\r\n\t\t\t\t\tpaletteid,\r\n\t\t\t\t\tset: type,\r\n\t\t\t\t\ttype: partType\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tinvalidate()\r\n\t{\r\n\t\tthis._parts = {};\r\n\t\tthis._sprites = {};\r\n\r\n\t\tthis.decideGeometry();\r\n\t\tthis.gatherParts();\r\n\t}\r\n\r\n\tpoof()\r\n\t{\r\n\t\tif (!this.canPoof)\r\n\t\t\treturn;\r\n\r\n\t\tconst clouds = [\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: -36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: 36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: 16\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: -16\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\tlet cx = this._width / 2, cy = this._height / 2;\r\n\t\tlet fn = cloud =>\r\n\t\t{\r\n\t\t\tthis.addChild(cloud.sprite);\r\n\t\t\tcloud.sprite.anchor.set(0.5);\r\n\t\t\tcloud.sprite.animationSpeed = 0.2;\r\n\t\t\tcloud.sprite.loop = false;\r\n\t\t\tcloud.sprite.hitArea = null;\r\n\t\t\tcloud.sprite.position.x = cx + cloud.x;\r\n\t\t\tcloud.sprite.position.y = cy + cloud.y;\r\n\t\t\tcloud.sprite.play();\r\n\r\n\t\t\tsetTimeout(() => this.removeChild(cloud.sprite), 330);\r\n\r\n\t\t\tif (clouds[0] !== undefined)\r\n\t\t\t\tsetTimeout(() => fn(clouds.shift()), 45);\r\n\t\t};\r\n\r\n\t\tfn(clouds.shift());\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tif (this._loading)\r\n\t\t{\r\n\t\t\tconst cmf = new PIXI.filters.AlphaFilter();\r\n\t\t\tcmf.alpha = 0.8;\r\n\t\t\tthis.filters = [cmf];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.filters = [];\r\n\t\t}\r\n\r\n\t\tlet draworderId = \"std\";\r\n\r\n\t\tif (this.hasActivePartSet(\"handLeft\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"rh-up\" : \"lh-up\";\r\n\t\telse if (this.hasActivePartSet(\"handRightAndHead\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"lh-up\" : \"rh-up\";\r\n\r\n\t\tlet draworder = querySelectorAllArray(`action[id=\"${draworderId}\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\tif (draworder.length === 0)\r\n\t\t\tdraworder = querySelectorAllArray(`action[id=\"std\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\twhile (this.partContainer.children[0])\r\n\t\t\tthis.partContainer.removeChild(this.partContainer.children[0]);\r\n\r\n\t\tfor (let type of draworder)\r\n\t\t\tif (this._sprites[type] !== undefined)\r\n\t\t\t\tthis._sprites[type].forEach(part => this.partContainer.addChild(part));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.actions.forEach(action => this.updateAction(action));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tupdateAction(action = null)\r\n\t{\r\n\t\tconst center = {\r\n\t\t\tx: this._width / 2,\r\n\t\t\ty: this._height / 2\r\n\t\t};\r\n\r\n\t\tconst activePartSets = this.getActivePartSets(action);\r\n\t\tconst frame = ++this._frames[action.id] || 0;\r\n\r\n\t\tconst hiddenlayers = [];\r\n\t\tconst avatarParts = this._loading ? (loadingAvatar !== null ? loadingAvatar._parts : {}) : this._parts;\r\n\r\n\t\tavatarParts.forEach(data => hiddenlayers.push(...data.hiddenlayers));\r\n\r\n\t\tlet bodyparts = [];\r\n\t\tthis.getBodyparts().forEach(bodypart => bodyparts.push(getGeometry().querySelector(`type[id=\"${this.geometry}\"] bodypart[id=\"${bodypart}\"]`)));\r\n\r\n\t\tfor (const partset of bodyparts.sort(radiusComparator))\r\n\t\t{\r\n\t\t\tlet bodypart = partset.getAttribute(\"id\");\r\n\t\t\tlet items = querySelectorAllArray(\"item\", partset).sort(radiusComparator);\r\n\r\n\t\t\tfor (const item of items)\r\n\t\t\t{\r\n\t\t\t\tlet partDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\tlet partType = item.getAttribute(\"id\");\r\n\t\t\t\tlet partDirectionWithoutFlip = partDirection;\r\n\t\t\t\tlet partTypeWithoutFlip = partType;\r\n\t\t\t\tlet partSwapped = false;\r\n\t\t\t\tlet removeSetType = getRemoveSetType(partType);\r\n\r\n\t\t\t\tif (removeSetType !== null)\r\n\t\t\t\t\thiddenlayers.push(removeSetType);\r\n\r\n\t\t\t\tif (partDirection > 3 && partDirection < 7)\r\n\t\t\t\t{\r\n\t\t\t\t\tpartSwapped = true;\r\n\t\t\t\t\tpartType = getFlippedSetType(partType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet partValidActions = getValidActionsForPart(partType);\r\n\t\t\t\tlet partFrames = getAnimationFrames(action.id, partType);\r\n\r\n\t\t\t\tif (activePartSets.indexOf(partType) === -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (this._sprites[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip] = {};\r\n\r\n\t\t\t\tif (hiddenlayers.indexOf(partType) > -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (avatarParts[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tfor (const part of avatarParts[partTypeWithoutFlip].parts)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._loading && part.library !== \"hh_human_body\")\r\n\t\t\t\t\t\tbreak; // Other parts are probably from another library.\r\n\r\n\t\t\t\t\tlet offset = {\r\n\t\t\t\t\t\tx: parseInt(partset.getAttribute(\"x\")),\r\n\t\t\t\t\t\ty: parseInt(partset.getAttribute(\"y\"))\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tlet partFlipped = false;\r\n\t\t\t\t\tlet partFrame = frame % (partFrames !== null ? Object.values(partFrames).length : 1);\r\n\t\t\t\t\tlet partAction = (partFrames && partFrames[partFrame] ? partFrames[partFrame].assetpartdefinition : action.assetpartdefinition);\r\n\r\n\t\t\t\t\tif (partValidActions.indexOf(partAction) === -1)\r\n\t\t\t\t\t\tpartAction = partValidActions[0];\r\n\r\n\t\t\t\t\tpartDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\t\tpartFrame = partFrames && partFrames[partFrame] ? partFrames[partFrame].number : 0;\r\n\r\n\t\t\t\t\tlet animationOffset = getAnimationOffset(action.id, bodypart, frame % getAnimationFramesCount(action.id), partDirection);\r\n\t\t\t\t\tlet generateAssetName = () => `h_${partAction}_${partType}_${part.id}_${partDirection}_${partFrame}`;\r\n\t\t\t\t\tlet sprite = getSprite(part.library, generateAssetName(), center);\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opf = partFrame;\r\n\t\t\t\t\t\tpartFrame = 0;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartFrame = opf;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpartDirection = 6 - partDirection;\r\n\t\t\t\t\t\tpartFlipped = partDirectionWithoutFlip > 3 && partDirectionWithoutFlip < 7;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opa = partAction;\r\n\t\t\t\t\t\tpartAction = \"std\";\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartAction = opa;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// if (partType !== \"ey\" && partType !== \"fc\")\r\n\t\t\t\t\t\t// \tLogger.debug(\"Sprite not found!\", generateAssetName(), part.library, partType);\r\n\r\n\t\t\t\t\t\tbreak; // Don't draw incomplete pieces.\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!partSwapped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x += offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y += offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x -= offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y -= offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (partFlipped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.scale.x = -1;\r\n\t\t\t\t\t\tsprite.x = (((this._width - sprite.width) - sprite.x) + sprite.width) + animationOffset.x;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsprite.x = Math.floor(sprite.x);\r\n\t\t\t\t\tsprite.y = Math.floor(sprite.y);\r\n\r\n\t\t\t\t\tif (part.colorable && partType !== \"ey\" && !this._loading)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst colors = this.figure.parts[part.set].color;\r\n\t\t\t\t\t\tconst color = colors[part.colorindex - 1] || colors[0];\r\n\t\t\t\t\t\tconst fdColor = getFigureData().querySelector(`palette[id=\"${part.paletteid}\"] color[id=\"${color}\"]`);\r\n\r\n\t\t\t\t\t\tif (fdColor !== null)\r\n\t\t\t\t\t\t\tsprite.tint = parseInt(`0x${fdColor.textContent}`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this._sprites[partTypeWithoutFlip][part.index] !== undefined)\r\n\t\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index].destroy(false);\r\n\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index] = sprite;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\t\tapplication.getManager(AvatarManager).removeAvatar(this);\r\n\t}\r\n\r\n}\r\n","const debugMode = false;\r\n\r\nexport class Logger\r\n{\r\n\r\n\tstatic debug(...data)\r\n\t{\r\n\t\tif (!debugMode)\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(\"[D]\", ...data);\r\n\t}\r\n\r\n\tstatic error(...data)\r\n\t{\r\n\t\tconsole.error(\"[E]\", ...data);\r\n\t}\r\n\r\n}\r\n","export class FigureString\r\n{\r\n\r\n\tget parts()\r\n\t{\r\n\t\treturn this._parts;\r\n\t}\r\n\r\n\tconstructor(figure)\r\n\t{\r\n\t\tthis._parts = {};\r\n\r\n\t\tthis.parse(figure);\r\n\t}\r\n\r\n\thasPartId(type, id)\r\n\t{\r\n\t\tif (!this.hasPartType(type))\r\n\t\t\treturn false;\r\n\r\n\t\treturn this._parts[type].id === id;\r\n\t}\r\n\r\n\thasPartType(type)\r\n\t{\r\n\t\treturn this._parts[type] !== undefined;\r\n\t}\r\n\r\n\tparse(figure)\r\n\t{\r\n\t\tfigure = figure.split(\".\");\r\n\t\tfigure = figure.map(part => part.split(\"-\"));\r\n\t\tfigure = figure.sort((a, b) => a[0].localeCompare(b[0]));\r\n\t\tfigure.forEach(part => this._parts[part[0]] = {id: parseInt(part[1]), color: [part[2], part[3]].filter(n => n !== null)});\r\n\t}\r\n\r\n\ttoString()\r\n\t{\r\n\t\tconst str = [];\r\n\r\n\t\tthis.parts.forEach((data, type) => str.push([type, data.id, ...data.color].join(\"-\")));\r\n\r\n\t\treturn str.join(\".\");\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../logging.js\";\r\n\r\nexport class Manager\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn application.display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn application.loader;\r\n\t}\r\n\r\n\tget name()\r\n\t{\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn application.stage;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._name = this.constructor.name;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tLogger.debug(`Initializing manager: ${this.name}`)\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t}\r\n\r\n}\r\n","import { initializeAvatarRenderer, loadAvatarClothingConfig, loadAvatarClothingLibrary } from \"./shared.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport const avatarResources = {\r\n\tpoof: {\r\n\t\t\"1_1\": \"./resource/image/avatar/poof/1-1.png\",\r\n\t\t\"1_2\": \"./resource/image/avatar/poof/1-2.png\",\r\n\t\t\"1_3\": \"./resource/image/avatar/poof/1-3.png\",\r\n\t\t\"1_4\": \"./resource/image/avatar/poof/1-4.png\",\r\n\t\t\"2_1\": \"./resource/image/avatar/poof/2-1.png\",\r\n\t\t\"2_2\": \"./resource/image/avatar/poof/2-2.png\",\r\n\t\t\"2_3\": \"./resource/image/avatar/poof/2-3.png\",\r\n\t\t\"2_4\": \"./resource/image/avatar/poof/2-4.png\",\r\n\t\t\"3_1\": \"./resource/image/avatar/poof/3-1.png\",\r\n\t\t\"3_2\": \"./resource/image/avatar/poof/3-2.png\",\r\n\t\t\"3_3\": \"./resource/image/avatar/poof/3-3.png\",\r\n\t\t\"3_4\": \"./resource/image/avatar/poof/3-4.png\",\r\n\t\t\"4_1\": \"./resource/image/avatar/poof/4-1.png\",\r\n\t\t\"4_2\": \"./resource/image/avatar/poof/4-2.png\",\r\n\t\t\"4_3\": \"./resource/image/avatar/poof/4-3.png\",\r\n\t\t\"4_4\": \"./resource/image/avatar/poof/4-4.png\"\r\n\t}\r\n};\r\n\r\nexport class AvatarManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatars = [];\r\n\t\tthis.lastUpdate = 0;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tawait loadAvatarClothingConfig(\"actions\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"animations\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"draworder\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"effectmap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuredata\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuremap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"geometry\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"offsets\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"partsets\", this.loader);\r\n\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_body\", this.loader);\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_face\", this.loader);\r\n\r\n\t\tavatarResources.poof.forEach(image => this.loader.add(image));\r\n\t}\r\n\r\n\tinitializeRenderer()\r\n\t{\r\n\t\tinitializeAvatarRenderer();\r\n\r\n\t\tapplication.ticker.add(() =>\r\n\t\t{\r\n\t\t\tif (this.lastUpdate === -1 || (application.ticker.lastTime - this.lastUpdate) > 90)\r\n\t\t\t{\r\n\t\t\t\tthis.lastUpdate = application.ticker.lastTime;\r\n\r\n\t\t\t\tthis.avatars.forEach(avatar => avatar.build());\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tnewAvatar(...options)\r\n\t{\r\n\t\tconst avatar = new Avatar(...options);\r\n\r\n\t\tthis.avatars.push(avatar);\r\n\r\n\t\treturn avatar;\r\n\t}\r\n\r\n\tremoveAvatar(avatar)\r\n\t{\r\n\t\tthis.avatars = this.avatars.filter(a => a.id !== avatar.id);\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst configJson = \"./resource/config/config.json\";\r\n\r\nexport class ConfigManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.config = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(configJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onConfigLoaded(application.getResource(configJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.config);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.config));\r\n\t}\r\n\r\n\tonConfigLoaded(config)\r\n\t{\r\n\t\tif (config === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.config = config.data;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { ConfigManager } from \"../config/config.js\";\r\n\r\nconst textsJson = \"./resource/config/texts.json\";\r\n\r\nexport class I18nManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.texts = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(textsJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onTextsLoaded(application.getResource(textsJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.texts);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.text, application.getManager(ConfigManager).config));\r\n\t}\r\n\r\n\tonTextsLoaded(texts)\r\n\t{\r\n\t\tif (texts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.texts = texts.data;\r\n\t}\r\n\r\n}\r\n","import { removeHtml } from \"./core/dom-utils.js\";\r\n\r\nlet frame = 0;\r\n\r\nconst stageElement = \"main#stage-mount\";\r\n\r\nexport class Display extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget frame()\r\n\t{\r\n\t\treturn frame;\r\n\t}\r\n\r\n\tget renderer()\r\n\t{\r\n\t\treturn this.app.renderer;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.app.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.app.ticker;\r\n\t}\r\n\r\n\tget view()\r\n\t{\r\n\t\treturn this.app.view;\r\n\t}\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this.renderer.height / this.dpi;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this.renderer.width / this.dpi;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.dpi = 1;//window.devicePixelRatio;\r\n\t\tthis.mount = document.querySelector(stageElement);\r\n\r\n\t\tif (this.mount === null)\r\n\t\t\tthrow new Error(\"Display mount not found!\");\r\n\r\n\t\tremoveHtml(this.mount);\r\n\r\n\t\tthis.initApp();\r\n\t\tthis.initEvents();\r\n\r\n\t\tthis.ticker.add(() => frame++);\r\n\t}\r\n\r\n\tinitApp()\r\n\t{\r\n\t\tthis.app = new PIXI.Application({\r\n\t\t\theight: window.innerHeight / this.dpi,\r\n\t\t\twidth: window.innerWidth / this.dpi,\r\n\t\t\tantialiasing: false,\r\n\t\t\ttransparent: false,\r\n\t\t\tresolution: this.dpi,\r\n\t\t\troundPixels: false\r\n\t\t});\r\n\r\n\t\tthis.mount.appendChild(this.view);\r\n\t}\r\n\r\n\tinitEvents()\r\n\t{\r\n\t\twindow.addEventListener(\"resize\", () => this.onWindowResize());\r\n\t}\r\n\r\n\tonWindowResize()\r\n\t{\r\n\t\tthis.renderer.resize(window.innerWidth / this.dpi, window.innerHeight / this.dpi);\r\n\t\tthis.emit(\"resize\");\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\n\r\nconst toolbarHeight = 54;\r\n\r\nexport class Toolbar extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x24211C);\r\n\t\tthis.drawRect(0, 0, application.display.width, toolbarHeight);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x27251F);\r\n\t\tthis.drawRect(0, 0, application.display.width, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x201D19);\r\n\t\tthis.drawRect(0, toolbarHeight - 6, application.display.width, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x33312B);\r\n\t\tthis.drawRect(0, toolbarHeight, application.display.width, 3);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nconst memenuSize = 60;\r\nconst memenuSizeHalf = Math.floor(memenuSize / 2);\r\n\r\nexport class MeMenu extends PIXI.Container\r\n{\r\n\r\n\tget avatar()\r\n\t{\r\n\t\treturn this._avatar;\r\n\t}\r\n\r\n\tget chatBubble()\r\n\t{\r\n\t\treturn this._chatBubble;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._avatarHolder = new PIXI.Graphics();\r\n\t\tthis._avatarHolder.buttonMode = true;\r\n\t\tthis._avatarHolder.interactive = true;\r\n\t\tthis._avatarHolder.on(\"pointerover\", () => this.onAvatarHover());\r\n\t\tthis._avatarHolder.on(\"pointerout\", () => this.onAvatarLeave());\r\n\r\n\t\tthis._avatar = application.getManager(AvatarManager).newAvatar(\"\", \"vertical\", \"head\");\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.headDirection = 3;\r\n\t\tthis.avatar.position.x = -15;\r\n\t\tthis.avatar.position.y = -11;\r\n\t\tthis.avatar.update();\r\n\t\tthis._avatarHolder.addChild(this.avatar);\r\n\r\n\t\tthis._chatBubble = new ChatBubble();\r\n\t\tthis.chatBubble.position.x = memenuSize + 8;\r\n\t\tthis.chatBubble.position.y = 8;\r\n\t\tthis.chatBubble.on(\"pointerover\", () => this.onChatBubbleHover());\r\n\t\tthis.chatBubble.on(\"pointerout\", () => this.onChatBubbleLeave());\r\n\r\n\t\tthis.addChild(this._avatarHolder);\r\n\t\tthis.addChild(this.chatBubble);\r\n\r\n\t\tthis.draw();\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\r\n\t\tsetTimeout(() => this.avatar.addAction(\"GestureSmile\"), 500);\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.position.x = 16;\r\n\t\tthis.position.y = application.display.height - (memenuSize + 16);\r\n\r\n\t\tthis._avatarHolder.clear();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x000000, 0.25);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf + 2, memenuSizeHalf + 2);\r\n\t\tthis._avatarHolder.endFill();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x0C3A65);\r\n\t\tthis._avatarHolder.lineStyle(4, 0x244d74);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf, memenuSizeHalf);\r\n\t\tthis._avatarHolder.endFill();\r\n\t}\r\n\r\n\tonAvatarHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"GestureSurprised\");\r\n\t}\r\n\r\n\tonAvatarLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSurprised\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n\tonChatBubbleHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"Talk\");\r\n\t}\r\n\r\n\tonChatBubbleLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"Talk\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n}\r\n\r\nclass ChatBubble extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.imLeft = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.left).texture); // 17x44\r\n\t\tthis.imMiddle = new PIXI.extras.TilingSprite(application.getResource(interfaceResources.chatBubble.middle).texture); // 1x44\r\n\t\tthis.imRight = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.right).texture); // 12x44\r\n\r\n\t\tthis.imLeft.height = 44;\r\n\t\tthis.imMiddle.height = 44;\r\n\t\tthis.imRight.height = 44;\r\n\r\n\t\tthis.addChild(this.imLeft);\r\n\t\tthis.addChild(this.imMiddle);\r\n\t\tthis.addChild(this.imRight);\r\n\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tlet textWidth = 100;\r\n\r\n\t\tthis.imLeft.position.x = 0;\r\n\t\tthis.imLeft.position.y = 0;\r\n\r\n\t\tthis.imMiddle.position.x = 17;\r\n\t\tthis.imMiddle.position.y = 0;\r\n\t\tthis.imMiddle.width = textWidth;\r\n\r\n\t\tthis.imRight.position.x = 17 + textWidth;\r\n\t\tthis.imRight.position.y = 0;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { Toolbar } from \"./toolbar.js\";\r\nimport { MeMenu } from \"./memenu.js\";\r\n\r\nexport const interfaceResources = {\r\n\tchatBubble: {\r\n\t\tleft: \"./resource/image/interface/chat-bubble/left.png\",\r\n\t\tmiddle: \"./resource/image/interface/chat-bubble/middle.png\",\r\n\t\tright: \"./resource/image/interface/chat-bubble/right.png\"\r\n\t}\r\n};\r\n\r\nexport class InterfaceContainer extends PIXI.Container\r\n{\r\n\r\n\tget memenu()\r\n\t{\r\n\t\treturn this._memenu;\r\n\t}\r\n\r\n\tget toolbar()\r\n\t{\r\n\t\treturn this._toolbar;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._memenu = new MeMenu();\r\n\t\tthis._toolbar = new Toolbar();\r\n\r\n\t\tthis.addChild(this.memenu);\r\n\t\tthis.addChild(this.toolbar);\r\n\r\n\t\tthis.memenu.avatar.figure = \"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\";\r\n\t}\r\n\r\n}\r\n\r\nexport class InterfaceManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(interfaceResources.chatBubble.left);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.middle);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.right);\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidth, tileWidthHalf } from \"./shared.js\";\r\nimport { withInstance } from \"../../core/pixi-utils.js\";\r\n\r\nexport class TileCursor extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tthis.lineStyle(4, 0xFFFFFF);\r\n\t\tthis.moveTo(points[0].x, points[0].y - 1);\r\n\t\tthis.lineTo(points[1].x, points[1].y - 1);\r\n\t\tthis.lineTo(points[2].x, points[2].y - 1);\r\n\t\tthis.lineTo(points[3].x, points[3].y - 1);\r\n\t\tthis.lineTo(points[0].x, points[0].y - 1);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.filters = [\r\n\t\t\twithInstance(new PIXI.filters.DropShadowFilter(), shadow =>\r\n\t\t\t{\r\n\t\t\t\tshadow.color = 0x000000;\r\n\t\t\t\tshadow.alpha = 0.2;\r\n\t\t\t\tshadow.blur = 0;\r\n\t\t\t\tshadow.distance = 2;\r\n\t\t\t\tshadow.rotation = 90;\r\n\t\t\t})\r\n\t\t];\r\n\t}\r\n\r\n\thover(x, y, z)\r\n\t{\r\n\t\tthis.position.x = x;\r\n\t\tthis.position.y = y - 2;\r\n\t\tthis.z = z;\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -tileWidthHalf,\r\n\t\t\ty: -tileHeightHalf\r\n\t\t};\r\n\t}\r\n\r\n}\r\n","export const heightMaps = [];\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx000x\r\n0000x\r\nx000x\r\nx000x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx110x\r\nx110x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx2222xxxxxxxxxxxxxx\r\nx2222xxxxxxxxxxxxxx\r\nx2222211111xx000000\r\nx222221111110000000\r\nx222221111110000000\r\nx2222211111xx000000\r\nxx22xxx1111xxxxxxxx\r\nxx11xxx1111xxxxxxxx\r\nx1111xx1111xx000000\r\nx1111xx111110000000\r\nx1111xx111110000000\r\nx1111xx1111xx000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxxx\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx000x11xxxxxxxx11x000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\n000000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx2222xx111111111111\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\n22222xx000000000000\r\nx2222xx000000000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x00000000xxxxxxxx00000000xxxx\r\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\n0000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n","import { tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\n\r\nexport class WallBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.doorHeight = 85;\r\n\t\tthis.floorThickness = floorThickness;\r\n\t\tthis.wallHeight = 115 + (top * tileHeight);\r\n\t\tthis.wallThickness = wallThickness;\r\n\t}\r\n\r\n}\r\n\r\nexport class WallColumn extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tlet hole = doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0x9697A1);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - (this.wallThickness / 2) - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0xB5B9C9);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallCorner extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(0, -this.wallHeight);\r\n\t\tthis.lineTo(this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight - this.wallThickness);\r\n\t\tthis.lineTo(-this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallRow extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tlet hole = doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0xBABECE);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x92939D);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(-this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../../core/pixi-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { TileCursor } from \"./cursor.js\";\r\nimport { heightMaps } from \"./dev.js\";\r\nimport { getHighestAndLowest, getStairsType, getTileHeightIndex, getTileImplementation, hitAreaOffset, isDoor, needsWallC, needsWallR, tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\nimport { Tile, TileBase } from \"./tiles.js\";\r\nimport { WallColumn, WallCorner, WallRow } from \"./walls.js\";\r\n\r\nconst debugDoor = true;\r\nconst debugWalls = true;\r\n\r\nexport class RoomView extends PIXI.Graphics\r\n{\r\n\r\n\tget entities()\r\n\t{\r\n\t\treturn this._entities;\r\n\t}\r\n\r\n\tget heightmap()\r\n\t{\r\n\t\treturn this._heightmap;\r\n\t}\r\n\r\n\tget roomScale()\r\n\t{\r\n\t\treturn this.scale.x;\r\n\t}\r\n\r\n\tset roomScale(value)\r\n\t{\r\n\t\tthis.scale.x = value;\r\n\t\tthis.scale.y = value;\r\n\t}\r\n\r\n\tget tiles()\r\n\t{\r\n\t\treturn this._tiles;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._heightmap = {};\r\n\t\tthis._tiles = {};\r\n\r\n\t\tthis.columns = 0;\r\n\t\tthis.rows = 0;\r\n\r\n\t\tthis.floorThickness = 8;\r\n\t\tthis.wallThickness = 8;\r\n\r\n\t\tthis.highest = 0;\r\n\t\tthis.lowest = 0;\r\n\r\n\t\tthis.offsets = {x: 0, y: 0};\r\n\r\n\t\tthis.roomScale = 1;\r\n\t\tthis.tileCursor = new TileCursor();\r\n\t\tthis.tileCursor.visible = false;\r\n\r\n\t\tsimpleDraggable(this);\r\n\t\tthis.prepareHeightmap(heightMaps[5]);\r\n\r\n\t\tapplication.ticker.add(() => this.onTick());\r\n\t}\r\n\r\n\tclearEverything()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\twhile (this.children[0])\r\n\t\t\tthis.removeChild(this.children[0]);\r\n\r\n\t\tthis.addChild(this.tileCursor);\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._tiles = {};\r\n\t}\r\n\r\n\tprepareHeightmap(floorplan)\r\n\t{\r\n\t\tthis.emit(\"room-view-emptied\");\r\n\r\n\t\tthis.clearEverything();\r\n\r\n\t\tconst tiles = this._heightmap = floorplan\r\n\t\t\t.trim()\r\n\t\t\t.split(\"\\n\")\r\n\t\t\t.map(row => row.split(\"\").map(char => getTileHeightIndex(char)));\r\n\r\n\t\tconst {highest, lowest} = getHighestAndLowest(this.heightmap);\r\n\t\tthis.highest = highest;\r\n\t\tthis.lowest = lowest;\r\n\r\n\t\tif (tiles.length === 0)\r\n\t\t\treturn;\r\n\r\n\t\tthis.columns = tiles[0].length;\r\n\t\tthis.rows = tiles.length;\r\n\r\n\t\tfor (let row = 0; row < tiles.length; row++)\r\n\t\t{\r\n\t\t\tthis._tiles[row] = {};\r\n\r\n\t\t\tfor (let column = 0; column < tiles[row].length; column++)\r\n\t\t\t{\r\n\t\t\t\tlet tileHeightLocal = this.getTileHeight(row, column);\r\n\r\n\t\t\t\tif (tileHeightLocal === null)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlet door = isDoor(tiles, row, column);\r\n\t\t\t\t// let doorDirection = door ? getDoorDirection(tiles, row, column) : null;\r\n\t\t\t\tlet stairsType = getStairsType(tiles, row, column);\r\n\t\t\t\tlet implementation = getTileImplementation(stairsType);\r\n\r\n\t\t\t\tlet wallC = needsWallC(tiles, row, column);\r\n\t\t\t\tlet wallR = needsWallR(tiles, row, column);\r\n\t\t\t\tlet wall = wallC || wallR;\r\n\r\n\t\t\t\tlet x = this.getX(row, column);\r\n\t\t\t\tlet y = this.getY(row, column);\r\n\t\t\t\tlet z = (row * this.columns) + column; //this.getZ(row, column);\r\n\r\n\t\t\t\tif (row === 1 && column === 21)\r\n\t\t\t\t\tconsole.log(wallC, wallR, door, isDoor(tiles, row - 1, column));\r\n\r\n\t\t\t\tif (wall)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet wallImplementations = [];\r\n\t\t\t\t\tlet isDoorColumn = isDoor(tiles, row - 1, column);\r\n\t\t\t\t\tlet isDoorRow = isDoor(tiles, row, column - 1);\r\n\t\t\t\t\tlet top = Math.abs(this.highest - tileHeightLocal);\r\n\r\n\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallCorner(this.floorThickness, this.wallThickness, top));\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet wallZ = isDoorColumn || isDoorRow ? (z + 2) : (z - 1);\r\n\r\n\t\t\t\t\tfor (const wi of wallImplementations)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.addChild(withInstance(wi, wall =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.entities.push(wall);\r\n\r\n\t\t\t\t\t\t\twall.x = x + tileWidthHalf;\r\n\t\t\t\t\t\t\twall.y = y + (stairsType !== undefined ? tileHeight : 0);\r\n\t\t\t\t\t\t\twall.z = wallZ;\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.addChild(withInstance(new implementation(this.floorThickness), tile =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.entities.push(tile);\r\n\t\t\t\t\tthis._tiles[row][column] = tile;\r\n\r\n\t\t\t\t\ttile.row = row;\r\n\t\t\t\t\ttile.column = column;\r\n\r\n\t\t\t\t\tif (debugDoor && door)\r\n\t\t\t\t\t\ttile.tint = 0xFF0000;\r\n\r\n\t\t\t\t\tif (debugWalls)\r\n\t\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FFFF;\r\n\t\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FF00;\r\n\t\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x0000FF;\r\n\r\n\t\t\t\t\ttile.on(\"tile-click\", evt => this.onTileClick(evt));\r\n\t\t\t\t\ttile.on(\"tile-hover\", evt => this.onTileHover(evt));\r\n\t\t\t\t\ttile.on(\"tile-leave\", evt => this.onTileLeave(evt));\r\n\r\n\t\t\t\t\ttile.x = x;\r\n\t\t\t\t\ttile.y = y;\r\n\t\t\t\t\ttile.z = z;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.centerRoom();\r\n\r\n\t\tthis.position.x = Math.floor((application.display.width / 2) - (this.width / 2));\r\n\t\tthis.position.y = Math.floor((application.display.height / 2) - (this.height / 2 - 115));\r\n\r\n\t\tthis.hitArea = new PIXI.Rectangle(-hitAreaOffset, -hitAreaOffset, this.width + (hitAreaOffset * 2), this.height + (hitAreaOffset * 2));\r\n\r\n\t\tthis.emit(\"room-view-ready\");\r\n\t}\r\n\r\n\tassociateEntityToTile(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet pos = this.getEntityPosition(entity, row, column, h);\r\n\r\n\t\tentity.position.x = pos.x;\r\n\t\tentity.position.y = pos.y;\r\n\t\tentity.z = pos.z;\r\n\t}\r\n\r\n\tcenterEntity(entity, animate = true)\r\n\t{\r\n\t\tlet x = application.display.width / 2;\r\n\t\tlet y = application.display.height / 2;\r\n\r\n\t\tx -= Math.round(entity.x + entity.width / 2);\r\n\t\ty -= Math.round(entity.y + entity.height / 2);\r\n\r\n\t\tx = x - (x % 2);\r\n\r\n\t\tif (animate)\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 800,\r\n\t\t\t\teasing: \"easeInOutSine\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 45,\r\n\t\t\t\teasing: \"linear\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcenterRoom()\r\n\t{\r\n\t\tif (this.entities.length > 0)\r\n\t\t{\r\n\t\t\tlet xred = this.entities.reduce((acc, cur) => acc.x < cur.x ? acc : cur).x;\r\n\t\t\tlet yred = this.entities\r\n\t\t\t\t.filter(acc => acc instanceof TileBase)\r\n\t\t\t\t.reduce((acc, cur) => acc.y < cur.y ? acc : cur).y;\r\n\r\n\t\t\tthis.offsets.x = -xred;\r\n\t\t\tthis.offsets.y = -yred;\r\n\r\n\t\t\tthis.entities.forEach(entity =>\r\n\t\t\t{\r\n\t\t\t\tentity.x -= xred;\r\n\t\t\t\tentity.y -= yred;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetClosestTile(x, y)\r\n\t{\r\n\t}\r\n\r\n\tgetEntityPosition(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet offsets = {x: 0, y: 0};\r\n\t\tlet tile = this.getTile(row, column);\r\n\r\n\t\tif (entity.getRoomOffsets !== undefined)\r\n\t\t\toffsets = entity.getRoomOffsets();\r\n\r\n\t\tlet isStairs = !(tile instanceof Tile);\r\n\r\n\t\tlet x = (this.getX(row, column) + tileWidthHalf) + (offsets.x + this.offsets.x);\r\n\t\tlet y = (this.getY(row, column) + tileHeightHalf) + (offsets.y + this.offsets.y) + (tile && isStairs ? tileHeightHalf : 0);\r\n\t\tlet z = this.getZ(row, column + 2, 5) + h;\r\n\r\n\t\tif (isDoor(this.tiles, row, column))\r\n\t\t\tz = this.getRealZ(row, column, h);\r\n\r\n\t\treturn {x, y, z, isStairs};\r\n\t}\r\n\r\n\tgetTile(row, column)\r\n\t{\r\n\t\tif (this.tiles[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.tiles[row][column] || undefined;\r\n\t}\r\n\r\n\tgetTileHeight(row, column)\r\n\t{\r\n\t\tif (this.heightmap[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.heightmap[row][column];\r\n\t}\r\n\r\n\tgetX(row, column)\r\n\t{\r\n\t\treturn (column - row) * tileWidthHalf;\r\n\t}\r\n\r\n\tgetY(row, column)\r\n\t{\r\n\t\tlet h = this.getTileHeight(row, column);\r\n\r\n\t\tif (h === undefined)\r\n\t\t\th = 0;\r\n\r\n\t\tif (getStairsType(this.heightmap, row, column) !== undefined)\r\n\t\t\th += 1;\r\n\r\n\t\treturn (column + row) * tileHeightHalf - (h * tileWidthHalf);\r\n\t}\r\n\r\n\tgetZ(row, column, add = 0)\r\n\t{\r\n\t\trow *= 1000;\r\n\t\tcolumn *= 1000;\r\n\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tgetRealZ(row, column, add = 0)\r\n\t{\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tonTick()\r\n\t{\r\n\t\tthis.updateLayerOrder();\r\n\t}\r\n\r\n\tonTileClick(evt)\r\n\t{\r\n\t\tthis.emit(\"tile-click\", evt);\r\n\t}\r\n\r\n\tonTileHover(evt)\r\n\t{\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tlet {x, y} = this.getEntityPosition(this.tileCursor, evt.row, evt.column);\r\n\r\n\t\t\tthis.currentHover = [evt.row, evt.column];\r\n\t\t\tthis.tileCursor.visible = true;\r\n\t\t\tthis.tileCursor.hover(x, y, this.getRealZ(evt.row, evt.column, 1));\r\n\t\t}, 1);\r\n\t}\r\n\r\n\tonTileLeave(evt)\r\n\t{\r\n\t\tthis.currentHover = undefined;\r\n\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tif (this.currentHover !== undefined && (evt.x !== this.currentHover.x || evt.y !== this.currentHover.y))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis.tileCursor.visible = false;\r\n\t\t}, 2);\r\n\t}\r\n\r\n}\r\n","const figures = [\r\n\t\"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\",\r\n\t\"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\",\r\n\t\"hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97\",\r\n\t\"hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106\",\r\n\t\"hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324\",\r\n\t\"hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110\",\r\n\t\"hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586\"\r\n];\r\n\r\nexport const randomFigure = () => figures[Math.floor(Math.random() * figures.length)];\r\n\r\nexport const walkTo = async (rv, avatar, cr, cc, row, column) =>\r\n{\r\n\tlet distance = Math.max(Math.abs(cr - row), Math.abs(cc - column));\r\n\tlet pos = rv.getEntityPosition(avatar, row, column, 2);\r\n\r\n\tavatar.addAction(\"Move\");\r\n\r\n\tlet direction = 0;\r\n\r\n\tif (row < cr && column > cc)\r\n\t\tdirection = 1;\r\n\telse if (row === cr && column > cc)\r\n\t\tdirection = 2;\r\n\telse if (row > cr && column > cc)\r\n\t\tdirection = 3;\r\n\telse if (row > cr && column === cc)\r\n\t\tdirection = 4;\r\n\telse if (row > cr && column < cc)\r\n\t\tdirection = 5;\r\n\telse if (row === cr && column < cc)\r\n\t\tdirection = 6;\r\n\telse if (row < cr && column < cc)\r\n\t\tdirection = 7;\r\n\r\n\tavatar.direction = avatar.headDirection = direction;\r\n\tavatar.z = pos.z;//Math.max(rv.getZ(row, column, 5), rv.getZ(cr, cc, 5));\r\n\r\n\tlet animationDuration = 360 * distance;\r\n\tlet anim = anime({\r\n\t\ttargets: avatar,\r\n\t\tduration: animationDuration,\r\n\t\tx: pos.x,\r\n\t\ty: pos.y,\r\n\t\teasing: \"linear\"\r\n\t});\r\n\r\n\t// anim.update = () => rv.centerEntity(avatar, false);\r\n\r\n\tawait anim.finished;\r\n\r\n\tcr = row;\r\n\tcc = column;\r\n\r\n\tavatar.z = pos.z;\r\n\tavatar.removeAction(\"Move\");\r\n\t// rv.centerEntity(avatar);\r\n\r\n\treturn {cr, cc, avatar};\r\n};\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { tileHeightHalf, tileWidthHalf } from \"../room/shared.js\";\r\n\r\nconst furniResources = {\r\n\tloading: \"./resource/image/furni/loading.png\"\r\n};\r\n\r\nexport class Furni extends PIXI.Container\r\n{\r\n\r\n\tget loading()\r\n\t{\r\n\t\treturn this._loading;\r\n\t}\r\n\r\n\tset loading(value)\r\n\t{\r\n\t\tthis._loading = value;\r\n\t}\r\n\r\n\tconstructor(furniName)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.furniName = furniName;\r\n\r\n\t\tthis._loadingSprite = new PIXI.Sprite(application.getResource(furniResources.loading).texture);\r\n\t\tthis.addChild(this._loadingSprite);\r\n\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -(tileWidthHalf + 2),\r\n\t\t\ty: -(tileHeightHalf + 34)\r\n\t\t};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t}\r\n\r\n}\r\n\r\nexport class FurniManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(furniResources.loading);\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\n\r\nconst roomAssets = {\r\n\tindex: getDeliveryAssetsUrl(\"/room-content/index.xml\"),\r\n\tassets: getDeliveryAssetsUrl(\"/room-content/room_assets.xml\"),\r\n\tmanifest: getDeliveryAssetsUrl(\"/room-content/manifest.xml\"),\r\n\tvisualization: getDeliveryAssetsUrl(\"/room-content/room_visualization.xml\")\r\n};\r\n\r\nexport class RoomManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(roomAssets.index);\r\n\t\tthis.loader.add(roomAssets.assets);\r\n\t\tthis.loader.add(roomAssets.manifest);\r\n\t\tthis.loader.add(roomAssets.visualization);\r\n\t}\r\n\r\n}\r\n","import { AvatarManager } from \"./view/avatar/manager.js\";\r\nimport { Logger } from \"./core/logging.js\";\r\nimport { LoadingView } from \"./view/loading-view.js\";\r\nimport { Display } from \"./display.js\";\r\nimport { I18nManager } from \"./core/i18n/i18n.js\";\r\nimport { ConfigManager } from \"./core/config/config.js\";\r\nimport { initialLoadingDelay } from \"./preferences.js\";\r\nimport { InterfaceContainer, InterfaceManager } from \"./ui/interface/interface.js\";\r\nimport { RoomView } from \"./view/room/room-view.js\";\r\nimport { randomFigure, walkTo } from \"./core/dev-utils.js\";\r\nimport { Furni, FurniManager } from \"./view/furni/furni.js\";\r\nimport { RoomManager } from \"./view/room/manager.js\";\r\n\r\nexport class InitializerLoader extends PIXI.loaders.Loader\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.urls = [];\r\n\t}\r\n\r\n\tadd(url, stage = 1)\r\n\t{\r\n\t\tthis.urls.push({\r\n\t\t\tstage,\r\n\t\t\turl\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tload()\r\n\t{\r\n\t\tLogger.debug(\"InitializerLoader\", \"Skipped load() initializing..\");\r\n\t}\r\n\r\n\trealLoad(cb, stage = 1)\r\n\t{\r\n\t\tthis.urls\r\n\t\t\t.filter(url => url.stage === stage)\r\n\t\t\t.map(url => url.url)\r\n\t\t\t.forEach(url => super.add(url));\r\n\r\n\t\tsuper.load(cb);\r\n\t}\r\n\r\n}\r\n\r\nexport class Application extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn this._display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn this._loader;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.display.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.display.ticker;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._display = new Display();\r\n\t\tthis._loader = new InitializerLoader();\r\n\r\n\t\tthis.managers = [];\r\n\t}\r\n\r\n\taddDefaultManagers()\r\n\t{\r\n\t\tthis.addManager(new ConfigManager());\r\n\t\tthis.addManager(new I18nManager());\r\n\r\n\t\tthis.addManager(new AvatarManager());\r\n\t\tthis.addManager(new FurniManager());\r\n\t\tthis.addManager(new RoomManager());\r\n\r\n\t\tthis.addManager(new InterfaceManager());\r\n\t}\r\n\r\n\taddManager(manager)\r\n\t{\r\n\t\tLogger.debug(\"Application\", `Added manager ${manager.constructor.name}`);\r\n\t\tthis.managers.push(manager);\r\n\t}\r\n\r\n\tgetManager(managerClass)\r\n\t{\r\n\t\treturn this.managers.find(manager => manager instanceof managerClass);\r\n\t}\r\n\r\n\tcreate()\r\n\t{\r\n\t\tthis.loadingView = new LoadingView();\r\n\t\tthis.loadingView.on(\"loader-ready\", () => this.emit(\"application-can-run\"));\r\n\t\tthis.stage.addChild(this.loadingView);\r\n\r\n\t\tthis.addDefaultManagers();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait this.managers.forEach(async manager => await manager.initialize());\r\n\t}\r\n\r\n\tasync run()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 0;\r\n\t\tsetTimeout(() => this.loader.realLoad(() => this.onLoadingStage0Done(), 0), initialLoadingDelay);\r\n\t}\r\n\r\n\tonLoadingStage0Done()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 1;\r\n\t\tthis.loadingView.percentage = 0;\r\n\t\tthis.loader.realLoad(() => this.onLoadingStage1Done(), 1);\r\n\t}\r\n\r\n\tonLoadingStage1Done()\r\n\t{\r\n\t\tLogger.debug(\"Application\", \"Loading of manager data done!\");\r\n\t\tthis.emit(\"application-loading-done\");\r\n\r\n\t\tthis.getManager(AvatarManager).initializeRenderer();\r\n\r\n\t\tdelete this.loader;\r\n\r\n\t\tthis.stage.removeChild(this.loadingView);\r\n\r\n\t\tlet avatars = [undefined, undefined];\r\n\t\tlet furnis = [undefined];\r\n\t\tlet roomViewer = new RoomView();\r\n\r\n\t\tthis.stage.addChild(roomViewer);\r\n\t\tthis.stage.addChild(new InterfaceContainer());\r\n\r\n\t\troomViewer.addChild(avatars[0] = this.getManager(AvatarManager).newAvatar(randomFigure(), \"vertical\", \"full\"));\r\n\t\troomViewer.addChild(avatars[1] = this.getManager(AvatarManager).newAvatar(randomFigure(), \"vertical\", \"full\"));\r\n\r\n\t\troomViewer.addChild(furnis[0] = new Furni(\"throne\"));\r\n\r\n\t\troomViewer.associateEntityToTile(avatars[0], 15, 0, 2);\r\n\t\troomViewer.associateEntityToTile(avatars[1], 8, 20, 2);\r\n\r\n\t\troomViewer.associateEntityToTile(furnis[0], 8, 21, 2);\r\n\r\n\t\tlet controllingAvatar = 0;\r\n\t\tlet current = {cr: 15, cc: 0, avatar: avatars[controllingAvatar]};\r\n\r\n\t\t// avatars[0].addAction(\"Blow\");\r\n\t\tavatars[0].on(\"click\", () => avatars[0].figure = randomFigure());\r\n\t\tavatars[0].on(\"click\", () => roomViewer.centerEntity(avatars[0]));\r\n\r\n\t\tavatars[1].addAction(\"Wave\");\r\n\t\tavatars[1].on(\"click\", () => avatars[1].figure = randomFigure());\r\n\t\tavatars[1].on(\"click\", () => roomViewer.centerEntity(avatars[1]));\r\n\r\n\t\troomViewer.centerEntity(avatars[controllingAvatar]);\r\n\r\n\t\troomViewer.on(\"tile-click\", evt => avatars[controllingAvatar].once(\"avatar-build\", async () => current = await walkTo(roomViewer, current.avatar, current.cr, current.cc, evt.row, evt.column)));\r\n\t}\r\n\r\n\tgetResource(resource, loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources[resource];\r\n\t}\r\n\r\n\tgetResources(loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources;\r\n\t}\r\n\r\n}\r\n","import { Logger } from \"./core/logging.js\";\r\nimport { Application } from \"./application.js\";\r\n\r\n/**\r\n * @type {Application}\r\n */\r\nexport const application = new Application();\r\n\r\n/**\r\n * Class Bootstrapper.\r\n */\r\nexport class Bootstrapper\r\n{\r\n\r\n\t/**\r\n\t * Initializes everything.\r\n\t */\r\n\tstatic async init()\r\n\t{\r\n\t\tLogger.debug(\"Bootstrapper\", \"Loading everything..\");\r\n\r\n\t\tPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n\r\n\t\tapplication.create();\r\n\r\n\t\tapplication.on(\"application-can-run\", () => application.run());\r\n\r\n\t\tawait application.initialize();\r\n\t}\r\n\r\n}\r\n","import { Bootstrapper } from \"./bootstrapper.js\";\r\n\r\nArray.prototype.pushChain = function (...entries)\r\n{\r\n\tthis.push(...entries);\r\n\r\n\treturn this;\r\n};\r\n\r\nArray.prototype.unique = function ()\r\n{\r\n\treturn this.filter((value, index, self) => self.indexOf(value) === index);\r\n};\r\n\r\nObject.prototype.forEach = function (callback)\r\n{\r\n\tfor (let key in this)\r\n\t\tif (this.hasOwnProperty(key))\r\n\t\t\tcallback(this[key], key);\r\n};\r\n\r\nPIXI.Container.prototype.updateLayerOrder = function ()\r\n{\r\n\tlet i = 0;\r\n\r\n\tthis.children.sort((a, b) =>\r\n\t{\r\n\t\tlet az = a.z || 0;\r\n\t\tlet bz = b.z || 0;\r\n\r\n\t\tif (az === bz)\r\n\t\t\treturn this.children.indexOf(a) - this.children.indexOf(b);\r\n\r\n\t\treturn az - bz;\r\n\t});\r\n};\r\n\r\nBootstrapper.init().then(() =>\r\n{\r\n});\r\n"],"names":["innerHTML","container","document","slice","call","querySelectorAll","interactive","data","pos","on","evt","getLocalPosition","simpleDraggableTarget","p","parent","position","x","y","deliveryRoot","getDeliveryUrl","actionsSorted","querySelectorAllArray","getActions","map","action","getAttribute","defaultAction","getAction","loadingAvatar","getDeliveryAssetsUrl","actions","push","LOADED_LIBS","Promise","configUrl","getAvatarClothingConfigUrl","isInitializerLoader","loader","add","application","getResource","LOADED_CONFIGS","debug","resolve","load","LOADING_LIBS","isLibraryLoaded","libraryUrl","getAvatarClothingLibraryUrl","onClothingLibraryLoaded","querySelector","definition","attributes","forEach","attribute","name","value","center","sprite","PIXI","Sprite","getTexture","offset","LOADED_TEXTURES","library","Texture","fromImage","flippedSetType","getPartSets","removeSetType","result","activeParts","activePart","defs","getAnimations","frames","repeats","def","hasAttribute","parseInt","i","number","assetpartdefinition","length","offsets","Math","isNaN","bodypart","context","string","replace","findKey","defaultValue","keyParts","key","split","current","beginFill","moveTo","points","lineTo","endFill","thickness","tileHeight","getTile","getSurroundings","tileNorthEast","tileNorthWest","tileSouthEast","tileSouthWest","StairsType","South","SouthEast","SouthWest","row","column","tiles","char","indexOf","stairsType","filter","t","isDoor","cy","cx","highest","lowest","heightmap","h","abs","round","max","floor","Logger","error","FigureString","_parts","parse","hasPartType","id","figure","part","sort","a","localeCompare","b","color","n","str","parts","join","Avatar","geometry","avatarSet","canPoof","window","performance","now","loaders","Loader","partContainer","Container","addChild","_alsoUpdate","_ticker","_width","_height","_actions","_frames","direction","headDirection","build","_avatarSet","_direction","_figure","poof","_geometry","_headDirection","pushChain","found","hasAction","dir","emit","invalidate","libraries","getLibraries","_loading","download","shift","then","update","getGeometry","activePartSets","getActivePartSets","unique","bodyparts","lib","getFigureMap","parentNode","toLowerCase","settype","getFigureData","set","getElementsByTagName","colorable","hiddenlayers","paletteid","setHiddenlayers","layer","partType","_sprites","decideGeometry","gatherParts","clouds","extras","AnimatedSprite","avatarResources","texture","fn","cloud","anchor","animationSpeed","loop","hitArea","play","removeChild","setTimeout","cmf","filters","AlphaFilter","alpha","draworderId","hasActivePartSet","draworder","getDraworder","children","updateAction","render","frame","avatarParts","getBodyparts","partset","items","item","partDirection","partDirectionWithoutFlip","partTypeWithoutFlip","partSwapped","getRemoveSetType","getFlippedSetType","partValidActions","getValidActionsForPart","partFrames","getAnimationFrames","partFlipped","partFrame","Object","values","partAction","animationOffset","getAnimationOffset","getAnimationFramesCount","generateAssetName","getSprite","opf","opa","scale","width","colors","colorindex","fdColor","tint","textContent","index","destroy","getManager","removeAvatar","radiusComparator","Manager","_name","constructor","display","stage","AvatarManager","avatars","lastUpdate","loadAvatarClothingConfig","loadAvatarClothingLibrary","ticker","lastTime","avatar","options","configJson","ConfigManager","config","onConfigLoaded","evaluateString","assign","textsJson","I18nManager","texts","onTextsLoaded","text","resourceLogo","LoadingBar","barColor","barHeight","barThickness","barWidth","percentage","onTick","clear","drawRect","lineStyle","Graphics","LoadingView","loadingBar","logo","init","loadResources","style","TextStyle","Text","onResourcesLoaded","state","progress","height","getString","Display","dpi","mount","Error","initApp","initEvents","app","renderer","view","Application","innerHeight","innerWidth","appendChild","addEventListener","onWindowResize","resize","utils","EventEmitter","toolbarHeight","Toolbar","draw","memenuSize","memenuSizeHalf","MeMenu","_avatarHolder","buttonMode","onAvatarHover","onAvatarLeave","_avatar","newAvatar","_chatBubble","chatBubble","onChatBubbleHover","onChatBubbleLeave","addAction","drawCircle","removeAction","ChatBubble","imLeft","interfaceResources","left","imMiddle","TilingSprite","middle","imRight","right","textWidth","InterfaceContainer","_memenu","_toolbar","memenu","toolbar","InterfaceManager","TileBase","onClick","onMouseOver","onMouseOut","z","StairsSouth","StairsSouthEast","allPoints","step","ax","ay","Point","tileWidth","StairsSouthWest","Tile","hitAreaOffset","tileHeightHalf","tileWidthHalf","TileCursor","withInstance","DropShadowFilter","blur","distance","rotation","heightMaps","doorHeight","floorThickness","wallHeight","top","wallThickness","WallColumn","hole","doorMode","WallCorner","WallRow","RoomView","_entities","_heightmap","_tiles","columns","rows","roomScale","tileCursor","visible","prepareHeightmap","clearEverything","floorplan","trim","getTileHeightIndex","getHighestAndLowest","tileHeightLocal","getTileHeight","door","getStairsType","implementation","getTileImplementation","wallC","needsWallC","wallR","needsWallR","getX","getY","wallImplementations","isDoorColumn","isDoorRow","wallZ","entities","tile","onTileClick","onTileHover","onTileLeave","centerRoom","Rectangle","getEntityPosition","animate","entity","xred","reduce","acc","cur","yred","getRoomOffsets","isStairs","getZ","getRealZ","updateLayerOrder","currentHover","hover","figures","randomFigure","random","walkTo","cr","cc","rv","anime","anim","finished","furniResources","Furni","furniName","_loadingSprite","loading","FurniManager","roomAssets","RoomManager","assets","manifest","visualization","InitializerLoader","urls","url","_display","_loader","managers","addManager","manager","find","loadingView","addDefaultManagers","initialize","realLoad","onLoadingStage0Done","onLoadingStage1Done","initializeRenderer","furnis","roomViewer","associateEntityToTile","controllingAvatar","centerEntity","once","resources","Bootstrapper","settings","SCALE_MODE","SCALE_MODES","NEAREST","create","run","Array","prototype","self","hasOwnProperty","callback","az","bz"],"mappings":"yBAkCO,aACP,GACSA,UAAY,GAWd,aACP,IADgDC,0DAAYC,eAEpD,GAAGC,KAAH,CAASC,IAAT,CAAcH,EAAUI,gBAAVJ,GAAd,EC/CD,aACP,GACQK,eAGD,aACP,KAAA,IAGKC,GAAO,IAHZ,CAIKC,EAAM,IAJX,GAMQC,GAAG,cAAe,WACzB,GACQC,EAAIH,IADZ,KAAA,GAGOA,EAAKI,gBAALJ,IAJP,EAND,GAaQE,GAAG,YAAa,UACvB,GACQ,IADR,GAEO,IAFP,IAGyB,IAJzB,EAbD,GAoBQA,GAAG,cAAe,UACzB,IAC+B,IAA1BG,UAGEC,GAAIN,EAAKI,gBAALJ,CAAsBK,GAAsBE,MAA5CP,KAEYQ,SAASC,EAAIH,EAAEG,CAAFH,CAAML,EAAIQ,KACvBD,SAASE,EAAIJ,EAAEI,CAAFJ,CAAML,EAAIS,EAR9C,GAYM,eACP,eCtCO,aACP,OACQC,MAGD,aACP,OACQC,GAAe,WAAfA,ECOR,eACA,SAIO,YACP,CACuB,IAAlBC,KADL,GAEEA,GAAgBC,EAAsB,QAAtBA,CAAgCC,GAAhCD,EAA8CE,GAA9CF,CAAkD,kBAAUG,GAAOC,YAAPD,CAAoB,IAApBA,CAA5D,CAAAH,CAFlB,EAIuB,IAAlBK,KAJL,GAKEA,GAAgBC,EAAU,SAAVA,CALlB,EAOuB,IAAlBC,KAPL,GAQEA,GAAgB,OAAW,UAAX,CARlB,EAWO,aACP,OACQC,wBAAAA,EAGD,aACP,OACQA,6BAAAA,EAGD,aACP,IACOC,GAAU,CAAC,KAAD,QAIV,WACIC,KAAK,MAAO,MAAO,OAGvB,WACIA,KAAK,MAAO,MAAO,OAGvB,WACIA,KAAK,MAAO,OAGhB,WACIA,KAAK,OAGT,WACIA,KAAK,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAG1D,WACIA,KAAK,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAG1D,UACA,YACIA,KAAK,OAGT,WACIA,KAAK,OAGT,WACIA,KAAK,MAAO,OAGhB,WACIA,KAAK,OAGT,WACIA,KAAK,OAGT,WACIA,KAAK,OAGT,WACIA,KAAK,MAAO,MAAO,OAGvB,WACIA,KAAK,UAAW,MAAO,MAAO,MAAO,OAGzC,WACIA,KAAK,MAAO,MAAO,OAGvB,WACIA,KAAK,MAAO,MAAO,OAGvB,WACIA,KAAK,MAAO,MAAO,MAAO,MAAO,OAGrC,WACIA,KAAK,MAAO,MAAO,MAAO,OAG9B,WACIA,KAAK,MAAO,MAAO,MAAO,OAG9B,WACIA,KAAK,MAAO,OAGhB,WACIA,KAAK,OAGT,WACIA,KAAK,MAAO,MAAO,gBAOvB,aACP,OACQC,gBAGD,eACP,OACQ,IAAIC,QAAJ,CAAY,WACnB,IACOC,GAAYC,IADnB,CAEOC,EAAsBC,eAF7B,MAOIC,OACA7B,GAAG,WAAY,iBAAM8B,IAAYC,WAAZD,oBAAmDE,MAAyBF,GAAYC,WAAZD,IAAmChC,IAFtI,EANF,IAAA,MAcSmC,2CAdT,GAiBIJ,OACA7B,GAAG,WAAY,UAChB,OAC0B8B,GAAYC,WAAZD,IAAmChC,IAD7D,IAIEoC,EAAQF,KAARE,CAPH,GASEC,MAzBJ,CADO,CAAA,EA+BD,eACP,OACKC,eADL,CAIKC,IAJL,CAKSb,QAAQU,OAARV,CAAgBD,KAAhBC,CALT,CAOQY,MAAwB,GAAIZ,QAAJ,CAAY,WAC3C,IACOc,GAAaC,IADpB,CAE6BX,eAF7B,IAMIC,OACA7B,GAAG,WAAY,iBAAM8B,IAAYC,WAAZD,sBAA4DU,IAAiCV,GAAYC,WAAZD,MAA4ChC,IAA7E0C,CAFnF,EALF,IAAA,MAaSP,4CAbT,GAgBIJ,OACA7B,GAAG,WAAY,UAChB,aAAA,KAEkC8B,GAAYC,WAAZD,MAA4ChC,KAF9E,GAGSyB,MANV,GAQEY,MAvBJ,CAD+B,CAAA,CAPhC,CAESC,MAkCF,aACP,IACOrB,GAASF,IAAa4B,aAAb5B,uBAAAA,CADhB,CAEO6B,EAAa,EAFpB,IAIgB,IAAX3B,cAGG4B,WAAWC,QAAQ,kBAAaF,GAAWG,EAAUC,IAArBJ,EAA6BG,EAAUE,KAA9E,KAKM,YACP,OACQf,YAGD,YACP,OACQA,eAGD,YACP,OACQA,cAGD,YACP,OACQA,eAGD,YACP,OACQA,cAGD,YACP,OACQA,aAGD,YACP,OACQA,aAGD,eACP,IAD0CgB,0DAAS,CAACzC,EAAG,CAAJ,CAAOC,EAAG,CAAV,KAE9Ce,gBAAsCA,kBACzC,MAAO,KAAP,IAEK0B,GAAS,GAAIC,MAAKC,MAAT,CAAgBC,MAAhB,WAER7C,EAAIyC,EAAOzC,CAAPyC,EAAYzB,SAA4B8B,MAA5B9B,CAAmChB,CAAnCgB,CAAuCyB,EAAOzC,CAA9CgB,CAAkD,EAA9DyB,IACJxC,EAAIwC,EAAOxC,CAAPwC,EAAYzB,SAA4B8B,MAA5B9B,CAAmCf,CAAnCe,CAAwCyB,EAAOxC,CAAPwC,CAAW,CAAnDzB,CAAwD,CAApEyB,IAKL,eACP,OACKzB,iBAAsCA,iBAD3C,CAES,IAFT,CAIK+B,YAAmBC,KAAAA,EAAnBD,CAJL,CAOQA,GAAmBC,KAAAA,EAAnBD,EAAyCJ,KAAKM,OAALN,CAAaO,SAAbP,CAAuB,yBAA2B3B,cAAlD2B,CAPjD,CAKSI,GAAmBC,KAAAA,EAAnBD,EAKF,aACP,IACKI,GAAiBC,IAAclB,aAAdkB,mCAAAA,EAAmE3C,YAAnE2C,CAAgF,kBAAhFA,EADtB,MAGwB,KAAnBD,MAA8C,EAAnBA,IAHhC,KASO,aACP,IACKE,GAAgBD,IAAclB,aAAdkB,mCAAAA,EAAmE3C,YAAnE2C,CAAgF,iBAAhFA,EADrB,MAGuB,KAAlBC,MAA4C,EAAlBA,IAH/B,GAMQ,KAGD,aACP,IACOC,GAAS,EADhB,CAEOC,EAAcH,IAAc/D,gBAAd+D,yCAAAA,CAFrB,UAIaf,QAAQ,kBAAciB,GAAOvC,IAAPuC,CAAYE,EAAW/C,YAAX+C,CAAwB,UAAxBA,CAAZF,CAAlC,KAKM,eACP,IACOG,GAAOC,IAAgBrE,gBAAhBqE,sDAAAA,CADd,CAEOC,EAAS,EAFhB,UAIMtB,QAAQ,WACb,QACOuB,GAAUC,EAAIC,YAAJD,CAAiB,SAAjBA,EAA8BE,SAASF,EAAIpD,YAAJoD,CAAiB,SAAjBA,CAATE,CAA9BF,CAAsE,EAE7EG,EAAI,EAAGA,IAAaA,MACrBjD,KAAK,CAACkD,OAAQF,SAASF,EAAIpD,YAAJoD,CAAiB,QAAjBA,CAATE,CAAT,CAA+CG,oBAAqBL,EAAIpD,YAAJoD,CAAiB,qBAAjBA,CAApE,EALd,KAWM,aACP,IACOF,GAASD,IAAgBrE,gBAAhBqE,8CAAAA,EAA8ES,MAD9F,CAEOC,EAAUV,IAAgBrE,gBAAhBqE,qCAAAA,EAAqES,MAFtF,OAIQE,QAGD,mBACP,IACKC,UAAgBA,SACnB,MAAO,CAACtE,EAAG,CAAJ,CAAOC,EAAG,CAAV,CAAP,IAEKsE,GAAWb,IAAgBxB,aAAhBwB,6GAAAA,EAJlB,MAMkB,KAAba,IANL,CAOS,CAACvE,EAAG,CAAJ,CAAOC,EAAG,CAAV,CAPT,CASQ,GACH8D,SAASQ,EAAS9D,YAAT8D,CAAsB,IAAtBA,CAATR,CADG,GAEHA,SAASQ,EAAS9D,YAAT8D,CAAsB,IAAtBA,CAATR,CAFG,ECjWD,aACP,IADuCS,0DAAU,YAEvCC,EAAOC,OAAPD,cAA8C,oBAAuBE,OAArE,CAAAF,IAKH,eACP,IADqCG,gEACrC,CACOC,EAAWC,EAAIC,KAAJD,CAAU,GAAVA,CADlB,CAEKE,GAFL,KAAA,KAAA,SAAA,mBAIuBH,iBAAAA,gCACtB,cACKG,cACH,WAESA,4FChBZ,iBACA,GACGC,UAAU,SADb,GAEGC,OAAOC,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAFjC,GAGGmF,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAHjC,GAIGmF,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAJjC,GAKGmF,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EALjC,GAMGoF,SANH,CAQiB,CAAZC,EARL,KAUIL,UAAU,QAVd,GAWIC,OAAOC,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAXlC,GAYImF,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,GAZxB,GAaIC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,GAbxB,GAcIC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAdlC,GAeIoF,SAfJ,GAiBIJ,UAAU,QAjBd,GAkBIC,OAAOC,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EAlBlC,GAmBImF,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,GAnBxB,GAoBIC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,GApBxB,GAqBIC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,EArBlC,GAsBIoF,SAtBJ,EC2BO,iBACP,IACKE,GAAaC,QADlB,GAEoEC,QAFpE,SAAA,CAEMC,MAFN,CAEqBC,MAFrB,CAEoCC,MAFpC,CAEmDC,MAFnD,IAIuB,IAAlBH,MAA4C,IAAlBC,IAA1BD,EAA6F,CAAzCrB,KAASkB,GAATlB,CAApDqB,EAA2I,CAAzCrB,KAASkB,GAATlB,EACrG,MAAOyB,IAAWC,KAAlB,CALF,MAM4B,KAAlBJ,MAAmE,CAAzCtB,KAASkB,GAATlB,CANpC,CAOSyB,GAAWE,SAPpB,CAQ4B,IAAlBN,MAAmE,CAAzCrB,KAASkB,GAATlB,CARpC,CASSyB,GAAWG,SATpB,QAgBO,iBACP,IACKP,GAAgBF,IAAeU,EAAM,CAArBV,GADrB,CAEKG,EAAgBH,MAAoBW,EAAS,CAA7BX,CAFrB,CAGKI,EAAgBJ,MAAoBW,EAAS,CAA7BX,CAHrB,CAIKK,EAAgBL,IAAeU,EAAM,CAArBV,GAJrB,OAMQ,UAGD,iBACP,OAC2B,WAAtB,QAAOY,KADZ,CAES,IAFT,CAImC,WAA9B,QAAOA,QAJZ,CAKS,IALT,CAOQA,QAGD,aACP,OACc,GAATC,IADL,CAES,IAFT,CAIQ,CAAC,GAAD,CAAM,GAAN,CAAW,GAAX,CAAgB,GAAhB,CAAqB,GAArB,CAA0B,GAA1B,CAA+B,GAA/B,CAAoC,GAApC,CAAyC,GAAzC,CAA8C,GAA9C,CAAmD,GAAnD,CAAwD,GAAxD,CAA6D,GAA7D,CAAkE,GAAlE,CAAuE,GAAvE,CAA4E,GAA5E,CAAiF,GAAjF,CAAsF,GAAtF,CAA2F,GAA3F,CAAgG,GAAhG,CAAqG,GAArG,CAA0G,GAA1G,CAA+G,GAA/G,CAAoH,GAApH,CAAyH,GAAzH,CAA8H,GAA9H,CAAmI,GAAnI,CAAwI,GAAxI,CAA6I,GAA7I,CAAkJ,GAAlJ,CAAuJ,GAAvJ,CAA4J,GAA5J,CAAiK,GAAjK,CAAsK,GAAtK,CAA2K,GAA3K,CAAgL,GAAhL,EAAqLC,OAArL,IAGD,YACP,IADsCC,iEACtC,MACKA,KAAeT,GAAWC,KAD/B,IAIKQ,IAAeT,GAAWE,SAJ/B,IAOKO,IAAeT,GAAWG,SAP/B,OAaO,iBACP,OACqC,KAAhCT,WADL,EAI+E,CAAvEC,YAAoCe,MAApCf,CAA2C,kBAAW,KAANgB,IAAhD,CAAAhB,EAA4DtB,OAG7D,iBACP,IACKuC,SACH,SAFF,OAIKC,IAJL,CAMa,CAALA,EANR,KAOuC,IAAjCnB,OAAe,GAAfA,KAAyC,CAACkB,SAC7C,SAEF,MAAUlB,CAAwC,IAAxCA,OAAeU,EAAM,CAArBV,CAAwBW,EAAS,CAAjCX,GAAiDkB,IAAcR,EAAM,CAApBQ,CAAuBP,EAAS,CAAhCO,CAAjDlB,IAAiI,IAAxCA,OAAeU,EAAM,CAArBV,CAAwBW,EAAS,CAAjCX,GAAiDkB,IAAcR,EAAM,CAApBQ,CAAuBP,EAAS,CAAhCO,CAA1IlB,EAGJ,iBACP,IACKkB,SACH,SAFF,OAIKE,IAJL,CAMa,CAALA,EANR,KAOoC,IAA9BpB,SAAoB,GAApBA,GAAsC,CAACkB,SAC1C,SAEF,MAAUlB,CAAwC,IAAxCA,OAAeU,EAAM,CAArBV,CAAwBW,EAAS,CAAjCX,GAAiDkB,IAAcR,EAAM,CAApBQ,CAAuBP,EAAS,CAAhCO,CAAjDlB,IAAiI,IAAxCA,OAAeU,EAAM,CAArBV,CAAwBW,EAAS,CAAjCX,GAAiDkB,IAAcR,EAAM,CAApBQ,CAAuBP,EAAS,CAAhCO,CAA1IlB,EAGJ,aACP,QACKqB,GAAU,EAAGC,EAAS,GAEjBZ,EAAM,EAAGA,EAAMa,EAAU5C,OAAQ+B,QAEpC,MAAIC,EAAS,EAAGA,EAASY,KAAe5C,OAAQgC,MAE5CY,QAEJC,MACHH,KAEGG,MACHF,EAAS,SAIL,CAACD,SAAD,CAAUC,QAAV,QA7GiDzC,KAAK4C,MCTxC5C,KAAK6C,QJ2TnB7C,KAAK8C,MKqMG9C,KAAK+C,03DCxhBRC,mFAIZ,sCAQA,8BADgB9H,qDAEP+H,eAAM,2BRfZ1H,GAAwB,KSAf2H,2BASZ,UAAA,MACMC,OAAS,EADf,MAGMC,gDARN,OACQ,MAAKD,oDAWb,SACM,KAAKE,WAAL,GADN,EAIQ,KAAKF,MAAL,IAAkBG,EAAlB,2CAIR,OACQ,eAAKH,MAAL,oCAIR,cACUI,EAAO7C,KAAP6C,CAAa,GAAbA,CADV,GAEUA,EAAOrH,GAAPqH,CAAW,kBAAQC,GAAK9C,KAAL8C,CAAW,GAAXA,CAAnB,CAAAD,CAFV,GAGUA,EAAOE,IAAPF,CAAY,oBAAUG,GAAE,CAAFA,EAAKC,aAALD,CAAmBE,EAAE,CAAFA,CAAnBF,CAAtB,CAAAH,CAHV,GAIQvF,QAAQ,kBAAQ,GAAKmF,MAAL,CAAYK,EAAK,CAALA,CAAZ,EAAuB,CAACF,GAAI5D,SAAS8D,EAAK,CAALA,CAAT9D,CAAL,CAAwBmE,MAAO,CAACL,EAAK,CAALA,CAAD,CAAUA,EAAK,CAALA,CAAV,EAAmBrB,MAAnB,CAA0B,kBAAW,KAAN2B,IAA/B,CAAA,CAA/B,CAA9C,qCAID,IACOC,GAAM,eAEPC,MAAMhG,QAAQ,oBAAgB+F,GAAIrH,IAAJqH,CAAS,GAAO7I,EAAKoI,EAAZ,QAAA,IAAmBpI,EAAK2I,MAAxB,EAA+BI,IAA/B,CAAoC,GAApC,CAATF,CAAnC,GAEOA,EAAIE,IAAJF,CAAS,GAATA,WFnCIG,2BA+DZ,IADYX,0DAAS,yEACrB,CADgGY,yDAAW,UAC3G,CADuHC,yDAAY,MACnI,UAAA,gFAKMC,aACAf,GAAK,UAAYgB,OAAOC,WAAPD,CAAmBE,GAAnBF,KACjBtH,OAAS,GAAIsB,MAAKmG,OAALnG,CAAaoG,SAC1BC,cAAgB,GAAIrG,MAAKsG,YAEzBC,SAAS,EAAKF,iBAEdG,YAAc,KACdC,aACAC,OAAS,IACTC,QAAU,IAEVC,SAAW,OACXC,QAAU,KAEVf,cACAgB,UAAY,IACZ7B,WACAY,aACAkB,cAAgB,EAAKD,YAErBE,UAEAjB,6DAvFN,OACQ,MAAKa,0CAIb,OACQ,MAAKK,UAVd,iBAcC,MACMA,8CAIN,OACQ,MAAKC,UApBd,iBAwBC,MACMA,2CAIN,OACQ,MAAKC,OA9Bd,iBAkCC,CACKtH,UADL,QAIMsH,QAAU,SAJhB,MAKMC,MALN,kCASA,OACQ,MAAKC,SA5Cd,iBAgDC,MACMA,iDAIN,OACQ,MAAKC,cAtDd,iBA0DC,MACMA,4DAoCN,SAAA,KAAA,SAAA,mBACe,KAAKV,QAAL,gBAAA,6CACTxB,EAAEJ,EAAFI,KACH,sFAEOpH,IALV,CAOKH,UAPL,QAUM+I,SACHW,aACApC,KAAK,oBAAU1H,IAAckG,OAAdlG,CAAsB6H,EAAEN,EAAxBvH,EAA8BA,GAAckG,OAAdlG,CAAsB2H,EAAEJ,EAAxBvH,CAF/C,EAVD,MAcMoJ,QAAQhJ,EAAOmH,IAAM,CAd3B,CAgBmC,MAA9BnH,oBAhBL,GAiBE,KAAKyJ,cAAL,CAAsB,KAAKR,SAjB7B,uCAqBA,IACKU,KADL,KAAA,KAAA,SAAA,mBAGe,KAAKZ,QAAL,gBAAA,0CACTxB,EAAEJ,EAAFI,OACHoC,mIAMH,CACM,KAAKC,SAAL,GADN,QAIMb,SAAW,KAAKA,QAAL,CACd/C,MADc,CACP,kBAAKuB,GAAEJ,EAAFI,IADE,CAAA,EAEdD,IAFc,CAET,oBAAU1H,IAAckG,OAAdlG,CAAsB6H,EAAEN,EAAxBvH,EAA8BA,GAAckG,OAAdlG,CAAsB2H,EAAEJ,EAAxBvH,CAF/B,CAAA,CAJjB,0CAUA,IADkBiK,0DAAM,cAElBrK,SACAC,SAEAwJ,iBACAC,gBAEE,oCAIR,iBACMY,KAAK,eAAgB,KAD3B,MAEMC,YAFN,IAIOC,GAAY,KAAKC,YAAL,GAAoBjE,MAApB,CAA2B,kBAAW,CAAC1E,IAAvC,CAAA,KAEK,CAAnB0I,GAAUrG,OACd,MACMuG,WADN,IAGOC,GAAW,YACjB,OAC0B,EAArBH,KAAUrG,MADf,QAGOuG,WAHP,SAO2BF,EAAUI,KAAVJ,GAAmB,EAAKnJ,QAAQwJ,OAR3D,WAcIC,iDAIN,IACOtC,GAAWuC,IAAc7I,aAAd6I,sCAA8D,KAAKvC,cAAnEuC,OACZzB,QAAUvF,SAASyE,EAAS/H,YAAT+H,CAAsB,QAAtBA,CAATzE,CAFhB,MAGMsF,OAAStF,SAASyE,EAAS/H,YAAT+H,CAAsB,OAAtBA,CAATzE,CAHf,CAKuB,MAAlB,QAAKyE,QALV,GAME,KAAKc,OAAL,CAAe,KAAKD,MANtB,6CAUA,IADkB7I,0DAAS,IAC3B,CACKwK,EAAiB,EADtB,OAGgB,KAAXxK,KACHwK,EAAejK,IAAfiK,MAAAA,MAAuBC,EAAkB,QAAlBA,EAAvBD,EAEAA,EAAejK,IAAfiK,MAAAA,MAAuBC,EAAkBzK,eAAlByK,EAAvBD,EAEMA,EAAeE,MAAfF,8CAIR,SAAA,KAAA,SAAA,mBACoB,KAAKlK,OAAL,gBAAA,6CACdN,oBACH,qIAMH,IACO2K,GAAY,8BAEqB,KAAK1C,yBAAwBsC,KAClE1I,QAAQ,kBAAQ8I,GAAUpK,IAAVoK,CAAetD,EAAKpH,YAALoH,CAAkB,IAAlBA,CAAfsD,CADlB,2CAOD,IACOX,GAAY,eAEbhD,OAAOnF,QAAQ,aACpB,GACSgG,MAAMhG,QAAQ,WACtB,IACK+I,GAAMC,IAAenJ,aAAfmJ,cAAyCxD,EAAKF,wBAA9C0D,EAEE,IAARD,MAAmC,IAAnBA,KAAIE,UAHzB,KAMOF,EAAIE,UANX,GAQWvK,KAAK8G,UAAkBuD,EAAI3K,YAAJ2K,CAAiB,IAAjBA,EAAuBG,WAAvBH,GARlC,CADA,EAFD,GAeOZ,EAAUU,MAAVV,2CAIR,IACKxK,GAAI,EAAE,KAAKqJ,MAAL,CAAc,CAAhB,CADT,OAIQ,CAACrJ,GAAD,CAAIC,EAFH,CAAC,GAEF,uCAIR,iBACM2H,OAAOS,MAAMhG,QAAQ,aAC1B,IACOmJ,GAAUC,IAAgBvJ,aAAhBuJ,iCAAAA,KAEA,IAAZD,SAGEE,GAAMF,EAAQtJ,aAARsJ,aAAiCjM,EAAKoI,QAAtC6D,EACNnD,EAAQqD,EAAIC,oBAAJD,CAAyB,MAAzBA,EAERE,EAA8C,GAAlCF,KAAIjL,YAAJiL,CAAiB,WAAjBA,EACZG,EAAe,GACfC,EAAYN,EAAQ/K,YAAR+K,CAAqB,WAArBA,EAEZO,EAAkBL,EAAIrM,gBAAJqM,CAAqB,oBAArBA,EACA,IAApBK,MACHA,EAAgB1J,OAAhB0J,CAAwB,kBAASF,GAAa9K,IAAb8K,CAAkBG,EAAMvL,YAANuL,CAAmB,UAAnBA,CAAlBH,CAAjC,CAAAE,IAEK1J,QAAQ,WACd,IACO4J,GAAWpE,EAAKpH,YAALoH,CAAkB,MAAlBA,EAEb,WAAKL,MAAL,GAHL,GAIE,EAAKA,MAAL,IAAwB,CAACqE,cAAD,CAAexD,MAAO,EAAtB,CAJ1B,IAMMb,UAAiBa,MAAMtH,KAAK,IAC5BgD,SAAS8D,EAAKpH,YAALoH,CAAkB,IAAlBA,CAAT9D,CAD4B,WAEc,GAAnC8D,KAAKpH,YAALoH,CAAkB,WAAlBA,IAFqB,YAGpB9D,SAAS8D,EAAKpH,YAALoH,CAAkB,YAAlBA,CAAT9D,CAHoB,OAIzBA,SAAS8D,EAAKpH,YAALoH,CAAkB,OAAlBA,CAAT9D,CAJyB,YAAA,MAAA,OAAA,EAPlC,GAlBD,uCAuCD,MACMyD,OAAS,EADf,MAEM0E,SAAW,EAFjB,MAIMC,gBAJN,MAKMC,4CAIN,eACM,KAAK1D,YAGJ2D,GAAS,CACd,QACS,GAAI1J,MAAK2J,MAAL3J,CAAY4J,cAAhB,CAA+B,CACtChL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OADf,CAEtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAFf,CAGtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAHf,CAItClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAJf,CAA/B,CADT,GAOI,CAAC,CAPL,GAQI,CAAC,EARL,CADc,CAWd,QACS,GAAI9J,MAAK2J,MAAL3J,CAAY4J,cAAhB,CAA+B,CACtChL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OADf,CAEtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAFf,CAGtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAHf,CAItClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAJf,CAA/B,CADT,GAOI,CAPJ,GAQI,EARJ,CAXc,CAqBd,QACS,GAAI9J,MAAK2J,MAAL3J,CAAY4J,cAAhB,CAA+B,CACtChL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OADf,CAEtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAFf,CAGtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAHf,CAItClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAJf,CAA/B,CADT,GAOI,CAAC,CAPL,GAQI,EARJ,CArBc,CA+Bd,QACS,GAAI9J,MAAK2J,MAAL3J,CAAY4J,cAAhB,CAA+B,CACtChL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OADf,CAEtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAFf,CAGtClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAHf,CAItClL,GAAYC,WAAZD,CAAwBiL,GAAgBzC,IAAhByC,CAAqB,KAArBA,CAAxBjL,EAAqDkL,OAJf,CAA/B,CADT,GAOI,CAPJ,GAQI,CAAC,EARL,CA/Bc,EA2CX7F,EAAK,KAAKyC,MAAL,CAAc,EAAG1C,EAAK,KAAK2C,OAAL,CAAe,EAC1CoD,EAAK,aACT,GACMxD,SAASyD,EAAMjK,OADrB,GAEOA,OAAOkK,OAAOlB,IAAI,GAFzB,GAGOhJ,OAAOmK,eAAiB,EAH/B,GAIOnK,OAAOoK,OAJd,GAKOpK,OAAOqK,QAAU,IALxB,GAMOrK,OAAO3C,SAASC,EAAI4G,EAAK+F,EAAM3M,CANtC,GAOO0C,OAAO3C,SAASE,EAAI0G,EAAKgG,EAAM1M,CAPtC,GAQOyC,OAAOsK,MARd,YAUY,iBAAM,GAAKC,WAAL,CAAiBN,EAAMjK,MAAvB,CAAjB,EAAiD,IAVlD,CAYK2J,WAAO,CAAPA,CAZL,EAaEa,WAAW,iBAAMR,GAAGL,EAAOzB,KAAPyB,EAAHK,CAAjB,CAAAQ,CAAqC,EAArCA,CAdF,IAiBGb,EAAOzB,KAAPyB,qCAIJ,eACK,KAAK3B,SACT,IACOyC,GAAM,GAAIxK,MAAKyK,OAALzK,CAAa0K,cACzBC,MAAQ,EAFb,MAGMF,QAAU,GAJhB,WAQMA,QAAU,MAGZG,GAAc,MAEd,KAAKC,gBAAL,CAAsB,UAAtB,CAdL,CAeED,EAA+B,CAAjB,MAAK9D,SAAL,EAAuC,CAAjB,MAAKA,SAA3B,CAA2C,OAA3C,CAAqD,OAfrE,CAgBU,KAAK+D,gBAAL,CAAsB,kBAAtB,CAhBV,GAiBED,EAA+B,CAAjB,MAAK9D,SAAL,EAAuC,CAAjB,MAAKA,SAA3B,CAA2C,OAA3C,CAAqD,OAjBrE,KAmBKgE,GAAYpN,yCAAmE,KAAKoJ,6BAAxEpJ,CAAqGqN,GAArGrN,EAAqHE,GAArHF,CAAyH,kBAAQwH,GAAKpH,YAALoH,CAAkB,UAAlBA,CAAjI,CAAAxH,EAnBjB,IAqB0B,CAArBoN,KAAUtJ,MArBf,GAsBEsJ,EAAYpN,uCAAwD,KAAKoJ,6BAA7DpJ,CAA0FqN,GAA1FrN,EAA0GE,GAA1GF,CAA8G,kBAAQwH,GAAKpH,YAALoH,CAAkB,UAAlBA,CAAtH,CAAAxH,CAtBd,EAwBQ,KAAK2I,aAAL,CAAmB2E,QAAnB,CAA4B,CAA5B,CAxBR,OAyBO3E,cAAciE,YAAY,KAAKjE,aAAL,CAAmB2E,QAAnB,CAA4B,CAA5B,GAzBjC,QAAA,KAAA,SAAA,mBA2BkBF,iBAAAA,0CACZ,cAAKvB,QAAL,KACH,KAAKA,QAAL,IAAoB7J,OAApB,CAA4B,kBAAQ,GAAK2G,aAAL,CAAmBE,QAAnB,GAApC,CAAA,gHAIH,iBACMpI,QAAQuB,QAAQ,kBAAU,GAAKuL,YAAL,GAA/B,EADD,MAEMC,+CAIN,WAAA,CADarN,yDAAS,IACtB,CACOiC,EAAS,GACX,KAAK4G,MAAL,CAAc,CADH,GAEX,KAAKC,OAAL,CAAe,CAFJ,CADhB,CAMO0B,EAAiB,KAAKC,iBAAL,GANxB,CAOO6C,EAAQ,EAAE,KAAKtE,OAAL,CAAahJ,EAAOmH,EAApB,CAAF,EAA6B,CAP5C,CASOkE,EAAe,EATtB,CAUOkC,EAAc,KAAKrD,QAAL,CAAmC,IAAlB9J,MAAgD,EAAhDA,CAAyBA,GAAc4G,MAAxD,CAAuE,KAAKA,MAVjG,GAYanF,QAAQ,kBAAQwJ,GAAa9K,IAAb8K,MAAAA,MAAqBtM,EAAKsM,aAA1BA,CAA5B,EAZD,IAcKV,GAAY,QACX6C,eAAe3L,QAAQ,kBAAY8I,GAAUpK,IAAVoK,CAAeJ,IAAc7I,aAAd6I,cAAwC,EAAKvC,qCAA7CuC,CAAfI,CAAxC,EAfD,SAAA,KAAA,SAAA,iBAiBuBA,EAAUrD,IAAVqD,oBAAAA,gCACtB,IADW8C,UACX,CACK1J,EAAW0J,EAAQxN,YAARwN,CAAqB,IAArBA,CADhB,CAEKC,EAAQ7N,EAAsB,MAAtBA,IAAuCyH,IAAvCzH,IAFb,KAAA,KAAA,SAAA,iCAIY8N,WAENC,EAA6B,MAAb7J,KAAsB,EAAKmF,aAA3BnF,CAA2C,EAAKkF,UAChEwC,EAAWkC,EAAK1N,YAAL0N,CAAkB,IAAlBA,EACXE,IACAC,IACAC,KACAlL,EAAgBmL,KAEE,IAAlBnL,MACHwI,EAAa9K,IAAb8K,IAEmB,CAAhBuC,IAAqC,CAAhBA,YAGbK,SAGRC,GAAmBC,KACnBC,EAAaC,EAAmBrO,EAAOmH,EAA1BkH,OAEwB,CAAC,CAAtC7D,KAAe1E,OAAf0E,IACH,gBAAA,IAEG,WAAKkB,QAAL,MACH,EAAKA,QAAL,IAAqC,IAED,CAAC,CAAlCL,GAAavF,OAAbuF,IACH,gBAAA,IAEGkC,cACH,gBAAA,wDAEUlG,cAEN,EAAK6C,QAAL,EAAkC,eAAjB7C,KAAK7E,QACzB,aAAA,IAEGF,GAAS,GACTiB,SAASkK,EAAQxN,YAARwN,CAAqB,GAArBA,CAATlK,CADS,GAETA,SAASkK,EAAQxN,YAARwN,CAAqB,GAArBA,CAATlK,CAFS,EAKT+K,KACAC,EAAYjB,GAAwB,IAAfc,KAAyD,CAAzDA,CAAsBI,OAAOC,MAAPD,IAA0B7K,MAAzD2J,EACZoB,EAAcN,GAAcA,IAAdA,CAAsCA,KAAsB1K,mBAA5D0K,CAAkFpO,EAAO0D,oBAE9D,CAAC,CAA1CwK,KAAiBpI,OAAjBoI,MACHQ,EAAaR,EAAiB,CAAjBA,KAEe,MAAbnK,KAAsB,EAAKmF,aAA3BnF,CAA2C,EAAKkF,YACpDmF,GAAcA,IAAdA,CAAsCA,KAAsB3K,MAA5D2K,CAAqE,KAE7EO,GAAkBC,EAAmB5O,EAAOmH,EAA1ByH,GAAwCtB,EAAQuB,EAAwB7O,EAAOmH,EAA/B0H,CAAhDD,IAClBE,EAAoB,kCAAqCzH,EAAKF,cAAlE,EACIjF,EAAS6M,EAAU1H,EAAK7E,OAAfuM,CAAwBD,GAAxBC,OAEE,IAAX7M,KACJ,IACK8M,OACQ,CAFb,GAGUD,EAAU1H,EAAK7E,OAAfuM,CAAwBD,GAAxBC,GAHV,QAOe,IAAX7M,SAEa,MACyB,CAA3B2L,IAA2D,CAA3BA,KACrCkB,EAAU1H,EAAK7E,OAAfuM,CAAwBD,GAAxBC,KAGK,IAAX7M,KACJ,IACK+M,OACS,KAFd,GAGUF,EAAU1H,EAAK7E,OAAfuM,CAAwBD,GAAxBC,GAHV,QAOe,IAAX7M,2BAeI1C,GAAK8C,EAAO9C,CAAP8C,CAAWqM,EAAgBnP,IAChCC,GAAK6C,EAAO7C,CAAP6C,CAAWqM,EAAgBlP,MANhCD,GAAK8C,EAAO9C,CAAP8C,CAAWqM,EAAgBnP,IAChCC,GAAK6C,EAAO7C,CAAP6C,CAAWqM,EAAgBlP,SAUhCyP,MAAM1P,EAAI,CAAC,IACXA,EAAO,EAAKqJ,MAAL,CAAc3G,EAAOiN,KAArB,CAA8BjN,EAAO1C,CAArC,CAA0C0C,EAAOiN,KAAjD,CAA0DR,EAAgBnP,KAGlFA,EAAIqE,EAAW3B,EAAO1C,CAAlBqE,IACJpE,EAAIoE,EAAW3B,EAAOzC,CAAlBoE,EAEPwD,EAAK+D,SAAL/D,EAA+B,IAAboE,IAAlBpE,EAAuC,CAAC,EAAK6C,SACjD,IACOkF,GAAS,EAAKhI,MAAL,CAAYS,KAAZ,CAAkBR,EAAK6D,GAAvB,EAA4BxD,KAD5C,CAEOA,EAAQ0H,EAAO/H,EAAKgI,UAALhI,CAAkB,CAAzB+H,GAA+BA,EAAO,CAAPA,CAF9C,CAGOE,EAAUrE,IAAgBvJ,aAAhBuJ,iBAA6C5D,EAAKiE,mCAAlDL,CAHjB,CAKiB,IAAZqE,IALL,GAMEpN,EAAOqN,IAAPrN,CAAcqB,cAAc+L,EAAQE,WAAtBjM,CANhB,EASI,WAAKmI,QAAL,IAAmCrE,EAAKoI,KAAxC,GACH,EAAK/D,QAAL,IAAmCrE,EAAKoI,KAAxC,EAA+CC,OAA/C,OAEIhE,YAA8BrE,EAAKoI,YAxFtBlC,KAAiC1F,KAAjC0F,gBAAAA,wIAjCDG,iBAAAA,mPAgIrB,IACaiC,eAA0BC,aAAa,aA3iBzBzN,KAAKsG,WNPpB/I,GAAe,2BCOfuB,GAAiB,GACjBT,GAAc,GACd+B,GAAkB,GAClBlB,GAAe,GAEjBzB,GAAgB,KAChBM,GAAgB,KAChBE,GAAgB,KAChByP,GAAmB,oBAAUpI,GAAExH,YAAFwH,CAAe,GAAfA,EAAsBF,EAAEtH,YAAFsH,CAAe,GAAfA,CAAvD,EQZMuI,0BAwBZ,UAAA,MACMC,MAAQ,KAAKC,WAAL,CAAiBjO,8CArB/B,OACQhB,IAAYkP,sCAIpB,OACQlP,IAAYF,mCAIpB,OACQ,MAAKkP,mCAIb,OACQhP,IAAYmP,iLAUZhP,+BAA+B,KAAKa,0IAI5C,WChCYiK,GAAkB,MACxB,OACE,sCADF,OAEE,sCAFF,OAGE,sCAHF,OAIE,sCAJF,OAKE,sCALF,OAME,sCANF,OAOE,sCAPF,OAQE,sCARF,OASE,sCATF,OAUE,sCAVF,OAWE,sCAXF,OAYE,sCAZF,OAaE,sCAbF,OAcE,sCAdF,OAeE,sCAfF,OAgBE,sCAhBF,CADwB,EAqBlBmE,2BAIZ,UAAA,2EAGMC,QAAU,KACVC,WAAa,kUAOZC,EAAyB,SAAzBA,CAAoC,KAAKzP,MAAzCyP,yBACAA,EAAyB,YAAzBA,CAAuC,KAAKzP,MAA5CyP,yBACAA,EAAyB,WAAzBA,CAAsC,KAAKzP,MAA3CyP,0BACAA,EAAyB,WAAzBA,CAAsC,KAAKzP,MAA3CyP,2BACAA,EAAyB,YAAzBA,CAAuC,KAAKzP,MAA5CyP,2BACAA,EAAyB,WAAzBA,CAAsC,KAAKzP,MAA3CyP,2BACAA,EAAyB,UAAzBA,CAAqC,KAAKzP,MAA1CyP,2BACAA,EAAyB,SAAzBA,CAAoC,KAAKzP,MAAzCyP,2BACAA,EAAyB,UAAzBA,CAAqC,KAAKzP,MAA1CyP,2BAEAC,EAA0B,eAA1BA,CAA2C,KAAK1P,MAAhD0P,2BACAA,EAA0B,eAA1BA,CAA2C,KAAK1P,MAAhD0P,aAEUhH,KAAK1H,QAAQ,kBAAS,GAAKhB,MAAL,CAAYC,GAAZ,GAAtC,mJAID,eAAA,IAGa0P,OAAO1P,IAAI,UACvB,EACyB,CAAC,CAArB,KAAKuP,UAAL,EAA4E,EAAjDtP,IAAYyP,MAAZzP,CAAmB0P,QAAnB1P,CAA8B,EAAKsP,UADnE,MAGOA,WAAatP,GAAYyP,MAAZzP,CAAmB0P,QAHvC,GAKOL,QAAQvO,QAAQ,kBAAU6O,GAAOvH,KAAPuH,EAA/B,EALF,CADA,sCAYD,4BADaC,4CAEND,uEAEDN,QAAQ7P,iDAMd,MACM6P,QAAU,KAAKA,OAAL,CAAapK,MAAb,CAAoB,kBAAKuB,GAAEJ,EAAFI,GAASmJ,EAAOvJ,EAAzC,CAAA,aC/EXyJ,GAAa,gCAENC,2BAIZ,UAAA,2EAGMC,OAAS,wTAOTjQ,OACHC,OAAgB,GAChB7B,GAAG,WAAY,iBAAM,GAAK8R,cAAL,CAAoBhQ,GAAYC,WAAZD,IAApB,CAFvB,0IAMD,IADeiD,0DAAU,EACzB,CAD6BI,+DAC7B,CACKH,EAASE,IAAa,KAAK2M,MAAlB3M,CADd,OAGKF,aAAwBG,UAH7B,GAMQ4M,IAAuBxC,OAAOyC,MAAPzC,CAAc,EAAdA,GAA2B,KAAKsC,MAAhCtC,CAAvBwC,2CAIR,CACKF,UADL,QAIMA,OAASA,EAAO/R,IAJtB,aC/BKmS,GAAY,+BAELC,2BAIZ,UAAA,2EAGMC,MAAQ,wTAORvQ,OACHC,OAAe,GACf7B,GAAG,WAAY,iBAAM,GAAKoS,aAAL,CAAmBtQ,GAAYC,WAAZD,IAAnB,CAFvB,0IAMD,IADeiD,0DAAU,EACzB,CAD6BI,+DAC7B,CACKH,EAASE,IAAa,KAAKiN,KAAlBjN,CADd,OAGKF,aAAwBG,UAH7B,GAMQ4M,IAAuBxC,OAAOyC,MAAPzC,CAAc,EAAdA,GAA2B,KAAK8C,IAAhC9C,CAAsCzN,GAAY4O,UAAZ5O,KAAsC+P,MAA5EtC,CAAvBwC,0CAIR,CACKI,UADL,QAIMA,MAAQA,EAAMrS,IAJpB,aPlCKwS,GAAe,2BAEfC,2BAIL,UAAA,2EAGMC,SAAW,UACXC,UAAY,KACZC,aAAe,IACfC,SAAW,MACXC,WAAa,KAEN5B,QAAQO,OAAO1P,IAAI,kBAAS,GAAKgR,MAAL,GAAxC,sDAID,MACMC,OADN,MAGMtN,UAAU,KAAKgN,SAHrB,MAIMO,SAAS,EAAG,EAAGnO,EAAW,KAAKgO,UAAL,CAAkB,GAAlB,CAAwB,KAAKD,QAAxC/N,EAAmD,KAAK6N,UAJ7E,MAKM7M,SALN,MAOMoN,UAAU,KAAKN,aAAc,KAAKF,SAPxC,MASM/M,OAAO,CAAC,KAAKiN,aAAc,CAAC,KAAKA,aATvC,MAUM/M,OAAO,KAAKgN,QAAL,CAAgB,KAAKD,aAAc,CAAC,KAAKA,aAVtD,MAWM/M,OAAO,KAAKgN,QAAL,CAAgB,KAAKD,aAAc,KAAKD,SAAL,CAAiB,KAAKC,aAXtE,MAYM/M,OAAO,CAAC,KAAK+M,aAAc,KAAKD,SAAL,CAAiB,KAAKC,aAZvD,MAaM/M,OAAO,CAAC,KAAK+M,aAAc,CAAC,KAAKA,qBA9BfxP,KAAK+P,UAmCjBC,2BAcZ,UAAA,2EAGMtR,OAAS,GAAIsB,MAAKmG,OAALnG,CAAaoG,SAC1B6J,WAAa,SAEbC,KAAO,OAEPC,SACAC,mBAEOtC,QAAQO,OAAO1P,IAAI,kBAAS,GAAKgR,MAAL,GAAxC,wDArBD,OACQ,MAAKM,UAAL,CAAgBP,UAAhB,EAA8B,CALvC,iBASC,MACMO,WAAWP,WAAahO,0CAmB9B,IACO2O,GAAQ,GAAIrQ,MAAKsQ,SAAT,CAAmB,OACzB,QADyB,YAEpB,UAFoB,UAGtB,EAHsB,MAI1B,OAJ0B,YAAA,eAMjB,GANiB,CAAnB,OASTnB,KAAO,GAAInP,MAAKuQ,IAAT,CAAc,EAAd,2CAIb,iBACM7R,OACHC,QACAM,KAAK,iBAAM,GAAKuR,iBAAL,EAFb,8CAMD,iBACMN,KAAO,GAAIlQ,MAAKC,MAAT,CAAgBrB,GAAYC,WAAZD,IAAsC,KAAKF,MAA3CE,EAAmDkL,OAAnE,CADb,MAGMvD,SAAS,KAAK2J,KAHpB,MAKM3J,SAAS,KAAK0J,WALpB,MAMM1J,SAAS,KAAK4I,KANpB,MAQMxH,KAAK,eARX,IAUajJ,OAAO5B,GAAG,WAAY,kBAAS,GAAK4S,UAAL,CAAkBe,EAAMC,QAAnE,mCAID,IACOhB,GAAa,KAAKA,gBAEnBE,OAHN,IAKOe,GAAS/R,GAAYkP,OAAZlP,CAAoB+R,MALpC,CAMO3D,EAAQpO,GAAYkP,OAAZlP,CAAoBoO,KANnC,MAQM1K,UAAU,EARhB,MASMuN,SAAS,EAAG,MATlB,MAUMnN,SAVN,MAYMuN,WAAW7S,SAASC,EAAIqE,EAAYsL,EAAQ,CAARA,CAAc,KAAKiD,UAAL,CAAgBjD,KAAhB,CAAwB,CAAlDtL,CAZ9B,MAaMuO,WAAW7S,SAASE,EAAIqT,GAAU,KAAKV,UAAL,CAAgBU,MAAhB,CAAyB,EAAnCA,CAb9B,CAemB,IAAd,QAAKT,IAfV,QAiBOA,KAAK7S,EAAIqE,EAAYsL,EAAQ,CAARA,CAAc,KAAKkD,IAAL,CAAUlD,KAAV,CAAkB,CAA5CtL,CAjBhB,MAkBOwO,KAAK5S,EAAIoE,EAAYiP,EAAS,CAATA,CAAe,KAAKT,IAAL,CAAUS,MAAV,CAAmB,CAA9CjP,CAlBhB,OAqBMyN,KAAKA,KAAOvQ,GAAY4O,UAAZ5O,KAAoCgS,SAApChS,CAA8C,0BAA9CA,CAA0E,CAAC8Q,YAAD,CAA1E9Q,CAAwF,EAAxFA,CArBlB,MAuBMuQ,KAAK/R,SAAS2L,IAClBrH,EAAYsL,EAAQ,CAARA,CAAc,KAAKmC,IAAL,CAAUnC,KAAV,CAAkB,CAA5CtL,EACA,KAAKuO,UAAL,CAAgB7S,QAAhB,CAAyBE,CAAzB,CAA6B,WAzFC0C,KAAK+P,UQtClC5E,GAAQ,EAIC0F,2BAuCZ,UAAA,uEAGMC,IAAM,IACNC,MAAQxU,SAASgD,aAAThD,CA7CM,kBA6CNA,EAEM,IAAf,KAAKwU,MACR,KAAM,IAAIC,MAAJ,CAAU,0BAAV,CAAN,UAEU,EAAKD,SAEXE,YACAC,eAEA7C,OAAO1P,IAAI,iBAAMwM,KAAtB,mDAjDD,2CAKA,OACQ,MAAKgG,GAAL,CAASC,sCAIjB,OACQ,MAAKD,GAAL,CAASpD,oCAIjB,OACQ,MAAKoD,GAAL,CAAS9C,mCAIjB,OACQ,MAAK8C,GAAL,CAASE,mCAIjB,OACQ,MAAKD,QAAL,CAAcT,MAAd,CAAuB,KAAKG,iCAIpC,OACQ,MAAKM,QAAL,CAAcpE,KAAd,CAAsB,KAAK8D,4CAsBnC,MACMK,IAAM,GAAInR,MAAKsR,WAAT,CAAqB,QACvBtL,OAAOuL,WAAPvL,CAAqB,KAAK8K,GADH,OAExB9K,OAAOwL,UAAPxL,CAAoB,KAAK8K,GAFD,gBAAA,eAAA,YAKnB,KAAKA,GALc,eAAA,CAArB,CADZ,MAUMC,MAAMU,YAAY,KAAKJ,0CAI7B,mBACQK,iBAAiB,SAAU,iBAAM,GAAKC,cAAL,EAAxC,2CAID,MACMP,SAASQ,OAAO5L,OAAOwL,UAAPxL,CAAoB,KAAK8K,IAAK9K,OAAOuL,WAAPvL,CAAqB,KAAK8K,IAD9E,MAEMnJ,KAAK,iBA9EiB3H,KAAK6R,KAAL7R,CAAW8R,cCJlCC,GAAgB,GAETC,2BAIZ,UAAA,2EAGMC,UAEOnE,QAAQhR,GAAG,SAAU,iBAAM,GAAKmV,IAAL,EAAvC,oDAID,MACMrC,OADN,MAGMtN,UAAU,QAHhB,MAIMuN,SAAS,EAAG,EAAGjR,GAAYkP,OAAZlP,CAAoBoO,SAJzC,MAKMtK,SALN,MAOMJ,UAAU,QAPhB,MAQMuN,SAAS,EAAG,EAAGjR,GAAYkP,OAAZlP,CAAoBoO,MAAO,EARhD,MASMtK,SATN,MAWMJ,UAAU,QAXhB,MAYMuN,SAAS,EAAGkC,GAAgB,EAAGnT,GAAYkP,OAAZlP,CAAoBoO,MAAO,EAZhE,MAaMtK,SAbN,MAeMJ,UAAU,QAfhB,MAgBMuN,SAAS,KAAkBjR,GAAYkP,OAAZlP,CAAoBoO,MAAO,EAhB5D,MAiBMtK,iBA9BsB1C,KAAK+P,UCA5BmC,GAAa,GACbC,MAEOC,2BAcZ,UAAA,2EAGMC,cAAgB,GAAIrS,MAAK+P,WACzBsC,cAAcC,gBACdD,cAAc1V,iBACd0V,cAAcvV,GAAG,cAAe,iBAAM,GAAKyV,aAAL,EAA3C,KACKF,cAAcvV,GAAG,aAAc,iBAAM,GAAK0V,aAAL,EAA1C,KAEKC,QAAU7T,GAAY4O,UAAZ5O,KAAsC8T,SAAtC9T,CAAgD,EAAhDA,CAAoD,UAApDA,CAAgE,MAAhEA,IACV2P,OAAOxI,aACPwI,OAAOxH,cAAgB,IACvBwH,OAAOnR,SAASC,EAAI,CAAC,KACrBkR,OAAOnR,SAASE,EAAI,CAAC,KACrBiR,OAAOpG,WACPkK,cAAc9L,SAAS,EAAKgI,UAE5BoE,YAAc,SACdC,WAAWxV,SAASC,EAAI6U,GAAa,IACrCU,WAAWxV,SAASE,EAAI,IACxBsV,WAAW9V,GAAG,cAAe,iBAAM,GAAK+V,iBAAL,EAAxC,KACKD,WAAW9V,GAAG,aAAc,iBAAM,GAAKgW,iBAAL,EAAvC,KAEKvM,SAAS,EAAK8L,iBACd9L,SAAS,EAAKqM,cAEdX,UACOnE,QAAQhR,GAAG,SAAU,iBAAM,GAAKmV,IAAL,EAAvC,cAEW,iBAAM,GAAK1D,MAAL,CAAYwE,SAAZ,CAAsB,cAAtB,CAAjB,EAAwD,sDAvCzD,OACQ,MAAKN,0CAIb,OACQ,MAAKE,iDAqCb,MACMvV,SAASC,EAAI,EADnB,MAEMD,SAASE,EAAIsB,GAAYkP,OAAZlP,CAAoB+R,MAApB/R,EAA8BsT,GAAa,EAA3CtT,CAFnB,MAIMyT,cAAczC,OAJpB,MAMMyC,cAAc/P,UAAU,EAAU,IANxC,MAOM+P,cAAcW,cAA2Bb,GAAiB,EAAGA,GAAiB,EAPpF,MAQME,cAAc3P,SARpB,MAUM2P,cAAc/P,UAAU,OAV9B,MAWM+P,cAAcvC,UAAU,EAAG,QAXjC,MAYMuC,cAAcW,oBAZpB,MAaMX,cAAc3P,iDAIpB,MACM6L,OAAO0E,aAAa,eAD1B,MAEM1E,OAAOwE,UAAU,2DAIvB,MACMxE,OAAO0E,aAAa,mBAD1B,MAEM1E,OAAOwE,UAAU,2DAIvB,MACMxE,OAAO0E,aAAa,eAD1B,MAEM1E,OAAOwE,UAAU,mDAIvB,MACMxE,OAAO0E,aAAa,OAD1B,MAEM1E,OAAOwE,UAAU,uBApFI/S,KAAKsG,WAyF3B4M,2BAIL,UAAA,2EAGMvW,iBAEAwW,OAAS,GAAInT,MAAKC,MAAT,CAAgBrB,GAAYC,WAAZD,CAAwBwU,GAAmBR,UAAnBQ,CAA8BC,IAAtDzU,EAA4DkL,OAA5E,IACTwJ,SAAW,GAAItT,MAAK2J,MAAL3J,CAAYuT,YAAhB,CAA6B3U,GAAYC,WAAZD,CAAwBwU,GAAmBR,UAAnBQ,CAA8BI,MAAtD5U,EAA8DkL,OAA3F,IACX2J,QAAU,GAAIzT,MAAKC,MAAT,CAAgBrB,GAAYC,WAAZD,CAAwBwU,GAAmBR,UAAnBQ,CAA8BM,KAAtD9U,EAA6DkL,OAA7E,IAEVqJ,OAAOxC,OAAS,KAChB2C,SAAS3C,OAAS,KAClB8C,QAAQ9C,OAAS,KAEjBpK,SAAS,EAAK4M,UACd5M,SAAS,EAAK+M,YACd/M,SAAS,EAAKkN,WAEdxB,wDAIN,IACK0B,GAAY,SAEXR,OAAO/V,SAASC,EAAI,CAH1B,MAIM8V,OAAO/V,SAASE,EAAI,CAJ1B,MAMMgW,SAASlW,SAASC,EAAI,EAN5B,MAOMiW,SAASlW,SAASE,EAAI,CAP5B,MAQMgW,SAAStG,OARf,MAUMyG,QAAQrW,SAASC,EAAI,IAV3B,MAWMoW,QAAQrW,SAASE,EAAI,SApCH0C,KAAK+P,UC5FjBqD,GAAqB,YACrB,MACL,iDADK,QAEH,mDAFG,OAGJ,kDAHI,CADqB,EAQrBQ,2BAcZ,UAAA,2EAGMC,QAAU,SACVC,SAAW,SAEXvN,SAAS,EAAKwN,UACdxN,SAAS,EAAKyN,WAEdD,OAAOxF,OAAOtJ,OAAS,kIAnB7B,OACQ,MAAK4O,uCAIb,OACQ,MAAKC,gBAV0B9T,KAAKsG,WA4BhC2N,2BAIZ,qXAQMvV,OAAOC,IAAIyU,GAAmBR,UAAnBQ,CAA8BC,WACzC3U,OAAOC,IAAIyU,GAAmBR,UAAnBQ,CAA8BI,aACzC9U,OAAOC,IAAIyU,GAAmBR,UAAnBQ,CAA8BM,qHbzBnCQ,4BAIZ,UAAA,2EAGM3Q,IAAM,IACNC,OAAS,IAET7G,iBACAgG,cAEA7F,GAAG,QAAS,iBAAM,GAAKqX,OAAL,EAAvB,KACKrX,GAAG,cAAe,iBAAM,GAAKsX,WAAL,EAA7B,KACKtX,GAAG,aAAc,iBAAM,GAAKuX,UAAL,EAA5B,uDAID,MACM1M,KAAK,aAAc,KAClB,KAAKpE,GADa,QAEf,KAAKC,MAFU,GAGpB,KAAKnG,CAHe,GAIpB,KAAKC,CAJe,GAKpB,KAAKgX,CALe,OAMhB,KAAKtH,KANW,QAOf,KAAK2D,MAPU,MAQjB,IARiB,wCAazB,MACMhJ,KAAK,aAAc,KAClB,KAAKpE,GADa,QAEf,KAAKC,MAFU,GAGpB,KAAKnG,CAHe,GAIpB,KAAKC,CAJe,GAKpB,KAAKgX,CALe,OAMhB,KAAKtH,KANW,QAOf,KAAK2D,MAPU,MAQjB,IARiB,uCAazB,MACMhJ,KAAK,aAAc,KAClB,KAAKpE,GADa,QAEf,KAAKC,MAFU,GAGpB,KAAKnG,CAHe,GAIpB,KAAKC,CAJe,OAKhB,KAAK0P,KALW,QAMf,KAAK2D,MANU,MAOjB,IAPiB,UAhDI3Q,KAAK+P,UA6DtBwE,4BAIZ,oGAMYC,4BAIZ,UAAA,wEAGOC,EAAY,GAETC,EAAO,EAAU,CAAPA,GAAUA,IAC7B,IACKC,GAAY,CAAPD,EADV,CAEKE,EAAY,EAAPF,EAFV,CAIOlS,EAAS,CACd,GAAIxC,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,EAAhB,GADc,CAEd,GAAI9U,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,CAAkBA,GAAY,CAA9BA,EAAhB,CAAwDlS,GAAa,CAAbA,EAAxD,CAFc,CAGd,GAAI5C,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,CAAiB,EAAjBA,EAAhB,CAA0C,IAA1C,CAHc,CAId,GAAI9U,MAAK6U,KAAT,GAAoBjS,GAAa,CAAbA,EAApB,CAJc,CAJhB,GAWWxE,eAXX,OAawB,EAAKuE,yCAMlBoS,4BAIZ,UAAA,wEAGUL,EAAO,EAAU,CAAPA,GAAUA,IAC7B,IACKC,GAAY,CAAC,CAARD,EADV,CAEKE,EAAY,EAAPF,EAFV,CAIOlS,EAAS,CACd,GAAIxC,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,EAAhB,GADc,CAEd,GAAI9U,MAAK6U,KAAT,CAAeC,IAAf,CAAgClS,GAAa,CAAbA,EAAhC,CAFc,CAGd,GAAI5C,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,CAAiB,EAAjBA,EAAhB,CAA0C,IAA1C,CAHc,CAId,GAAI9U,MAAK6U,KAAT,CAAgBC,GAAY,CAAZA,CAAkBA,GAAY,CAA9BA,EAAhB,CAAwDlS,GAAa,CAAbA,EAAxD,CAJc,CAJhB,OAWwB,EAAKD,yCAMlBqS,4BAIZ,UAAA,mEAAA,CAGOxS,EAAS,CACd,GAAIxC,MAAK6U,KAAT,CAAeC,GAAY,CAA3B,CAA8B,CAA9B,CADc,CAEd,GAAI9U,MAAK6U,KAAT,IAA0BjS,GAAa,CAAvC,CAFc,CAGd,GAAI5C,MAAK6U,KAAT,CAAeC,GAAY,CAA3B,IAHc,CAId,GAAI9U,MAAK6U,KAAT,CAAe,CAAf,CAAkBjS,GAAa,CAA/B,CAJc,CAHhB,cAUwB,EAAKD,kCCtKjBsS,GAAgB,IAEhBrS,GAAa,GACbsS,GAAiBtS,GAAa,EAC9BkS,GAAY,GACZK,GAAgBL,GAAY,EAS5B3R,GAAa,OAClB,CADkB,WAEd,CAFc,WAGd,CAHc,EabbiS,2BAIZ,UAAA,iEAAA,CAGO5S,EAAS,CACd,GAAIxC,MAAK6U,KAAT,CAAeC,GAAY,CAA3B,CAA8B,CAA9B,CADc,CAEd,GAAI9U,MAAK6U,KAAT,IAA0BjS,GAAa,CAAvC,CAFc,CAGd,GAAI5C,MAAK6U,KAAT,CAAeC,GAAY,CAA3B,IAHc,CAId,GAAI9U,MAAK6U,KAAT,CAAe,CAAf,CAAkBjS,GAAa,CAA/B,CAJc,CAHhB,UAUMkN,UAAU,EAAG,YACbvN,OAAOC,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,CAAc,KAClCC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,CAAc,KAClCC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,CAAc,KAClCC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,CAAc,KAClCC,OAAOD,EAAO,CAAPA,EAAUnF,EAAGmF,EAAO,CAAPA,EAAUlF,CAAVkF,CAAc,KAClCE,YAEA+H,QAAU,CACd4K,EAAa,GAAIrV,MAAKyK,OAALzK,CAAasV,gBAA9BD,CAAkD,WAClD,GACQ9P,MAAQ,CADhB,GAEQoF,MAAQ,EAFhB,GAGQ4K,KAAO,CAHf,GAIQC,SAAW,CAJnB,GAKQC,SAAW,EANnB,CAAAJ,CADc,yDAahB,MACMjY,SAASC,GADf,MAEMD,SAASE,EAAIA,EAAI,CAFvB,MAGMgX,4CAIN,OACQ,GACH,GADG,GAEH,GAFG,SA3CuBtU,KAAK+P,UCHxB2F,GAAa,GAE1BA,GAAWtX,IAAXsX,sDAAAA,EAUAA,GAAWtX,IAAXsX,wCAAAA,EAQAA,GAAWtX,IAAXsX,uiBAAAA,EA6BAA,GAAWtX,IAAXsX,6cAAAA,EAsBAA,GAAWtX,IAAXsX,uiBAAAA,EA6BAA,GAAWtX,IAAXsX,qyCAAAA,sCC9FC,UAAA,2EAGM/Y,iBAEAgZ,WAAa,KACbC,mBACAC,WAAa,IAAOC,OACpBC,mCAZuB/V,KAAK+P,UAiBtBiG,kCAIZ,UAAA,uEAAA,CAGKC,EAAOC,EAAY,EAAKP,UAAL,CAAkB,EAAKC,cAAnCM,CAAqD,CAHjE,cAOO5T,UAAU,WACVC,UAAsB2S,GAAiB,EAAKU,kBAC5CnT,OAAO0S,GAAgB,EAAKY,cAAeb,GAAiB,EAAKU,cAAtBV,CAAwC,EAAKa,aAAL,CAAqB,KACxGtT,OAAO0S,GAAgB,EAAKY,cAAeb,GAAkB,EAAKa,aAAL,CAAqB,CAAvCb,CAA4C,EAAKW,cAC5FpT,UAAsByS,GAAiB,EAAKW,cAC5CpT,UAAsByS,GAAiB,EAAKU,kBAC5ClT,aAGDJ,UAAU,YACVC,UAAsB2S,GAAiB,EAAKU,cAAtBV,MACtBzS,UAAsByS,GAAiB,EAAKW,cAC5CpT,OAAO,EAAGyS,GAAiB,EAAKW,UAAtBX,OACVzS,OAAO,EAAG,EAAKmT,cAAL,MACVnT,UAAsByS,GAAiB,EAAKU,cAAtBV,MACtBxS,YAEAJ,UAAU,WACVC,UAAsB2S,GAAiB,EAAKW,cAC5CpT,OAAO,EAAGyS,GAAiB,EAAKW,UAAtBX,OACVzS,OAAO,EAAKsT,cAAeb,GAAiB,EAAKW,UAAtBX,IAAqD,EAAKa,aAAL,CAAqB,KACrGtT,OAAO0S,GAAgB,EAAKY,cAAeb,GAAiB,EAAKW,UAAtBX,CAAoC,EAAKa,aAAL,CAAqB,KACpGtT,UAAsByS,GAAiB,EAAKW,cAC5CnT,iCAKMyT,gCAIZ,UAAA,iFAGM7T,UAAU,WACVC,OAAO,EAAG,CAAC,EAAKsT,cAChBpT,OAAO,EAAKsT,cAAe,CAAC,EAAKF,UAAN,CAAoB,EAAKE,aAAL,CAAqB,KACpEtT,OAAO,EAAG,CAAC,EAAKoT,UAAN,CAAmB,EAAKE,iBAClCtT,OAAO,CAAC,EAAKsT,cAAe,CAAC,EAAKF,UAAN,CAAoB,EAAKE,aAAL,CAAqB,KACrEtT,OAAO,EAAG,CAAC,EAAKoT,cAChBnT,iCAKM0T,kCAIZ,UAAA,uEAAA,CAGKH,EAAOC,EAAY,EAAKP,UAAL,CAAkB,EAAKC,cAAnCM,CAAqD,CAHjE,cAOO5T,UAAU,YACVC,OAAO,IAAgB2S,GAAiB,EAAKU,kBAC7CnT,OAAO,IAAgByS,GAAiB,EAAKW,cAC7CpT,OAAO,IAAiB,EAAKsT,cAAeb,GAAiB,EAAKW,UAAtBX,CAAoC,EAAKa,aAAL,CAAqB,KACrGtT,OAAO,IAAiB,EAAKsT,cAAeb,GAAiB,EAAKU,cAAtBV,CAAwC,EAAKa,aAAL,CAAqB,KACzGtT,OAAO,IAAgByS,GAAiB,EAAKU,kBAC7ClT,aAGDJ,UAAU,WACVC,OAAO,IAAgB2S,GAAiB,EAAKU,cAAtBV,MACvBzS,OAAO,IAAgByS,GAAiB,EAAKW,cAC7CpT,OAAO,EAAGyS,GAAiB,EAAKW,UAAtBX,OACVzS,OAAO,EAAG,EAAKmT,cAAL,MACVnT,OAAO,IAAgByS,GAAiB,EAAKU,cAAtBV,MACvBxS,YAEAJ,UAAU,WACVC,OAAO,IAAgB2S,GAAiB,EAAKW,cAC7CpT,OAAO,EAAGyS,GAAiB,EAAKW,UAAtBX,OACVzS,OAAO,CAAC,EAAKsT,cAAeb,GAAiB,EAAKW,UAAtBX,IAAqD,EAAKa,aAAL,CAAqB,KACtGtT,OAAO,IAAiB,EAAKsT,cAAeb,GAAiB,EAAKW,UAAtBX,CAAoC,EAAKa,aAAL,CAAqB,KACrGtT,OAAO,IAAgByS,GAAiB,EAAKW,cAC7CnT,iCCnGM2T,2BA8BZ,UAAA,2EAGMC,UAAY,KACZC,WAAa,KACbC,OAAS,KAETC,QAAU,IACVC,KAAO,IAEPd,eAAiB,IACjBG,cAAgB,IAEhB7R,QAAU,IACVC,OAAS,IAET1C,QAAU,CAACpE,EAAG,CAAJ,CAAOC,EAAG,CAAV,IAEVqZ,UAAY,IACZC,WAAa,SACbA,WAAWC,kBAGXC,iBAAiBpB,GAAW,CAAXA,MAEVrH,OAAO1P,IAAI,iBAAM,GAAKgR,MAAL,EAA7B,sDAnDD,OACQ,MAAK2G,2CAIb,OACQ,MAAKC,4CAIb,OACQ,MAAKxJ,KAAL,CAAW1P,CAfpB,iBAmBC,MACM0P,MAAM1P,GADZ,MAEM0P,MAAMzP,iCAIZ,OACQ,MAAKkZ,uDAiCb,UACM5G,OADN,CAGQ,KAAK5E,QAAL,CAAc,CAAd,CAHR,OAIOV,YAAY,KAAKU,QAAL,CAAc,CAAd,GAElB,KAAKzE,QAAL,CAAc,KAAKqQ,UAAnB,CAND,MAQMN,UAAY,EARlB,MASME,OAAS,8CAIf,iBACM7O,KAAK,oBADX,MAGMoP,iBAHN,IAKOtT,GAAQ,KAAK8S,UAAL,CAAkBS,EAC9BC,IAD8BD,GAE9B5U,KAF8B4U,CAExB,IAFwBA,EAG9BpZ,GAH8BoZ,CAG1B,kBAAOzT,GAAInB,KAAJmB,CAAU,EAAVA,EAAc3F,GAAd2F,CAAkB,kBAAQ2T,KAA1B,CAAA3T,CAHmB,CAAAyT,CALjC,GAU2BG,EAAoB,KAAK/S,SAAzB+S,CAV3B,CAUQjT,IAAAA,OAVR,CAUiBC,IAAAA,MAVjB,SAWMD,eACAC,SAEgB,CAAjBV,KAAMjC,aAGLiV,QAAUhT,EAAM,CAANA,EAASjC,YACnBkV,KAAOjT,EAAMjC,+BAIZgV,UAAc,8BAIdY,GAAkB,EAAKC,aAAL,SAEE,IAApBD,KACH,gBAAA,IAEGE,GAAOvT,SAEPH,EAAa2T,SACbC,EAAiBC,KAEjBC,EAAQC,SACRC,EAAQC,SAGRxa,EAAI,EAAKya,IAAL,MACJxa,EAAI,EAAKya,IAAL,MACJzD,EAAK/Q,EAAM,EAAKkT,OAAXlT,IAJEmU,qBAWNM,GAAsB,GACtBC,EAAelU,IAAcR,EAAM,CAApBQ,IACfmU,EAAYnU,MAAmBP,EAAS,CAA5BO,EACZ+R,EAAMpU,EAAS,EAAKwC,OAAL,EAATxC,EAENgW,QAEiBtZ,KAAK,OAAe,EAAKwX,cAApB,CAAoC,EAAKG,aAAzC,OACL3X,KAAK,OAAe,EAAKwX,cAApB,CAAoC,EAAKG,aAAzC,SACL3X,KAAK,OAAY,EAAKwX,cAAjB,CAAiC,EAAKG,aAAtC,YAIL3X,KAAK,OAAe,EAAKwX,cAApB,CAAoC,EAAKG,aAAzC,YAIL3X,KAAK,OAAY,EAAKwX,cAAjB,CAAiC,EAAKG,aAAtC,UAGtBoC,GAAQF,KAA6B3D,EAAI,CAAjC2D,CAAuC3D,EAAI,uCAEtC0D,iBAAAA,4CAEXzR,SAAS8O,IAAiB,WAC/B,GACM+C,SAASha,OADf,GAGMf,EAAIA,IAHV,GAIMC,EAAIA,GAAKsG,WAAwC,CAAxCA,GAALtG,CAJV,GAKMgX,GANQ,CAAAe,sFAWX9O,SAAS8O,EAAa,MAAmB,EAAKO,cAAxB,CAAbP,CAAsD,WACpE,GACM+C,SAASha,OADf,GAEMoY,cAFN,GAIMjT,KAJN,GAKMC,QALN,KAQE6U,EAAKjL,IAALiL,CAAY,QARd,EAWMX,IAXN,CAYGW,EAAKjL,IAALiL,CAAY,KAZf,GAcGA,EAAKjL,IAALiL,CAAY,KAdf,KAgBGA,EAAKjL,IAALiL,CAAY,GAhBf,IAkBMvb,GAAG,aAAc,kBAAO,GAAKwb,WAAL,GAA7B,EAlBD,GAmBMxb,GAAG,aAAc,kBAAO,GAAKyb,WAAL,GAA7B,EAnBD,GAoBMzb,GAAG,aAAc,kBAAO,GAAK0b,WAAL,GAA7B,EApBD,GAsBMnb,GAtBN,GAuBMC,GAvBN,GAwBMgX,GAzBQ,CAAAe,IA5DN7R,EAAS,EAAGA,EAASC,KAAWjC,OAAQgC,2BAJzCD,EAAM,EAAGA,EAAME,EAAMjC,OAAQ+B,cA8FjCkV,kBAEArb,SAASC,EAAIqE,EAAY9C,GAAYkP,OAAZlP,CAAoBoO,KAApBpO,CAA4B,CAA5BA,CAAkC,KAAKoO,KAAL,CAAa,CAA3DtL,OACbtE,SAASE,EAAIoE,EAAY9C,GAAYkP,OAAZlP,CAAoB+R,MAApB/R,CAA6B,CAA7BA,EAAmC,KAAK+R,MAAL,CAAc,CAAd,CAAkB,GAArD/R,CAAZ8C,OAEb0I,QAAU,GAAIpK,MAAK0Y,SAAT,CAAmB,GAAnB,CAAmC,GAAnC,CAAmD,KAAK1L,KAAL,CAA8B,CAAhBiI,GAAjE,CAAqF,KAAKtE,MAAL,CAA+B,CAAhBsE,GAApG,OAEVtN,KAAK,wEAIX,IAD2CtD,0DAAI,CAC/C,CACKxH,EAAM,KAAK8b,iBAAL,SADX,GAGQvb,SAASC,EAAIR,EAAIQ,CAHzB,GAIQD,SAASE,EAAIT,EAAIS,CAJzB,GAKQgX,EAAIzX,EAAIyX,yCAIhB,IADqBsE,8CAAAA,eACrB,CACKvb,EAAIuB,GAAYkP,OAAZlP,CAAoBoO,KAApBpO,CAA4B,CADrC,CAEKtB,EAAIsB,GAAYkP,OAAZlP,CAAoB+R,MAApB/R,CAA6B,CAFtC,IAIM8C,EAAWmX,EAAOxb,CAAPwb,CAAWA,EAAO7L,KAAP6L,CAAe,CAArCnX,CAJN,IAKMA,EAAWmX,EAAOvb,CAAPub,CAAWA,EAAOlI,MAAPkI,CAAgB,CAAtCnX,CALN,IAOUrE,EAAI,CAPd,SAWQ,SACI,IADJ,IAAA,IAAA,UAIK,GAJL,QAKG,eALH,EAXR,OAqBQ,SACI,IADJ,IAAA,IAAA,UAIK,EAJL,QAKG,QALH,uCAWR,IAC4B,CAAvB,MAAK+a,QAAL,CAAc5W,OAClB,IACKsX,GAAO,KAAKV,QAAL,CAAcW,MAAd,CAAqB,oBAAcC,GAAI3b,CAAJ2b,CAAQC,EAAI5b,CAAZ2b,IAAnC,CAAA,EAA8D3b,CAD1E,CAEK6b,EAAO,KAAKd,QAAL,CACTvU,MADS,CACF,kBAAOmV,gBADL,CAAA,EAETD,MAFS,CAEF,oBAAcC,GAAI1b,CAAJ0b,CAAQC,EAAI3b,CAAZ0b,IAFZ,CAAA,EAEuC1b,CAJnD,MAMMmE,QAAQpE,EAAI,EANlB,MAOMoE,QAAQnE,EAAI,EAPlB,MASM8a,SAAS1Y,QAAQ,WACtB,GACQrC,IADR,GAEQC,IAHR,4CASF,kDAIA,IADuC+G,0DAAI,CAC3C,CACK5C,EAAU,CAACpE,EAAG,CAAJ,CAAOC,EAAG,CAAV,CADf,CAEK+a,EAAO,KAAKxV,OAAL,KAFZ,CAIKgW,WAAOM,cAJZ,GAKE1X,EAAUoX,EAAOM,cAAPN,EALZ,KAOKO,GAAW,EAAEf,eAAF,CAPhB,CASKhb,EAAK,KAAKya,IAAL,UAA2CrW,EAAQpE,CAARoE,CAAY,KAAKA,OAAL,CAAapE,CAApE,CATV,CAUKC,EAAK,KAAKya,IAAL,UAA4CtW,EAAQnE,CAARmE,CAAY,KAAKA,OAAL,CAAanE,CAArE,GAA2E+a,QAAoC,CAA/G,CAVV,CAWK/D,EAAI,KAAK+E,IAAL,GAAe7V,EAAS,CAAxB,CAA2B,CAA3B,GAXT,OAaKO,GAAO,KAAKN,KAAZM,QACHuQ,EAAI,KAAKgF,QAAL,SAEE,CAACjc,GAAD,CAAIC,GAAJ,CAAOgX,GAAP,CAAU8E,UAAV,sCAIR,OACK,eAAK3V,KAAL,GADL,QAIQ,KAAKA,KAAL,yDAIR,OACK,eAAKW,SAAL,GADL,QAIQ,KAAKA,SAAL,wCAIR,OACQ,CAACZ,GAAD,sCAIR,IACKa,GAAI,KAAKgT,aAAL,YAEJhT,cACHA,EAAI,GAEDkT,WAAc,KAAKnT,SAAnBmT,QACHlT,GAAK,GAEC,CAACb,GAAD,KAAmCa,sCAI3C,IADkB1F,0DAAM,YAEhB,OACG,IAEF4E,EAAM,KAAKkT,OAAXlT,0CAIT,IADsB5E,0DAAM,QAEnB4E,GAAM,KAAKkT,OAAXlT,qCAIT,MACMgW,yDAIN,MACM5R,KAAK,sDAIX,uBACY,UACX,OACc,EAAKgR,iBAAL,CAAuB,EAAK/B,UAA5B,CAAwC7Z,EAAIwG,GAA5C,CAAiDxG,EAAIyG,MAArD,EAARnG,IAAAA,EAAGC,IAAAA,IAEHkc,aAAe,CAACzc,EAAIwG,GAAL,CAAUxG,EAAIyG,MAAd,CAHrB,GAIMoT,WAAWC,UAJjB,GAKMD,WAAW6C,UAAY,EAAKH,QAAL,CAAcvc,EAAIwG,GAAlB,CAAuBxG,EAAIyG,MAA3B,CAAmC,CAAnC,EAN7B,EAOG,yCAIJ,iBACMgW,mBADN,YAGY,UACX,CACK,WAAKA,YAAL,GAAoCzc,EAAIM,CAAJN,GAAU,EAAKyc,YAAL,CAAkBnc,CAA5BN,EAAiCA,EAAIO,CAAJP,GAAU,EAAKyc,YAAL,CAAkBlc,CAAjG,CADL,KAIMsZ,WAAWC,UAJjB,CADA,EAMG,UAxWyB7W,KAAK+P,UCX7B2J,GAAU,CACf,gFADe,CAEf,yEAFe,CAGf,wGAHe,CAIf,0FAJe,CAKf,oFALe,CAMf,qFANe,CAOf,2EAPe,EAUHC,GAAe,iBAAMD,IAAQhY,EAAWA,KAAKkY,MAALlY,GAAgBgY,GAAQlY,MAAnCE,CAARgY,CAA3B,EAEMG,8CAAS,8HAENnY,EAASA,EAASoY,GAATpY,CAATA,CAA6BA,EAASqY,GAATrY,CAA7BA,IACLsY,EAAGrB,iBAAHqB,OAA0C,CAA1CA,IAEHjH,UAAU,UAED,EAEZxP,KAAYC,IACfsD,EAAY,EACJvD,OAAcC,IACtBsD,EAAY,EACJvD,KAAYC,IACpBsD,EAAY,EACJvD,KAAYC,MACpBsD,EAAY,EACJvD,KAAYC,IACpBsD,EAAY,EACJvD,OAAcC,IACtBsD,EAAY,EACJvD,KAAYC,MACpBsD,EAAY,KAENA,UAAYyH,EAAOxH,aAAPwH,KACZ+F,EAAIzX,EAAIyX,IAES,QACb2F,MAAM,UAAA,WAAA,GAGbpd,EAAIQ,CAHS,GAIbR,EAAIS,CAJS,QAKR,QALQ,CAAN2c,YAULC,EAAKC,kCAKJ7F,EAAIzX,EAAIyX,IACRrB,aAAa,0BAGb,CAAC6G,IAAD,CAAKC,IAAL,CAASxL,QAAT,iDA/CK,yDCRP6L,GAAiB,SACb,oCADa,EAIVC,4BAcZ,UAAA,2EAGMC,cAEAC,eAAiB,GAAIva,MAAKC,MAAT,CAAgBrB,GAAYC,WAAZD,CAAwBwb,GAAeI,OAAvC5b,EAAgDkL,OAAhE,IACjBvD,SAAS,EAAKgU,kBAEdC,aAEAtP,2DApBN,OACQ,MAAKnD,QALd,iBASC,MACMA,0DAkBN,OACQ,GACH,EAAEoN,GAAgB,CAAlB,CADG,GAEH,EAAED,GAAiB,EAAnB,CAFG,kCAOR,SApC0BlV,KAAKsG,WAyCnBmU,2BAIZ,qXAQM/b,OAAOC,IAAIyb,GAAeI,uHC1D3BE,GAAa,OACXxc,EAAqB,yBAArBA,CADW,QAEVA,EAAqB,+BAArBA,CAFU,UAGRA,EAAqB,4BAArBA,CAHQ,eAIHA,EAAqB,sCAArBA,CAJG,EAONyc,2BAIZ,qXAQMjc,OAAOC,IAAI+b,GAAWpN,YACtB5O,OAAOC,IAAI+b,GAAWE,aACtBlc,OAAOC,IAAI+b,GAAWG,eACtBnc,OAAOC,IAAI+b,GAAWI,6HCZhBC,2BAIZ,UAAA,2EAGMC,KAAO,oDAIb,IADSjN,0DAAQ,cAEXiN,KAAK5c,KAAK,QAAA,MAAA,GAKR,mCAIR,IACQW,MAAM,oBAAqB,oEAInC,WAAA,CADagP,yDAAQ,CACrB,MACMiN,KACHnX,OAAO,kBAAOoX,GAAIlN,KAAJkN,IADhB,GAEErd,IAAI,kBAAOqd,GAAIA,GAFjB,GAGEvb,QAAQ,iGAHV,EADD,8FA1BsCM,KAAKmG,OAALnG,CAAaoG,QAqCvCkL,2BAwBZ,UAAA,2EAGM4J,SAAW,SACXC,QAAU,SAEVC,SAAW,qDA1BjB,OACQ,MAAKF,uCAIb,OACQ,MAAKC,qCAIb,OACQ,MAAKrN,OAAL,CAAaC,oCAIrB,OACQ,MAAKD,OAAL,CAAaO,0DAcrB,MACMgN,WAAW,OADjB,MAEMA,WAAW,OAFjB,MAIMA,WAAW,OAJjB,MAKMA,WAAW,OALjB,MAMMA,WAAW,OANjB,MAQMA,WAAW,6CAIjB,IACQtc,MAAM,+BAAgCuc,EAAQzN,WAARyN,CAAoB1b,KADlE,MAEMwb,SAAShd,6CAIf,OACQ,MAAKgd,QAAL,CAAcG,IAAd,CAAmB,kBAAWD,eAA9B,CAAA,kCAIR,iBACME,YAAc,MADpB,MAEMA,YAAY1e,GAAG,eAAgB,iBAAM,GAAK6K,IAAL,CAAU,qBAAV,CAA1C,EAFD,MAGMoG,MAAMxH,SAAS,KAAKiV,YAH1B,MAKMC,iNAKC,KAAKL,QAAL,CAAc1b,OAAd,4CAAsB,6GAAuB4b,EAAQI,UAARJ,mFAA7C,wDAAA,+QAKDE,YAAYvL,WAAWtF,MAAQ,aACzB,iBAAM,GAAKjM,MAAL,CAAYid,QAAZ,CAAqB,iBAAM,GAAKC,mBAAL,EAA3B,CAAA,CAAuD,CAAvD,CAAjB,ExB1HiC,mJwB8HlC,iBACMJ,YAAYvL,WAAWtF,MAAQ,CADrC,MAEM6Q,YAAY9L,WAAa,CAF/B,MAGMhR,OAAOid,SAAS,iBAAM,GAAKE,mBAAL,EAA3B,EAAuD,gDAIxD,eACQ9c,MAAM,cAAe,gCAD7B,MAEM4I,KAAK,2BAFX,MAIM6F,eAA0BsO,oBAJhC,OAMQ,MAAKpd,MANb,MAQMqP,MAAMzD,YAAY,KAAKkR,YAR7B,IAUKvN,GAAU,eAVf,CAWK8N,EAAS,QAXd,CAYKC,EAAa,MAZlB,MAcMjO,MAAMxH,WAdZ,MAeMwH,MAAMxH,SAAS,OAfrB,GAiBYA,SAAS0H,EAAQ,CAARA,EAAa,KAAKT,UAAL,KAA+BkF,SAA/B,CAAyCiH,IAAzC,CAAyD,UAAzD,CAAqE,MAArE,EAjBlC,GAkBYpT,SAAS0H,EAAQ,CAARA,EAAa,KAAKT,UAAL,KAA+BkF,SAA/B,CAAyCiH,IAAzC,CAAyD,UAAzD,CAAqE,MAArE,EAlBlC,GAoBYpT,SAASwV,EAAO,CAAPA,EAAY,OAAU,QAAV,EApBjC,GAsBYE,sBAAsBhO,EAAQ,CAARA,EAAY,GAAI,EAAG,EAtBrD,GAuBYgO,sBAAsBhO,EAAQ,CAARA,EAAY,EAAG,GAAI,EAvBrD,GAyBYgO,sBAAsBF,EAAO,CAAPA,EAAW,EAAG,GAAI,EAzBpD,IA2BKG,GAAoB,CA3BzB,CA4BK7Z,EAAU,CAACyX,GAAI,EAAL,CAASC,GAAI,CAAb,CAAgBxL,OAAQN,IAAxB,CA5Bf,GA+BS,GAAGnR,GAAG,QAAS,iBAAMmR,GAAQ,CAARA,EAAWhJ,MAAXgJ,CAAoB0L,IAAjD,EA/BD,GAgCS,GAAG7c,GAAG,QAAS,iBAAMkf,GAAWG,YAAXH,CAAwB/N,EAAQ,CAARA,CAAxB+N,CAA7B,EAhCD,GAkCS,GAAGjJ,UAAU,OAlCtB,GAmCS,GAAGjW,GAAG,QAAS,iBAAMmR,GAAQ,CAARA,EAAWhJ,MAAXgJ,CAAoB0L,IAAjD,EAnCD,GAoCS,GAAG7c,GAAG,QAAS,iBAAMkf,GAAWG,YAAXH,CAAwB/N,EAAQ,CAARA,CAAxB+N,CAA7B,EApCD,GAsCYG,aAAalO,KAtCzB,GAwCYnR,GAAG,aAAc,kBAAOmR,MAA2BmO,IAA3BnO,CAAgC,cAAhCA,2BAAgD,4GAA4B4L,KAAmBxX,EAAQkM,MAA3BsL,CAAmCxX,EAAQyX,EAA3CD,CAA+CxX,EAAQ0X,EAAvDF,CAA2D9c,EAAIwG,GAA/DsW,CAAoE9c,EAAIyG,MAAxEqW,kCAAhBxX,kDAA5D,GAAA4L,CAAnC,yCAID,IADsBvP,uEAEd,CAACA,GAAU,KAAKA,MAAhB,EAAwB2d,SAAxB,0CAIR,IADa3d,uEAEL,CAACA,GAAU,KAAKA,MAAhB,EAAwB2d,iBAtIArc,KAAK6R,KAAL7R,CAAW8R,cC5C/BlT,GAAc,OAKd0d,yNAQJvd,MAAM,eAAgB,6BAExBwd,SAASC,WAAaxc,KAAKyc,WAALzc,CAAiB0c,WAEhCC,YAEA7f,GAAG,sBAAuB,iBAAM8B,IAAYge,GAAZhe,EAA5C,YAEMA,GAAY8c,UAAZ9c,+GCzBRie,MAAMC,SAAND,CAAgBtV,SAAhBsV,CAA4B,UAC5B,aACMze,2BAEE,IAJR,EAOAye,MAAMC,SAAND,CAAgBtU,MAAhBsU,CAAyB,UACzB,OACQ,MAAKhZ,MAAL,CAAY,sBAAwBkZ,GAAKpZ,OAALoZ,OAApC,CAAA,CAFR,EAKA1Q,OAAOyQ,SAAPzQ,CAAiB3M,OAAjB2M,CAA2B,WAC3B,KACM,GAAIlK,KAAO,MACX,KAAK6a,cAAL,KACHC,EAAS,OAATA,GAJH,EAOAjd,KAAKsG,SAALtG,CAAe8c,SAAf9c,CAAyBuZ,gBAAzBvZ,CAA4C,UAC5C,iBAGMgL,SAAS7F,KAAK,aACnB,IACK+X,GAAK9X,EAAEkP,CAAFlP,EAAO,CADjB,CAEK+X,EAAK7X,EAAEgP,CAAFhP,EAAO,CAFjB,OAIK4X,MAJL,CAKS,EAAKlS,QAAL,CAAcrH,OAAd,IAA2B,EAAKqH,QAAL,CAAcrH,OAAd,GALpC,CAOQuZ,GARR,EAJD,EAgBAZ,GAAanM,IAAbmM,GAAoBpU,IAApBoU,CAAyB,UACzB,CADA,CAAAA"}