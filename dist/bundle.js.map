{"version":3,"file":"bundle.js.map","sources":["../src/core/dom-utils.js","../src/core/pixi-utils.js","../src/preferences.js","../src/view/avatar/shared.js","../src/core/json-utils.js","../src/view/room/tiles.js","../src/view/room/shared.js","../src/view/loading-view.js","../src/view/avatar/avatar.js","../src/core/logging.js","../src/view/avatar/figure.js","../src/core/manager/manager.js","../src/view/avatar/manager.js","../src/core/config/config.js","../src/core/i18n/i18n.js","../src/display.js","../src/ui/interface/bottombar.js","../src/ui/interface/memenu.js","../src/ui/interface/bottomBar.js","../src/ui/window.js","../src/ui/ui.js","../src/ui/interface/interface.js","../src/ui/interface/manager.js","../src/view/furni/furni.js","../src/view/room/cursor.js","../src/view/room/walls.js","../src/view/room/room-view.js","../src/view/room/manager.js","../src/dev/avatars.js","../src/dev/rooms.js","../src/ui/navigator/window.js","../src/view/hotel-view.js","../src/dev/gameplay.js","../src/application.js","../src/bootstrapper.js","../src/main.js"],"sourcesContent":["/**\r\n * Applies styles to an element.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Object} styles\r\n */\r\nexport function applyStyles(element, styles)\r\n{\r\n\tstyles.forEach((value, key) => element.style.setProperty(key, value));\r\n}\r\n\r\n/**\r\n * Creates an element.\r\n *\r\n * @param {String} tagName\r\n * @param {Function} callback\r\n *\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tagName, callback = null)\r\n{\r\n\tconst element = document.createElement(tagName);\r\n\r\n\tif (callback !== null)\r\n\t\tcallback(element);\r\n\r\n\treturn element;\r\n}\r\n\r\n/**\r\n * Removes contents.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nexport function removeHtml(element)\r\n{\r\n\telement.innerHTML = \"\";\r\n}\r\n\r\n/**\r\n * Query Selector All to Array.\r\n *\r\n * @param selector\r\n * @param container\r\n *\r\n * @returns {Array<Element>}\r\n */\r\nexport function querySelectorAllArray(selector, container = document)\r\n{\r\n\treturn [].slice.call(container.querySelectorAll(selector));\r\n}\r\n","export function getTextureFromRectangle(base, x, y, width, height)\r\n{\r\n\tconst texture = new PIXI.Texture(base);\r\n\ttexture.frame = new PIXI.Rectangle(x, y, width, height);\r\n\r\n\treturn texture;\r\n}\r\n\r\nexport function setInteractive(target)\r\n{\r\n\ttarget.interactive = true;\r\n}\r\n\r\nexport function simpleDraggable(target)\r\n{\r\n\tsetInteractive(target);\r\n\r\n\tlet simpleDraggableTarget = null;\r\n\tlet data = null;\r\n\tlet pos = null;\r\n\r\n\ttarget.on(\"pointerdown\", function (evt)\r\n\t{\r\n\t\tdata = evt.data;\r\n\t\tsimpleDraggableTarget = target;\r\n\t\tpos = data.getLocalPosition(simpleDraggableTarget);\r\n\r\n\t\tif (typeof target.getDraggableRegion === \"undefined\")\r\n\t\t\treturn;\r\n\r\n\t\tconst {x, y, width, height} = target.getDraggableRegion();\r\n\r\n\t\tif (pos.x < x || pos.x > width || pos.y < y || pos.y > height)\r\n\t\t{\r\n\t\t\tdata = null;\r\n\t\t\tpos = null;\r\n\t\t\tsimpleDraggableTarget = null;\r\n\t\t}\r\n\t});\r\n\r\n\ttarget.on(\"pointerup\", function ()\r\n\t{\r\n\t\tdata = null;\r\n\t\tpos = null;\r\n\t\tsimpleDraggableTarget = null;\r\n\t});\r\n\r\n\ttarget.on(\"pointermove\", function ()\r\n\t{\r\n\t\tif (simpleDraggableTarget === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst p = data.getLocalPosition(simpleDraggableTarget.parent);\r\n\r\n\t\tlet newX = p.x - pos.x;\r\n\t\tlet newY = p.y - pos.y;\r\n\r\n\t\tif (typeof target.getDraggingRegion !== \"undefined\")\r\n\t\t{\r\n\t\t\tconst {x, y, width, height} = target.getDraggingRegion();\r\n\t\t\tconst bounds = typeof target.getDraggableRegion !== \"undefined\" ? target.getDraggableRegion() : target;\r\n\r\n\t\t\tif (newX < x)\r\n\t\t\t\tnewX = x;\r\n\r\n\t\t\tif ((newX + bounds.width) > width)\r\n\t\t\t\tnewX = (width - bounds.width);\r\n\r\n\t\t\tif (newY < y)\r\n\t\t\t\tnewY = y;\r\n\r\n\t\t\tif ((newY + bounds.height) > height)\r\n\t\t\t\tnewY = (height - bounds.height);\r\n\t\t}\r\n\r\n\t\tsimpleDraggableTarget.position.x = newX;\r\n\t\tsimpleDraggableTarget.position.y = newY;\r\n\t});\r\n}\r\n\r\nexport function withInstance(instance, callback)\r\n{\r\n\tcallback(instance);\r\n\r\n\treturn instance;\r\n}\r\n","export const deliveryRoot = \"https://cdn.mili.us/time\";\r\nexport const initialLoadingDelay = 0;\r\n\r\nexport function getDeliveryUrl(path)\r\n{\r\n\treturn deliveryRoot + path;\r\n}\r\n\r\nexport function getDeliveryAssetsUrl(path)\r\n{\r\n\treturn getDeliveryUrl(\"/assets\" + path);\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { Logger } from \"../../core/logging.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { InitializerLoader } from \"../../application.js\";\r\n\r\nexport const LOADED_CONFIGS = {};\r\nexport const LOADED_LIBS = {};\r\nexport const LOADED_TEXTURES = {};\r\nexport const LOADING_LIBS = {};\r\n\r\nexport let actionsSorted = null;\r\nexport let defaultAction = null;\r\nexport let loadingAvatar = null;\r\nexport let radiusComparator = (a, b) => b.getAttribute(\"z\") - a.getAttribute(\"z\");\r\n\r\nexport function initializeAvatarRenderer()\r\n{\r\n\tif (actionsSorted === null)\r\n\t\tactionsSorted = querySelectorAllArray(\"action\", getActions()).map(action => action.getAttribute(\"id\"));\r\n\r\n\tif (defaultAction === null)\r\n\t\tdefaultAction = getAction(\"Default\");\r\n\r\n\tif (loadingAvatar === null)\r\n\t\tloadingAvatar = new Avatar(\"hd-195-1\");\r\n}\r\n\r\nexport function getAvatarClothingConfigUrl(config)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/${config}.xml`);\r\n}\r\n\r\nexport function getAvatarClothingLibraryUrl(library)\r\n{\r\n\treturn getDeliveryAssetsUrl(`/clothing/sprite/${library}.json`);\r\n}\r\n\r\nexport function getValidActionsForPart(partType)\r\n{\r\n\tconst actions = [\"std\"];\r\n\r\n\tswitch (partType)\r\n\t{\r\n\t\tcase \"bd\":\r\n\t\t\tactions.push(\"sit\", \"lay\", \"wlk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hd\":\r\n\t\t\tactions.push(\"lsp\", \"lay\", \"spk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fa\":\r\n\t\t\tactions.push(\"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ea\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ey\":\r\n\t\t\tactions.push(\"agr\", \"sad\", \"sml\", \"srp\", \"lag\", \"lsp\", \"lay\", \"eyb\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"fc\":\r\n\t\t\tactions.push(\"agr\", \"blw\", \"sad\", \"spk\", \"srp\", \"sml\", \"lsp\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hr\":\r\n\t\tcase \"hrb\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"he\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ha\":\r\n\t\t\tactions.push(\"spk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ch\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"cc\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ca\":\r\n\t\t\tactions.push(\"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lg\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lh\":\r\n\t\t\tactions.push(\"respect\", \"sig\", \"wav\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ls\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"lc\":\r\n\t\t\tactions.push(\"wlk\", \"wav\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rh\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\", \"blw\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rs\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"rc\":\r\n\t\t\tactions.push(\"drk\", \"crr\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"ri\":\r\n\t\t\tactions.push(\"crr\", \"drk\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"li\":\r\n\t\t\tactions.push(\"sig\");\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"sh\":\r\n\t\t\tactions.push(\"sit\", \"wlk\", \"lay\");\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn actions;\r\n}\r\n\r\nexport function isLibraryLoaded(library)\r\n{\r\n\treturn LOADED_LIBS[library] !== undefined;\r\n}\r\n\r\nexport function loadAvatarClothingConfig(config, loader)\r\n{\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tconst configUrl = getAvatarClothingConfigUrl(config);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () => application.getResource(configUrl) !== undefined ? LOADED_CONFIGS[config] = application.getResource(configUrl).data : undefined);\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing config: ${config}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(configUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADED_CONFIGS[config] = application.getResource(configUrl).data;\r\n\r\n\t\t\t\t\tif (!isInitializerLoader)\r\n\t\t\t\t\t\tresolve(LOADED_CONFIGS[config]);\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function loadAvatarClothingLibrary(library, loader)\r\n{\r\n\tif (LOADING_LIBS[library] !== undefined)\r\n\t\treturn LOADING_LIBS[library];\r\n\r\n\tif (isLibraryLoaded(library))\r\n\t\treturn Promise.resolve(LOADED_LIBS[library]);\r\n\r\n\treturn LOADING_LIBS[library] = new Promise(resolve =>\r\n\t{\r\n\t\tconst libraryUrl = getAvatarClothingLibraryUrl(library);\r\n\t\tconst isInitializerLoader = loader instanceof InitializerLoader;\r\n\r\n\t\tif (isInitializerLoader)\r\n\t\t{\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.use((asset, next) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tif (asset.name !== libraryUrl)\r\n\t\t\t\t\t\treturn next();\r\n\r\n\t\t\t\t\tLOADED_LIBS[library] = asset.data;\r\n\r\n\t\t\t\t\tgetTexture(library, true)\r\n\t\t\t\t\t\t.then(() => next());\r\n\t\t\t\t});\r\n\r\n\t\t\tresolve();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tLogger.debug(`Loading avatar clothing library: ${library}`);\r\n\r\n\t\t\tloader\r\n\t\t\t\t.add(libraryUrl)\r\n\t\t\t\t.on(\"complete\", () =>\r\n\t\t\t\t{\r\n\t\t\t\t\tLOADED_LIBS[library] = application.getResource(libraryUrl, loader).data;\r\n\t\t\t\t\tLOADING_LIBS[library] = undefined;\r\n\r\n\t\t\t\t\tgetTexture(library, true)\r\n\t\t\t\t\t\t.then(() => resolve(LOADED_LIBS[library]));\r\n\t\t\t\t})\r\n\t\t\t\t.load();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function getAction(id)\r\n{\r\n\tconst action = getActions().querySelector(`action[id=\"${id}\"]`);\r\n\tconst definition = {};\r\n\r\n\tif (action === null)\r\n\t\treturn undefined;\r\n\r\n\taction.attributes.forEach(attribute => definition[attribute.name] = attribute.value);\r\n\r\n\treturn definition;\r\n}\r\n\r\nexport function getActions()\r\n{\r\n\treturn LOADED_CONFIGS[\"actions\"];\r\n}\r\n\r\nexport function getAnimations()\r\n{\r\n\treturn LOADED_CONFIGS[\"animations\"];\r\n}\r\n\r\nexport function getDraworder()\r\n{\r\n\treturn LOADED_CONFIGS[\"draworder\"];\r\n}\r\n\r\nexport function getFigureData()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuredata\"];\r\n}\r\n\r\nexport function getFigureMap()\r\n{\r\n\treturn LOADED_CONFIGS[\"figuremap\"];\r\n}\r\n\r\nexport function getGeometry()\r\n{\r\n\treturn LOADED_CONFIGS[\"geometry\"];\r\n}\r\n\r\nexport function getPartSets()\r\n{\r\n\treturn LOADED_CONFIGS[\"partsets\"];\r\n}\r\n\r\nexport function getSprite(library, asset, center = {x: 0, y: 0})\r\n{\r\n\tif (LOADED_LIBS[library] === undefined)\r\n\t\treturn null;\r\n\r\n\ttry\r\n\t{\r\n\t\tconst data = LOADED_LIBS[library][\"assets\"][asset];\r\n\r\n\t\tif (data === undefined)\r\n\t\t\treturn null;\r\n\r\n\t\tconst texture = new PIXI.Texture(getTexture(library));\r\n\t\ttexture.frame = new PIXI.Rectangle(data[0], data[1], data[2], data[3]);\r\n\r\n\t\tconst sprite = new PIXI.Sprite(texture);\r\n\r\n\t\tsprite.x = center.x - (data[4] + center.x - 12);\r\n\t\tsprite.y = center.y - (data[5] - (center.y / 2) - 6);\r\n\r\n\t\treturn sprite;\r\n\t}\r\n\tcatch (err)\r\n\t{\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nexport function getTexture(library, promise = false)\r\n{\r\n\tif (LOADED_LIBS[library] === undefined)\r\n\t\treturn null;\r\n\r\n\tif (LOADED_TEXTURES[library] !== undefined)\r\n\t\treturn promise ? Promise.resolve(LOADED_TEXTURES[library]) : LOADED_TEXTURES[library];\r\n\r\n\tif (!promise)\r\n\t\treturn LOADED_TEXTURES[library] = PIXI.Texture.fromImage(\"data:image/png;base64,\" + LOADED_LIBS[library][\"resource\"]);\r\n\r\n\treturn new Promise(resolve =>\r\n\t{\r\n\t\tLOADED_TEXTURES[library] = PIXI.Texture.fromImage(\"data:image/png;base64,\" + LOADED_LIBS[library][\"resource\"]);\r\n\t\tresolve(LOADED_TEXTURES[library]);\r\n\t});\r\n}\r\n\r\nexport function getFlippedSetType(setType)\r\n{\r\n\tlet flippedSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"flipped-set-type\");\r\n\r\n\tif (flippedSetType !== null && flippedSetType !== \"\")\r\n\t\treturn flippedSetType;\r\n\r\n\treturn setType;\r\n}\r\n\r\nexport function getRemoveSetType(setType)\r\n{\r\n\tlet removeSetType = getPartSets().querySelector(`partSet part[set-type=\"${setType}\"]`).getAttribute(\"remove-set-type\");\r\n\r\n\tif (removeSetType !== null && removeSetType !== \"\")\r\n\t\treturn removeSetType;\r\n\r\n\treturn null;\r\n}\r\n\r\nexport function getActivePartSets(id)\r\n{\r\n\tconst result = [];\r\n\tconst activeParts = getPartSets().querySelectorAll(`activePartSet[id=\"${id}\"] activePart`);\r\n\r\n\tactiveParts.forEach(activePart => result.push(activePart.getAttribute(\"set-type\")));\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function getAnimationFrames(id, type)\r\n{\r\n\tconst defs = getAnimations().querySelectorAll(`action[id=\"${id}\"] part[set-type=\"${type}\"] frame`);\r\n\tconst frames = [];\r\n\r\n\tdefs.forEach(def =>\r\n\t{\r\n\t\tconst repeats = def.hasAttribute(\"repeats\") ? parseInt(def.getAttribute(\"repeats\")) : 1;\r\n\r\n\t\tfor (let i = 0; i < repeats; i++)\r\n\t\t\tframes.push({number: parseInt(def.getAttribute(\"number\")), assetpartdefinition: def.getAttribute(\"assetpartdefinition\")});\r\n\t});\r\n\r\n\treturn frames;\r\n}\r\n\r\nexport function getAnimationFramesCount(id)\r\n{\r\n\tconst frames = getAnimations().querySelectorAll(`action[id=\"${id}\"] part:first-child frame`).length;\r\n\tconst offsets = getAnimations().querySelectorAll(`action[id=\"${id}\"] offsets frame`).length;\r\n\r\n\treturn Math.max(frames, offsets);\r\n}\r\n\r\nexport function getAnimationOffset(id, geometryId, frame, direction)\r\n{\r\n\tif (isNaN(frame) || isNaN(direction))\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\tconst bodypart = getAnimations().querySelector(`action[id=\"${id}\"] offsets frame[id=\"${frame}\"] directions direction[id=\"${direction}\"] bodypart[id=\"${geometryId}\"]`);\r\n\r\n\tif (bodypart === null)\r\n\t\treturn {x: 0, y: 0};\r\n\r\n\treturn {\r\n\t\tx: parseInt(bodypart.getAttribute(\"dx\")),\r\n\t\ty: parseInt(bodypart.getAttribute(\"dy\"))\r\n\t};\r\n}\r\n","\r\nexport function evaluateString(string, context = {})\r\n{\r\n\tstring = string.replace(new RegExp(\"\\\\${(.*?)}\", \"g\"), (matches, contents) => findKey(contents, context));\r\n\r\n\treturn string;\r\n}\r\n\r\nexport function findKey(key, object, defaultValue = undefined)\r\n{\r\n\tconst keyParts = key.split(\".\");\r\n\tlet current = object;\r\n\r\n\tfor (const keyPart of keyParts)\r\n\t{\r\n\t\tif (current[keyPart] === undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\tcurrent = current[keyPart];\r\n\t}\r\n\r\n\treturn current;\r\n}\r\n","import { tileHeight, tileWidth } from \"./shared.js\";\r\n\r\nfunction drawTile(g, points, thickness)\r\n{\r\n\tg.beginFill(0x989865);\r\n\tg.lineStyle(.5, 0x838357);\r\n\tg.moveTo(points[0].x, points[0].y);\r\n\tg.lineTo(points[1].x, points[1].y);\r\n\tg.lineTo(points[2].x, points[2].y);\r\n\tg.lineTo(points[3].x, points[3].y);\r\n\tg.endFill();\r\n\r\n\tif (thickness > 0)\r\n\t{\r\n\t\tg.beginFill(0x838357);\r\n\t\tg.moveTo(points[1].x, points[1].y);\r\n\t\tg.lineTo(points[1].x, points[1].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\r\n\t\tg.beginFill(0x6F6F49);\r\n\t\tg.moveTo(points[3].x, points[3].y);\r\n\t\tg.lineTo(points[3].x, points[3].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y + thickness);\r\n\t\tg.lineTo(points[2].x, points[2].y);\r\n\t\tg.endFill();\r\n\t}\r\n}\r\n\r\nexport class TileBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.row = 0;\r\n\t\tthis.column = 0;\r\n\r\n\t\tthis.cacheAsBitmap = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.thickness = thickness;\r\n\r\n\t\tthis.on(\"pointertap\", () => this.onClick());\r\n\t\tthis.on(\"pointerover\", () => this.onMouseOver());\r\n\t\tthis.on(\"pointerout\", () => this.onMouseOut());\r\n\t}\r\n\r\n\tonClick()\r\n\t{\r\n\t\tthis.emit(\"tile-tap\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOver()\r\n\t{\r\n\t\tthis.emit(\"tile-hover\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tz: this.z,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n\tonMouseOut()\r\n\t{\r\n\t\tthis.emit(\"tile-leave\", {\r\n\t\t\trow: this.row,\r\n\t\t\tcolumn: this.column,\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\ttile: this\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouth extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthEast extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst allPoints = [];\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * 8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + (tileWidth / 8) + ax, (tileHeight / 8) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point(ax, (tileHeight / 2) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tallPoints.push(...points);\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class StairsSouthWest extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tfor (let step = 0; step < 4; step++)\r\n\t\t{\r\n\t\t\tlet ax = step * -8;\r\n\t\t\tlet ay = step * 12;\r\n\r\n\t\t\tconst points = [\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + ax, ay),\r\n\t\t\t\tnew PIXI.Point(tileWidth + ax, (tileHeight / 2) + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) + 24 + ax, 20 + ay),\r\n\t\t\t\tnew PIXI.Point((tileWidth / 2) - (tileWidth / 8) + ax, (tileHeight / 8) + ay)\r\n\t\t\t];\r\n\r\n\t\t\tdrawTile(this, points, this.thickness);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport class Tile extends TileBase\r\n{\r\n\r\n\tconstructor(thickness)\r\n\t{\r\n\t\tsuper(thickness);\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tdrawTile(this, points, this.thickness);\r\n\t}\r\n\r\n}\r\n","import { StairsSouth, StairsSouthEast, StairsSouthWest, Tile } from \"./tiles.js\";\r\n\r\nconst HeadingNorthEast = 0;\r\nconst HeadingNorthWest = 1;\r\nconst HeadingSouthEast = 2;\r\nconst HeadingSouthWest = 3;\r\n\r\nconst StairsTypeSouth = 3;\r\nconst StairsTypeSouthEast = 2;\r\nconst StairsTypeSouthWest = 4;\r\n\r\nexport const hitAreaOffset = 5000;\r\n\r\nexport const tileHeight = 32;\r\nexport const tileHeightHalf = tileHeight / 2;\r\nexport const tileWidth = 64;\r\nexport const tileWidthHalf = tileWidth / 2;\r\n\r\nexport function getDistance(a, b)\r\n{\r\n\treturn Math.max(Math.abs(a.row - b.row), Math.abs(a.column - b.column));\r\n}\r\n\r\nexport function getHeading(a, b)\r\n{\r\n\tif (a.row === b.row && a.column === b.column)\r\n\t\treturn undefined;\r\n\r\n\tif (b.row < a.row && b.column > a.column)\r\n\t\treturn 1;\r\n\telse if (b.row === a.row && b.column > a.column)\r\n\t\treturn 2;\r\n\telse if (b.row > a.row && b.column > a.column)\r\n\t\treturn 3;\r\n\telse if (b.row > a.row && b.column === a.column)\r\n\t\treturn 4;\r\n\telse if (b.row > a.row && b.column < a.column)\r\n\t\treturn 5;\r\n\telse if (b.row === a.row && b.column < a.column)\r\n\t\treturn 6;\r\n\telse if (b.row < a.row && b.column < a.column)\r\n\t\treturn 7;\r\n\telse\r\n\t\treturn 0;\r\n}\r\n\r\nexport function getDoorDirection(tiles, row, column)\r\n{\r\n\tif (!isDoor(tiles, row, column))\r\n\t\treturn null;\r\n\r\n\treturn [HeadingNorthEast, HeadingNorthWest, HeadingSouthEast, HeadingSouthWest][getSurroundings(tiles, row, column).findIndex(t => t !== null)];\r\n}\r\n\r\nexport function getStairsType(tiles, row, column)\r\n{\r\n\tlet tileHeight = getTile(tiles, row, column);\r\n\tlet [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest] = getSurroundings(tiles, row, column);\r\n\r\n\tif (tileNorthEast !== null && tileNorthWest !== null && Math.abs(tileHeight - tileNorthEast) === 1 && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsTypeSouth;\r\n\telse if (tileNorthWest !== null && Math.abs(tileHeight - tileNorthWest) === 1)\r\n\t\treturn StairsTypeSouthEast;\r\n\telse if (tileNorthEast !== null && Math.abs(tileHeight - tileNorthEast) === 1)\r\n\t\treturn StairsTypeSouthWest;\r\n\r\n\t// TODO: Other stairs.\r\n\r\n\treturn -1;\r\n}\r\n\r\nexport function getSurroundings(tiles, row, column)\r\n{\r\n\tlet tileNorthEast = getTile(tiles, row - 1, column);\r\n\tlet tileNorthWest = getTile(tiles, row, column - 1);\r\n\tlet tileSouthEast = getTile(tiles, row, column + 1);\r\n\tlet tileSouthWest = getTile(tiles, row + 1, column);\r\n\r\n\treturn [tileNorthEast, tileNorthWest, tileSouthEast, tileSouthWest];\r\n}\r\n\r\nexport function getTile(tiles, row, column)\r\n{\r\n\tif (typeof tiles[row] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\tif (typeof tiles[row][column] === \"undefined\")\r\n\t\treturn null;\r\n\r\n\treturn tiles[row][column];\r\n}\r\n\r\nexport function getTileHeightIndex(char)\r\n{\r\n\tif (char === \"x\")\r\n\t\treturn null;\r\n\r\n\treturn [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"].indexOf(char);\r\n}\r\n\r\nexport function getTileImplementation(type = -1)\r\n{\r\n\tif (type === StairsTypeSouth)\r\n\t\treturn StairsSouth;\r\n\r\n\tif (type === StairsTypeSouthEast)\r\n\t\treturn StairsSouthEast;\r\n\r\n\tif (type === StairsTypeSouthWest)\r\n\t\treturn StairsSouthWest;\r\n\r\n\treturn Tile;\r\n}\r\n\r\nexport function isDoor(tiles, row, column)\r\n{\r\n\tif (getTile(tiles, row, column) === null)\r\n\t\treturn false;\r\n\r\n\treturn getSurroundings(tiles, row, column).filter(t => t !== null).length === 1;\r\n}\r\n\r\nexport function needsWallC(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cy = row;\r\n\r\n\twhile (cy > -1)\r\n\t\tif (getTile(tiles, --cy, column) !== null && !isDoor(tiles, cy, column))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row - 1, column + 1) !== null && !isDoor(tiles, row - 1, column + 1)));\r\n}\r\n\r\nexport function needsWallR(tiles, row, column)\r\n{\r\n\tif (isDoor(tiles, row, column))\r\n\t\treturn false;\r\n\r\n\tlet cx = column;\r\n\r\n\twhile (cx > -1)\r\n\t\tif (getTile(tiles, row, --cx) !== null && !isDoor(tiles, row, cx))\r\n\t\t\treturn false;\r\n\r\n\treturn !((getTile(tiles, row - 1, column - 1) !== null && !isDoor(tiles, row - 1, column - 1)) || (getTile(tiles, row + 1, column - 1) !== null && !isDoor(tiles, row + 1, column - 1)));\r\n}\r\n\r\nexport function getHighestAndLowest(heightmap)\r\n{\r\n\tlet highest = 0, lowest = 36;\r\n\r\n\tfor (let row = 0; row < heightmap.length; row++)\r\n\t{\r\n\t\tfor (let column = 0; column < heightmap[row].length; column++)\r\n\t\t{\r\n\t\t\tlet h = heightmap[row][column];\r\n\r\n\t\t\tif (h > highest)\r\n\t\t\t\thighest = h;\r\n\r\n\t\t\tif (h < lowest)\r\n\t\t\t\tlowest = 0;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {highest, lowest};\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { I18nManager } from \"../core/i18n/i18n.js\";\r\n\r\nconst resourceLogo = \"/resource/image/logo.png\";\r\n\r\nclass LoadingBar extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this._percentage;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis._percentage = value;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.barHeight = 30;\r\n\t\tthis.barThickness = 2;\r\n\t\tthis.barWidth = 300;\r\n\t\tthis.percentage = 0;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x000000);\r\n\t\tthis.lineStyle(this.barThickness, 0x434343);\r\n\t\tthis.drawRoundedRect(0, 0, this.barWidth, this.barHeight, 6);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x575757);\r\n\t\tthis.lineStyle(null);\r\n\t\tthis.drawRoundedRect(this.barThickness, this.barThickness, Math.round(this.percentage / 100 * (this.barWidth - this.barThickness * 2)), this.barHeight - this.barThickness * 2, 4);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class LoadingView extends PIXI.Graphics\r\n{\r\n\r\n\tget percentage()\r\n\t{\r\n\t\treturn this.loadingBar.percentage || 0;\r\n\t}\r\n\r\n\tset percentage(value)\r\n\t{\r\n\t\tthis.loadingBar.percentage = Math.round(value);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.loadingBar = new LoadingBar();\r\n\r\n\t\tthis.logo = null;\r\n\r\n\t\tthis.init();\r\n\t\tthis.loadResources();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 300,\r\n\t\t\tfill: 0xFFFFFF,\r\n\t\t\twordWrap: true,\r\n\t\t\twordWrapWidth: this.loadingBar.barWidth\r\n\t\t});\r\n\r\n\t\tthis.text = new PIXI.Text(\"\", style);\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.render());\r\n\t}\r\n\r\n\tloadResources()\r\n\t{\r\n\t\tthis.loader\r\n\t\t\t.add(resourceLogo)\r\n\t\t\t.load(() => this.onResourcesLoaded())\r\n\t}\r\n\r\n\tonResourcesLoaded()\r\n\t{\r\n\t\tthis.logo = new PIXI.Sprite(application.getResource(resourceLogo, this.loader).texture);\r\n\r\n\t\tthis.addChild(this.logo);\r\n\t\tthis.addChild(this.loadingBar);\r\n\t\tthis.addChild(this.text);\r\n\r\n\t\tthis.logo.visible = false;\r\n\r\n\t\tapplication.loader.on(\"progress\", state => this.percentage = state.progress);\r\n\r\n\t\tthis.render();\r\n\t\tthis.emit(\"loader-ready\");\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst percentage = this.percentage;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst height = application.display.height;\r\n\t\tconst width = application.display.width;\r\n\r\n\t\tthis.beginFill(0x000000);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.loadingBar.position.x = (width / 2) - (this.loadingBar.barWidth / 2);\r\n\t\tthis.loadingBar.position.y = height - (this.loadingBar.barHeight + 60);\r\n\r\n\t\tthis.logo.visible = true;\r\n\t\tthis.logo.x = Math.round((width / 2) - (this.logo.width / 2));\r\n\t\tthis.logo.y = Math.round((height / 2) - (this.logo.height / 2));\r\n\r\n\t\tthis.text.text = application.getManager(I18nManager).getString(\"loading-view.starting-up\", {percentage}, \"\");\r\n\r\n\t\tthis.text.position.set(\r\n\t\t\t(this.loadingBar.position.x + (this.loadingBar.barWidth / 2)) - (this.text.width / 2),\r\n\t\t\tthis.loadingBar.position.y - 30\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { querySelectorAllArray } from \"../../core/dom-utils.js\";\r\nimport { setInteractive } from \"../../core/pixi-utils.js\";\r\nimport { FigureString } from \"./figure.js\";\r\nimport { actionsSorted, defaultAction, getAction, getActivePartSets, getAnimationFrames, getAnimationFramesCount, getAnimationOffset, getDraworder, getFigureData, getFigureMap, getFlippedSetType, getGeometry, getRemoveSetType, getSprite, getValidActionsForPart, isLibraryLoaded, loadAvatarClothingLibrary, loadingAvatar, radiusComparator } from \"./shared.js\";\r\nimport { AvatarManager, avatarResources } from \"./manager.js\";\r\n\r\nexport class Avatar extends PIXI.Container\r\n{\r\n\r\n\tget actions()\r\n\t{\r\n\t\treturn this._actions;\r\n\t}\r\n\r\n\tget avatarSet()\r\n\t{\r\n\t\treturn this._avatarSet;\r\n\t}\r\n\r\n\tset avatarSet(value)\r\n\t{\r\n\t\tthis._avatarSet = value;\r\n\t}\r\n\r\n\tget direction()\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction(value)\r\n\t{\r\n\t\tthis._direction = value;\r\n\t}\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this._figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tif (value === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._figure = new FigureString(value);\r\n\r\n\t\tif (!this.initialBuild)\r\n\t\t\tthis.build();\r\n\r\n\t\tthis.poof();\r\n\t}\r\n\r\n\tget geometry()\r\n\t{\r\n\t\treturn this._geometry;\r\n\t}\r\n\r\n\tset geometry(value)\r\n\t{\r\n\t\tthis._geometry = value;\r\n\t}\r\n\r\n\tget headDirection()\r\n\t{\r\n\t\treturn this._headDirection;\r\n\t}\r\n\r\n\tset headDirection(value)\r\n\t{\r\n\t\tthis._headDirection = value;\r\n\t}\r\n\r\n\tconstructor(figure = \"hd-195-4\", geometry = \"vertical\", avatarSet = \"full\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tsetInteractive(this);\r\n\r\n\t\tthis.initialBuild = true;\r\n\t\tthis.canPoof = false;\r\n\t\tthis.id = \"avatar-\" + window.performance.now();\r\n\t\tthis.loader = new PIXI.loaders.Loader();\r\n\t\tthis.needsUpdate = false;\r\n\t\tthis.partContainer = new PIXI.Container();\r\n\r\n\t\tthis.addChild(this.partContainer);\r\n\r\n\t\tthis._alsoUpdate = [];\r\n\t\tthis._ticker = false;\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\r\n\t\tthis._actions = [defaultAction];\r\n\t\tthis._frames = {};\r\n\r\n\t\tthis.avatarSet = avatarSet;\r\n\t\tthis.direction = 2;\r\n\t\tthis.figure = figure;\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.headDirection = this.direction;\r\n\r\n\t\tthis.build();\r\n\t\tthis.canPoof = true;\r\n\t\tthis.initialBuild = false;\r\n\t}\r\n\r\n\taddAction(action)\r\n\t{\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\treturn;\r\n\r\n\t\taction = getAction(action);\r\n\r\n\t\tif (action === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions\r\n\t\t\t.pushChain(action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\r\n\t\tthis._frames[action.id] = 0;\r\n\r\n\t\tif (action[\"preventheadturn\"] === \"true\")\r\n\t\t\tthis._headDirection = this.direction;\r\n\t}\r\n\r\n\thasAction(action)\r\n\t{\r\n\t\tlet found = false;\r\n\r\n\t\tfor (let a of this._actions)\r\n\t\t\tif (a.id === action)\r\n\t\t\t\tfound = true;\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tremoveAction(action)\r\n\t{\r\n\t\tif (!this.hasAction(action))\r\n\t\t\treturn;\r\n\r\n\t\tthis._actions = this._actions\r\n\t\t\t.filter(a => a.id !== action)\r\n\t\t\t.sort((a, b) => actionsSorted.indexOf(b.id) - actionsSorted.indexOf(a.id));\r\n\t}\r\n\r\n\tsetPosition(x, y, dir = 3)\r\n\t{\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\tthis.direction = dir;\r\n\t\tthis.headDirection = dir;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tbuild()\r\n\t{\r\n\t\tif (this.isBuilding)\r\n\t\t\treturn;\r\n\r\n\t\tthis.isBuilding = true;\r\n\t\tthis.needsUpdate = true;\r\n\r\n\t\tthis.emit(\"avatar-build\", this);\r\n\t\tthis.invalidate();\r\n\r\n\t\tconst libraries = this.getLibraries().filter(library => !isLibraryLoaded(library));\r\n\r\n\t\tif (libraries.length > 0)\r\n\t\t{\r\n\t\t\tthis._loading = true;\r\n\r\n\t\t\tconst download = () =>\r\n\t\t\t{\r\n\t\t\t\tif (libraries.length === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._loading = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloadAvatarClothingLibrary(libraries.shift(), this.loader).then(download);\r\n\t\t\t};\r\n\r\n\t\t\tdownload();\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\r\n\t\tthis.isBuilding = false;\r\n\t}\r\n\r\n\tdecideGeometry()\r\n\t{\r\n\t\tconst geometry = getGeometry().querySelector(`canvas[scale=\"h\"] geometry[id=\"${this.geometry}\"]`);\r\n\t\tthis._height = parseInt(geometry.getAttribute(\"height\"));\r\n\t\tthis._width = parseInt(geometry.getAttribute(\"width\"));\r\n\r\n\t\tif (this.geometry === \"head\")\r\n\t\t\tthis._height = this._width;\r\n\t}\r\n\r\n\tgetActivePartSets(action = null)\r\n\t{\r\n\t\tlet activePartSets = [];\r\n\r\n\t\tif (action === null)\r\n\t\t\tactivePartSets.push(...getActivePartSets(\"figure\"));\r\n\t\telse\r\n\t\t\tactivePartSets.push(...getActivePartSets(action[\"activepartset\"]));\r\n\r\n\t\treturn activePartSets.unique();\r\n\t}\r\n\r\n\thasActivePartSet(id)\r\n\t{\r\n\t\tfor (let action of this.actions)\r\n\t\t\tif (action !== null && action[\"activepartset\"] === id)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetBodyparts()\r\n\t{\r\n\t\tconst bodyparts = [];\r\n\r\n\t\tquerySelectorAllArray(`avatarset[id=\"${this.avatarSet}\"] bodypart`, getGeometry())\r\n\t\t\t.forEach(part => bodyparts.push(part.getAttribute(\"id\")));\r\n\r\n\t\treturn bodyparts;\r\n\t}\r\n\r\n\tgetLibraries()\r\n\t{\r\n\t\tconst libraries = [];\r\n\r\n\t\tthis._parts.forEach((settype, type) =>\r\n\t\t{\r\n\t\t\tsettype.parts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tlet lib = getFigureMap().querySelector(`part[id=\"${part.id}\"][type=\"${type}\"]`);\r\n\r\n\t\t\t\tif (lib === null || lib.parentNode === null)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tlib = lib.parentNode;\r\n\r\n\t\t\t\tlibraries.push(part[\"library\"] = lib.getAttribute(\"id\").toLowerCase());\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn libraries.unique();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\tlet x = -(this._width / 2);\r\n\t\tlet y = -104;\r\n\r\n\t\treturn {x, y};\r\n\t}\r\n\r\n\tgatherParts()\r\n\t{\r\n\t\tthis.figure.parts.forEach((data, type) =>\r\n\t\t{\r\n\t\t\tconst settype = getFigureData().querySelector(`sets > settype[type=\"${type}\"]`);\r\n\r\n\t\t\tif (settype === null)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst set = settype.querySelector(`set[id=\"${data.id}\"]`);\r\n\t\t\tconst parts = set.getElementsByTagName(\"part\");\r\n\r\n\t\t\tconst colorable = set.getAttribute(\"colorable\") === \"1\";\r\n\t\t\tconst hiddenlayers = [];\r\n\t\t\tconst paletteid = settype.getAttribute(\"paletteid\");\r\n\r\n\t\t\tconst setHiddenlayers = set.querySelectorAll(\"hiddenlayers layer\");\r\n\t\t\tif (setHiddenlayers !== null)\r\n\t\t\t\tsetHiddenlayers.forEach(layer => hiddenlayers.push(layer.getAttribute(\"parttype\")));\r\n\r\n\t\t\tparts.forEach(part =>\r\n\t\t\t{\r\n\t\t\t\tconst partType = part.getAttribute(\"type\");\r\n\r\n\t\t\t\tif (this._parts[partType] === undefined)\r\n\t\t\t\t\tthis._parts[partType] = {hiddenlayers, parts: []};\r\n\r\n\t\t\t\tthis._parts[partType].parts.push({\r\n\t\t\t\t\tid: parseInt(part.getAttribute(\"id\")),\r\n\t\t\t\t\tcolorable: part.getAttribute(\"colorable\") === \"1\" && colorable,\r\n\t\t\t\t\tcolorindex: parseInt(part.getAttribute(\"colorindex\")),\r\n\t\t\t\t\tindex: parseInt(part.getAttribute(\"index\")),\r\n\t\t\t\t\tpaletteid,\r\n\t\t\t\t\tset: type,\r\n\t\t\t\t\ttype: partType\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tinvalidate()\r\n\t{\r\n\t\tthis._parts = {};\r\n\t\tthis._sprites = {};\r\n\r\n\t\tthis.decideGeometry();\r\n\t\tthis.gatherParts();\r\n\t}\r\n\r\n\tpoof()\r\n\t{\r\n\t\tif (!this.canPoof)\r\n\t\t\treturn;\r\n\r\n\t\tconst clouds = [\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"1_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: -36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"2_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: 36\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: -4,\r\n\t\t\t\ty: 16\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tsprite: new PIXI.extras.AnimatedSprite([\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_1\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_2\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_3\"]).texture,\r\n\t\t\t\t\tapplication.getResource(avatarResources.poof[\"3_4\"]).texture\r\n\t\t\t\t]),\r\n\t\t\t\tx: 4,\r\n\t\t\t\ty: -16\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\tlet cx = this._width / 2, cy = this._height / 2;\r\n\t\tlet fn = cloud =>\r\n\t\t{\r\n\t\t\tthis.addChild(cloud.sprite);\r\n\t\t\tcloud.sprite.anchor.set(0.5);\r\n\t\t\tcloud.sprite.animationSpeed = 0.2;\r\n\t\t\tcloud.sprite.loop = false;\r\n\t\t\tcloud.sprite.hitArea = null;\r\n\t\t\tcloud.sprite.position.x = cx + cloud.x;\r\n\t\t\tcloud.sprite.position.y = cy + cloud.y;\r\n\t\t\tcloud.sprite.play();\r\n\r\n\t\t\tsetTimeout(() => this.removeChild(cloud.sprite), 330);\r\n\r\n\t\t\tif (clouds[0] !== undefined)\r\n\t\t\t\tsetTimeout(() => fn(clouds.shift()), 45);\r\n\t\t};\r\n\r\n\t\tfn(clouds.shift());\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.partContainer.cacheAsBitmap = false;\r\n\t\tthis.alpha = this._loading ? 0.8 : 1.0;\r\n\r\n\t\tlet draworderId = \"std\";\r\n\r\n\t\tif (this.hasActivePartSet(\"handLeft\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"rh-up\" : \"lh-up\";\r\n\t\telse if (this.hasActivePartSet(\"handRightAndHead\"))\r\n\t\t\tdraworderId = this.direction > 3 && this.direction < 7 ? \"lh-up\" : \"rh-up\";\r\n\r\n\t\tlet draworder = querySelectorAllArray(`action[id=\"${draworderId}\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\tif (draworder.length === 0)\r\n\t\t\tdraworder = querySelectorAllArray(`action[id=\"std\"] direction[id=\"${this.direction}\"] partList part`, getDraworder()).map(part => part.getAttribute(\"set-type\"));\r\n\r\n\t\twhile (this.partContainer.children[0])\r\n\t\t\tthis.partContainer.removeChild(this.partContainer.children[0]);\r\n\r\n\t\tfor (let type of draworder)\r\n\t\t\tif (this._sprites[type] !== undefined)\r\n\t\t\t\tthis._sprites[type].forEach(part => this.partContainer.addChild(part));\r\n\r\n\t\tthis.partContainer.cacheAsBitmap = true;\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tif (!this.needsUpdate)\r\n\t\t\treturn;\r\n\r\n\t\tthis.actions.forEach(action => this.updateAction(action));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tupdateAction(action = null)\r\n\t{\r\n\t\tconst center = {\r\n\t\t\tx: this._width / 2,\r\n\t\t\ty: this._height / 2\r\n\t\t};\r\n\r\n\t\tif (action === null)\r\n\t\t\treturn;\r\n\r\n\t\tconst activePartSets = this.getActivePartSets(action);\r\n\t\tconst frame = ++this._frames[action.id] || 0;\r\n\r\n\t\tconst hiddenlayers = [];\r\n\t\tconst avatarParts = this._loading ? (loadingAvatar !== null ? loadingAvatar._parts : {}) : this._parts;\r\n\r\n\t\tif (avatarParts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tavatarParts.forEach(data => hiddenlayers.push(...data.hiddenlayers));\r\n\r\n\t\tlet bodyparts = [];\r\n\t\tthis.getBodyparts().forEach(bodypart => bodyparts.push(getGeometry().querySelector(`type[id=\"${this.geometry}\"] bodypart[id=\"${bodypart}\"]`)));\r\n\r\n\t\tfor (const partset of bodyparts.sort(radiusComparator))\r\n\t\t{\r\n\t\t\tlet bodypart = partset.getAttribute(\"id\");\r\n\t\t\tlet items = querySelectorAllArray(\"item\", partset).sort(radiusComparator);\r\n\r\n\t\t\tfor (const item of items)\r\n\t\t\t{\r\n\t\t\t\tlet partDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\tlet partType = item.getAttribute(\"id\");\r\n\t\t\t\tlet partDirectionWithoutFlip = partDirection;\r\n\t\t\t\tlet partTypeWithoutFlip = partType;\r\n\t\t\t\tlet partSwapped = false;\r\n\t\t\t\tlet removeSetType = getRemoveSetType(partType);\r\n\r\n\t\t\t\tif (removeSetType !== null)\r\n\t\t\t\t\thiddenlayers.push(removeSetType);\r\n\r\n\t\t\t\tif (partDirection > 3 && partDirection < 7)\r\n\t\t\t\t{\r\n\t\t\t\t\tpartSwapped = true;\r\n\t\t\t\t\tpartType = getFlippedSetType(partType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet partValidActions = getValidActionsForPart(partType);\r\n\t\t\t\tlet partFrames = getAnimationFrames(action.id, partType);\r\n\r\n\t\t\t\tif (activePartSets.indexOf(partTypeWithoutFlip) === -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (this._sprites[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip] = {};\r\n\r\n\t\t\t\tif (hiddenlayers.indexOf(partType) > -1)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (avatarParts[partTypeWithoutFlip] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tfor (const part of avatarParts[partTypeWithoutFlip].parts)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._loading && part.library !== \"hh_human_body\")\r\n\t\t\t\t\t\tbreak; // Other parts are probably from another library.\r\n\r\n\t\t\t\t\tlet offset = {\r\n\t\t\t\t\t\tx: parseInt(partset.getAttribute(\"x\")),\r\n\t\t\t\t\t\ty: parseInt(partset.getAttribute(\"y\"))\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tlet partFlipped = false;\r\n\t\t\t\t\tlet partFrame = frame % (partFrames !== null ? Object.values(partFrames).length : 1);\r\n\t\t\t\t\tlet partAction = (partFrames && partFrames[partFrame] ? partFrames[partFrame].assetpartdefinition : action.assetpartdefinition);\r\n\r\n\t\t\t\t\tif (partValidActions.indexOf(partAction) === -1)\r\n\t\t\t\t\t\tpartAction = partValidActions[0];\r\n\r\n\t\t\t\t\tpartDirection = bodypart === \"head\" ? this.headDirection : this.direction;\r\n\t\t\t\t\tpartFrame = partFrames && partFrames[partFrame] ? partFrames[partFrame].number : 0;\r\n\r\n\t\t\t\t\tlet animationOffset = getAnimationOffset(action.id, bodypart, frame % getAnimationFramesCount(action.id), partDirection);\r\n\t\t\t\t\tlet generateAssetName = () => `h_${partAction}_${partType}_${part.id}_${partDirection}_${partFrame}`;\r\n\t\t\t\t\tlet sprite = getSprite(part.library, generateAssetName(), center);\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opf = partFrame;\r\n\t\t\t\t\t\tpartFrame = 0;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartFrame = opf;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpartDirection = 6 - partDirection;\r\n\t\t\t\t\t\tpartFlipped = partDirectionWithoutFlip > 3 && partDirectionWithoutFlip < 7;\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet opa = partAction;\r\n\t\t\t\t\t\tpartAction = \"std\";\r\n\t\t\t\t\t\tsprite = getSprite(part.library, generateAssetName(), center);\r\n\t\t\t\t\t\tpartAction = opa;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sprite === null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// if (partType !== \"ey\" && partType !== \"fc\")\r\n\t\t\t\t\t\t// \tLogger.debug(\"Sprite not found!\", generateAssetName(), part.library, partType);\r\n\r\n\t\t\t\t\t\tbreak; // Don't draw incomplete pieces.\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!partSwapped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x += offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y += offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.x -= offset.x + animationOffset.x;\r\n\t\t\t\t\t\tsprite.y -= offset.y + animationOffset.y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (partFlipped)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsprite.scale.x = -1;\r\n\t\t\t\t\t\tsprite.x = (((this._width - sprite.width) - sprite.x) + sprite.width) + animationOffset.x;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsprite.x = Math.floor(sprite.x);\r\n\t\t\t\t\tsprite.y = Math.floor(sprite.y);\r\n\r\n\t\t\t\t\tif (part.colorable && partType !== \"ey\" && !this._loading)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst colors = this.figure.parts[part.set].color;\r\n\t\t\t\t\t\tconst color = colors[part.colorindex - 1] || colors[0];\r\n\t\t\t\t\t\tconst fdColor = getFigureData().querySelector(`palette[id=\"${part.paletteid}\"] color[id=\"${color}\"]`);\r\n\r\n\t\t\t\t\t\tif (fdColor !== null)\r\n\t\t\t\t\t\t\tsprite.tint = parseInt(`0x${fdColor.textContent}`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this._sprites[partTypeWithoutFlip][part.index] !== undefined)\r\n\t\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index].destroy(false);\r\n\r\n\t\t\t\t\tthis._sprites[partTypeWithoutFlip][part.index] = sprite;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\t\tapplication.getManager(AvatarManager).removeAvatar(this);\r\n\t}\r\n\r\n}\r\n","const debugMode = false;\r\n\r\nexport class Logger\r\n{\r\n\r\n\tstatic debug(...data)\r\n\t{\r\n\t\tif (!debugMode)\r\n\t\t\treturn;\r\n\r\n\t\tconsole.log(\"[D]\", ...data);\r\n\t}\r\n\r\n\tstatic error(...data)\r\n\t{\r\n\t\tconsole.error(\"[E]\", ...data);\r\n\t}\r\n\r\n}\r\n","export class FigureString\r\n{\r\n\r\n\tget parts()\r\n\t{\r\n\t\treturn this._parts;\r\n\t}\r\n\r\n\tconstructor(figure)\r\n\t{\r\n\t\tthis._parts = {};\r\n\r\n\t\tthis.parse(figure);\r\n\t}\r\n\r\n\thasPartId(type, id)\r\n\t{\r\n\t\tif (!this.hasPartType(type))\r\n\t\t\treturn false;\r\n\r\n\t\treturn this._parts[type].id === id;\r\n\t}\r\n\r\n\thasPartType(type)\r\n\t{\r\n\t\treturn this._parts[type] !== undefined;\r\n\t}\r\n\r\n\tparse(figure)\r\n\t{\r\n\t\tfigure = figure.split(\".\");\r\n\t\tfigure = figure.map(part => part.split(\"-\"));\r\n\t\tfigure = figure.sort((a, b) => a[0].localeCompare(b[0]));\r\n\t\tfigure.forEach(part => this._parts[part[0]] = {id: parseInt(part[1]), color: [part[2], part[3]].filter(n => n !== null)});\r\n\t}\r\n\r\n\ttoString()\r\n\t{\r\n\t\tconst str = [];\r\n\r\n\t\tthis.parts.forEach((data, type) => str.push([type, data.id, ...data.color].join(\"-\")));\r\n\r\n\t\treturn str.join(\".\");\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { Logger } from \"../logging.js\";\r\n\r\nexport class Manager\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn application.display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn application.loader;\r\n\t}\r\n\r\n\tget name()\r\n\t{\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn application.stage;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._name = this.constructor.name;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tLogger.debug(`Initializing manager: ${this.name}`)\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t}\r\n\r\n\tlog(...data)\r\n\t{\r\n\t\tconsole.log(this.name, ...data);\r\n\t}\r\n\r\n\tlogDebug(...data)\r\n\t{\r\n\t\tconsole.debug(this.name, ...data);\r\n\t}\r\n\r\n\tlogError(...data)\r\n\t{\r\n\t\tconsole.error(this.name, ...data);\r\n\t}\r\n\r\n\tlogWarning(...data)\r\n\t{\r\n\t\tconsole.warn(this.name, ...data);\r\n\t}\r\n\r\n}\r\n","import { initializeAvatarRenderer, loadAvatarClothingConfig, loadAvatarClothingLibrary } from \"./shared.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { Avatar } from \"./avatar.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport const avatarResources = {\r\n\tpoof: {\r\n\t\t\"1_1\": \"./resource/image/avatar/poof/1-1.png\",\r\n\t\t\"1_2\": \"./resource/image/avatar/poof/1-2.png\",\r\n\t\t\"1_3\": \"./resource/image/avatar/poof/1-3.png\",\r\n\t\t\"1_4\": \"./resource/image/avatar/poof/1-4.png\",\r\n\t\t\"2_1\": \"./resource/image/avatar/poof/2-1.png\",\r\n\t\t\"2_2\": \"./resource/image/avatar/poof/2-2.png\",\r\n\t\t\"2_3\": \"./resource/image/avatar/poof/2-3.png\",\r\n\t\t\"2_4\": \"./resource/image/avatar/poof/2-4.png\",\r\n\t\t\"3_1\": \"./resource/image/avatar/poof/3-1.png\",\r\n\t\t\"3_2\": \"./resource/image/avatar/poof/3-2.png\",\r\n\t\t\"3_3\": \"./resource/image/avatar/poof/3-3.png\",\r\n\t\t\"3_4\": \"./resource/image/avatar/poof/3-4.png\",\r\n\t\t\"4_1\": \"./resource/image/avatar/poof/4-1.png\",\r\n\t\t\"4_2\": \"./resource/image/avatar/poof/4-2.png\",\r\n\t\t\"4_3\": \"./resource/image/avatar/poof/4-3.png\",\r\n\t\t\"4_4\": \"./resource/image/avatar/poof/4-4.png\"\r\n\t}\r\n};\r\n\r\nexport class AvatarManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatars = [];\r\n\t\tthis.lastUpdate = 0;\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => this.initializeRenderer());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tawait loadAvatarClothingConfig(\"actions\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"animations\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"draworder\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"effectmap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuredata\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"figuremap\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"geometry\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"offsets\", this.loader);\r\n\t\tawait loadAvatarClothingConfig(\"partsets\", this.loader);\r\n\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_body\", this.loader);\r\n\t\tawait loadAvatarClothingLibrary(\"hh_human_face\", this.loader);\r\n\r\n\t\tavatarResources.poof.forEach(image => this.loader.add(image));\r\n\t}\r\n\r\n\tinitializeRenderer()\r\n\t{\r\n\t\tinitializeAvatarRenderer();\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.onGameTick());\r\n\t}\r\n\r\n\tnewAvatar(...options)\r\n\t{\r\n\t\tconst avatar = new Avatar(...options);\r\n\r\n\t\tthis.avatars.push(avatar);\r\n\r\n\t\treturn avatar;\r\n\t}\r\n\r\n\tremoveAvatar(avatar)\r\n\t{\r\n\t\tthis.avatars = this.avatars.filter(a => a.id !== avatar.id);\r\n\t}\r\n\r\n\tonGameTick()\r\n\t{\r\n\t\tif (this.lastUpdate === -1 || (application.ticker.lastTime - this.lastUpdate) > 90)\r\n\t\t{\r\n\t\t\tthis.lastUpdate = application.ticker.lastTime;\r\n\r\n\t\t\tthis.avatars.forEach(avatar => avatar.update());\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nconst configJson = \"./resource/config/config.json\";\r\n\r\nexport class ConfigManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.config = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(configJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onConfigLoaded(application.getResource(configJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.config);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.config));\r\n\t}\r\n\r\n\tonConfigLoaded(config)\r\n\t{\r\n\t\tif (config === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.config = config.data;\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { evaluateString, findKey } from \"../json-utils.js\";\r\nimport { ConfigManager } from \"../config/config.js\";\r\n\r\nconst textsJson = \"./resource/config/texts.json\";\r\n\r\nexport class I18nManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.texts = {};\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader\r\n\t\t\t.add(textsJson, 0)\r\n\t\t\t.on(\"complete\", () => this.onTextsLoaded(application.getResource(textsJson)));\r\n\t}\r\n\r\n\tgetString(key, context = {}, defaultValue = undefined)\r\n\t{\r\n\t\tlet string = findKey(key, this.texts);\r\n\r\n\t\tif (string === undefined && defaultValue !== undefined)\r\n\t\t\treturn defaultValue;\r\n\r\n\t\treturn evaluateString(string, Object.assign({}, context, this.text, application.getManager(ConfigManager).config));\r\n\t}\r\n\r\n\tonTextsLoaded(texts)\r\n\t{\r\n\t\tif (texts === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.texts = texts.data;\r\n\t}\r\n\r\n}\r\n","import { removeHtml } from \"./core/dom-utils.js\";\r\n\r\nlet frame = 0;\r\n\r\nconst stageElement = \"main#stage-mount\";\r\n\r\nexport class Display extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget frame()\r\n\t{\r\n\t\treturn frame;\r\n\t}\r\n\r\n\tget renderer()\r\n\t{\r\n\t\treturn this.app.renderer;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.app.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.app.ticker;\r\n\t}\r\n\r\n\tget view()\r\n\t{\r\n\t\treturn this.app.view;\r\n\t}\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this.renderer.height / this.dpi;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this.renderer.width / this.dpi;\r\n\t}\r\n\r\n\tget size()\r\n\t{\r\n\t\treturn {width: this.width, height: this.height};\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.dpi = window.devicePixelRatio;\r\n\t\tthis.mount = document.querySelector(stageElement);\r\n\r\n\t\tif (this.mount === null)\r\n\t\t\tthrow new Error(\"Display mount not found!\");\r\n\r\n\t\tremoveHtml(this.mount);\r\n\r\n\t\tthis.initApp();\r\n\t\tthis.initEvents();\r\n\r\n\t\tthis.ticker.add(delta => this.onTick(delta));\r\n\t}\r\n\r\n\tinitApp()\r\n\t{\r\n\t\tthis.app = new PIXI.Application({\r\n\t\t\theight: window.innerHeight,\r\n\t\t\twidth: window.innerWidth,\r\n\t\t\tantialiasing: false,\r\n\t\t\ttransparent: false,\r\n\t\t\tresolution: this.dpi,\r\n\t\t\troundPixels: false,\r\n\t\t\tpowerPreference: \"high-performance\",\r\n\t\t\tforceFXAA: false\r\n\t\t});\r\n\r\n\t\tthis.mount.appendChild(this.view);\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n\tinitEvents()\r\n\t{\r\n\t\twindow.addEventListener(\"resize\", () => this.onWindowResize());\r\n\t}\r\n\r\n\tonTick(delta)\r\n\t{\r\n\t\tframe++;\r\n\r\n\t\tthis.emit(\"tick\", delta);\r\n\r\n\t\tif (frame % 12 === 0)\r\n\t\t\tthis.emit(\"tick-update\", delta);\r\n\r\n\t\tthis.stage.updateLayerOrder();\r\n\t}\r\n\r\n\tonWindowResize()\r\n\t{\r\n\t\tthis.renderer.resize(window.innerWidth, window.innerHeight);\r\n\t\tthis.emit(\"resize\");\r\n\r\n\t\tthis.view.style.height = window.innerHeight + \"px\";\r\n\t\tthis.view.style.width = window.innerWidth + \"px\";\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.meButton = new BottomBarButtonMe());\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.meButton.x = 12;\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonMe extends PIXI.Graphics\r\n{\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this.avatar.figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tthis.avatar.figure = value;\r\n\t}\r\n\r\n\tconstructor(figure = undefined)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatar = application.getManager(AvatarManager).newAvatar(figure, \"vertical\", \"head\");\r\n\t\tthis.addChild(this.avatar);\r\n\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.direction = this.avatar.headDirection = 3;\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\r\n\t\tthis.avatar.x = -10;\r\n\t\tthis.avatar.y = -5;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarChatBubble extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nconst memenuSize = 60;\r\nconst memenuSizeHalf = Math.floor(memenuSize / 2);\r\n\r\nexport class MeMenu extends PIXI.Container\r\n{\r\n\r\n\tget avatar()\r\n\t{\r\n\t\treturn this._avatar;\r\n\t}\r\n\r\n\tget chatBubble()\r\n\t{\r\n\t\treturn this._chatBubble;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._avatarHolder = new PIXI.Graphics();\r\n\t\tthis._avatarHolder.buttonMode = true;\r\n\t\tthis._avatarHolder.interactive = true;\r\n\t\tthis._avatarHolder.on(\"pointerover\", () => this.onAvatarHover());\r\n\t\tthis._avatarHolder.on(\"pointerout\", () => this.onAvatarLeave());\r\n\r\n\t\tthis._avatar = application.getManager(AvatarManager).newAvatar(\"\", \"vertical\", \"head\");\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.headDirection = 3;\r\n\t\tthis.avatar.position.x = -15;\r\n\t\tthis.avatar.position.y = -11;\r\n\t\tthis._avatarHolder.addChild(this.avatar);\r\n\r\n\t\tthis._chatBubble = new ChatBubble();\r\n\t\tthis.chatBubble.position.x = memenuSize + 8;\r\n\t\tthis.chatBubble.position.y = 8;\r\n\t\tthis.chatBubble.on(\"pointerover\", () => this.onChatBubbleHover());\r\n\t\tthis.chatBubble.on(\"pointerout\", () => this.onChatBubbleLeave());\r\n\r\n\t\tthis.addChild(this._avatarHolder);\r\n\t\tthis.addChild(this.chatBubble);\r\n\r\n\t\tthis.draw();\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\r\n\t\tsetTimeout(() => this.avatar.addAction(\"GestureSmile\"), 500);\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tthis.position.x = 16;\r\n\t\tthis.position.y = application.display.height - (memenuSize + 16);\r\n\r\n\t\tthis._avatarHolder.clear();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x000000, 0.25);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf + 2, memenuSizeHalf + 2);\r\n\t\tthis._avatarHolder.endFill();\r\n\r\n\t\tthis._avatarHolder.beginFill(0x0C3A65);\r\n\t\tthis._avatarHolder.lineStyle(4, 0x244d74);\r\n\t\tthis._avatarHolder.drawCircle(memenuSizeHalf, memenuSizeHalf, memenuSizeHalf);\r\n\t\tthis._avatarHolder.endFill();\r\n\t}\r\n\r\n\tonAvatarHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"GestureSurprised\");\r\n\t}\r\n\r\n\tonAvatarLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSurprised\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n\tonChatBubbleHover()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"GestureSmile\");\r\n\t\tthis.avatar.addAction(\"Talk\");\r\n\t}\r\n\r\n\tonChatBubbleLeave()\r\n\t{\r\n\t\tthis.avatar.removeAction(\"Talk\");\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\t}\r\n\r\n}\r\n\r\nclass ChatBubble extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.imLeft = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.left).texture); // 17x44\r\n\t\tthis.imMiddle = new PIXI.extras.TilingSprite(application.getResource(interfaceResources.chatBubble.middle).texture); // 1x44\r\n\t\tthis.imRight = new PIXI.Sprite(application.getResource(interfaceResources.chatBubble.right).texture); // 12x44\r\n\r\n\t\tthis.imLeft.height = 44;\r\n\t\tthis.imMiddle.height = 44;\r\n\t\tthis.imRight.height = 44;\r\n\r\n\t\tthis.addChild(this.imLeft);\r\n\t\tthis.addChild(this.imMiddle);\r\n\t\tthis.addChild(this.imRight);\r\n\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tlet textWidth = 100;\r\n\r\n\t\tthis.imLeft.position.x = 0;\r\n\t\tthis.imLeft.position.y = 0;\r\n\r\n\t\tthis.imMiddle.position.x = 17;\r\n\t\tthis.imMiddle.position.y = 0;\r\n\t\tthis.imMiddle.width = textWidth;\r\n\r\n\t\tthis.imRight.position.x = 17 + textWidth;\r\n\t\tthis.imRight.position.y = 0;\r\n\t}\r\n\r\n}\r\n","import { application } from \"../../bootstrapper.js\";\r\nimport { interfaceResources } from \"./interface.js\";\r\nimport { getTextureFromRectangle } from \"../../core/pixi-utils.js\";\r\nimport { AvatarManager } from \"../../view/avatar/manager.js\";\r\n\r\nexport const bottomBarHeight = 70;\r\n\r\nexport class BottomBar extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.background = new PIXI.Sprite(application.getResource(interfaceResources.bottomBar.background).texture);\r\n\t\tthis.addChild(this.background);\r\n\r\n\t\tthis.addChild(this.meButton = new BottomBarButtonMe());\r\n\t\tthis.addChild(this.navigatorButton = new BottomBarButtonNavigator());\r\n\t\tthis.addChild(this.friendsButton = new BottomBarButtonFriends());\r\n\t\tthis.addChild(this.chatButton = new BottomBarButtonChat());\r\n\t\tthis.addChild(this.catalogueButton = new BottomBarButtonCatalogue());\r\n\t\tthis.addChild(this.inventoryButton = new BottomBarButtonInventory());\r\n\t\tthis.addChild(this.helpButton = new BottomBarButtonHelp());\r\n\r\n\t\tthis.draw();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.draw());\r\n\t}\r\n\r\n\tdraw()\r\n\t{\r\n\t\tconst { width, height } = application.display.size;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = height - bottomBarHeight;\r\n\r\n\t\tthis.background.x = 0;\r\n\t\tthis.background.y = 0;\r\n\t\tthis.background.width = width;\r\n\r\n\t\tthis.meButton.x = 12;\r\n\t\tthis.navigatorButton.x = (width - 24) - 360;\r\n\t\tthis.friendsButton.x = (width - 24) - 300;\r\n\t\tthis.chatButton.x = (width - 24) - 240;\r\n\t\tthis.catalogueButton.x = (width - 24) - 180;\r\n\t\tthis.inventoryButton.x = (width - 24) - 120;\r\n\t\tthis.helpButton.x = (width - 24) - 60;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButton extends PIXI.extras.AnimatedSprite\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonMe extends PIXI.Graphics\r\n{\r\n\r\n\tget figure()\r\n\t{\r\n\t\treturn this.avatar.figure;\r\n\t}\r\n\r\n\tset figure(value)\r\n\t{\r\n\t\tthis.avatar.figure = value;\r\n\t}\r\n\r\n\tconstructor(figure = undefined)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.avatar = application.getManager(AvatarManager).newAvatar(figure, \"vertical\", \"head\");\r\n\t\tthis.addChild(this.avatar);\r\n\r\n\t\tthis.avatar.canPoof = false;\r\n\t\tthis.avatar.direction = this.avatar.headDirection = 3;\r\n\t\tthis.avatar.addAction(\"GestureSmile\");\r\n\r\n\t\tthis.avatar.x = -10;\r\n\t\tthis.avatar.y = -5;\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonAnimatedHover extends BottomBarButton\r\n{\r\n\r\n\tconstructor(textures)\r\n\t{\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.interactive = true;\r\n\t\tthis.loop = false;\r\n\r\n\t\tthis.on(\"pointerover\", () => this.onPointerOver());\r\n\t\tthis.on(\"pointerout\", () => this.onPointerOut());\r\n\t}\r\n\r\n\tonPointerOver()\r\n\t{\r\n\t\tthis.animationSpeed = 0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tonPointerOut()\r\n\t{\r\n\t\tthis.animationSpeed = -0.2;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonCatalogue extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.catalogue).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 420, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChat extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chat).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonChatMessages extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.chatMessages).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriends extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friends).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonFriendsInvited extends BottomBarButton\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.friendsInvited).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\r\n\t\tthis.animationSpeed = 0.025;\r\n\t\tthis.loop = true;\r\n\t\tthis.play();\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonHelp extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.help).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 350, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonInventory extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.inventory).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 280, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarButtonNavigator extends BottomBarButtonAnimatedHover\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tconst texture = application.getResource(interfaceResources.bottomBar.navigator).texture;\r\n\t\tconst textures = [\r\n\t\t\tgetTextureFromRectangle(texture, 0, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 70, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 140, 0, 70, 70),\r\n\t\t\tgetTextureFromRectangle(texture, 210, 0, 70, 70)\r\n\t\t];\r\n\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n}\r\n\r\nexport class BottomBarChatBubble extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../core/pixi-utils.js\";\r\nimport { application } from \"../bootstrapper.js\";\r\nimport { bottomBarHeight } from \"./interface/bottomBar.js\";\r\n\r\nconst contentMargin = 6;\r\nconst cornerRadius = 6;\r\n\r\nexport class Window extends PIXI.Container\r\n{\r\n\r\n\tget height()\r\n\t{\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height(value)\r\n\t{\r\n\t\tthis._height = value;\r\n\t}\r\n\r\n\tget opened()\r\n\t{\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\tget title()\r\n\t{\r\n\t\treturn this.titleText.text.trim();\r\n\t}\r\n\r\n\tset title(value)\r\n\t{\r\n\t\tthis.titleText.text = value;\r\n\t}\r\n\r\n\tget width()\r\n\t{\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width(value)\r\n\t{\r\n\t\tthis._width = value;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.x = 100;\r\n\t\tthis.y = 100;\r\n\t\tthis.z = 10000;\r\n\t\tthis.visible = false;\r\n\r\n\t\tthis.bg = new PIXI.Graphics();\r\n\t\tthis.addChild(this.bg);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.title = \"\";\r\n\r\n\t\tthis.render();\r\n\r\n\t\tapplication.display.on(\"tick\", () => this.render());\r\n\r\n\t\tsimpleDraggable(this);\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst style = new PIXI.TextStyle({\r\n\t\t\talign: \"center\",\r\n\t\t\tfontFamily: \"proxima-nova\",\r\n\t\t\tfontSize: 15,\r\n\t\t\tfontWeight: 700,\r\n\t\t\tfill: 0xE4E4E4\r\n\t\t});\r\n\r\n\t\tthis.titleText = new PIXI.Text(\"\", style);\r\n\t\tthis.addChild(this.titleText);\r\n\r\n\t\tthis.filters = [\r\n\t\t\twithInstance(new PIXI.filters.DropShadowFilter(), shadow =>\r\n\t\t\t{\r\n\t\t\t\tshadow.color = 0x000000;\r\n\t\t\t\tshadow.alpha = 0.2;\r\n\t\t\t\tshadow.blur = 2;\r\n\t\t\t\tshadow.distance = 1;\r\n\t\t\t\tshadow.rotation = 90;\r\n\t\t\t})\r\n\t\t];\r\n\t}\r\n\r\n\tgetDraggableRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.title !== \"\" ? 42 : 0\r\n\t\t};\r\n\t}\r\n\r\n\tgetDraggingRegion()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: 12,\r\n\t\t\ty: 12,\r\n\t\t\twidth: application.display.width - 12,\r\n\t\t\theight: application.display.height - bottomBarHeight - 12\r\n\t\t};\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [1, 0],\r\n\t\t\ty: [this.y, this.y + 24]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t\tthis.y -= 24;\r\n\t\t\tthis.visible = false;\r\n\t\t});\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tif (this.currentAnimation !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.currentAnimation = anime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 210,\r\n\t\t\teasing: [.55, 0, .1, 1],\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [this.y + 24, this.y]\r\n\t\t}).finished.then(() =>\r\n\t\t{\r\n\t\t\tthis.currentAnimation = undefined;\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.bg.clear();\r\n\r\n\t\tconst width = Math.max(this.width || 0, super.width);\r\n\t\tconst height = Math.max(this.height || 0, super.height);\r\n\r\n\t\tlet contentOffset = 0;\r\n\r\n\t\tthis.bg.beginFill(0x165679);\r\n\t\tthis.bg.lineStyle(3, 0x1a658f);\r\n\t\tthis.bg.drawRoundedRect(0, 0, width, height, cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\r\n\t\tthis.bg.lineStyle(0);\r\n\r\n\t\tif (this.title !== \"\")\r\n\t\t{\r\n\t\t\tcontentOffset = 39;\r\n\t\t\tthis.titleText.x = width / 2;\r\n\t\t\tthis.titleText.y = 15;\r\n\t\t\tthis.titleText.anchor.x = 0.5;\r\n\t\t\tthis.titleText.visible = true;\r\n\r\n\t\t\tlet old = this.title;\r\n\t\t\tthis.title = \"\";\r\n\t\t\tthis.title = old;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.titleText.visible = false;\r\n\t\t}\r\n\r\n\t\tthis.bg.beginFill(0xFFFFFF);\r\n\t\tthis.bg.drawRoundedRect(contentMargin, contentMargin + contentOffset, width - (contentMargin * 2), height - ((contentMargin * 2) + contentOffset), cornerRadius);\r\n\t\tthis.bg.endFill();\r\n\t}\r\n\r\n}\r\n","import { Window } from \"./window.js\";\r\n\r\nexport const UI = {\r\n\tWindow\r\n};\r\n\r\nexport const Easings = {\r\n\tAccelerationCurve: [0.4, 0.0, 1, 1],\r\n\tDecelerationCurve: [0.0, 0.0, 0.2, 1],\r\n\tSharpCurve: [0.4, 0.0, 0.6, 1],\r\n\tStandardCurve: [0.4, 0.0, 0.2, 1],\r\n\tSwiftOut: [.55, 0, .1, 1]\r\n};\r\n","import { BottomBar, bottomBarHeight } from \"./bottombar.js\";\r\nimport { MeMenu } from \"./memenu.js\";\r\nimport { Easings } from \"../ui.js\";\r\n\r\nexport const interfaceResources = {\r\n\tchatBubble: {\r\n\t\tleft: \"./resource/image/interface/chat-bubble/left.png\",\r\n\t\tmiddle: \"./resource/image/interface/chat-bubble/middle.png\",\r\n\t\tright: \"./resource/image/interface/chat-bubble/right.png\"\r\n\t},\r\n\tbottomBar: {\r\n\t\tbackground: \"./resource/image/interface/bottom-bar/background.png\",\r\n\t\tnavigator: \"./resource/image/interface/bottom-bar/navigator.png\",\r\n\t\tfriends: \"./resource/image/interface/bottom-bar/friends.png\",\r\n\t\tfriendsInvited: \"./resource/image/interface/bottom-bar/friends-invited.png\",\r\n\t\tchat: \"./resource/image/interface/bottom-bar/chat.png\",\r\n\t\tchatMessages: \"./resource/image/interface/bottom-bar/chat-messages.png\",\r\n\t\tcatalogue: \"./resource/image/interface/bottom-bar/catalogue.png\",\r\n\t\tinventory: \"./resource/image/interface/bottom-bar/inventory.png\",\r\n\t\thelp: \"./resource/image/interface/bottom-bar/help.png\"\r\n\t}\r\n};\r\n\r\nexport class InterfaceContainer extends PIXI.Container\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 100000;\r\n\r\n\t\tthis.init();\r\n\t\tthis.hello();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.bottomBar = new BottomBar();\r\n\t\tthis.addChild(this.bottomBar);\r\n\t}\r\n\r\n\thello()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this.bottomBar,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [this.bottomBar.y + bottomBarHeight, this.bottomBar.y]\r\n\t\t})\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { InterfaceContainer, interfaceResources } from \"./interface.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nlet localInterface;\r\n\r\nfunction initInterface()\r\n{\r\n\tlocalInterface = new InterfaceContainer();\r\n\r\n\tapplication.display.stage.addChild(localInterface);\r\n}\r\n\r\nexport class InterfaceManager extends Manager\r\n{\r\n\r\n\tget interface()\r\n\t{\r\n\t\treturn localInterface;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => initInterface());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(interfaceResources.bottomBar.background);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.catalogue);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chat);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.chatMessages);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friends);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.friendsInvited);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.help);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.inventory);\r\n\t\tthis.loader.add(interfaceResources.bottomBar.navigator);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.left);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.middle);\r\n\t\tthis.loader.add(interfaceResources.chatBubble.right);\r\n\t}\r\n\r\n}\r\n","import { Manager } from \"../../core/manager/manager.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { tileHeightHalf, tileWidthHalf } from \"../room/shared.js\";\r\n\r\nconst furniResources = {\r\n\tloading: \"./resource/image/furni/loading.png\"\r\n};\r\n\r\nexport class Furni extends PIXI.Container\r\n{\r\n\r\n\tget loading()\r\n\t{\r\n\t\treturn this._loading;\r\n\t}\r\n\r\n\tset loading(value)\r\n\t{\r\n\t\tthis._loading = value;\r\n\t}\r\n\r\n\tconstructor(furniName)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.furniName = furniName;\r\n\r\n\t\tthis._loadingSprite = new PIXI.Sprite(application.getResource(furniResources.loading).texture);\r\n\t\tthis.addChild(this._loadingSprite);\r\n\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -(tileWidthHalf + 2),\r\n\t\t\ty: -(tileHeightHalf + 34)\r\n\t\t};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t}\r\n\r\n}\r\n\r\nexport class FurniManager extends Manager\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(furniResources.loading);\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidth, tileWidthHalf } from \"./shared.js\";\r\n\r\nconst tileOffset = 1;\r\n\r\nexport class TileCursor extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tconst points = [\r\n\t\t\tnew PIXI.Point(tileWidth / 2, 0),\r\n\t\t\tnew PIXI.Point(tileWidth, tileHeight / 2),\r\n\t\t\tnew PIXI.Point(tileWidth / 2, tileHeight),\r\n\t\t\tnew PIXI.Point(0, tileHeight / 2)\r\n\t\t];\r\n\r\n\t\tthis.lineStyle(4, 0x000000, 0.2);\r\n\t\tthis.moveTo(points[0].x, points[0].y);\r\n\t\tthis.lineTo(points[1].x, points[1].y);\r\n\t\tthis.lineTo(points[2].x, points[2].y);\r\n\t\tthis.lineTo(points[3].x, points[3].y);\r\n\t\tthis.lineTo(points[0].x, points[0].y);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.lineStyle(4, 0xFFFFFF);\r\n\t\tthis.moveTo(points[0].x, points[0].y - tileOffset);\r\n\t\tthis.lineTo(points[1].x, points[1].y - tileOffset);\r\n\t\tthis.lineTo(points[2].x, points[2].y - tileOffset);\r\n\t\tthis.lineTo(points[3].x, points[3].y - tileOffset);\r\n\t\tthis.lineTo(points[0].x, points[0].y - tileOffset);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n\thover(x, y, z)\r\n\t{\r\n\t\tthis.position.x = x;\r\n\t\tthis.position.y = y - 2;\r\n\t\tthis.z = z;\r\n\t}\r\n\r\n\tgetRoomOffsets()\r\n\t{\r\n\t\treturn {\r\n\t\t\tx: -tileWidthHalf,\r\n\t\t\ty: -tileHeightHalf\r\n\t\t};\r\n\t}\r\n\r\n}\r\n","import { tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\nimport { Easings } from \"../../ui/ui.js\";\r\n\r\nexport class WallBase extends PIXI.Graphics\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.doorHeight = 85;\r\n\t\tthis.floorThickness = floorThickness;\r\n\t\tthis.wallHeight = 115 + (top * tileHeight);\r\n\t\tthis.wallThickness = wallThickness;\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tdelay: 2000,\r\n\t\t\tduration: 900,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1],\r\n\t\t\twallHeight: [0, this.wallHeight],\r\n\t\t\tupdate: () => this.render()\r\n\t\t})\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.clear();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallColumn extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.doorMode = doorMode;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tlet hole = this.doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!this.doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0x9697A1);\r\n\t\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - (this.wallThickness / 2) - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0xB5B9C9);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf + this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallCorner extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(0, -this.wallHeight);\r\n\t\tthis.lineTo(this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight - this.wallThickness);\r\n\t\tthis.lineTo(-this.wallThickness, -this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(0, -this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n\r\nexport class WallRow extends WallBase\r\n{\r\n\r\n\tconstructor(floorThickness, wallThickness, top, doorMode)\r\n\t{\r\n\t\tsuper(floorThickness, wallThickness, top);\r\n\r\n\t\tthis.doorMode = doorMode;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tsuper.render();\r\n\r\n\t\tlet hole = this.doorMode ? (this.doorHeight + this.floorThickness) : 0;\r\n\r\n\t\tif (!this.doorMode)\r\n\t\t{\r\n\t\t\tthis.beginFill(0xBABECE);\r\n\t\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf + this.floorThickness - (this.wallThickness / 2));\r\n\t\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tthis.beginFill(0x92939D);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(0, this.floorThickness - hole);\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf + this.floorThickness - hole);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.beginFill(0x71727B);\r\n\t\tthis.moveTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.lineTo(0, tileHeightHalf - this.wallHeight - tileHeightHalf);\r\n\t\tthis.lineTo(-this.wallThickness, tileHeightHalf - this.wallHeight - tileHeightHalf - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf - this.wallThickness, tileHeightHalf - this.wallHeight - (this.wallThickness / 2));\r\n\t\tthis.lineTo(-tileWidthHalf, tileHeightHalf - this.wallHeight);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n}\r\n","import { simpleDraggable, withInstance } from \"../../core/pixi-utils.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\nimport { TileCursor } from \"./cursor.js\";\r\nimport { getDoorDirection, getHighestAndLowest, getStairsType, getTileHeightIndex, getTileImplementation, hitAreaOffset, isDoor, needsWallC, needsWallR, tileHeight, tileHeightHalf, tileWidthHalf } from \"./shared.js\";\r\nimport { Tile, TileBase } from \"./tiles.js\";\r\nimport { WallColumn, WallCorner, WallRow } from \"./walls.js\";\r\nimport { Easings } from \"../../ui/ui.js\";\r\n\r\nconst debugDoor = true;\r\nconst debugWalls = false;\r\n\r\nexport class RoomView extends PIXI.Container\r\n{\r\n\r\n\tget entities()\r\n\t{\r\n\t\treturn this._entities;\r\n\t}\r\n\r\n\tget heightmap()\r\n\t{\r\n\t\treturn this._heightmap;\r\n\t}\r\n\r\n\tget roomScale()\r\n\t{\r\n\t\treturn this.scale.x;\r\n\t}\r\n\r\n\tset roomScale(value)\r\n\t{\r\n\t\tthis.scale.x = value;\r\n\t\tthis.scale.y = value;\r\n\t}\r\n\r\n\tget tiles()\r\n\t{\r\n\t\treturn this._tiles;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.z = 1000;\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._heightmap = {};\r\n\t\tthis._tiles = {};\r\n\r\n\t\tthis.columns = 0;\r\n\t\tthis.rows = 0;\r\n\r\n\t\tthis.floorThickness = 8;\r\n\t\tthis.wallThickness = 8;\r\n\r\n\t\tthis.highest = 0;\r\n\t\tthis.lowest = 0;\r\n\r\n\t\tthis.offsets = {x: 0, y: 0};\r\n\r\n\t\tthis.roomScale = 1;\r\n\t\tthis.tileCursor = new TileCursor();\r\n\t\tthis.tileCursor.visible = false;\r\n\r\n\t\tsimpleDraggable(this);\r\n\t}\r\n\r\n\tclearEverything()\r\n\t{\r\n\t\twhile (this.children[0])\r\n\t\t\tthis.removeChild(this.children[0]);\r\n\r\n\t\tthis.addChild(this.tileCursor);\r\n\r\n\t\tthis._entities = [];\r\n\t\tthis._tiles = {};\r\n\t}\r\n\r\n\tprepareHeightmap(floorplan)\r\n\t{\r\n\t\tthis.emit(\"room-view-emptied\");\r\n\r\n\t\tthis.clearEverything();\r\n\r\n\t\tconst tiles = this._heightmap = floorplan\r\n\t\t\t.trim()\r\n\t\t\t.split(\"\\n\")\r\n\t\t\t.map(row => row.split(\"\").map(char => getTileHeightIndex(char)));\r\n\r\n\t\tconst {highest, lowest} = getHighestAndLowest(this.heightmap);\r\n\t\tthis.highest = highest;\r\n\t\tthis.lowest = lowest;\r\n\r\n\t\tif (tiles.length === 0)\r\n\t\t\treturn;\r\n\r\n\t\tthis.columns = tiles[0].length;\r\n\t\tthis.rows = tiles.length;\r\n\r\n\t\tthis.doors = [];\r\n\r\n\t\tfor (let row = 0; row < tiles.length; row++)\r\n\t\t{\r\n\t\t\tthis._tiles[row] = {};\r\n\r\n\t\t\tfor (let column = 0; column < tiles[row].length; column++)\r\n\t\t\t{\r\n\t\t\t\tlet tileHeightLocal = this.getTileHeight(row, column);\r\n\r\n\t\t\t\tif (tileHeightLocal === null)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlet door = isDoor(tiles, row, column);\r\n\t\t\t\tlet stairsType = getStairsType(tiles, row, column);\r\n\t\t\t\tlet implementation = getTileImplementation(stairsType);\r\n\r\n\t\t\t\tlet wallC = needsWallC(tiles, row, column);\r\n\t\t\t\tlet wallR = needsWallR(tiles, row, column);\r\n\t\t\t\tlet wall = wallC || wallR;\r\n\r\n\t\t\t\tlet x = this.getX(row, column);\r\n\t\t\t\tlet y = this.getY(row, column);\r\n\t\t\t\tlet z = this.getRealZ(row, column, 1);\r\n\r\n\t\t\t\tif (wall)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet wallImplementations = [];\r\n\t\t\t\t\tlet isDoorColumn = isDoor(tiles, row - 1, column);\r\n\t\t\t\t\tlet isDoorRow = isDoor(tiles, row, column - 1);\r\n\t\t\t\t\tlet isADoor = isDoorColumn || isDoorRow;\r\n\t\t\t\t\tlet top = Math.abs(this.highest - tileHeightLocal);\r\n\r\n\t\t\t\t\tif (isADoor)\r\n\t\t\t\t\t\tif (isDoorColumn)\r\n\t\t\t\t\t\t\tthis.doors.push({row: row - 1, column: column, direction: getDoorDirection(tiles, row - 1, column)});\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tthis.doors.push({row: row, column: column - 1, direction: getDoorDirection(tiles, row, column - 1)});\r\n\r\n\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallCorner(this.floorThickness, this.wallThickness, top));\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallColumn(this.floorThickness, this.wallThickness, top, isDoorColumn));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twallImplementations.push(new WallRow(this.floorThickness, this.wallThickness, top, isDoorRow));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const wi of wallImplementations)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.addChild(withInstance(wi, wall =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.entities.push(wall);\r\n\r\n\t\t\t\t\t\t\twall.x = x + tileWidthHalf;\r\n\t\t\t\t\t\t\twall.y = y + (stairsType !== -1 ? tileHeight : 0);\r\n\t\t\t\t\t\t\twall.z = this.getRealZ(row, column, isADoor ? 4 : 0);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.addChild(withInstance(new implementation(this.floorThickness), tile =>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.entities.push(tile);\r\n\t\t\t\t\tthis._tiles[row][column] = tile;\r\n\r\n\t\t\t\t\ttile.row = row;\r\n\t\t\t\t\ttile.column = column;\r\n\r\n\t\t\t\t\tif (debugDoor && door)\r\n\t\t\t\t\t\ttile.tint = 0xFF0000;\r\n\r\n\t\t\t\t\tif (debugWalls)\r\n\t\t\t\t\t\tif (wallC && wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FFFF;\r\n\t\t\t\t\t\telse if (wallC)\r\n\t\t\t\t\t\t\ttile.tint = 0x00FF00;\r\n\t\t\t\t\t\telse if (wallR)\r\n\t\t\t\t\t\t\ttile.tint = 0x0000FF;\r\n\r\n\t\t\t\t\ttile.on(\"tile-tap\", evt => this.onTileClick(evt));\r\n\t\t\t\t\ttile.on(\"tile-hover\", evt => this.onTileHover(evt));\r\n\t\t\t\t\ttile.on(\"tile-leave\", evt => this.onTileLeave(evt));\r\n\r\n\t\t\t\t\ttile.x = x;\r\n\t\t\t\t\ttile.y = y;\r\n\t\t\t\t\ttile.z = z;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.centerRoom();\r\n\r\n\t\tthis.position.x = Math.floor((application.display.width / 2) - (this.width / 2));\r\n\t\tthis.position.y = Math.floor((application.display.height / 2) - (this.height / 2 - 115));\r\n\r\n\t\tthis.hitArea = new PIXI.Rectangle(-hitAreaOffset, -hitAreaOffset, this.width + (hitAreaOffset * 2), this.height + (hitAreaOffset * 2));\r\n\r\n\t\tthis.emit(\"room-view-ready\");\r\n\t}\r\n\r\n\taddEntityToTile(entity, row, column, h)\r\n\t{\r\n\t\tthis.addChild(entity);\r\n\r\n\t\tthis.associateEntityToTile(entity, row, column, h);\r\n\t}\r\n\r\n\tremoveEntity(entity)\r\n\t{\r\n\t\tthis.removeChild(entity);\r\n\t}\r\n\r\n\tanimateBuildingTiles()\r\n\t{\r\n\t\tfor(let row = 0; row < this.rows; row++)\r\n\t\t{\r\n\t\t\tfor(let column = 0; column < this.columns; column++)\r\n\t\t\t{\r\n\t\t\t\tif (this.tiles[row][column] === undefined)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tanime({\r\n\t\t\t\t\ttargets: this.tiles[row][column],\r\n\t\t\t\t\tdelay: (row + column) * 50,\r\n\t\t\t\t\tduration: 900,\r\n\t\t\t\t\teasing: Easings.DecelerationCurve,\r\n\t\t\t\t\talpha: [0, 1],\r\n\t\t\t\t\ty: [this.tiles[row][column].y + application.display.height, this.tiles[row][column].y]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassociateEntityToTile(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet pos = this.getEntityPosition(entity, row, column, h);\r\n\r\n\t\tentity.position.x = pos.x;\r\n\t\tentity.position.y = pos.y;\r\n\t\tentity.z = pos.z;\r\n\r\n\t\tthis.updateLayerOrder();\r\n\t}\r\n\r\n\tcenterEntity(entity, animate = true)\r\n\t{\r\n\t\tlet x = application.display.width / 2;\r\n\t\tlet y = application.display.height / 2;\r\n\r\n\t\tx -= Math.round(entity.x + entity.width / 2);\r\n\t\ty -= Math.round(entity.y + entity.height / 2);\r\n\r\n\t\tx = x - (x % 2);\r\n\r\n\t\tif (animate)\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 800,\r\n\t\t\t\teasing: \"easeInOutSine\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tanime({\r\n\t\t\t\ttargets: this,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tduration: 45,\r\n\t\t\t\teasing: \"linear\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcenterRoom()\r\n\t{\r\n\t\tif (this.entities.length > 0)\r\n\t\t{\r\n\t\t\tlet xred = this.entities.reduce((acc, cur) => acc.x < cur.x ? acc : cur).x;\r\n\t\t\tlet yred = this.entities\r\n\t\t\t\t.filter(acc => acc instanceof TileBase)\r\n\t\t\t\t.reduce((acc, cur) => acc.y < cur.y ? acc : cur).y;\r\n\r\n\t\t\tthis.offsets.x = -xred;\r\n\t\t\tthis.offsets.y = -yred;\r\n\r\n\t\t\tthis.entities.forEach(entity =>\r\n\t\t\t{\r\n\t\t\t\tentity.x -= xred;\r\n\t\t\t\tentity.y -= yred;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetClosestTile(x, y)\r\n\t{\r\n\t}\r\n\r\n\tgetDoorTile(random = true)\r\n\t{\r\n\t\tif (!random)\r\n\t\t\treturn this.doors[0];\r\n\r\n\t\treturn this.doors[Math.floor(Math.random() * this.doors.length)];\r\n\t}\r\n\r\n\tgetEntityPosition(entity, row, column, h = 0)\r\n\t{\r\n\t\tlet offsets = {x: 0, y: 0};\r\n\t\tlet tile = this.getTile(row, column);\r\n\r\n\t\tif (entity.getRoomOffsets !== undefined)\r\n\t\t\toffsets = entity.getRoomOffsets();\r\n\r\n\t\tlet isStairs = !(tile instanceof Tile);\r\n\r\n\t\tlet x = (this.getX(row, column) + tileWidthHalf) + (offsets.x + this.offsets.x);\r\n\t\tlet y = (this.getY(row, column) + tileHeightHalf) + (offsets.y + this.offsets.y) + (tile && isStairs ? tileHeightHalf : 0);\r\n\t\tlet z = this.getZ(row, column + 2, 5) + h;\r\n\r\n\t\tif (isDoor(this.tiles, row, column))\r\n\t\t\tz = this.getRealZ(row, column, 4);\r\n\r\n\t\treturn {x, y, z, isStairs};\r\n\t}\r\n\r\n\tgetRandomTile()\r\n\t{\r\n\t\tlet row = Math.floor(Math.random() * this.rows);\r\n\t\tlet column = Math.floor(Math.random() * this.columns);\r\n\r\n\t\tif (!this.isValidTile(row, column))\r\n\t\t\treturn this.getRandomTile();\r\n\r\n\t\treturn {row, column};\r\n\t}\r\n\r\n\tgetTile(row, column)\r\n\t{\r\n\t\tif (this.tiles[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.tiles[row][column] || undefined;\r\n\t}\r\n\r\n\tgetTileHeight(row, column)\r\n\t{\r\n\t\tif (this.heightmap[row] === undefined)\r\n\t\t\treturn undefined;\r\n\r\n\t\treturn this.heightmap[row][column];\r\n\t}\r\n\r\n\tgetX(row, column)\r\n\t{\r\n\t\treturn (column - row) * tileWidthHalf;\r\n\t}\r\n\r\n\tgetY(row, column)\r\n\t{\r\n\t\tlet h = this.getTileHeight(row, column);\r\n\r\n\t\tif (h === undefined)\r\n\t\t\th = 0;\r\n\r\n\t\tif (getStairsType(this.heightmap, row, column) !== -1)\r\n\t\t\th += 1;\r\n\r\n\t\treturn (column + row) * tileHeightHalf - (h * tileWidthHalf);\r\n\t}\r\n\r\n\tgetZ(row, column, add = 0)\r\n\t{\r\n\t\trow *= 1000;\r\n\t\tcolumn *= 1000;\r\n\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tgetRealZ(row, column, add = 0)\r\n\t{\r\n\t\treturn (row * this.columns) + column + add;\r\n\t}\r\n\r\n\tisValidTile(row, column)\r\n\t{\r\n\t\treturn this.getTile(row, column) !== undefined;\r\n\t}\r\n\r\n\tonTileClick(evt)\r\n\t{\r\n\t\tthis.emit(\"tile-tap\", evt);\r\n\t}\r\n\r\n\tonTileHover(evt)\r\n\t{\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tlet {x, y} = this.getEntityPosition(this.tileCursor, evt.row, evt.column);\r\n\r\n\t\t\tthis.currentHover = [evt.row, evt.column];\r\n\t\t\tthis.tileCursor.visible = true;\r\n\t\t\tthis.tileCursor.hover(x, y, this.getRealZ(evt.row, evt.column, 2));\r\n\t\t\tthis.updateLayerOrder();\r\n\t\t}, 1);\r\n\t}\r\n\r\n\tonTileLeave(evt)\r\n\t{\r\n\t\tthis.currentHover = undefined;\r\n\r\n\t\tsetTimeout(() =>\r\n\t\t{\r\n\t\t\tif (this.currentHover !== undefined && (evt.x !== this.currentHover.x || evt.y !== this.currentHover.y))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tthis.tileCursor.visible = false;\r\n\t\t}, 2);\r\n\t}\r\n\r\n}\r\n","import { application} from \"../../bootstrapper.js\";\r\nimport { Manager } from \"../../core/manager/manager.js\";\r\nimport { getDeliveryAssetsUrl } from \"../../preferences.js\";\r\nimport { RoomView } from \"./room-view.js\";\r\n\r\nconst roomAssets = {\r\n\tindex: getDeliveryAssetsUrl(\"/room-content/index.xml\"),\r\n\tassets: getDeliveryAssetsUrl(\"/room-content/room_assets.xml\"),\r\n\tmanifest: getDeliveryAssetsUrl(\"/room-content/manifest.xml\"),\r\n\tvisualization: getDeliveryAssetsUrl(\"/room-content/room_visualization.xml\")\r\n};\r\n\r\nlet localRoomViewer;\r\n\r\nfunction initRoomViewer()\r\n{\r\n\tlocalRoomViewer = new RoomView();\r\n}\r\n\r\nexport class RoomManager extends Manager\r\n{\r\n\r\n\tget roomViewer()\r\n\t{\r\n\t\treturn localRoomViewer;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tinitRoomViewer();\r\n\r\n\t\tthis.roomViewer.visible = false;\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait super.initialize();\r\n\r\n\t\tthis.loader.add(roomAssets.index);\r\n\t\tthis.loader.add(roomAssets.assets);\r\n\t\tthis.loader.add(roomAssets.manifest);\r\n\t\tthis.loader.add(roomAssets.visualization);\r\n\t}\r\n\r\n\tensureRoomViewerIsMounted()\r\n\t{\r\n\t\tif (this.roomViewer.parent !== null)\r\n\t\t\treturn;\r\n\r\n\t\tapplication.display.stage.addChild(this.roomViewer);\r\n\t}\r\n\r\n\tremoveRoomViewer()\r\n\t{\r\n\t\tthis.roomViewer.removeAllListeners();\r\n\t\tapplication.display.stage.removeChild(this.roomViewer);\r\n\t}\r\n\r\n\tshowRoomViewer(heightmap)\r\n\t{\r\n\t\tthis.ensureRoomViewerIsMounted();\r\n\r\n\t\tthis.roomViewer.prepareHeightmap(heightmap);\r\n\t\tthis.roomViewer.visible = true;\r\n\t}\r\n\r\n}\r\n","const figures = [\r\n\t\"hr-3163-61.cc-3075-73.ca-3175-92.hd-195-3.ch-3030-92.sh-3016-64.lg-3116-110-92\",\r\n\t\"lg-3116-110-92.hr-3163-61.sh-3275-92.hd-195-4.ha-3268-1415-92.ch-255-92\",\r\n\t\"hr-3012-44.hd-605-2.ch-3439-92-66.lg-3006-100-92.sh-725-92.he-3329-1412-100.ca-3414-1412.cc-3542-97-97\",\r\n\t\"hr-3012-1407.hd-600-3.ch-3013-93.lg-3006-110-1408.sh-725-92.he-1603-1328.cc-3390-110-106\",\r\n\t\"hr-834-34.hd-600-2.ch-3013-1330.lg-710-92.sh-730-1408.ha-3620.he-3579.ca-1815-1324\",\r\n\t\"hr-3012-1405.hd-600-1390.ch-3636-1324.lg-3418-110.sh-725-92.ea-3169-110.cc-3289-110\",\r\n\t\"hr-3012-61.hd-600-1370.ch-3399-92-1409.lg-3006-1409-92.sh-3064-89.ha-3586\"\r\n];\r\n\r\nexport const randomFigure = () => figures[Math.floor(Math.random() * figures.length)];\r\n","export const heightMaps = [];\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx000x\r\n0000x\r\nx000x\r\nx000x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxx\r\nx110x\r\nx110x\r\nx000x\r\nxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nxxxxxxxxxxx22222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx222222222222222222\r\nx2222xxxxxxxxxxxxxx\r\nx2222xxxxxxxxxxxxxx\r\nx2222211111xx000000\r\nx222221111110000000\r\nx222221111110000000\r\nx2222211111xx000000\r\nxx22xxx1111xxxxxxxx\r\nxx11xxx1111xxxxxxxx\r\nx1111xx1111xx000000\r\nx1111xx111110000000\r\nx1111xx111110000000\r\nx1111xx1111xx000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxxx\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx22222222222222222222x\r\nx000x11xxxxxxxx11x000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\n000000000000000000000x\r\nx00000000000000000000x\r\nx00000000000000000000x\r\nxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxx\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx222222222222\r\nxxxxxxx111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx222221111111111111\r\nx2222xx111111111111\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\nx2222xx000000000000\r\n22222xx000000000000\r\nx2222xx000000000000\r\nxxxxxxxxxxxxxxxxxxx\r\n`);\r\n\r\nheightMaps.push(`\r\nxxxxxxxxxxxxxxxxxxxxx0xxxxxxxxxxxxxxxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x000000000000000000000000xxxx\r\nx222222222x00000000xxxxxxxx00000000xxxx\r\nx11xxxxxxxx00000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\n0000000000000000000xxxxxxxx00000000xxxx\r\nx000000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00x000000000000000xxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00xxxxxxxxxxxxxxxxxxxxxxxx00000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx0000000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nx00x0000000000000000000000000000000xxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\n`);\r\n","import { Window } from \"../window.js\";\r\nimport { application } from \"../../bootstrapper.js\";\r\n\r\nexport class NavigatorWindow extends Window\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.height = 540;\r\n\t\tthis.width = 420;\r\n\t\tthis.title = \"Navigator\";\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.x = application.display.width / 2 - this.width / 2;\r\n\t\tthis.y = application.display.height / 2 - this.height / 2;\r\n\r\n\t\tsuper.open();\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { Easings } from \"../ui/ui.js\";\r\nimport { Manager } from \"../core/manager/manager.js\";\r\nimport { bottomBarHeight } from \"../ui/interface/bottomBar.js\";\r\n\r\nexport const hotelViewAssets = {\r\n\thotel: \"./resource/image/hotel-view/hotel.png\",\r\n\tskyline: \"./resource/image/hotel-view/skyline.png\"\r\n};\r\n\r\nexport class HotelView extends PIXI.Graphics\r\n{\r\n\r\n\tget opened()\r\n\t{\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.skyline = new PIXI.extras.TilingSprite(application.getResource(hotelViewAssets.skyline).texture);\r\n\t\tthis.addChild(this.skyline);\r\n\r\n\t\tthis.hotel = new PIXI.Sprite(application.getResource(hotelViewAssets.hotel).texture);\r\n\t\tthis.addChild(this.hotel);\r\n\r\n\t\tthis.visible = false;\r\n\t\tthis.render();\r\n\r\n\t\tapplication.display.on(\"resize\", () => this.render());\r\n\t}\r\n\r\n\tclose()\r\n\t{\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [1, 0]\r\n\t\t}).finished.then(() => this.visible = false);\r\n\t}\r\n\r\n\topen()\r\n\t{\r\n\t\tthis.visible = true;\r\n\r\n\t\tconst height = application.display.height;\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this,\r\n\t\t\tduration: 300,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.skyline,\r\n\t\t\tdelay: 75,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\talpha: [0, 1],\r\n\t\t\ty: [height, this.skyline.y]\r\n\t\t});\r\n\r\n\t\tanime({\r\n\t\t\ttargets: this.hotel,\r\n\t\t\tdelay: 150,\r\n\t\t\tduration: 750,\r\n\t\t\teasing: Easings.SwiftOut,\r\n\t\t\ty: [height, this.hotel.y]\r\n\t\t});\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst {width, height} = application.display.size;\r\n\t\tconst bottomOffset = bottomBarHeight;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.beginFill(0x25B8EE);\r\n\t\tthis.drawRect(0, 0, width, height);\r\n\t\tthis.endFill();\r\n\r\n\t\tthis.hotel.x = width - 750;\r\n\t\tthis.hotel.y = height - (568 + bottomOffset);\r\n\r\n\t\tthis.skyline.height = 120;\r\n\t\tthis.skyline.width = width;\r\n\t\tthis.skyline.x = 0;\r\n\t\tthis.skyline.y = height - (120 + bottomOffset);\r\n\t}\r\n\r\n}\r\n\r\nexport class HotelViewManager extends Manager\r\n{\r\n\r\n\tget hotelView()\r\n\t{\r\n\t\treturn this._hotelView;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tapplication.once(\"application-loading-done\", () => this.onApplicationLoadingDone());\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tthis.loader.add(hotelViewAssets.hotel);\r\n\t\tthis.loader.add(hotelViewAssets.skyline);\r\n\t}\r\n\r\n\tonApplicationLoadingDone()\r\n\t{\r\n\t\tthis._hotelView = new HotelView();\r\n\t\tapplication.display.stage.addChild(this.hotelView);\r\n\t}\r\n\r\n}\r\n","import { application } from \"../bootstrapper.js\";\r\nimport { AvatarManager } from \"../view/avatar/manager.js\";\r\nimport { Furni } from \"../view/furni/furni.js\";\r\nimport { RoomManager } from \"../view/room/manager.js\";\r\nimport { getDistance, getHeading } from \"../view/room/shared.js\";\r\nimport { randomFigure } from \"./avatars.js\";\r\nimport { heightMaps } from \"./rooms.js\";\r\nimport { NavigatorWindow } from \"../ui/navigator/window.js\";\r\nimport { InterfaceManager } from \"../ui/interface/manager.js\";\r\nimport { HotelViewManager } from \"../view/hotel-view.js\";\r\n\r\nlet generateFurnis = 0;\r\nlet generateHumans = 10;\r\n\r\nlet furnis = [];\r\nlet humans = [];\r\n\r\nlet controllingHuman = 0;\r\n\r\nexport function fakeGamePlay()\r\n{\r\n\tconst theRandomFigure = randomFigure();\r\n\r\n\tconst avatarManager = application.getManager(AvatarManager);\r\n\tconst roomManager = application.getManager(RoomManager);\r\n\tconst hotelViewManager = application.getManager(HotelViewManager);\r\n\tconst interfaceManager = application.getManager(InterfaceManager);\r\n\r\n\thotelViewManager.hotelView.open();\r\n\r\n\tconst nav = new NavigatorWindow();\r\n\tapplication.stage.addChild(nav);\r\n\r\n\tinterfaceManager.interface.bottomBar.navigatorButton.on(\"pointertap\", () =>\r\n\t{\r\n\t\tif (nav.opened)\r\n\t\t\tnav.close();\r\n\t\telse\r\n\t\t\tnav.open();\r\n\t});\r\n\r\n\tinterfaceManager.interface.bottomBar.friendsButton.on(\"pointertap\", () =>\r\n\t{\r\n\t\tif (hotelViewManager.hotelView.opened)\r\n\t\t{\r\n\t\t\thotelViewManager.hotelView.close();\r\n\r\n\t\t\tsetTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\troomManager.roomViewer.on(\"room-view-ready\", () => roomManager.roomViewer.animateBuildingTiles());\r\n\t\t\t\troomManager.roomViewer.on(\"tile-tap\", evt => humans[controllingHuman].walkTo(evt.row, evt.column));\r\n\t\t\t\troomManager.showRoomViewer(heightMaps[3]);\r\n\r\n\t\t\t\tfor (let i = 0; i < generateHumans; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet human = avatarManager.newAvatar(randomFigure());\r\n\t\t\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\t\t\tif (i === controllingHuman)\r\n\t\t\t\t\t\tposition = roomManager.roomViewer.getDoorTile(true);\r\n\r\n\t\t\t\t\thuman.direction = human.headDirection = position.direction || Math.floor(Math.random() * 8) % 8;\r\n\r\n\t\t\t\t\thumans.push(new RoomUser(roomManager.roomViewer, human, position.row, position.column));\r\n\t\t\t\t\thuman.on(\"pointertap\", () => human.figure = randomFigure());\r\n\r\n\t\t\t\t\troomManager.roomViewer.addEntityToTile(human, position.row, position.column);\r\n\t\t\t\t}\r\n\t\t\t}, 300);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\thumans.forEach(human => roomManager.roomViewer.removeEntity(human.avatar));\r\n\t\t\thumans.forEach(human => avatarManager.removeAvatar(human.avatar));\r\n\r\n\t\t\thumans = undefined;\r\n\t\t\thumans = [];\r\n\r\n\t\t\thotelViewManager.hotelView.open();\r\n\t\t\troomManager.removeRoomViewer();\r\n\t\t}\r\n\t});\r\n\r\n\tinterfaceManager.interface.bottomBar.meButton.figure = theRandomFigure;\r\n\r\n\tif (true === false)\r\n\t{\r\n\t\tfor (let i = 0; i < generateFurnis; i++)\r\n\t\t{\r\n\t\t\tlet furni = new Furni(\"throne\");\r\n\t\t\tlet position = roomManager.roomViewer.getRandomTile();\r\n\r\n\t\t\tfurnis.push(furni);\r\n\r\n\t\t\troomManager.roomViewer.addEntityToTile(furni, position.row, position.column);\r\n\t\t}\r\n\t}\r\n\r\n\tinterfaceManager.interface.bottomBar.friendsButton.emit(\"pointertap\");\r\n}\r\n\r\nclass RoomUser\r\n{\r\n\r\n\tget position()\r\n\t{\r\n\t\treturn {row: this.row, column: this.column};\r\n\t}\r\n\r\n\tconstructor(roomViewer, avatar, row, column)\r\n\t{\r\n\t\tthis.roomViewer = roomViewer;\r\n\t\tthis.avatar = avatar;\r\n\t\tthis.row = row;\r\n\t\tthis.column = column;\r\n\t}\r\n\r\n\tmoveTo(row, column, heading = undefined)\r\n\t{\r\n\t\tlet distance = getDistance(this.position, {row, column});\r\n\t\theading = heading !== undefined ? heading : getHeading(this.position, {row, column}) || this.avatar.direction;\r\n\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column);\r\n\r\n\t\tif (distance > 1)\r\n\t\t{\r\n\t\t\tthis.teleportTo(row, column);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.avatar.direction = this.avatar.headDirection = heading;\r\n\r\n\t\tlet animationDuration = 360;\r\n\t\tlet anim = anime({\r\n\t\t\ttargets: this.avatar,\r\n\t\t\tduration: animationDuration,\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\teasing: \"linear\"\r\n\t\t});\r\n\r\n\t\tanim.update = a =>\r\n\t\t{\r\n\t\t\tif (a.currentTime < 180)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tanim.update = undefined;\r\n\r\n\t\t\tthis.avatar.z = z;\r\n\t\t\tthis.roomViewer.updateLayerOrder();\r\n\t\t};\r\n\t}\r\n\r\n\tteleportTo(row, column)\r\n\t{\r\n\t\tconst {x, y, z} = this.roomViewer.getEntityPosition(this.avatar, row, column);\r\n\r\n\t\tthis.avatar.position.x = x;\r\n\t\tthis.avatar.position.y = y;\r\n\t\tthis.avatar.z = z;\r\n\r\n\t\tthis.roomViewer.updateLayerOrder();\r\n\t}\r\n\r\n\twalkTo(row, column)\r\n\t{\r\n\t\tlet current = this.position;\r\n\r\n\t\tif (current.row === row && current.column === column)\r\n\t\t\treturn;\r\n\r\n\t\tthis.avatar.addAction(\"Move\");\r\n\r\n\t\tconst walk = () =>\r\n\t\t{\r\n\t\t\tlet nextRow = current.row > row ? --current.row : current.row < row ? ++current.row : row;\r\n\t\t\tlet nextColumn = current.column > column ? --current.column : current.column < column ? ++current.column : column;\r\n\r\n\t\t\tlet heading = getHeading(this.position, {row: nextRow, column: nextColumn});\r\n\r\n\t\t\tthis.column = nextColumn;\r\n\t\t\tthis.row = nextRow;\r\n\r\n\t\t\tthis.moveTo(nextRow, nextColumn, heading);\r\n\r\n\t\t\tsetTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\tif (!(current.row === row && current.column === column))\r\n\t\t\t\t\twalk();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.avatar.removeAction(\"Move\");\r\n\t\t\t}, 360);\r\n\t\t};\r\n\r\n\t\twalk();\r\n\t}\r\n\r\n}\r\n","import { AvatarManager } from \"./view/avatar/manager.js\";\r\nimport { Logger } from \"./core/logging.js\";\r\nimport { LoadingView } from \"./view/loading-view.js\";\r\nimport { Display } from \"./display.js\";\r\nimport { I18nManager } from \"./core/i18n/i18n.js\";\r\nimport { ConfigManager } from \"./core/config/config.js\";\r\nimport { initialLoadingDelay } from \"./preferences.js\";\r\nimport { InterfaceManager } from \"./ui/interface/manager.js\";\r\nimport { FurniManager } from \"./view/furni/furni.js\";\r\nimport { RoomManager } from \"./view/room/manager.js\";\r\nimport { fakeGamePlay } from \"./dev/gameplay.js\";\r\nimport { HotelViewManager } from \"./view/hotel-view.js\";\r\nimport { LOADED_LIBS } from \"./view/avatar/shared.js\";\r\n\r\nexport class InitializerLoader extends PIXI.loaders.Loader\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.urls = [];\r\n\t}\r\n\r\n\tadd(url, stage = 1)\r\n\t{\r\n\t\tthis.urls.push({\r\n\t\t\tstage,\r\n\t\t\turl\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tload()\r\n\t{\r\n\t\tLogger.debug(\"InitializerLoader\", \"Skipped load() initializing..\");\r\n\t}\r\n\r\n\trealLoad(cb, stage = 1)\r\n\t{\r\n\t\tconst valid = this.urls\r\n\t\t\t.filter(url => url.stage === stage)\r\n\t\t\t.map(url => url.url);\r\n\r\n\t\tconst urls = valid.filter(url => typeof url === \"string\");\r\n\t\tconst promises = valid.filter(url => typeof url !== \"string\");\r\n\r\n\t\turls.forEach(url => super.add(url));\r\n\r\n\t\tconst executor = async () =>\r\n\t\t{\r\n\t\t\tawait new Promise(resolve => super.load(resolve));\r\n\r\n\t\t\tfor (let promise of promises)\r\n\t\t\t\tawait promise;\r\n\t\t};\r\n\r\n\t\texecutor()\r\n\t\t\t.then(() => cb());\r\n\t}\r\n\r\n}\r\n\r\nexport class Application extends PIXI.utils.EventEmitter\r\n{\r\n\r\n\tget display()\r\n\t{\r\n\t\treturn this._display;\r\n\t}\r\n\r\n\tget loader()\r\n\t{\r\n\t\treturn this._loader;\r\n\t}\r\n\r\n\tget stage()\r\n\t{\r\n\t\treturn this.display.stage;\r\n\t}\r\n\r\n\tget ticker()\r\n\t{\r\n\t\treturn this.display.ticker;\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._display = new Display();\r\n\t\tthis._loader = new InitializerLoader();\r\n\r\n\t\tthis.managers = [];\r\n\t}\r\n\r\n\taddDefaultManagers()\r\n\t{\r\n\t\tthis.addManager(new ConfigManager());\r\n\t\tthis.addManager(new I18nManager());\r\n\r\n\t\tthis.addManager(new AvatarManager());\r\n\t\tthis.addManager(new FurniManager());\r\n\t\tthis.addManager(new HotelViewManager());\r\n\t\tthis.addManager(new RoomManager());\r\n\r\n\t\tthis.addManager(new InterfaceManager());\r\n\t}\r\n\r\n\taddManager(manager)\r\n\t{\r\n\t\tLogger.debug(\"Application\", `Added manager ${manager.constructor.name}`);\r\n\t\tthis.managers.push(manager);\r\n\t}\r\n\r\n\tgetManager(managerClass)\r\n\t{\r\n\t\treturn this.managers.find(manager => manager instanceof managerClass);\r\n\t}\r\n\r\n\tcreate()\r\n\t{\r\n\t\tthis.loadingView = new LoadingView();\r\n\t\tthis.loadingView.on(\"loader-ready\", () => this.emit(\"application-can-run\"));\r\n\t\tthis.stage.addChild(this.loadingView);\r\n\r\n\t\tthis.addDefaultManagers();\r\n\t}\r\n\r\n\tasync initialize()\r\n\t{\r\n\t\tawait this.managers.forEach(async manager => await manager.initialize());\r\n\t}\r\n\r\n\tasync run()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 0;\r\n\t\tsetTimeout(() => this.loader.realLoad(() => this.onLoadingStage0Done(), 0), initialLoadingDelay);\r\n\t}\r\n\r\n\tonLoadingStage0Done()\r\n\t{\r\n\t\tthis.loadingView.loadingBar.alpha = 1;\r\n\t\tthis.loadingView.percentage = 0;\r\n\t\tthis.loader.realLoad(() => this.onLoadingStage1Done(), 1);\r\n\t}\r\n\r\n\tonLoadingStage1Done()\r\n\t{\r\n\t\tLogger.debug(\"Application\", \"Loading of manager data done!\");\r\n\t\tthis.emit(\"application-loading-done\");\r\n\r\n\t\tdelete this.loader;\r\n\r\n\t\tthis.stage.removeChild(this.loadingView);\r\n\r\n\t\tfakeGamePlay();\r\n\t}\r\n\r\n\tgetResource(resource, loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources[resource];\r\n\t}\r\n\r\n\tgetResources(loader = undefined)\r\n\t{\r\n\t\treturn (loader || this.loader).resources;\r\n\t}\r\n\r\n}\r\n","import { Logger } from \"./core/logging.js\";\r\nimport { Application } from \"./application.js\";\r\n\r\n/**\r\n * @type {Application}\r\n */\r\nexport const application = new Application();\r\n\r\n/**\r\n * Class Bootstrapper.\r\n */\r\nexport class Bootstrapper\r\n{\r\n\r\n\t/**\r\n\t * Initializes everything.\r\n\t */\r\n\tstatic async init()\r\n\t{\r\n\t\tLogger.debug(\"Bootstrapper\", \"Loading everything..\");\r\n\r\n\t\tPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n\r\n\t\tapplication.create();\r\n\t\tapplication.on(\"application-can-run\", () => application.run());\r\n\r\n\t\tawait application.initialize();\r\n\t}\r\n\r\n}\r\n","import { Bootstrapper } from \"./bootstrapper.js\";\r\n\r\nArray.prototype.pushChain = function (...entries)\r\n{\r\n\tthis.push(...entries);\r\n\r\n\treturn this;\r\n};\r\n\r\nArray.prototype.unique = function ()\r\n{\r\n\treturn this.filter((value, index, self) => self.indexOf(value) === index);\r\n};\r\n\r\nObject.prototype.forEach = function (callback)\r\n{\r\n\tfor (let key in this)\r\n\t\tif (this.hasOwnProperty(key))\r\n\t\t\tcallback(this[key], key);\r\n};\r\n\r\nPIXI.Container.prototype.updateLayerOrder = function ()\r\n{\r\n\tlet i = 0;\r\n\r\n\tthis.children.sort((a, b) =>\r\n\t{\r\n\t\tlet az = a.z || 0;\r\n\t\tlet bz = b.z || 0;\r\n\r\n\t\tif (az === bz)\r\n\t\t\treturn this.children.indexOf(a) - this.children.indexOf(b);\r\n\r\n\t\treturn az - bz;\r\n\t});\r\n};\r\n\r\nBootstrapper.init().then(() =>\r\n{\r\n});\r\n"],"names":["selector","document","slice","call","container","querySelectorAll","base","x","y","width","height","Texture","frame","Rectangle","texture","target","interactive","data","pos","on","evt","getLocalPosition","simpleDraggableTarget","getDraggableRegion","parent","newX","p","newY","getDraggingRegion","bounds","position","instance","callback","path","deliveryRoot","library","config","loader","isInitializerLoader","add","configUrl","getResource","LOADED_CONFIGS","application","debug","resolve","load","isLibraryLoaded","Promise","LOADED_LIBS","LOADING_LIBS","libraryUrl","use","asset","next","name","then","id","getActions","querySelector","definition","attributes","forEach","attribute","value","getTexture","Sprite","center","sprite","err","LOADED_TEXTURES","promise","PIXI","fromImage","getPartSets","push","activePart","getAttribute","result","geometryId","direction","isNaN","getAnimations","parseInt","bodypart","string","replace","matches","contents","context","key","object","keyParts","split","current","keyPart","g","points","thickness","beginFill","lineStyle","moveTo","lineTo","endFill","a","b","row","column","tiles","getSurroundings","findIndex","getTile","tileNorthEast","tileNorthWest","tileHeight","filter","length","Math","abs","round","max","floor","Logger","error","FigureString","figure","_parts","parse","type","this","hasPartType","map","sort","localeCompare","part","color","parts","join","str","Avatar","geometry","avatarSet","initialBuild","canPoof","window","performance","now","loaders","Loader","needsUpdate","partContainer","Container","addChild","_this","_alsoUpdate","_ticker","_width","_height","_actions","defaultAction","_frames","headDirection","build","_avatarSet","_direction","_figure","poof","_geometry","_headDirection","action","getAction","pushChain","indexOf","actionsSorted","found","hasAction","dir","isBuilding","emit","invalidate","getLibraries","_loading","libraries","shift","_this2","download","update","getGeometry","activePartSets","getActivePartSets","unique","actions","bodyparts","settype","parentNode","lib","toLowerCase","getFigureData","set","getElementsByTagName","colorable","hiddenlayers","paletteid","setHiddenlayers","layer","partType","_this3","_sprites","decideGeometry","gatherParts","extras","AnimatedSprite","avatarResources","cx","cy","cloud","anchor","animationSpeed","loop","hitArea","play","removeChild","clouds","setTimeout","cacheAsBitmap","alpha","hasActivePartSet","draworderId","querySelectorAllArray","getDraworder","draworder","children","updateAction","render","avatarParts","loadingAvatar","getBodyparts","_this7","radiusComparator","partset","items","setType","partDirection","item","partDirectionWithoutFlip","partTypeWithoutFlip","partSwapped","removeSetType","flippedSetType","frames","partFrames","def","hasAttribute","i","repeats","number","assetpartdefinition","partFlipped","partFrame","Object","values","partAction","partValidActions","offsets","getAnimationOffset","generateAssetName","getSprite","opf","opa","offset","animationOffset","scale","colors","colorindex","fdColor","tint","textContent","index","destroy","getManager","AvatarManager","removeAvatar","Manager","_name","constructor","display","stage","log","warn","avatars","lastUpdate","once","initializeRenderer","loadAvatarClothingConfig","loadAvatarClothingLibrary","image","onGameTick","options","avatar","ticker","lastTime","ConfigManager","onConfigLoaded","defaultValue","findKey","evaluateString","assign","I18nManager","texts","onTextsLoaded","text","LoadingBar","barHeight","barThickness","barWidth","percentage","_percentage","clear","drawRoundedRect","Graphics","LoadingView","loadingBar","logo","init","loadResources","style","TextStyle","Text","onResourcesLoaded","visible","state","progress","drawRect","getString","Display","dpi","devicePixelRatio","mount","innerHTML","initApp","initEvents","onTick","delta","app","renderer","view","Application","innerHeight","innerWidth","appendChild","addEventListener","onWindowResize","updateLayerOrder","resize","utils","EventEmitter","BottomBar","background","interfaceResources","bottomBar","meButton","navigatorButton","friendsButton","chatButton","catalogueButton","inventoryButton","helpButton","draw","size","BottomBarButton","textures","buttonMode","BottomBarButtonMe","newAvatar","addAction","BottomBarButtonAnimatedHover","onPointerOver","onPointerOut","BottomBarButtonCatalogue","catalogue","getTextureFromRectangle","BottomBarButtonChat","chat","BottomBarButtonFriends","chatMessages","friends","BottomBarButtonHelp","friendsInvited","help","BottomBarButtonInventory","inventory","BottomBarButtonNavigator","navigator","ChatBubble","_avatarHolder","onAvatarHover","onAvatarLeave","_avatar","_chatBubble","chatBubble","onChatBubbleHover","onChatBubbleLeave","drawCircle","removeAction","imLeft","left","imMiddle","TilingSprite","middle","imRight","right","Window","z","bg","title","titleText","trim","filters","withInstance","DropShadowFilter","blur","distance","rotation","currentAnimation","anime","finished","contentOffset","old","contentMargin","Easings","InterfaceContainer","hello","SwiftOut","localInterface","InterfaceManager","TileBase","onClick","onMouseOver","onMouseOut","StairsSouth","StairsSouthEast","allPoints","step","ay","Point","tileWidth","ax","StairsSouthWest","_this4","Tile","_this5","furniResources","FurniManager","furniName","_loadingSprite","loading","TileCursor","WallBase","floorThickness","wallThickness","top","doorHeight","wallHeight","WallColumn","doorMode","tileHeightHalf","tileWidthHalf","hole","WallCorner","WallRow","RoomView","_entities","_heightmap","_tiles","columns","rows","highest","lowest","roomScale","tileCursor","floorplan","clearEverything","char","heightmap","h","getHighestAndLowest","doors","getTileHeight","isDoor","stairsType","getStairsType","implementation","getTileImplementation","wallC","needsWallC","wallR","needsWallR","getX","getY","getRealZ","isDoorColumn","isDoorRow","isADoor","tileHeightLocal","getDoorDirection","wi","wallImplementations","entities","wall","tile","debugDoor","onTileClick","onTileHover","onTileLeave","centerRoom","entity","associateEntityToTile","DecelerationCurve","getEntityPosition","animate","reduce","acc","cur","yred","xred","random","getRoomOffsets","isStairs","getZ","isValidTile","getRandomTile","currentHover","hover","roomAssets","getDeliveryAssetsUrl","localRoomViewer","RoomManager","roomViewer","assets","manifest","visualization","removeAllListeners","ensureRoomViewerIsMounted","prepareHeightmap","figures","randomFigure","heightMaps","hotelViewAssets","HotelView","skyline","hotel","HotelViewManager","onApplicationLoadingDone","_hotelView","hotelView","humans","RoomUser","heading","getHeading","teleportTo","currentTime","nextColumn","nextRow","walk","InitializerLoader","urls","url","cb","valid","promises","_display","_loader","managers","addManager","manager","managerClass","find","loadingView","addDefaultManagers","initialize","realLoad","onLoadingStage0Done","onLoadingStage1Done","avatarManager","roomManager","hotelViewManager","interfaceManager","open","nav","interface","opened","close","animateBuildingTiles","walkTo","showRoomViewer","getDoorTile","human","addEntityToTile","removeEntity","removeRoomViewer","theRandomFigure","resource","resources","Bootstrapper","settings","SCALE_MODE","SCALE_MODES","NEAREST","create","run","Array","prototype","self","hasOwnProperty","bz","az"],"mappings":"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"}